(()=>{var zt=Object.create;var D=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Et=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var Mt=(c,e,t)=>e in c?D(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var F=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports);var kt=(c,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Nt(e))!Ft.call(c,s)&&s!==t&&D(c,s,{get:()=>e[s],enumerable:!(i=St(e,s))||i.enumerable});return c};var rt=(c,e,t)=>(t=c!=null?zt(Et(c)):{},kt(e||!c||!c.__esModule?D(t,"default",{value:c,enumerable:!0}):t,c));var h=(c,e,t)=>(Mt(c,typeof e!="symbol"?e+"":e,t),t);var ht=F((fe,At)=>{At.exports=""});var lt=F((ye,Ct)=>{Ct.exports=`<div>\r
    Check Console\r
    <button>Run</button>\r
</div>`});var dt=F((we,Rt)=>{Rt.exports='<canvas height="100%" width="100%"></canvas>'});var ct=F((Ne,qt)=>{qt.exports="<button>Click</button>"});var ft=F((Me,Lt)=>{Lt.exports="<input></input>"});var pt=F((Be,jt)=>{jt.exports=`<div>Test worked!</div>\r
<button>Clickme</button>`});var ut=F((Re,$t)=>{$t.exports="<table></table>"});var K=F(gt=>{var Gt={debug:!1,protocol:"http",host:"localhost",port:8080,socket_protocol:"ws",hotreload:5e3,python:7e3,python_node:7001,startpage:"spectrometer.html",errpage:"src/other/404.html",certpath:"node_server/ssl/cert.pem",keypath:"node_server/ssl/key.pem"};gt.settings=Gt});var mt=F((Le,Xt)=>{Xt.exports=`\r
`});var yt=F((Ie,Zt)=>{Zt.exports=""});var xt=F((Ge,Ut)=>{Ut.exports='<canvas height="100%" width="100%"></canvas>'});var vt=F((Ue,Kt)=>{Kt.exports=`<div style="position:absolute">\r
    <input type="color" id="colorwheel">\r
    <button id="zoomin">Zoom +</button>\r
    <button id="zoomout">Zoom -</button>\r
    <button id="panleft">Left</button>\r
    <button id="panright">Right</button>\r
    <button id="panup">Up</button>\r
    <button id="pandown">Down</button>\r
</div>\r
<canvas height="100%" width="100%"></canvas>`});var bt=F((ti,te)=>{te.exports='<canvas height="100%" width="100%" style="position:absolute;"></canvas>'});var wt=F((hi,ie)=>{ie.exports=`<div style="z-index:10;">\r
    <button id="webcam">Webcam</button>\r
    <button id="image">Image</button>\r
    <select id="imgselect">\r
        <option value="src/assets/spectrum_full.png" selected>Full Image</option>\r
        <option value="src/assets/spectrum1.jpg">Spectrum 1</option>\r
        <option value="src/assets/spectrum2.jpg">Spectrum 2</option>\r
    </select>\r
    <input type="url" id="imgurl" placeholder="Image URL"></input>\r
    <button id="setImgUrl">Set Image URL</button>\r
    <input type="url" id="videourl" placeholder="Video URL"></input>\r
    <button id="setVideoUrl">Set Video URL</button>\r
</div>\r
<div height="100%" width="100%">\r
    <canvas id="picker" style="position:absolute; z-index:3;" height="100%" width="100%"></canvas>\r
    <img src="" style="position:absolute; z-index:1;" width="100%" height="100%"></img>\r
    <video src="" style="position:absolute; display:none; z-index:2;" height="100%" width="100%"></video>\r
</div>\r
<div style="z-index:11; color:white; position:absolute; top:100vh;">\r
    Results:<br>\r
    <canvas id="capture"></canvas>\r
    <canvas id="graph"></canvas>\r
</div>`});var k=class extends HTMLElement{constructor(){super();h(this,"template",t=>`<div> Custom Fragment Props: ${JSON.stringify(t)} </div>`);h(this,"props",{test:!0});h(this,"useShadow",!1);h(this,"oncreate");h(this,"onresize");h(this,"ondelete");h(this,"onchanged");h(this,"FRAGMENT");h(this,"attachedShadow",!1);h(this,"obsAttributes",["props","options","onchanged","onresize","ondelete","oncreate","template"]);h(this,"delete",()=>{this.remove(),typeof this.ondelete=="function"&&this.ondelete(this.props)});h(this,"render",(t=this.props)=>{typeof this.template=="function"?this.templateString=this.template(t):this.templateString=this.template;let i=document.createElement("template");i.innerHTML=this.templateString;let s=i.content;this.FRAGMENT&&(this.useShadow?this.shadowRoot.removeChild(this.FRAGMENT):this.removeChild(this.FRAGMENT)),this.useShadow?(this.attachedShadow||this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(s),this.FRAGMENT=this.shadowRoot.childNodes[this.shadowRoot.childNodes.length-1]):this.appendChild(s),this.FRAGMENT=this.childNodes[this.childNodes.length-1],this.oncreate&&this.oncreate(t)});h(this,"state",{pushToState:{},data:{},triggers:{},setState(t){if(Object.assign(this.pushToState,t),Object.keys(this.triggers).length>0)for(let i of Object.getOwnPropertyNames(this.triggers))this.pushToState[i]&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(s=>{s.onchanged(this.data[i])}));return this.pushToState},subscribeTrigger(t,i=s=>{}){if(t){this.triggers[t]||(this.triggers[t]=[]);let s=this.triggers[t].length;return this.triggers[t].push({idx:s,onchanged:i}),this.triggers[t].length-1}else return},unsubscribeTrigger(t,i){let s,n=this.triggers[t];if(n)if(!i)delete this.triggers[t];else return n.find(a=>{if(a.idx===i)return!0})&&n.splice(s,1),!0},subscribeTriggerOnce(t=void 0,i=s=>{}){let s,n=o=>{i(o),this.unsubscribeTrigger(t,s)};s=this.subscribeTrigger(t,n)}})}get observedAttributes(){return this.obsAttributes}get obsAttributes(){return this.obsAttributes}set obsAttributes(t){typeof t=="string"?this.obsAttributes.push(t):Array.isArray(t)&&(this.obsAttributes=t)}static get tag(){return this.name.toLowerCase()+"-"}static addElement(t=this.tag,i=this,s=void 0){B(i,t,s)}attributeChangedCallback(t,i,s){if(t==="onchanged"){let n=s;if(typeof n=="string"&&(n=R(n)),typeof n=="function"){this.onchanged=n,this.state.data.props=this.props,this.state.unsubscribeTrigger("props"),this.state.subscribeTrigger("props",this.onchanged);let o=new CustomEvent("changed",{detail:{props:this.props}});this.state.subscribeTrigger("props",()=>{this.dispatchEvent(o)})}}else if(t==="onresize"){let n=s;if(typeof n=="string"&&(n=R(n)),typeof n=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=o=>{this.onresize(this.props)},this.onresize=n,window.addEventListener("resize",this.ONRESIZE)}}else if(t==="ondelete"){let n=s;typeof n=="string"&&(n=R(n)),typeof n=="function"&&(this.ondelete=()=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),n&&n(this.props)})}else if(t==="oncreate"){let n=s;typeof n=="string"&&(n=R(n)),typeof n=="function"&&(this.oncreate=n)}else if(t==="props"){let n=s;typeof n=="string"&&(n=JSON.parse(n)),Object.assign(this.props,n),this.state.setState({props:this.props})}else if(t==="template"){let n=s;this.template=options.template,typeof n=="function"?this.templateString=this.template(this.props):this.templateString=n,this.render(this.props);let o=new CustomEvent("created",{detail:{props:this.props}});this.dispatchEvent(o)}else{let n=s;if(t.includes("eval_"))t=t.split("_"),t.shift(),t=t.join(),n=R(s);else if(typeof s=="string")try{n=JSON.parse(s)}catch{n=s}this[t]=n,this.props[t]=n}}connectedCallback(){let t=this.getAttribute("props");typeof t=="string"&&(t=JSON.parse(t)),Object.assign(this.props,t),this.state.setState({props:this.props}),Array.from(this.attributes).forEach(a=>{let r=a.name,d=a.value;if(r.includes("eval_"))r=r.split("_"),r.shift(),r=r.join(),d=R(a.value);else if(typeof a.value=="string")try{d=JSON.parse(a.value)}catch{d=a.value}this[r]||Object.defineProperties(this,a,{value:d,writable:!0,get(){return this[r]},set(f){this.setAttribute(r,f)}}),this[r]=d,this.props[r]=d,this.obsAttributes.push(r)});let i=new CustomEvent("resized",{detail:{props:this.props}}),s=new CustomEvent("changed",{detail:{props:this.props}}),n=new CustomEvent("deleted",{detail:{props:this.props}}),o=new CustomEvent("created",{detail:{props:this.props}});if(this.render(this.props),this.dispatchEvent(o),this.state.subscribeTrigger("props",()=>{this.dispatchEvent(s)}),typeof this.onresize=="function"){if(this.ONRESIZE)try{window.removeEventListener("resize",this.ONRESIZE)}catch{}this.ONRESIZE=a=>{this.onresize(this.props)},window.addEventListener("resize",this.ONRESIZE)}if(typeof this.ondelete=="function"){let a=this.ondelete;this.ondelete=(r=this.props)=>{this.ONRESIZE&&window.removeEventListener("resize",this.ONRESIZE),this.state.unsubscribeTrigger("props"),a(r)}}typeof this.onchanged=="function"&&(this.state.data.props=this.props,this.state.subscribeTrigger("props",this.onchanged))}get props(){return this.props}set props(t={}){this.setAttribute("props",t)}get template(){return this.template}set template(t){this.setAttribute("template",t)}get render(){return this.render}get delete(){return this.delete}get state(){return this.state}get onchanged(){return this.onchanged}set onchanged(t){this.setAttribute("onchanged",t)}get onresize(){return this.props}set onresize(t){this.setAttribute("onresize",t)}get ondelete(){return this.props}set ondelete(t){this.setAttribute("ondelete",t)}get oncreate(){return this.oncreate}set oncreate(t){this.setAttribute("oncreated",t)}};function B(c,e,t=null){try{t?e?window.customElements.define(e,c,{extends:t}):window.customElements.define(c.name.toLowerCase()+"-",c,{extends:t}):e?window.customElements.define(e,c):window.customElements.define(c.name.toLowerCase()+"-",c)}catch{}}function re(c=""){return c+Math.floor(Math.random()*1e15)}function R(method){let getFunctionBody=c=>c.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=c=>{let e=c.indexOf(")");return c.slice(0,c.indexOf("{",e)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;try{if(newFuncHead.includes("function ")){let c=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(c,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let c=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(c,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else try{newFunc=eval(newFuncHead+newFuncBody+"}")}catch(err){newFunc=eval(method)}}catch(c){}return newFunc}var at={pushToState:{},data:{},triggers:{},setState(c){if(Object.assign(this.pushToState,c),Object.keys(this.triggers).length>0)for(let e of Object.getOwnPropertyNames(this.triggers))this.pushToState[e]&&(this.data[e]=this.pushToState[e],delete this.pushToState[e],this.triggers[e].forEach(t=>{t.onchange(this.data[e])}));return this.pushToState},subscribeTrigger(c,e=t=>{}){if(c){this.triggers[c]||(this.triggers[c]=[]);let t=this.triggers[c].length;return this.triggers[c].push({idx:t,onchange:e}),this.triggers[c].length-1}else return},unsubscribeTrigger(c,e){let t,i=this.triggers[c];if(i)if(!e)delete this.triggers[c];else return i.find(n=>{if(n.idx===e)return!0})&&i.splice(t,1),!0},subscribeTriggerOnce(c=void 0,e=t=>{}){let t,i=s=>{e(s),this.unsubscribeTrigger(c,t)};t=this.subscribeTrigger(c,i)}},L=class{constructor(){h(this,"state",at);h(this,"nodes",new Map);h(this,"nNodes",0);h(this,"runNode",this.run)}convertChildrenToNodes(e){e.convertChildrenToNodes(e)}addNode(e={}){return new E(e,void 0,this)}getNode(e){return this.nodes.get(e)}run(e,t,i){if(typeof e=="string"&&(e=this.nodes.get(e)),e)return e.run(t,e,i)}removeTree(e){if(typeof e=="string"&&(e=this.nodes.get(e)),e){let t=function(i){i.children&&(Array.isArray(i.children)?i.children.forEach(s=>{s.stopNode&&s.stopNode(),s.tag&&this.nodes.get(s.tag)&&this.nodes.delete(s.tag),this.nodes.forEach(n=>{n.nodes.get(s.tag)&&n.nodes.delete(s.tag)}),t(s)}):typeof i.children=="object"&&(i.stopNode&&i.stopNode(),i.tag&&this.nodes.get(i.tag)&&this.nodes.delete(i.tag),this.nodes.forEach(s=>{s.nodes.get(i.tag)&&s.nodes.delete(i.tag)}),t(i)))};e.stopNode&&e.stopNode(),e.tag&&(this.nodes.delete(e.tag),this.nodes.forEach(i=>{i.nodes.get(e.tag)&&i.nodes.delete(e.tag)}),t(e))}}removeNode(e){typeof e=="string"&&(e=this.nodes.get(e)),e?.tag&&this.nodes.delete(e.tag),e?.tag&&this.nodes.get(e.tag)&&(this.nodes.delete(e.tag),this.nodes.forEach(t=>{t.nodes.get(e.tag)&&t.nodes.delete(e.tag)}))}appendNode(e={},t){t.addChildren(e)}async callParent(e,t,i=e,s){if(e?.parent)return await e.callParent(t,e.parent,i,s)}async callChildren(e,t,i=e,s,n){if(e?.children)return await e.callChildren(t,i,s,n)}subscribe(e,t=i=>{}){return this.state.subscribeTrigger(e,t)}unsubscribe(e,t){this.state.unsubscribeTrigger(e,t)}subscribeNode(e,t){return this.state.subscribeTrigger(e.tag,i=>{this.run(t,i,this)})}create(e=(s,n,o,a)=>{},t,i){return Pt(e,t,i,this)}print(e,t=!0){if(e instanceof E)return e.print(e,t)}reconstruct(e="{}"){let t=G(e);t&&this.addNode(t)}},E=class{constructor(e={},t,i){h(this,"tag");h(this,"parent");h(this,"children");h(this,"graph");h(this,"state",at);h(this,"nodes",new Map);h(this,"ANIMATE","animate");h(this,"LOOP","loop");h(this,"looper");h(this,"animation");!e.tag&&i?e.tag=`node${i.nNodes}`:e.tag||(e.tag=`node${Math.floor(Math.random()*1e10)}`),Object.assign(this,e),this.parent=t,this.graph=i,i&&(i.nNodes++,i.nodes.set(e.tag,this)),this.children&&this.convertChildrenToNodes(this)}operator(e,t=this,i,s){return e}async runOp(e,t=this,i,s){let n=await this.operator(e,t,i,s);return this.tag&&this.state.setState({[this.tag]:n}),n}runNode(e,t,i){if(typeof e=="string"&&(e=this.nodes.get(e)),e)return e.run(t,e,i)}run(e,t=this,i){if(typeof t=="string"){let s;if(this.graph&&(s=this.graph.nodes.get(t)),s||(s=this.nodes.get(t)),t=s,!t)return}return new Promise(async s=>{if(t){let n=(a,r,d=0)=>new Promise(async f=>{d++;let l=await a.runOp(r,a,i,d);if(typeof a.repeat=="number"){for(;d<a.repeat;){if(a.delay){setTimeout(async()=>{f(await n(a,r,d))},a.delay);break}else if(a.frame&&requestAnimationFrame){requestAnimationFrame(async()=>{f(await n(a,r,d))});break}else l=await a.runOp(r,a,i,d);d++}if(d===a.repeat){f(l);return}}else if(typeof a.recursive=="number"){for(;d<a.recursive;){if(a.delay){setTimeout(async()=>{f(await n(a,l,d))},a.delay);break}else if(a.frame&&requestAnimationFrame){requestAnimationFrame(async()=>{f(await n(a,l,d))});break}else l=await a.runOp(l,a,i,d);d++}if(d===a.recursive){f(l);return}}else{f(l);return}}),o=async()=>{let a=await n(t,e);if(t.backward&&t.parent&&await this.runNode(t.parent,a,t),t.children&&t.forward)if(Array.isArray(t.children))for(let r=0;r<t.children.length;r++)await this.runNode(t.children[r],a,t);else await this.runNode(t.children,a,t);return t.animate&&!t.isAnimating&&this.runAnimation(this.animation,e,t,i),typeof t.loop=="number"&&!t.isLooping&&this.runLoop(this.looper,e,t,i),a};t.delay?setTimeout(async()=>{s(await o())},t.delay):t.frame&&requestAnimationFrame?requestAnimationFrame(async()=>{s(await o())}):s(await o())}else s(void 0)})}runAnimation(e=this.animation,t,i=this,s){if(this.animation=e,e||(this.animation=this.operator),i.animate&&!i.isAnimating){i.isAnimating=!0;let n=async()=>{if(i.isAnimating){let o=await this.animation(t,i,s,this.ANIMATE);if(this.tag&&typeof o<"u"&&(this.state.setState({[this.tag]:o}),i.backward&&i.parent&&await this.runNode(i.parent,o,i),i.children&&i.forward))if(Array.isArray(i.children))for(let a=0;a<i.children.length;a++)await this.runNode(i.children[a],o,i);else await this.runNode(i.children,o,i);requestAnimationFrame(async()=>{await n()})}};requestAnimationFrame(n)}}runLoop(e=this.looper,t,i=this,s){if(this.looper=e,e||(this.looper=this.operator),typeof i.loop=="number"&&!i.isLooping){i.isLooping=!0;let n=async()=>{if(i.looping){let o=await this.looper(t,i,s);if(this.tag&&typeof o<"u"&&(this.state.setState({[this.tag]:o}),i.backward&&i.parent&&await this.runNode(i.parent,o,i),i.children&&i.forward))if(Array.isArray(i.children))for(let a=0;a<i.children.length;a++)await this.runNode(i.children[a],o,i);else await this.runNode(i.children,o,i);setTimeout(async()=>{await n()},i.loop)}}}}setOperator(e=function(i,s=this,n,o){return i}){this.operator=e}setParent(e){this.parent=e}setChildren(e){this.children=e}removeTree(e){if(typeof e=="string"&&(e=this.nodes.get(e)),e){let t=function(i){i.children&&(Array.isArray(i.children)?i.children.forEach(s=>{s.stopNode&&s.stopNode(),s.tag&&this.nodes.get(s.tag)&&this.nodes.delete(s.tag),this.nodes.forEach(n=>{n.nodes.get(s.tag)&&n.nodes.delete(s.tag)}),t(s)}):typeof i.children=="object"&&(i.stopNode&&i.stopNode(),i.tag&&this.nodes.get(i.tag)&&this.nodes.delete(i.tag),this.nodes.forEach(s=>{s.nodes.get(i.tag)&&s.nodes.delete(i.tag)}),t(i)))};e.stopNode&&e.stopNode(),e.tag&&(this.nodes.delete(e.tag),this.nodes.forEach(i=>{i.nodes.get(e.tag)&&i.nodes.delete(e.tag)}),t(e),this.graph&&this.graph.nodes.removeTree(e))}}addNode(e={}){let t=new E(e,this,this.graph);return this.nodes.set(convertedtag,t),this.graph&&this.graph.nodes.set(t.tag,t),t}removeNode(e){typeof e=="string"&&(e=this.nodes.get(e)),e?.tag&&this.nodes.delete(e.tag),e?.tag&&this.nodes.get(e.tag)&&(this.nodes.delete(e.tag),this.graph&&this.graph.nodes.delete(e.tag),this.nodes.forEach(t=>{t.nodes.get(e.tag)&&t.nodes.delete(e.tag)}))}appendNode(e,t=this){typeof e=="string"&&(e=this.nodes.get(e)),e&&t.addChildren(e)}getNode(e){return this.nodes.get(e)}stopLooping(e=this){e.isLooping=!1}stopAnimating(e=this){e.isAnimating=!1}stopNode(e=this){e.stopAnimating(e),e.stopLooping(e)}addChildren(e){this.children||(this.children=[]),!Array.isArray(this.children)&&this.children?this.children=[this.children]:Array.isArray(e)?this.children.push(...e):this.children.push(e)}convertChildrenToNodes(e=this){if(e.children?.name==="GraphNode")this.graph?.nodes.get(e.tag)||this.graph.nodes.set(e.tag,e),this.nodes.get(e.tag)||this.nodes.set(e.tag,e);else if(Array.isArray(e.children))for(let t=0;t<e.children.length;t++)if(e.children[t].name==="GraphNode"){this.graph?.nodes.get(e.children[t].tag)||this.graph.nodes.set(e.children[t].tag,e.children[t]),this.nodes.get(e.children[t].tag)||this.nodes.set(e.children[t].tag,e.children[t]);continue}else typeof e.children[t]=="object"?(e.children[t]=new E(e.children[t],e,this.graph),this.nodes.set(e.children[t].tag,e.children[t]),this.convertChildrenToNodes(e.children[t])):typeof e.children[t]=="string"&&(this.graph&&(e.children[t]=this.graph.getNode(e.children[t]),this.nodes.get(e.children[t].tag)||this.nodes.set(e.children[t].tag,e.children[t])),e.children[t]||(e.children[t]=this.nodes.get(e.children[t])));else typeof e.children=="object"?(e.children=new E(e.children,e,this.graph),this.nodes.set(e.children.tag,e.children),this.convertChildrenToNodes(e.children)):typeof e.children=="string"&&(this.graph&&(e.children=this.graph.getNode(e.children),this.nodes.get(e.children.tag)||this.nodes.set(e.children.tag,e.children)),e.children||(e.children=this.nodes.get(e.children)));return e.children}async callParent(e,t=this,i){if(typeof this.parent?.operator=="function")return await this.parent.runOp(e,this.parent,t,i)}async callChildren(e,t=this,i,s){let n;if(Array.isArray(this.children))if(s)n=await this.children[s]?.runOp(e,this.children[s],t,i);else{n=[];for(let o=0;o<this.children.length;o++)n.push(await this.children[o]?.runOp(e,this.children[o],t,i))}else this.children&&(n=await this.children.runOp(e,this.children,t,i));return n}setProps(e={}){Object.assign(this,e)}subscribe(e=i=>{},t=this.tag){return e instanceof E?this.subscribeNode(e):this.state.subscribeTrigger(t,e)}unsubscribe(e,t=this.tag){this.state.unsubscribeTrigger(t,e)}subscribeNode(e,t=this.tag){return this.state.subscribeTrigger(t,i=>{this.runNode(e,i,this)})}print(e=this,t=!0,i=[]){let s=new E;i.push(e.tag);let n={tag:e.tag,operator:e.operator.toString()};e.parent&&(n.parent=e.parent.tag),e.children&&(Array.isArray(e.children)?e.children=e.children.map(o=>typeof o=="string"?o:i.includes(o.tag)?o.tag:t?o.print(o,t,i):o.tag):typeof e.children=="object"?(t||(n.children=[e.children.tag]),i.includes(e.children.tag)?n.children=[e.children.tag]:n.children=[e.children.print(e.children,t,i)]):typeof e.children=="string"&&(n.children=[e.children]));for(let o in e)o==="parent"||o==="children"||typeof s[o]>"u"&&(typeof e[o]=="function"?n[o]=e[o].toString():typeof e[o]=="object"?n[o]=JSON.stringifyWithCircularRefs(e[o]):n[o]=e[o]);return JSON.stringify(n)}reconstruct(e="{}"){let t=G(e);t&&this.addNode(t)}};function Pt(c,e,t,i){return typeof t=="object"?(t.operator=c,new E(t,e,i)):new E({operator:c},e,i)}function de(c="{}",e,t){let i=G(c);if(i)return new E(i,e,t)}function G(c="{}"){try{let t=function(i){for(let s in i)if(typeof i[s]=="string"){let n=Tt(i[s]);typeof n=="function"&&(i[s]=n)}else typeof i[s]=="object"&&t(i[s]);return i},e=JSON.parse(c);return t(e)}catch(e){console.error(e);return}}JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=function(){let c=new Map,e=[],t=["this"];function i(){c.clear(),e.length=0,t.length=1}function s(o,a){var r=e.length-1,d=e[r];if(typeof d=="object")if(d[o]===a||r===0)t.push(o),e.push(a.pushed);else for(;r-->=0;){if(d=e[r],typeof d=="object"&&d[o]===a){r+=2,e.length=r,t.length=r,--r,e[r]=a,t[r]=o;break}r--}}function n(o,a){if(a!=null&&typeof a=="object"){o&&s(o,a);let r=c.get(a);if(r)return"[Circular Reference]"+r;c.set(a,t.join("."))}return a}return function(a,r){try{return e.push(a),JSON.stringify(a,n,r)}finally{i()}}}());function Tt(method=""){let getFunctionBody=c=>c.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=c=>{let e=c.indexOf(")");return c.slice(0,c.indexOf("{",e)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;if(newFuncHead.includes("function ")){let c=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(c,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let c=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(c,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else newFunc=eval(newFuncHead+newFuncBody+"}");return newFunc}var Bt=ht(),S=class extends k{constructor(){super(...arguments);h(this,"props",{operator:(t,i,s,n)=>(console.log(t),t),forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!1,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"input_delay",1);h(this,"template",Bt);h(this,"render",(t=this.props)=>{typeof this.template=="function"?this.templateString=this.template(t):this.templateString=this.template;let i=document.createElement("template");i.innerHTML=this.templateString;let s=i.content;this.fragment&&this.removeChild(this.fragment),this.fragment=s,this.appendChild(s),this.setupNode(this.props),this.props.input&&setTimeout(async()=>{this.props.node.runNode(this.props.node,this.props.input,this.props.graph)},this.input_delay),this.oncreate&&this.oncreate(t)})}setupNode(t){let i=this.parentNode;if(i.props?.operator&&i.props?.node&&(t.parent=i.props.node),!t.graph){for(;!i.props?.nodes&&!(i.constructor.name==="HTMLBodyElement"||i.constructor.name==="HTMLHeadElement"||i.constructor.name==="HTMLHtmlElement"||i.constructor.name==="HTMLDocument");)i=i.parentNode;i.props?.nodes&&(t.graph=i.props.graph,t.input_delay=i.props.input_delay)}this.id&&!t.tag&&(t.tag=this.id),t.graph&&!t.node&&t.tag?t.node=t.graph.nodes.get(t.tag):t.graph&&typeof t.node=="string"&&(t.node=t.graph.nodes.get(t.node)),t.node||(t.node=new E(t,t.parent,t.graph)),t.tag=t.node.tag,this.id||(this.id=t.tag),t.parent&&t.parent.addChildren(t.node)}};S.addElement("graph-node");var Ot=lt(),X=class extends k{constructor(){super();h(this,"props",{graph:new L,nodes:[]});h(this,"input_delay",1);h(this,"template",Ot);setTimeout(()=>{let t=Array.from(this.children),i=[];t?.length>0&&t.forEach(s=>{s.props&&this.props.nodes.push(s.props.node),s.props&&s.parentNode.tagName===this.tagName&&i.push(s)}),this.children_ready(t,i)},this.input_delay)}children_ready(t=[],i=[]){this.querySelector("button").onclick=()=>{i.forEach(s=>{s.props.node.runNode(s.props.node)})}}};X.addElement("acyclic-graph");var _t=dt(),Y=class extends S{constructor(){super(...arguments);h(this,"props",{operator:(t,i,s,n)=>{if(n==="animate"){this.draw(t,i,s,n);for(let o=0;o<this.drawFuncs.length;o++){let a=this.drawFuncs[o];typeof a=="function"&&a(t,i,s,n)}}},forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!0,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",_t);h(this,"drawFuncs",[]);h(this,"oncreate",t=>{this.canvas=this.querySelector("canvas"),t.width&&(this.canvas.width=t.width,this.canvas.style.width=t.width),t.height&&(this.canvas.height=t.height,this.canvas.style.height=t.height),t.style&&(this.canvas.style=t.style,setTimeout(()=>{this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth},10)),t.canvas=this.canvas,t.context?t.context=this.canvas.getContext(t.context):t.context=this.canvas.getContext("2d"),this.context=t.context,this.ctx=this.context,t.ctx=this.context,setTimeout(()=>{t.animate&&t.node.runAnimation()},10)});h(this,"onresize",t=>{this.canvas&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.style.width=this.canvas.clientWidth,this.canvas.style.height=this.canvas.clientHeight)})}draw(t,i,s,n){let o=this.props.canvas,a=this.props.ctx}addDraw(t){typeof t=="function"&&this.drawFuncs.push(t)}};Y.addElement("canvas-node");var Ht=ct(),Z=class extends S{constructor(){super(...arguments);h(this,"props",{operator:(t,i,s,n)=>(t&&(this.props.input=t),this.props.input),forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,animate:!1,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",Ht);h(this,"oncreate",t=>{let i=this.querySelector("button");i.onclick=s=>{t.node.run(t.input)}})}};Z.addElement("button-node");var Wt=ft(),J=class extends S{constructor(){super(...arguments);h(this,"props",{operator:(t,i,s,n)=>(this.props.input=t,t),forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,animate:!1,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",Wt);h(this,"oncreate",t=>{let i=this.querySelector("input");i.type=this.type,i.oninput=s=>{t.node&&t.node.callChildren(s.target.value)}})}};J.addElement("input-node");var It=pt(),U=class extends k{constructor(){super(...arguments);h(this,"props",{});h(this,"template",It);h(this,"oncreate",t=>{let i=this.querySelector("button"),s=this.querySelector("div");i&&(i.onclick=n=>{s.innerHTML="Clicked!"})})}};U.addElement("custom-");var Dt=ut(),V=class extends S{constructor(){super(...arguments);h(this,"log",(t,i=`<tr><td>${t}</td></tr>`)=>{let s=document.createElement("template");s.innerHTML=i;let n=s.content;this.props.div||(this.props.div=this.querySelector("table"),this.props.scrollable&&(this.props.div.style.overflow="hidden")),this.props.messages.length>=this.props.max&&(this.props.messages.shift(),this.props.messagedivs[0].remove(),this.props.messagedivs.shift()),this.props.messages.push(t),this.props.div.appendChild(n);let o=this.querySelectorAll("tr");this.props.messagedivs.push(o[o.length-1]),this.props.messagedivs.length+2>=this.props.max&&(this.props.messagedivs[this.props.max-3]&&this.props.messagedivs.length===this.props.max&&(this.props.messagedivs[0].style.opacity="0.25"),this.props.messagedivs[this.props.max-2]&&(this.props.messagedivs.length===this.props.max?this.props.messagedivs[1].style.opacity="0.5":this.props.messagedivs[0].style.opacity="0.5"),this.props.messagedivs.length===this.props.max?this.props.messagedivs[2].style.opacity="0.75":this.props.messagedivs.length+1>=this.props.max?this.props.messagedivs[1].style.opacity="0.75":this.props.messagedivs[0].style.opacity="0.75")});h(this,"props",{messages:[],messagedivs:[],max:5,scrollable:!1,div:void 0,log:this.log,operator:(t,i,s,n)=>(console.log(t),t),forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!1,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",Dt);h(this,"oncreate",t=>{})}};V.addElement("logger-");var W=rt(K()),Yt=mt(),Q=class extends k{constructor(){super();h(this,"props",{protocol:W.settings.socket_protocol,host:W.settings.host,port:W.settings.python,subdomain:"",ws:void 0,logger:void 0});h(this,"template",Yt);h(this,"onmessage",async t=>{let i=new Date(Date.now()),s=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),n=t.data;t.data.constructor.name==="Blob"&&(n=await t.data.text());let o=`${s}:: WS ${this.props.host}:${this.props.port} message:
 ${n}`,a=`<tr><td style='color:lightgreen;'>${o}</tr></td>`;this.props.logger?this.props.logger.props.log(o,a):console.log(o)});h(this,"onopen");h(this,"onclose");h(this,"oncreate",t=>{t.logger?typeof t.logger=="string"&&(t.logger=document.getElementById(t.logger)):t.logger=document.querySelector("logger-");try{t.ws=new WebSocket(`${t.protocol}://${t.host}:${t.port}/${t.subdomain}`),t.ws.onmessage=this.onmessage,this.ws=t.ws,this.onopen&&t.ws.addEventListener("open",this.onopen),this.onclose&&t.ws.addEventListener("close",this.onclose),t.ws.onerror=i=>{t.ws.close()}}catch{}});h(this,"ondelete",t=>{t.ws.close()})}};B(Q,"socket-");var I=rt(K()),Jt=yt(),tt=class extends k{constructor(){super();h(this,"props",{protocol:I.settings.protocol,host:I.settings.host,port:I.settings.python,subdomain:"sse",sse:void 0,logger:void 0});h(this,"template",Jt);h(this,"onmessage",async t=>{let i=new Date(Date.now()),s=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),n=t.data;t.data.constructor.name==="Blob"&&(n=await t.data.text());let o=`${s}:: SSE ${this.props.host}:${this.props.port} message:
 ${n}`,a=`<tr><td style='color:yellow;'>${o}</tr></td>`;this.props.logger?this.props.logger.props.log(o,a):console.log(o)});h(this,"oncreate",t=>{t.logger?typeof t.logger=="string"&&(t.logger=document.getElementById(t.logger)):t.logger=document.querySelector("logger-");try{t.sse=new EventSource(`${t.protocol}://${t.host}:${t.port}/${t.subdomain}`),this.sse=t.sse,t.sse&&(t.sse.onmessage=this.onmessage),t.sse.onerror=i=>{console.error(i),t.sse.close()}}catch(i){console.error(i)}});h(this,"ondelete",t=>{t.sse.close()})}};B(tt,"sse-");var Vt=xt(),et=class extends S{constructor(){super(...arguments);h(this,"props",{radius:20,triggered:!1,operator:(t,i,s,n)=>{if(this.props.triggered||(this.props.radius+=Math.random()-.5),n==="animate"){this.draw();for(let o=0;o<this.drawFuncs.length;o++){let a=this.drawFuncs[o];typeof a=="function"&&a(t,i,s,n)}}else typeof t=="object"?(t.radius&&(this.props.radius+=t.radius),this.props.triggered=!0):typeof t=="number"?(this.props.radius+=t,this.props.triggered=!0):typeof t=="string"?(this.props.radius+=parseFloat(t),this.props.triggered=!0):(this.props.radius+=Math.random()-.5,this.props.triggered=!0)},forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!0,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",Vt);h(this,"drawFuncs",[]);h(this,"oncreate",t=>{this.canvas=this.querySelector("canvas"),t.width&&(this.canvas.width=t.width,this.canvas.style.height=t.height),t.height&&(this.canvas.height=t.height,this.canvas.style.height=t.height),t.style&&(this.canvas.style=t.style,setTimeout(()=>{this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth},10)),t.canvas=this.canvas,t.context?t.context=this.canvas.getContext(t.context):t.context=this.canvas.getContext("2d"),this.context=t.context,this.ctx=this.context,t.ctx=this.context,setTimeout(()=>{t.animate&&t.node.runAnimation()},10)});h(this,"onresize",t=>{this.canvas&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.style.width=this.canvas.clientWidth,this.canvas.style.height=this.canvas.clientHeight)})}draw(t,i,s,n){let o=this.props.canvas,a=this.props.ctx;this.props.radius<=1&&(this.props.radius=1),a.clearRect(0,0,o.width,o.height),this.drawCircle(o.width*.5,o.height*.5,this.props.radius,"green",5,"#003300")}addDraw(t){typeof t=="function"&&this.drawFuncs.push(t)}drawCircle(t,i,s,n="green",o=5,a="#003300"){this.props.ctx.beginPath(),this.props.ctx.arc(t,i,s,0,2*Math.PI,!1),this.props.ctx.fillStyle=n,this.props.ctx.fill(),this.props.ctx.lineWidth=o,this.props.ctx.strokeStyle=a,this.props.ctx.stroke()}drawLine(t={x:0,y:0},i={x:1,y:1},s=5,n="#003300"){this.props.ctx.beginPath(),this.props.ctx.lineWidth=s,this.props.ctx.strokeStyle=n,this.props.ctx.moveTo(t.x,t.y),this.props.ctx.lineTo(i.x,i.y),this.props.ctx.stroke()}};et.addElement("circlecanvas-node");var Qt=vt(),it=class extends S{constructor(){super(...arguments);h(this,"props",{colorPicked:"red",xSize:128,ySize:128,xPosition:1,yPosition:1,xPixelSize:5,yPixelSize:5,zoom:1,data:{},canvasClicked:this.canvasClicked,updated:{},operator:(t,i,s,n)=>{if(n==="update"&&Object.assign(this.props.data,t),n==="animate"){this.draw(t,i,s,n);for(let o=0;o<this.drawFuncs.length;o++){let a=this.drawFuncs[o];typeof a=="function"&&a(t,i,s,n)}}},forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!0,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",Qt);h(this,"drawFuncs",[]);h(this,"canvasClicked",(t,i)=>{let s=t,n=i,o=this.canvas.width*.5,a=this.canvas.height*.5,r=this.props.xPixelSize*this.props.zoom,d=this.props.yPixelSize*this.props.zoom,f=this.props.xPosition%this.props.xPixelSize,l=this.props.yPosition%this.props.yPixelSize,u=s-this.canvas.width*.5,w=n-this.canvas.height*.5,y=f;for(;y<o+u;)y+=r;y=(y-.5*(this.canvas.width-r*this.props.xSize))/r;let x=l;for(;x<a+w;)x+=d;x=(x-.5*(this.canvas.height-d*this.props.ySize))/d;let g=y+x*this.props.xSize;this.props.data[g]&&(this.props.updated[g]=this.props.colorPicked)});h(this,"oncreate",t=>{this.canvas=this.querySelector("canvas"),t.width&&(this.canvas.width=t.width,this.canvas.style.height=t.height),t.height&&(this.canvas.height=t.height,this.canvas.style.height=t.height),t.style&&(this.canvas.style=t.style,setTimeout(()=>{this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth,this.generateDataStructure(),this.props.xPosition=this.props.xPixelSize*this.props.xSize*.5,this.props.yPosition=this.props.yPixelSize*this.props.ySize*.5,this.drawSquare()},10)),t.canvas=this.canvas,t.context?t.context=this.canvas.getContext(t.context):t.context=this.canvas.getContext("2d"),this.context=t.context,this.ctx=this.context,t.ctx=this.context,this.canvas.onmousedown=i=>{this.canvasClicked(i.pageX-this.canvas.offsetLeft,i.pageY-this.canvas.offsetTop),this.canvas.onmousemove=s=>{this.canvasClicked(s.pageX-this.canvas.offsetLeft,s.pageY-this.canvas.offsetTop)},this.canvas.onmouseup=s=>{this.canvas.onmousemove=void 0}},this.querySelector("#zoomin").onclick=i=>{this.props.zoom+=.1,this.drawSquare()},this.querySelector("#zoomout").onclick=i=>{this.props.zoom-=.1,this.drawSquare()},this.querySelector("#panleft").onclick=i=>{this.props.xPosition+=this.props.xPixelSize,this.drawSquare()},this.querySelector("#panright").onclick=i=>{this.props.xPosition-=this.props.xPixelSize,this.drawSquare()},this.querySelector("#panup").onclick=i=>{this.props.yPosition-=this.props.yPixelSize,this.drawSquare()},this.querySelector("#pandown").onclick=i=>{this.props.yPosition+=this.props.yPixelSize,this.drawSquare()},this.querySelector("#colorwheel").onchange=i=>{console.log(i.target.value),this.props.colorPicked=i.target.value},setTimeout(()=>{t.animate&&t.node.runAnimation()},10)});h(this,"onresize",t=>{this.canvas&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.style.width=this.canvas.clientWidth,this.canvas.style.height=this.canvas.clientHeight,this.drawSquare())})}draw(t,i,s,n){let o=this.props.canvas,a=this.props.ctx,r=o.width*.5,d=o.height*.5,f=this.props.xPixelSize*this.props.zoom,l=this.props.yPixelSize*this.props.zoom,u=Math.ceil(o.width/f);u>this.props.xSize&&(u=this.props.xSize);let w=Math.ceil(o.height/l);w>this.props.ySize&&(w=this.props.ySize);let y=this.props.xPosition%this.props.xPixelSize,x=this.props.yPosition%this.props.yPixelSize,g=Math.floor(this.props.xPosition/this.props.xPixelSize),m=Math.floor(this.props.yPosition/this.props.yPixelSize),v=y;for(;v<r&&v<f*this.props.xSize*.5;)v+=f;v=v/f;let b=x;for(;b<d&&b<l*this.props.ySize*.5;)b+=l;b=b/l;let N=g-Math.floor(v),z=m-Math.floor(b),P=N+u,T=z+w,M=r-v*f,C=d-b*l;for(let A=N;A<P;A++)for(let _=z;_<T;_++){let O=A+_*this.props.xSize;if(!this.props.data[O]||!this.props.updated[O])continue;this.props.data[O]=this.props.updated[O],delete this.props.updated[O],a.fillStyle=this.props.data[O];let q=M+(A-N)*f,H=C+(_-z)*l;if(q<0)q=0;else if(q>o.width)continue;if(H<0)H=0;else if(H>o.height)continue;a.fillRect(q,H,f,l)}}addDraw(t){typeof t=="function"&&this.drawFuncs.push(t)}drawSquare(){console.time("square");let t=this.props.canvas,i=this.props.ctx;i.clearRect(0,0,t.width,t.height);let s=t.width*.5,n=t.height*.5,o=this.props.xPixelSize*this.props.zoom,a=this.props.yPixelSize*this.props.zoom,r=Math.ceil(t.width/o);r>this.props.xSize&&(r=this.props.xSize);let d=Math.ceil(t.height/a);d>this.props.ySize&&(d=this.props.ySize);let f=this.props.xPosition%this.props.xPixelSize,l=this.props.yPosition%this.props.yPixelSize,u=Math.floor(this.props.xPosition/this.props.xPixelSize),w=Math.floor(this.props.yPosition/this.props.yPixelSize),y=f;for(;y<s&&y<o*this.props.xSize*.5;)y+=o;y=y/o;let x=l;for(;x<n&&x<a*this.props.ySize*.5;)x+=a;x=x/a;let g=u-Math.floor(y),m=w-Math.floor(x),v=g+r,b=m+d,N=s-y*o,z=n-x*a;for(let P=g;P<v;P++)for(let T=m;T<b;T++){let M=P+T*this.props.xSize;if(!this.props.data[M])continue;i.fillStyle=this.props.data[M];let C=N+(P-g)*o,A=z+(T-m)*a;if(C<0)C=0;else if(C>t.width)continue;if(A<0)A=0;else if(A>t.height)continue;i.fillRect(C,A,o,a)}console.timeEnd("square")}generateDataStructure(t=(i,s)=>`rgb(${255*i/this.props.xSize},0,${255*s/this.props.ySize})`){for(let i=0;i<this.props.xSize;i++)for(let s=0;s<this.props.ySize;s++){let n=i+s*this.props.xSize;this.props.data[n]||(typeof t=="function"?this.props.data[n]=t(i,s):t?this.data[n]=t:this.props.data[n]="0xFFFFFF")}}};it.addElement("place-node");var $=class{constructor(e=[["boids",100],["boids",50]],t=void 0,i=!0,s=!0){h(this,"init",(e=this.startingRules)=>{this.canvas&&this.defaultCanvas&&(this.ctx=this.canvas.getContext("2d")),this.canvas&&window.addEventListener("resize",this.onresize),this.setupRules(e),this.startingRules=e,this.looping||(this.currFrame=performance.now()*.001,this.looping=!0,this.loop())});h(this,"deinit",()=>{this.looping=!1,this.canvas&&window.removeEventListener("resize",this.onresize())});h(this,"defaultAnimation",e=>{this.ctx.beginPath();let t=Math.sqrt(e.velocity.x*e.velocity.x+e.velocity.y*e.velocity.y+e.velocity.z*e.velocity.z);var i=Math.floor(t*255/(e.maxSpeed*1.2));i>255?i=255:i<0&&(i=0),this.ctx.fillStyle=this.colorScale[i],this.ctx.arc(e.position.x,e.position.y,e.particleSize,0,Math.PI*2,!0),this.ctx.closePath(),this.ctx.fill()});h(this,"updateGroupProperties",(e,t={},i=void 0,s=void 0)=>{i?s?this.particles[e].particles.map(n=>Object.assign(n[i][s],t)):this.particles[e].particles.map(n=>Object.assign(n[i],t)):this.particles[e].particles.map(n=>Object.assign(n,t))});h(this,"defaultGroupRule",(e,t)=>{e.type=t[0],t[1]>3e3&&t[1]<5e3?e.boid.searchLimit=3:t[1]>=5e3&&(e.boid.searchLimit=1);let i=t[7];i&&(e.boid.avoidance.groups=i);let s=1,n=1,o=1;t[2]?(s=t[2][0],n=t[2][1],o=t[2][2],e.boid.separation*=(s+n+o)/3):this.canvas?(s=this.canvas.height,n=this.canvas.width,o=this.canvas.width):(s=1,n=1,o=1);let a=Math.random()*n,r=Math.random()*s,d=Math.random()*o;e.startingX=Math.random(),e.startingY=Math.random(),e.startingZ=Math.random(),e.position={x:a,y:r,z:d},e.boundingBox={left:e.boundingBox.left*n,right:e.boundingBox.right*n,bot:e.boundingBox.bot*s,top:e.boundingBox.top*s,front:e.boundingBox.front*o,back:e.boundingBox.back*o},e.boid.boundingBox={left:e.boid.boundingBox.left*n,right:e.boid.boundingBox.right*n,bot:e.boid.boundingBox.bot*s,top:e.boid.boundingBox.top*s,front:e.boid.boundingBox.front*o,back:e.boid.boundingBox.back*o},e.boid.attractor={x:.5*n,y:.5*s,z:.5*o,mul:e.boid.attractor.mul},e.boid.swirl={x:.5*n,y:.5*s,z:.5*o,mul:e.boid.swirl.mul}});h(this,"checkParticleBounds",e=>{if(e.velocity.x>e.maxSpeed||e.velocity.y>e.maxSpeed||e.velocity.z>e.maxSpeed||e.velocity.x<-e.maxSpeed||e.velocity.y<-e.maxSpeed||e.velocity.z<-e.maxSpeed){let t=this.normalize3D([e.velocity.x,e.velocity.y,e.velocity.z]);e.velocity.x=t[0]*e.maxSpeed,e.velocity.y=t[1]*e.maxSpeed,e.velocity.z=t[2]*e.maxSpeed}e.position.y-e.particleSize<=e.boundingBox.top&&(e.velocity.y*=e.yBounce,e.position.y=e.boundingBox.top+e.particleSize),e.position.y+e.particleSize>=e.boundingBox.bot&&(e.velocity.y*=e.yBounce,e.position.y=e.boundingBox.bot-e.particleSize),e.position.x-e.particleSize<=e.boundingBox.left&&(e.velocity.x*=e.xBounce,e.position.x=e.boundingBox.left+e.particleSize),e.position.x+e.particleSize>=e.boundingBox.right&&(e.velocity.x*=e.xBounce,e.position.x=e.boundingBox.right-e.particleSize),e.position.z-e.particleSize<=e.boundingBox.front&&(e.velocity.z*=e.xBounce,e.position.z=e.boundingBox.front+e.particleSize),e.position.z+e.particleSize>=e.boundingBox.back&&(e.velocity.z*=e.xBounce,e.position.z=e.boundingBox.back-e.particleSize)});h(this,"defaultTimestepFunc",(e,t)=>{if(e.particles.length<e.max){let s=e.max,n=e.particles.length;for(e.spawnRate&&(n=0,s=e.spawnRate);n<s;)e.particles.push(this.newParticle()),e.groupRuleGen(e.particles[e.particles.length-1],e.rule),n++}else e.particles.length>e.max&&e.particles.splice(e.max);e.useBoids&&(this.calcBoids(e.particles,t)||console.error("boids error"));let i=[];e.particles.forEach((s,n)=>{s.timestepFunc&&s.timestepFunc(e,s,t),s.gravity!==0&&(s.velocity.y+=s.gravity*t),s.force.x!==0&&(s.velocity.x+=s.force.x*t/s.mass),s.force.y!==0&&(s.velocity.y+=s.force.y*t/s.mass),s.force.z!==0&&(s.velocity.z+=s.force.z*t/s.mass),s.acceleration.x!==0&&(s.velocity.x+=s.acceleration.x*t),s.acceleration.y!==0&&(s.velocity.y+=s.acceleration.y*t),s.acceleration.z!==0&&(s.velocity.z+=s.acceleration.z*t),s.velocity.x!==0&&(s.position.x+=s.velocity.x*t),s.velocity.y!==0&&(s.position.y+=s.velocity.y*t),s.velocity.z!==0&&(s.position.z+=s.velocity.z*t),this.checkParticleBounds(s),s.life+=t,this.defaultCanvas&&e.animateParticle(s),s.life>=s.lifeTime&&i.push(n)}),i.reverse().forEach(s=>{e.particles.splice(s,1)})});h(this,"calcAttraction",(e,t,i,s)=>{let n=t.position.x-e.position.x,o=t.position.y-e.position.y,a=t.position.z-e.position.z,r=e.attraction*e.mass*t.mass/(i*i),d=r*n,f=r*o,l=r*a,u=s*d/e.mass,w=s*f/e.mass,y=s*l/e.mass;e.velocity.x+=u,e.velocity.y+=w,e.velocity.z+=y;let x=-s*d/t.mass,g=-s*f/t.mass,m=-s*l/t.mass;return t.velocity.x+=x,t.velocity.y+=g,t.velocity.z+=m,m});h(this,"calcBoids",(e=[],t,i=0,s=e.length)=>{let n=[],o=1/t;e:for(var a=i;a<s;a++){let r=e[a],d=[],f=[],l=[r.position.x,r.position.y,r.position.z,0,0,0,r.velocity.x,r.velocity.y,r.velocity.z,0,0,0,0,0,0,0,0,0],u=1;t:for(let g=0;g<e.length;g++){let m=e[g];if(f.length>r.boid.groupSize||g>=r.boid.searchLimit)break t;let v=Math.floor(Math.random()*e.length);if(!(g===a||v===a||d.indexOf(v)>-1)){let b=e[v],N=this.distance3D(r.position,b.position);if(!(N>r.boid.groupRadius)){f.push(N),d.push(v);let z;if((r.boid.useSeparation||r.boid.useAlignment)&&(z=r.boid.groupRadius/(N*N),z==1/0?z=m.maxSpeed:z==-1/0&&(z=-m.maxSpeed)),r.boid.useCohesion&&(l[0]+=(b.position.x-r.position.x)*.5*N*o,l[1]+=(b.position.y-r.position.y)*.5*N*o,l[2]+=(b.position.z-r.position.z)*.5*N*o),isNaN(N)||isNaN(l[0])||isNaN(b.position.x)){console.log(N,a,v,r.position,b.position,l),r.position.x=NaN;return}r.boid.useSeparation&&(l[3]=l[3]+(r.position.x-b.position.x)*z,l[4]=l[4]+(r.position.y-b.position.y)*z,l[5]=l[5]+(r.position.z-b.position.z)*z),r.boid.useAttraction&&this.calcAttraction(r,b,N,t),r.boid.useAlignment&&(l[6]=l[6]+b.velocity.x*z,l[7]=l[7]+b.velocity.y*z,l[8]=l[8]+b.velocity.z*z),u++}}}if(r.boid.useAvoidance&&r.boid.avoidance.groups.length>0){let g=Math.floor(Math.random()*r.boid.avoidanceGroups.length),m=[];t:for(let b=0;b<r.searchLimit;b++){g++;let N=r.boid.avoidanceGroups[g%r.boid.avoidanceGroups.length];if(m>r.boid.groupSize)break t;let z=Math.floor(Math.random()*N.length);if(!(j===a||z===a||m.indexOf(z)>-1)){let P=N[z],T=this.distance3D(r.position,P.position);if(!(T>r.boid.groupRadius)){m.push(z);let M=r.boid.groupRadius/(T*T);M==1/0?M=p.maxSpeed:M==-1/0&&(M=-p.maxSpeed),l[15]=l[15]+(r.position.x-P.position.x)*M,l[16]=l[16]+(r.position.y-P.position.y)*M,l[17]=l[17]+(r.position.z-P.position.z)*M}}}let v=m.length;l[15]=l[15]*v,l[16]=l[16]*v,l[17]=l[17]*v}let w=1/u;r.boid.useCohesion?(l[0]=r.boid.cohesion*(l[0]*w),l[1]=r.boid.cohesion*(l[1]*w),l[2]=r.boid.cohesion*(l[2]*w)):(l[0]=0,l[1]=0,l[2]=0),r.boid.useSeparation?(l[3]=r.boid.separation*l[3],l[4]=r.boid.separation*l[4],l[5]=r.boid.separation*l[5]):(l[3]=0,l[4]=0,l[5]=0),r.boid.useAlignment?(l[6]=-(r.boid.alignment*l[6]*w),l[7]=r.boid.alignment*l[7]*w,l[8]=r.boid.alignment*l[8]*w):(l[6]=0,l[7]=0,l[8]=0);let y=[0,0,0];r.boid.useSwirl==!0&&(l[9]=-(r.position.y-r.boid.swirl.y)*r.boid.swirl.mul,l[10]=(r.position.z-r.boid.swirl.z)*r.boid.swirl.mul,l[11]=(r.position.x-r.boid.swirl.x)*r.boid.swirl.mul);let x=[0,0,0];r.boid.useAttractor==!0&&(l[12]=(r.boid.attractor.x-r.position.x)*r.boid.attractor.mul,(r.position.x>r.boid.boundingBox.left||r.position.x<r.boid.boundingBox.right)&&(l[12]*=3),l[13]=(r.boid.attractor.y-r.position.y)*r.boid.attractor.mul,(r.position.y>r.boid.boundingBox.top||r.position.y<r.boid.boundingBox.bottom)&&(l[13]*=3),l[14]=(r.boid.attractor.z-r.position.z)*r.boid.attractor.mul,(r.position.z>r.boid.boundingBox.front||r.position.z<r.boid.boundingBox.back)&&(l[14]*=3)),n.push([r.velocity.x*r.drag+l[0]+l[3]+l[6]+l[9]+l[12]+l[15],r.velocity.y*r.drag+l[1]+l[4]+l[7]+l[10]+l[13]+l[16],r.velocity.z*r.drag+l[2]+l[5]+l[8]+l[11]+l[14]+l[17]]),isNaN(n[n.length-1][0])&&console.log(r,a,u,r.position,r.velocity,cohesionVec,separationVec,alignmentVec,y,x)}return n.length===e.length?(e.forEach((r,d)=>{r.velocity.x+=n[d][0],r.velocity.y+=n[d][1],r.velocity.z+=n[d][2]}),!0):(console.error("Boids error"),!1)});h(this,"removeGroup",e=>{this.particles.splice(e,1)});h(this,"onresize",()=>{if(this.canvas){this.defaultCanvas&&(this.canvas.width=this.canvas.parentNode.clientWidth,this.canvas.height=this.canvas.parentNode.clientHeight,this.canvas.style.width=this.canvas.parentNode.clientWidth,this.canvas.style.height=this.canvas.parentNode.clientHeight);let e=this.canvas.clientHeight,t=this.canvas.clientWidth,i=JSON.parse(JSON.stringify(this.prototype)),s={left:i.boundingBox.left*t,right:i.boundingBox.right*t,bot:i.boundingBox.bot*e,top:i.boundingBox.top*e,front:i.boundingBox.front*e,back:i.boundingBox.back*e},n={left:i.boid.boundingBox.left*t,right:i.boid.boundingBox.right*t,bot:i.boid.boundingBox.bot*e,top:i.boid.boundingBox.top*e,front:i.boid.boundingBox.front*e,back:i.boid.boundingBox.back*e};this.particles.forEach(o=>{o.particles.forEach(a=>{a.boundingBox=JSON.parse(JSON.stringify(s)),a.boid.boundingBox=JSON.parse(JSON.stringify(n))})})}});h(this,"frame",e=>{this.frameOffset||(this.frameOffset=e),this.currFrame=performance.now()*.001+this.frameOffset;let t=this.currFrame-e;return t>1&&(t=1),this.defaultCanvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles.forEach(i=>{if(i.timestepFunc(i,t),isNaN(i.particles[0].position.x)){console.log(t,this.ticks,i.particles[0]),this.looping=!1;return}}),this.ticks++,this.currFrame});h(this,"loop",()=>{this.looping!==!1&&(this.frame(this.currFrame),setTimeout(()=>{requestAnimationFrame(()=>{this.loop()})},15))});this.canvas=t,this.defaultCanvas=i,this.ctx=void 0,this.looping=!1,this.currFrame=performance.now()*.001,this.frameOffset=void 0,this.ticks=0,this.startingRules=e,this.nGroups=this.startingRules.length,this.particles=[],this.maxParticles=0,this.colorScale=["#000000","#030106","#06010c","#090211","#0c0215","#0e0318","#10031b","#12041f","#130522","#140525","#150628","#15072c","#16082f","#160832","#160936","#160939","#17093d","#170a40","#170a44","#170a48","#17094b","#17094f","#170953","#170956","#16085a","#16085e","#150762","#140766","#140669","#13066d","#110571","#100475","#0e0479","#0b037d","#080281","#050185","#020089","#00008d","#000090","#000093","#000096","#000099","#00009c","#00009f","#0000a2","#0000a5","#0000a8","#0000ab","#0000ae","#0000b2","#0000b5","#0000b8","#0000bb","#0000be","#0000c1","#0000c5","#0000c8","#0000cb","#0000ce","#0000d1","#0000d5","#0000d8","#0000db","#0000de","#0000e2","#0000e5","#0000e8","#0000ec","#0000ef","#0000f2","#0000f5","#0000f9","#0000fc","#0803fe","#2615f9","#3520f4","#3f29ef","#4830eb","#4e37e6","#543ee1","#5944dc","#5e49d7","#614fd2","#6554cd","#6759c8","#6a5ec3","#6c63be","#6e68b9","#6f6db4","#7072af","#7177aa","#717ba5","#7180a0","#71859b","#718996","#708e91","#6f928b","#6e9786","#6c9b80","#6aa07b","#68a475","#65a96f","#62ad69","#5eb163","#5ab65d","#55ba56","#4fbf4f","#48c347","#40c73f","#36cc35","#34ce32","#37cf31","#3ad130","#3cd230","#3fd32f","#41d52f","#44d62e","#46d72d","#48d92c","#4bda2c","#4ddc2b","#4fdd2a","#51de29","#53e029","#55e128","#58e227","#5ae426","#5ce525","#5ee624","#60e823","#62e922","#64eb20","#66ec1f","#67ed1e","#69ef1d","#6bf01b","#6df11a","#6ff318","#71f416","#73f614","#75f712","#76f810","#78fa0d","#7afb0a","#7cfd06","#7efe03","#80ff00","#85ff00","#89ff00","#8eff00","#92ff00","#96ff00","#9aff00","#9eff00","#a2ff00","#a6ff00","#aaff00","#adff00","#b1ff00","#b5ff00","#b8ff00","#bcff00","#bfff00","#c3ff00","#c6ff00","#c9ff00","#cdff00","#d0ff00","#d3ff00","#d6ff00","#daff00","#ddff00","#e0ff00","#e3ff00","#e6ff00","#e9ff00","#ecff00","#efff00","#f3ff00","#f6ff00","#f9ff00","#fcff00","#ffff00","#fffb00","#fff600","#fff100","#ffec00","#ffe700","#ffe200","#ffdd00","#ffd800","#ffd300","#ffcd00","#ffc800","#ffc300","#ffbe00","#ffb900","#ffb300","#ffae00","#ffa900","#ffa300","#ff9e00","#ff9800","#ff9300","#ff8d00","#ff8700","#ff8100","#ff7b00","#ff7500","#ff6f00","#ff6800","#ff6100","#ff5a00","#ff5200","#ff4900","#ff4000","#ff3600","#ff2800","#ff1500","#ff0004","#ff000c","#ff0013","#ff0019","#ff001e","#ff0023","#ff0027","#ff002b","#ff012f","#ff0133","#ff0137","#ff013b","#ff023e","#ff0242","#ff0246","#ff0349","#ff034d","#ff0450","#ff0454","#ff0557","#ff065b","#ff065e","#ff0762","#ff0865","#ff0969","#ff0a6c","#ff0a70","#ff0b73","#ff0c77","#ff0d7a","#ff0e7e","#ff0f81","#ff1085","#ff1188","#ff128c","#ff138f","#ff1493"],this.rules=[{type:"default",groupRuleGen:this.defaultGroupRule,timestepFunc:this.defaultTimestepFunc,animateParticle:this.defaultAnimation},{type:"boids",groupRuleGen:this.defaultGroupRule,timestepFunc:this.defaultTimestepFunc,animateParticle:this.defaultAnimation}],this.prototype={position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0},acceleration:{x:0,y:0,z:0},force:{x:0,y:0,z:0},timestepFunc:void 0,type:"boids",particleSize:5,startingX:.5,startingY:.5,maxSpeed:40,xBounce:-1,yBounce:-1,gravity:0,mass:1,drag:.033,life:0,lifeTime:1e8,boundingBox:{left:0,right:1,bot:1,top:0,front:0,back:1},boid:{boundingBox:{left:0,right:1,bot:1,top:0,front:0,back:1},cohesion:1e-5,separation:1e-4,alignment:.006,swirl:{x:.5,y:.5,z:.5,mul:.006},attractor:{x:.5,y:.5,z:.5,mul:.002},avoidance:{groups:[],mul:.1},useCohesion:!0,useSeparation:!0,useAlignment:!0,useSwirl:!0,useAttractor:!0,useAvoidance:!0,attraction:6674e-14,useAttraction:!1,groupRadius:200,groupSize:10,searchLimit:10},plant:{diet:"photosynthetic"},animal:{diet:"omnivore"},bacteria:{},atom:{},proton:{},neutron:{},electron:{},conway:{survivalRange:[2,3],reproductionRange:[3,3],groupRadius:10}},s&&this.init()}setupRules(e=this.startingRules){return e.forEach((t,i)=>{let s=this.addGroup(t)}),this.particles}distance3D(e,t){return Array.isArray(e)?Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])):Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))}normalize3D(e=[]){let t;return Array.isArray(e)?(t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),[e[0]/t,e[1]/t,e[2]/t]):(t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),{x:e.x/t,y:e.y/t,z:e.z/t})}addRule(e="",t=(n,o)=>{},i=(n,o)=>{},s=n=>{}){if(e.length>0&&typeof t=="function"&&typeof timestepFunc=="function"&&typeof s=="function")this.rules.push({type:e,groupRuleGen:t,timestepFunc:i,animateParticle:s});else return!1}removeGroup(e=0){return this.particles[e]?(this.maxParticles-=this.particles[e].max,this.particles.slice(e,1),!0):!1}addGroup(e=["boids",50]){if(!Array.isArray(e))return!1;let t=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5];t==="boids"&&(a=!0);let r=e[6];if(!e[0]||!e[1])return!1;this.maxParticles+=e[1];let d,f,l;if(this.rules.forEach(g=>{t===g.type&&(d=g.timestepFunc,f=g.groupRuleGen,l=g.animateParticle)}),!d||!f||this.defaultCanvas&&!l)return!1;let u=new Array(i).fill(0),w=Math.random()*.4+.35,y=Math.random()*.4+.35,x=Math.random()*.4+.35;if(n)for(let g=0;g<n;g++)u[g]=this.newParticle(),f(u[g],e),r&&(u[g].timestepFunc=d),t==="boids"&&(u[g].boid.attractor.x=u[g].boid.boundingBox.right*w,u[g].boid.attractor.y=u[g].boid.boundingBox.bot*y,u[g].boid.attractor.z=u[g].boid.boundingBox.back*x,w<.5&&(u[g].boid.swirl.mul=-u[g].boid.swirl.mul));else u.forEach((g,m)=>{u[m]=this.newParticle(),f(u[m],e),t==="boids"&&(r&&(u[m].timestepFunc=d),u[m].boid.attractor.x=u[m].boid.boundingBox.right*w,u[m].boid.attractor.y=u[m].boid.boundingBox.bot*y,u[m].boid.attractor.z=u[m].boid.boundingBox.back*x,w<.5&&(u[m].boid.swirl.mul=-u[m].boid.swirl.mul))});return this.particles.push({rule:e,type:t,max:i,particles:u,timestepFunc:d,groupRuleGen:f,animateParticle:l,spawnRate:o,useBoids:a,groupId:"id"+Math.floor(Math.random()*99999999)}),u}newParticle(e=void 0){let t=JSON.parse(JSON.stringify(this.prototype));return e&&Object.assign(t,e),t}setParticle(e,t={}){return Object.assign(e,t),e}};var ee=bt(),st=class extends S{constructor(){super(...arguments);h(this,"props",{bodies:{},speed:3e5,lastTime:void 0,now:void 0,canvas:void 0,ctx:void 0,useCanvas:!0,useHTML:!0,meter_per_px:1e9,px_per_meter:1/1e9,zind:0,stars:[],boids:void 0,nstars:void 0,nboids:void 0,operator:(t,i,s,n)=>{if(n==="animate"){this.props.lastTime=this.props.now,this.props.now=Date.now();let o,a=(this.props.now-this.props.lastTime)*.001;a>.1&&(a=.1),o=a*this.props.speed;let r=this.props.bodies,d=Object.keys(r);for(let f=0;f<d.length;f++)for(let l=0;l<d.length;l++)f!==l&&!r[d[f]].fixed&&!r[d[l]].fixed&&this.newtonianMechanics(r[d[f]],r[d[l]],o);if(this.props.node.callChildren(o),this.props.useCanvas){this.draw(t,i,s,n);for(let f=0;f<this.drawFuncs.length;f++){let l=this.drawFuncs[f];typeof l=="function"&&l(t,i,s,n)}}}},forward:!0,backward:!1,children:void 0,delay:!1,repeat:!1,recursive:!1,animate:!0,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",ee);h(this,"drawFuncs",[]);h(this,"oncreate",t=>{this.canvas=this.querySelector("canvas"),t.meter_per_px&&(t.px_per_meter=1/t.meter_per_px),t.width&&(this.canvas.width=t.width,this.canvas.style.height=t.height),t.height&&(this.canvas.height=t.height,this.canvas.style.height=t.height),t.style&&(this.canvas.style=t.style,setTimeout(()=>{if(this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth,t.useCanvas){t.nstars||(t.nstars=200),t.nboids||(t.nboids=100),t.stars=[];let i=0;for(;i<t.nstars;){let n=Math.floor(Math.random()*100);n<20&&(n=20),t.stars.push({x:Math.random(),y:Math.random(),z:Math.random(),color:`#${n}${n}${n}`}),i++}let s=[["boids",t.nboids],["default",200]];t.boids=new $(s,this.canvas,!1),this.props.boids.particles.forEach((n,o)=>{o===0&&n.particles.forEach((a,r)=>{a.maxSpeed=70,a.boid.separation=.1,a.boid.attractor.mul=.02,a.boid.swirl.mul=.1;let d=Math.floor(Math.random()*100);d<10&&(d=10),a.color=`#${d}DDFF`}),o===1&&n.particles.forEach((a,r)=>{a.velocity={x:Math.random()*10-5,y:Math.random()*10-5,z:Math.random()*10-5};let d=Math.floor(Math.random()*100);d<30&&(d=30);let f=Math.floor(Math.random()*100);f<30&&(f=30);let l=Math.floor(Math.random()*100);l<30&&(l=30),a.color=`#${d}${f}${l}`})})}},10)),t.canvas=this.canvas,t.context?t.context=this.canvas.getContext(t.context):t.context=this.canvas.getContext("2d"),this.context=t.context,this.ctx=this.context,t.ctx=this.context,setTimeout(()=>{t.animate&&(t.now=Date.now(),t.node.runAnimation())},10)});h(this,"onresize",t=>{this.canvas&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.style.width=this.canvas.clientWidth,this.canvas.style.height=this.canvas.clientHeight,t.width=this.canvas.clientWidth,t.height=this.canvas.clientHeight);let i=t.bodies,s=Object.keys(i);for(let n=0;n<i.length;n++)i[s[n]].props.display===!1&&i[s[n]].props.display==="none"&&(i[s[n]].div.style.height=2*i[s[n]].radius/t.meter_per_px,i[s[n]].div.style.width=2*i[s[n]].radius/t.meter_per_px,i[s[n]].div.style.borderRadius=i[s[n]].radius/t.meter_per_px)})}draw(t,i,s,n){let o=this.props.canvas,a=this.props.ctx;a.clearRect(0,0,o.width,o.height),a.fillStyle="#111111",a.fillRect(0,0,o.width,o.height),this.props.stars.forEach((r,d)=>{a.fillStyle=r.color,a.fillRect(r.x*o.width,r.y*o.height,2,2)}),this.props.boids.particles.forEach((r,d)=>{d===0&&r.particles.forEach((f,l)=>{this.props.bodies.saturn&&(f.boid.attractor.x=this.canvas.clientWidth*.5+this.props.bodies.saturn.position.x*this.props.px_per_meter,f.boid.attractor.y=this.canvas.clientHeight*.5-this.props.bodies.saturn.position.y*this.props.px_per_meter,f.boid.attractor.z=this.canvas.clientWidth*.5+this.props.bodies.saturn.position.z*this.props.px_per_meter),f.boid.swirl.x=f.boid.attractor.x,f.boid.swirl.y=f.boid.attractor.y,f.boid.swirl.z=f.boid.attractor.z;let u=Math.floor(10+l/r.particles.length*90);a.fillStyle=f.color,a.fillRect(f.position.x,f.position.y,2,2)}),d===1&&r.particles.forEach((f,l)=>{a.fillStyle=f.color,a.fillRect(f.position.x,f.position.y,2,2)})})}addDraw(t){typeof t=="function"&&this.drawFuncs.push(t)}magnitude(t={}){let i=0;return Object.keys(t).forEach(s=>{i+=t[s]*t[s]}),Math.sqrt(i)}distance(t={},i={}){let s=0;return Object.keys(t).forEach((n,o)=>{let a=i[n]-t[n];s+=a*a}),Math.sqrt(s)}makeVec(t={},i={}){var s={};return Object.keys(t).forEach((n,o)=>{s[n]=i[n]-t[n]}),s}normalize(t={}){let i=1/this.magnitude(t),s={};return Object.keys(t).forEach((n,o)=>{s[n]=t[n]*i}),s}calcAzimuth(t={x:1,y:1,z:0}){return Math.atan2(t.x,t.y)}calcZenith(t={x:1,y:0,z:1}){return Math.acos(t.z/this.magnitude(t))}sphereCollision(t,i){let s=this.distance(t.position,i.position);return s<t.radius+i.radius?t.radius+i.radius-s:!1}newtonianMechanics(t,i,s){if(!t.mass||!i.mass||t.mass==0&&i.mass===0)return;let n=this.distance(t.position,i.position),o=this.normalize(this.makeVec(t.position,i.position)),a=this.sphereCollision(t,i);if(a){let w=t.mass+i.mass,y=t.mass/w,x=1-y;t.fixed===!1?(t.position.x+=o.x*a*x*1.01,t.position.y+=o.y*a*x*1.01,t.position.z+=o.z*a*x*1.001):(i.position.x-=o.x*a*1.01,i.position.y-=o.y*a*1.01,i.position.z-=o.z*a*1.01),i.fixed===!1?(i.position.x+=o.x*a*y*1.01,i.position.y+=o.y*a*y*1.01,i.position.z+=o.z*a*y*1.01):(t.position.x+=o.x*a*1.01,t.position.y+=o.y*a*1.01,t.position.z+=o.z*a*1.01),n=this.distance(t.position,i.position);let g={x:t.velocity.x-i.velocity.x,y:t.velocity.y-i.velocity.y,z:t.velocity.z-i.velocity.z},m=g.x*o.x+g.y*o.y+g.z*o.z;if(m>0){let v=2*m/w;t.fixed===!1&&(t.velocity.x-=v*o.x*i.mass*t.restitution,t.velocity.y-=v*o.y*i.mass*t.restitution,t.velocity.z-=v*o.z*i.mass*t.restitution),i.fixed===!1&&(i.velocity.x+=v*o.x*i.mass*i.restitution/i.mass,i.velocity.y+=v*o.y*i.mass*i.restitution/i.mass,i.velocity.z+=v*o.z*i.mass*i.restitution/i.mass)}}let r=1/t.mass,d=1/i.mass,f=6674e-14*t.mass*i.mass/(n*n),l={x:o.x*f,y:o.y*f,z:o.z*f},u={x:-o.x*f,y:-o.y*f,z:-o.z*f};t.fixed||(t.velocity.x+=s*l.x*r,t.velocity.y+=s*l.y*r,t.velocity.z+=s*l.z*r),i.fixed||(i.velocity.x+=s*u.x*d,i.velocity.y+=s*u.y*d,i.velocity.z+=s*u.z*d)}};B(st,"space-node");var nt=class extends S{constructor(){super(...arguments);h(this,"operator",(t,i,s,n)=>{let o;typeof t=="object"?(t.position&&(this.props.position=t.position),t.velocity&&(this.props.velocity=t.velocity),t.acceleration&&(this.props.acceleration=t.acceleration),t.force&&(this.props.force=t.force),t.tstep&&(o=t.tstep)):typeof t=="number"?o=t:typeof t=="string"&&(o=parseInt(t));let a=this.props.force,r=this.props.acceleration,d=this.props.velocity,f=this.props.position;if(o&&this.props.fixed===!1&&(a.x&&(r.x+=a.x/this.props.mass,a.x=0),a.y&&(r.y+=a.y/this.props.mass,a.y=0),a.z&&(r.z+=a.z/this.props.mass,a.z=0),r.x&&(d.x+=r.x*o),r.y&&(d.y+=r.y*o),r.z&&(d.z+=r.z*o),d.x&&(f.x+=d.x*o),d.y&&(f.y+=d.y*o),d.z&&(f.z+=d.z*o),this.props.bounded&&this.checkBoundaries(f,d),this.props.distance=this.magnitude(this.props.position),this.props.azimuth=this.calcAzimuth(this.props.position),this.props.zenith=this.calcZenith(this.props.position,this.props.distance),this.parentNode.props?.useHTML||!this.parentNode.props)){this.props.div.style.left=this.parentNode.clientWidth*.5+this.props.position.x/this.parentNode.props.meter_per_px+"px",this.props.div.style.top=this.parentNode.clientHeight*.5-this.props.position.y/this.parentNode.props.meter_per_px+"px";let l=Math.floor(this.props.position.z/this.parentNode.props.meter_per_px);this.parentNode.props.zind>l&&(this.parentNode.props.zind=l);let u=parseInt(this.parentNode.props.canvas.style.zIndex);u||(u=1),this.props.div.style.zIndex=l+u-this.parentNode.props.zind}return t});h(this,"props",{mass:5972e21,radius:63781e5,distance:void 0,theta:void 0,azimuth:void 0,position:{x:15e10,y:0,z:0},velocity:{x:0,y:0,z:0},acceleration:{x:0,y:0,z:0},force:{x:0,y:0,z:0},restitution:.01,vloss:1e-14,fixed:!1,bounded:!0,operator:this.operator,forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!1,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",t=>{let i="''";if((t.display===!1||t.display==="none"||this.parentNode.props?.useHTML===!1)&&(i="'none'"),this.parentNode.props?.useHTML===!1)return"";let s;return t.img?`
                <div>
                    <img src=${t.img} height="100%" width="100%" style="position:absolute;"></img>
                </div>
            `:(t.style?s=t.style:s=`"display:${i}; background-color:blue;"`,`
            <div style=${s}></div>
        `)});h(this,"checkBoundaries",(t,i)=>{let s=this.parentNode.getBoundingClientRect(),n=1/this.parentNode.props.meter_per_px,o=s.left+this.parentNode.clientWidth*.5-t.x*n,a=s.top+this.parentNode.clientHeight*.5-t.y*n,r=s.left+this.parentNode.clientWidth*.5-t.z*n,d=this.props.radius*n;o+d>=s.right&&(t.x=-(this.parentNode.clientWidth*.5)*this.parentNode.props.meter_per_px+this.props.radius,i.x<0&&(i.x=-i.x)),o-d<=s.left&&(t.x=this.parentNode.clientWidth*.5*this.parentNode.props.meter_per_px-this.props.radius,i.x>0&&(i.x=-i.x)),a-d<=s.top&&(t.y=this.parentNode.clientHeight*.5*this.parentNode.props.meter_per_px-this.props.radius,i.y>0&&(i.y=-i.y)),a+d>=s.bottom&&(t.y=(this.parentNode.clientHeight*.5-(s.bottom-s.top))*this.parentNode.props.meter_per_px+this.props.radius,i.y<0&&(i.y=-i.y)),r+d>=s.right&&(t.z=-(this.parentNode.clientWidth*.5)*this.parentNode.props.meter_per_px+this.props.radius,i.z<0&&(i.z=-i.z)),r-d<=s.left&&(t.z=this.parentNode.clientWidth*.5*this.parentNode.props.meter_per_px-this.props.radius,i.z>0&&(i.z=-i.z))});h(this,"render",(t=this.props)=>{typeof this.template=="function"?this.templateString=this.template(t):this.templateString=this.template;let i=document.createElement("template");i.innerHTML=this.templateString;let s=i.content;this.fragment&&this.removeChild(this.fragment),this.fragment=s,this.appendChild(s),this.setupNode(this.props),this.props.input&&setTimeout(async()=>{this.props.node.runNode(this.props.node,this.props.input,this.props.graph)},this.input_delay),this.setupPhysicsBody(t),this.oncreate&&this.oncreate(t)});h(this,"oncreate",t=>{});h(this,"dragElement",t=>{let i=o=>{o=o||window.event,o.preventDefault();let a=!1;setTimeout(()=>{a||(document.onmouseup=n,document.onmousemove=s)},200),document.onmouseup=()=>{a=!0}},s=o=>{if(o=o||window.event,o.preventDefault(),this.parentNode.props?.meter_per_px){let a=this.parentNode.getBoundingClientRect();this.props.position.x=-(this.parentNode.clientWidth*.5+a.x-o.clientX)*this.parentNode.props.meter_per_px,this.props.position.y=(this.parentNode.clientHeight*.5+a.y-o.clientY)*this.parentNode.props.meter_per_px,this.props.velocity.x=0,this.props.velocity.y=0}(this.parentNode.props?.useHTML||!this.parentNode.props)&&(t.style.top=o.clientY+"px",t.style.left=o.clientX+"px")},n=()=>{document.onmouseup=null,document.onmousemove=null};t&&(t.style.cursor="pointer",t.onmousedown=i)})}d2r(t){return Math.PI*t/180}r2d(t){return 180*t/Math.PI}magnitude(t={}){let i=0;return Object.keys(t).forEach(s=>{i+=t[s]*t[s]}),Math.sqrt(i)}distance(t={},i={}){let s=0;return Object.keys(t).forEach((n,o)=>{let a=i[n]-t[n];s+=a*a}),Math.sqrt(s)}makeVec(t={},i={}){var s={};return Object.keys(t).forEach((n,o)=>{s[n]=i[n]-t[n]}),s}normalize(t={}){let i=1/this.magnitude(t),s={};return Object.keys(t).forEach((n,o)=>{s[n]=t[n]*i}),s}calcAzimuth(t={x:1,y:1,z:0}){return Math.atan2(t.x,t.y)}calcZenith(t={x:1,y:0,z:1},i=this.magnitude(t)){if(i)return Math.acos(t.z/i);let s=this.magnitude(t);return(s=0)?0:Math.acos(t.z/s)}setAzimuth(t){this.props.azimuth=t,props.position.z=props.distance*Math.sin(2*props.azimuth)}setZenith(t){this.props.theta=t,this.props.position.x=this.props.distance*Math.cos(this.props.theta),this.props.position.y=this.props.distance*Math.sin(this.props.theta)}setPositionFromSpherical(t){if(!t.distance)t.distance=this.magnitude(t.position),t.azimuth?(t.position.z=t.distance*Math.sin(2*t.azimuth),t.div.style.top=this.parentNode.clientHeight*.5-t.position.y/this.parentNode.props.meter_per_px+"px"):t.azimuth=this.calcZenith(t.position),t.theta?(t.position.x=t.distance*Math.cos(t.theta),t.position.y=t.distance*Math.sin(t.theta),t.div.style.left=this.parentNode.clientWidth*.5-t.position.x/this.parentNode.props.meter_per_px+"px"):t.theta=this.calcAzimuth(t.position);else if(t.azimuth||(t.azimuth=this.calcZenith(t.position)),t.position.z=t.distance*Math.sin(2*t.azimuth),t.theta||(t.theta=this.calcAzimuth(t.position)),t.position.x=t.distance*Math.cos(t.theta),t.position.y=t.distance*Math.sin(t.theta),this.parentNode.props?.useHTML||!this.parentNode.props){t.div.style.left=this.parentNode.clientWidth*.5+t.position.x/this.parentNode.props.meter_per_px+"px",t.div.style.top=this.parentNode.clientHeight*.5-t.position.y/this.parentNode.props.meter_per_px+"px";let i=Math.floor(t.position.z/this.parentNode.props.meter_per_px);Math.abs(this.parentNode.props.zind)>i&&(this.parentNode.props.zind=i),t.div.style.zIndex=i+parseInt(this.parentNode.props.canvas.style.zIndex)+this.parentNode.props.zind}}setupPhysicsBody(t){typeof t.px=="number"&&(t.position.x=t.px),typeof t.py=="number"&&(t.position.y=t.py),typeof t.pz=="number"&&(t.position.z=t.pz),typeof t.vx=="number"&&(t.velocity.x=t.vx),typeof t.vy=="number"&&(t.velocity.y=t.vy),typeof t.vz=="number"&&(t.velocity.z=t.vz);let i=this.querySelector("div");t.div=i;let s=t.radius;if(this.parentNode?.props?.meter_per_px&&(s=s/this.parentNode.props.meter_per_px),this.parentNode.props?.useHTML||!this.parentNode.props){let n=this.parentNode.clientWidth*.5+t.position.x/this.parentNode.props.meter_per_px,o=this.parentNode.clientHeight*.5-t.position.y/this.parentNode.props.meter_per_px;i.style.position="absolute",i.style.height=2*s+"px",i.style.width=2*s+"px",i.style.borderRadius=s+"px",i.style.left=n+"px",i.style.top=o+"px",i.style.transform="translate(-"+s+"px,-"+s+"px)",this.style.backgroundColor&&(i.style.backgroundColor=this.style.backgroundColor)}this.setPositionFromSpherical(t),this.dragElement(i),this.parentNode.props?.bodies&&(this.parentNode.props.bodies[t.tag]=t)}};B(nt,"physics-body");var se=wt(),ot=class extends S{constructor(){super(...arguments);h(this,"bitmap");h(this,"bitslice");h(this,"canvas");h(this,"ctx");h(this,"offscreen");h(this,"offscreenctx");h(this,"capture");h(this,"capturectx");h(this,"graph");h(this,"graphctx");h(this,"img");h(this,"video");h(this,"imgselect");h(this,"props",{picking:0,picked:{x0:0,x1:100,y0:0,y1:100},mode:"img",operator:(t,i,s,n)=>{if(n==="animate"){this.draw(t,i,s,n);for(let o=0;o<this.drawFuncs.length;o++){let a=this.drawFuncs[o];typeof a=="function"&&a(t,i,s,n)}}},forward:!0,backward:!1,children:void 0,parent:void 0,delay:!1,repeat:!1,recursive:!1,animate:!0,loop:void 0,tag:void 0,input:void 0,graph:void 0,node:void 0});h(this,"template",se);h(this,"drawFuncs",[]);h(this,"useWebcam",()=>{this.img.style.display="none",this.video.style.display="",navigator.getUserMedia&&navigator.getUserMedia({video:!0},t=>{this.video.srcObject=t,this.video.play(),this.video.width=this.canvas.width,this.video.height=this.canvas.height,this.props.mode="video"},console.error)});h(this,"useImage",()=>{this.video.src&&(this.video.pause(),this.video.src="",this.video.style.display="none"),this.img.src=this.select.value,this.img.style.display="",this.props.mode="img",this.canvas.height=this.img.height,this.canvas.width=this.img.width,this.canvas.style.width=this.img.style.width,this.canvas.style.height=this.img.style.height});h(this,"canvasClicked",t=>{if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.props.picking===0)this.props.picked.x0=t.pageX-this.canvas.offsetLeft,this.props.picked.y0=t.pageY-this.canvas.offsetTop,this.drawCircle(this.props.picked.x0,this.props.picked.y0,2.5,"orange",1,"orange"),this.props.picking=1;else{if(this.props.picked.x1=t.pageX-this.canvas.offsetLeft,this.props.picked.y1=t.pageY-this.canvas.offsetTop,this.props.picked.x1<this.props.picked.x0){let i=this.props.picked.x1;this.props.picked.x1=this.props.picked.x0,this.props.picked.x0=i}if(this.props.picked.y1<this.props.picked.y0){let i=this.props.picked.y1;this.props.picked.y1=this.props.picked.y0,this.props.picked.y0=i}this.props.picking=0,this.ctx.lineWidth=3,this.ctx.strokeStyle="orange",this.ctx.rect(this.props.picked.x0,this.props.picked.y0,this.props.picked.x1-this.props.picked.x0,this.props.picked.y1-this.props.picked.y0),this.ctx.stroke(),this.canvasCapture(t)}});h(this,"processCapture",t=>{this.capturectx.clearRect(0,0,this.capture.width,this.capture.height),this.graphctx.fillStyle="gray",this.graphctx.fillRect(0,0,this.graph.width,this.graph.height),this.capture.width=t.width,this.capture.height=t.height,this.graph.width=t.width,this.graph.height=t.height,this.capturectx.drawImage(t,0,0),this.bitmap=this.capturectx.getImageData(0,0,this.capture.width,this.capture.height);let i=Array.from(this.bitmap.data);console.log(i);let s=[],n=[],o=0;for(let r=0;r<i.length;r+=4)r/4%t.width===0&&(o=0),s[o]?(s[o]+=i[r+1]+i[r+2]+i[r+3],n[o].r+=i[r+1],n[o].g+=i[r+2],n[o].b+=i[r+3]):(s[o]=i[r+1]+i[r+2]+i[r+3],n[o]={r:i[r+1],g:i[r+2],b:i[r+3]}),o++;let a=Math.max(...s.map(r=>{if(!typeof r!=="number")return parseFloat(r)}));console.log(a),this.graphctx.fillStyle="white",this.graphctx.fillText(`Max summed value: ${a}`,10,10,100),this.graphctx.strokeStyle="orange",s.forEach((r,d)=>{d===0?this.graphctx.moveTo(0,this.graph.height*(1-r/a)):this.graphctx.lineTo(d,this.graph.height*(1-r/a))}),this.graphctx.stroke()});h(this,"oncreate",t=>{this.canvas=this.querySelector("#picker"),this.img=this.querySelector("img"),this.video=this.querySelector("video"),this.select=this.querySelector("#imgselect"),this.capture=this.querySelector("#capture"),this.graph=this.querySelector("#graph"),this.select.onchange=i=>{this.mode==="img"&&this.useImage()},this.querySelector("#webcam").onclick=this.useWebcam,this.querySelector("#image").onclick=this.useImage,this.querySelector("#setImgUrl").onclick=this.inputImgUrl,this.querySelector("#setVideoUrl").onclick=this.inputVideoSrc,t.width&&(this.canvas.width=t.width,this.canvas.style.width=t.width,this.video.width=t.width,this.video.style.width=t.width,this.img.width=t.width,this.img.style.width=t.width),t.height&&(this.canvas.height=t.height,this.canvas.style.height=t.height,this.video.height=t.height,this.video.style.height=t.height,this.img.height=t.height,this.img.style.height=t.height),t.style&&(this.canvas.style=t.style,this.canvas.zIndex=3,this.video.style=t.style,this.video.zIndex=2,this.img.style=t.style,this.img.zIndex=1,setTimeout(()=>{this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth,this.img.width=t.width,this.img.height=t.height,this.video.width=t.width,this.video.height=t.height},10)),t.canvas=this.canvas,t.context?t.context=this.canvas.getContext(t.context):t.context=this.canvas.getContext("2d"),this.context=t.context,this.ctx=this.context,t.ctx=this.context,this.offscreen=new OffscreenCanvas(this.canvas.width,this.canvas.height),this.offscreenctx=this.offscreen.getContext("2d"),this.capturectx=this.capture.getContext("2d"),this.graphctx=this.capture.getContext("2d"),this.useImage(),this.props.picked.x1=this.canvas.width,this.props.picked.y1=this.canvas.height,this.canvas.onclick=this.canvasClicked,setTimeout(()=>{t.animate&&t.node.runAnimation()},10)});h(this,"onresize",t=>{this.canvas&&(this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.style.width=this.canvas.clientWidth,this.canvas.style.height=this.canvas.clientHeight)})}draw(t,i,s,n){let o=this.props.canvas,a=this.props.ctx}addDraw(t){typeof t=="function"&&this.drawFuncs.push(t)}inputImgUrl(){let t=this.querySelector("#imgurl").value;t&&(this.video.src&&(this.video.pause(),this.video.src="",this.video.style.display="none"),this.img.src=t,this.img.style.display="",this.props.mode="img",this.canvas.height=this.img.height,this.canvas.width=this.canvas.width,this.canvas.style.width=this.img.style.width,this.canvas.style.height=this.img.style.height)}inputVideoSrc(){this.img.style.display="none",this.video.style.display="";let t=this.querySelector("#videourl").value;t&&(this.video.src=t,this.video.play(),this.props.mode="video",this.canvas.height=this.video.height,this.canvas.width=this.video.width,this.canvas.style.width=this.video.style.width,this.canvas.style.height=this.video.style.height)}drawCircle(t,i,s,n="green",o=5,a="#003300",r=this.ctx){r.beginPath(),r.arc(t,i,s,0,2*Math.PI,!1),r.fillStyle=n,r.fill(),r.lineWidth=o,r.strokeStyle=a,r.stroke()}drawLine(t={x:0,y:0},i={x:1,y:1},s=5,n="#003300",o=this.ctx){o.beginPath(),o.lineWidth=s,o.strokeStyle=n,o.moveTo(t.x,t.y),o.lineTo(i.x,i.y),o.stroke()}canvasCapture(t){if(this.props.mode==="img"){if(!this.img.src)return;let i={x0:this.img.naturalWidth*this.props.picked.x0/this.canvas.width,y0:this.img.naturalHeight*this.props.picked.y0/this.canvas.height,x1:this.img.naturalWidth*this.props.picked.x1/this.canvas.width,y1:this.img.naturalHeight*this.props.picked.y1/this.canvas.height};createImageBitmap(this.img,i.x0,i.y0,i.x1-i.x0,i.y1-i.y0).then(this.processCapture)}else if(this.props.mode==="video"){if(!this.video.src)return;let i={x0:this.video.videoWidth*this.props.picked.x0/this.canvas.width,y0:(this.video.videoHeight+.5*(this.canvas.height-this.canvas.height*(this.video.videoHeight/this.video.videoWidth)))*this.props.picked.y0/this.canvas.height,x1:this.video.videoWidth*this.props.picked.x1/this.canvas.width,y1:(this.video.videoHeight+.5*(this.canvas.height-this.canvas.height*(this.video.videoHeight/this.video.videoWidth)))*this.props.picked.y1/this.canvas.height};createImageBitmap(this.video,i.x0,i.y0,i.x1-i.x0,i.y1-i.y0).then(this.processCapture)}}};ot.addElement("spectrometer-node");var ne=document.createElement("spectrometer-node");document.body.appendChild(ne);})();
//# sourceMappingURL=app.js.map
