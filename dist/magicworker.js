(()=>{(()=>{var E=Object.defineProperty,_=(e,t)=>{for(var r in t)E(e,r,{get:t[r],enumerable:!0})},m={};_(m,{ProxyElement:()=>x,ThreadedCanvas:()=>A,WorkerManager:()=>y,initProxyElement:()=>S});var w=URL.createObjectURL(new Blob([String('(()=>{var mi=Object.create;var ht=Object.defineProperty;var gi=Object.getOwnPropertyDescriptor;var xi=Object.getOwnPropertyNames;var yi=Object.getPrototypeOf,bi=Object.prototype.hasOwnProperty;var Ti=(D,s,h)=>s in D?ht(D,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):D[s]=h;var ze=(D=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(D,{get:(s,h)=>(typeof require!="undefined"?require:s)[h]}):D)(function(D){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+D+\'" is not supported\')});var vi=(D,s)=>()=>(s||D((s={exports:{}}).exports,s),s.exports);var Si=(D,s,h,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of xi(s))!bi.call(D,o)&&o!==h&&ht(D,o,{get:()=>s[o],enumerable:!(i=gi(s,o))||i.enumerable});return D};var _i=(D,s,h)=>(h=D!=null?mi(yi(D)):{},Si(s||!D||!D.__esModule?ht(h,"default",{value:D,enumerable:!0}):h,D));var oe=(D,s,h)=>(Ti(D,typeof s!="symbol"?s+"":s,h),h);var Gt=vi((Kt,ft)=>{(function(D){if(typeof Kt=="object"&&typeof ft<"u")ft.exports=D();else if(typeof define=="function"&&define.amd)define([],D);else{var s;typeof window<"u"?s=window:typeof global<"u"?s=global:typeof self<"u"?s=self:s=this,D()}})(function(){var D,s,h;return function(){function i(o,m,u){function p(r,a){if(!m[r]){if(!o[r]){var t=typeof ze=="function"&&ze;if(!a&&t)return t(r,!0);if(d)return d(r,!0);var n=new Error("Cannot find module \'"+r+"\'");throw n.code="MODULE_NOT_FOUND",n}var g=m[r]={exports:{}};o[r][0].call(g.exports,function(v){var k=o[r][1][v];return p(k||v)},g,g.exports,i,o,m,u)}return m[r].exports}for(var d=typeof ze=="function"&&ze,f=0;f<u.length;f++)p(u[f]);return p}return i}()({1:[function(i,o,m){(function(u,p){typeof m=="object"&&typeof o<"u"?p(m):typeof D=="function"&&D.amd?D(["exports"],p):(u=u||self,p(u.acorn={}))})(this,function(u){"use strict";var p={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},d="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",f={5:d,"5module":d+" export import",6:d+" const class extends export import super"},r=/^in(stanceof)?$/,a="\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0560-\\u0588\\u05D0-\\u05EA\\u05EF-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E86-\\u0E8A\\u0E8C-\\u0EA3\\u0EA5\\u0EA7-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1878\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1C90-\\u1CBA\\u1CBD-\\u1CBF\\u1CE9-\\u1CEC\\u1CEE-\\u1CF3\\u1CF5\\u1CF6\\u1CFA\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2118-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309B-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312F\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEF\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7BF\\uA7C2-\\uA7C6\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA8FE\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB67\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC",t="\\u200C\\u200D\\xB7\\u0300-\\u036F\\u0387\\u0483-\\u0487\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u0610-\\u061A\\u064B-\\u0669\\u0670\\u06D6-\\u06DC\\u06DF-\\u06E4\\u06E7\\u06E8\\u06EA-\\u06ED\\u06F0-\\u06F9\\u0711\\u0730-\\u074A\\u07A6-\\u07B0\\u07C0-\\u07C9\\u07EB-\\u07F3\\u07FD\\u0816-\\u0819\\u081B-\\u0823\\u0825-\\u0827\\u0829-\\u082D\\u0859-\\u085B\\u08D3-\\u08E1\\u08E3-\\u0903\\u093A-\\u093C\\u093E-\\u094F\\u0951-\\u0957\\u0962\\u0963\\u0966-\\u096F\\u0981-\\u0983\\u09BC\\u09BE-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CD\\u09D7\\u09E2\\u09E3\\u09E6-\\u09EF\\u09FE\\u0A01-\\u0A03\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A66-\\u0A71\\u0A75\\u0A81-\\u0A83\\u0ABC\\u0ABE-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AE2\\u0AE3\\u0AE6-\\u0AEF\\u0AFA-\\u0AFF\\u0B01-\\u0B03\\u0B3C\\u0B3E-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B62\\u0B63\\u0B66-\\u0B6F\\u0B82\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C04\\u0C3E-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C62\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0CBC\\u0CBE-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CE2\\u0CE3\\u0CE6-\\u0CEF\\u0D00-\\u0D03\\u0D3B\\u0D3C\\u0D3E-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4D\\u0D57\\u0D62\\u0D63\\u0D66-\\u0D6F\\u0D82\\u0D83\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E\\u0E50-\\u0E59\\u0EB1\\u0EB4-\\u0EBC\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E\\u0F3F\\u0F71-\\u0F84\\u0F86\\u0F87\\u0F8D-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u102B-\\u103E\\u1040-\\u1049\\u1056-\\u1059\\u105E-\\u1060\\u1062-\\u1064\\u1067-\\u106D\\u1071-\\u1074\\u1082-\\u108D\\u108F-\\u109D\\u135D-\\u135F\\u1369-\\u1371\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17B4-\\u17D3\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u18A9\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u194F\\u19D0-\\u19DA\\u1A17-\\u1A1B\\u1A55-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AB0-\\u1ABD\\u1B00-\\u1B04\\u1B34-\\u1B44\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1B82\\u1BA1-\\u1BAD\\u1BB0-\\u1BB9\\u1BE6-\\u1BF3\\u1C24-\\u1C37\\u1C40-\\u1C49\\u1C50-\\u1C59\\u1CD0-\\u1CD2\\u1CD4-\\u1CE8\\u1CED\\u1CF4\\u1CF7-\\u1CF9\\u1DC0-\\u1DF9\\u1DFB-\\u1DFF\\u203F\\u2040\\u2054\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2CEF-\\u2CF1\\u2D7F\\u2DE0-\\u2DFF\\u302A-\\u302F\\u3099\\u309A\\uA620-\\uA629\\uA66F\\uA674-\\uA67D\\uA69E\\uA69F\\uA6F0\\uA6F1\\uA802\\uA806\\uA80B\\uA823-\\uA827\\uA880\\uA881\\uA8B4-\\uA8C5\\uA8D0-\\uA8D9\\uA8E0-\\uA8F1\\uA8FF-\\uA909\\uA926-\\uA92D\\uA947-\\uA953\\uA980-\\uA983\\uA9B3-\\uA9C0\\uA9D0-\\uA9D9\\uA9E5\\uA9F0-\\uA9F9\\uAA29-\\uAA36\\uAA43\\uAA4C\\uAA4D\\uAA50-\\uAA59\\uAA7B-\\uAA7D\\uAAB0\\uAAB2-\\uAAB4\\uAAB7\\uAAB8\\uAABE\\uAABF\\uAAC1\\uAAEB-\\uAAEF\\uAAF5\\uAAF6\\uABE3-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uFB1E\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFF10-\\uFF19\\uFF3F",n=new RegExp("["+a+"]"),g=new RegExp("["+a+t+"]");a=t=null;var v=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,155,22,13,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,0,33,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,0,161,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,754,9486,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],k=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,232,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,792487,239];function T(e,l){for(var S=65536,I=0;I<l.length;I+=2){if(S+=l[I],S>e)return!1;if(S+=l[I+1],S>=e)return!0}}function A(e,l){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&n.test(String.fromCharCode(e)):l===!1?!1:T(e,v)}function E(e,l){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&g.test(String.fromCharCode(e)):l===!1?!1:T(e,v)||T(e,k)}var y=function(l,S){S===void 0&&(S={}),this.label=l,this.keyword=S.keyword,this.beforeExpr=!!S.beforeExpr,this.startsExpr=!!S.startsExpr,this.isLoop=!!S.isLoop,this.isAssign=!!S.isAssign,this.prefix=!!S.prefix,this.postfix=!!S.postfix,this.binop=S.binop||null,this.updateContext=null};function _(e,l){return new y(e,{beforeExpr:!0,binop:l})}var w={beforeExpr:!0},L={startsExpr:!0},N={};function b(e,l){return l===void 0&&(l={}),l.keyword=e,N[e]=new y(e,l)}var c={num:new y("num",L),regexp:new y("regexp",L),string:new y("string",L),name:new y("name",L),eof:new y("eof"),bracketL:new y("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new y("]"),braceL:new y("{",{beforeExpr:!0,startsExpr:!0}),braceR:new y("}"),parenL:new y("(",{beforeExpr:!0,startsExpr:!0}),parenR:new y(")"),comma:new y(",",w),semi:new y(";",w),colon:new y(":",w),dot:new y("."),question:new y("?",w),arrow:new y("=>",w),template:new y("template"),invalidTemplate:new y("invalidTemplate"),ellipsis:new y("...",w),backQuote:new y("`",L),dollarBraceL:new y("${",{beforeExpr:!0,startsExpr:!0}),eq:new y("=",{beforeExpr:!0,isAssign:!0}),assign:new y("_=",{beforeExpr:!0,isAssign:!0}),incDec:new y("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new y("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:_("||",1),logicalAND:_("&&",2),bitwiseOR:_("|",3),bitwiseXOR:_("^",4),bitwiseAND:_("&",5),equality:_("==/!=/===/!==",6),relational:_("</>/<=/>=",7),bitShift:_("<</>>/>>>",8),plusMin:new y("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:_("%",10),star:_("*",10),slash:_("/",10),starstar:new y("**",{beforeExpr:!0}),_break:b("break"),_case:b("case",w),_catch:b("catch"),_continue:b("continue"),_debugger:b("debugger"),_default:b("default",w),_do:b("do",{isLoop:!0,beforeExpr:!0}),_else:b("else",w),_finally:b("finally"),_for:b("for",{isLoop:!0}),_function:b("function",L),_if:b("if"),_return:b("return",w),_switch:b("switch"),_throw:b("throw",w),_try:b("try"),_var:b("var"),_const:b("const"),_while:b("while",{isLoop:!0}),_with:b("with"),_new:b("new",{beforeExpr:!0,startsExpr:!0}),_this:b("this",L),_super:b("super",L),_class:b("class",L),_extends:b("extends",w),_export:b("export"),_import:b("import",L),_null:b("null",L),_true:b("true",L),_false:b("false",L),_in:b("in",{beforeExpr:!0,binop:7}),_instanceof:b("instanceof",{beforeExpr:!0,binop:7}),_typeof:b("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:b("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:b("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},C=/\\r\\n?|\\n|\\u2028|\\u2029/,F=new RegExp(C.source,"g");function P(e,l){return e===10||e===13||!l&&(e===8232||e===8233)}var M=/[\\u1680\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]/,$=/(?:\\s|\\/\\/.*|\\/\\*[^]*?\\*\\/)*/g,G=Object.prototype,O=G.hasOwnProperty,Y=G.toString;function W(e,l){return O.call(e,l)}var K=Array.isArray||function(e){return Y.call(e)==="[object Array]"};function J(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var Q=function(l,S){this.line=l,this.column=S};Q.prototype.offset=function(l){return new Q(this.line,this.column+l)};var te=function(l,S,I){this.start=S,this.end=I,l.sourceFile!==null&&(this.source=l.sourceFile)};function H(e,l){for(var S=1,I=0;;){F.lastIndex=I;var R=F.exec(e);if(R&&R.index<l)++S,I=R.index+R[0].length;else return new Q(S,l-I)}}var B={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function he(e){var l={};for(var S in B)l[S]=e&&W(e,S)?e[S]:B[S];if(l.ecmaVersion>=2015&&(l.ecmaVersion-=2009),l.allowReserved==null&&(l.allowReserved=l.ecmaVersion<5),K(l.onToken)){var I=l.onToken;l.onToken=function(R){return I.push(R)}}return K(l.onComment)&&(l.onComment=Z(l,l.onComment)),l}function Z(e,l){return function(S,I,R,V,z,U){var X={type:S?"Block":"Line",value:I,start:R,end:V};e.locations&&(X.loc=new te(this,z,U)),e.ranges&&(X.range=[R,V]),l.push(X)}}var ie=1,Se=2,ee=ie|Se,ce=4,fe=8,me=16,ne=32,ue=64,xe=128;function _e(e,l){return Se|(e?ce:0)|(l?fe:0)}var ke=0,$e=1,Ie=2,Tt=3,vt=4,St=5,pe=function(l,S,I){this.options=l=he(l),this.sourceFile=l.sourceFile,this.keywords=J(f[l.ecmaVersion>=6?6:l.sourceType==="module"?"5module":5]);var R="";if(l.allowReserved!==!0){for(var V=l.ecmaVersion;!(R=p[V]);V--);l.sourceType==="module"&&(R+=" await")}this.reservedWords=J(R);var z=(R?R+" ":"")+p.strict;this.reservedWordsStrict=J(z),this.reservedWordsStrictBind=J(z+" "+p.strictBind),this.input=String(S),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`\n`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(C).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=c.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=l.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&l.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ie),this.regexpState=null},Le={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};pe.prototype.parse=function(){var l=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(l)},Le.inFunction.get=function(){return(this.currentVarScope().flags&Se)>0},Le.inGenerator.get=function(){return(this.currentVarScope().flags&fe)>0},Le.inAsync.get=function(){return(this.currentVarScope().flags&ce)>0},Le.allowSuper.get=function(){return(this.currentThisScope().flags&ue)>0},Le.allowDirectSuper.get=function(){return(this.currentThisScope().flags&xe)>0},Le.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},pe.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Se)>0},pe.extend=function(){for(var l=[],S=arguments.length;S--;)l[S]=arguments[S];for(var I=this,R=0;R<l.length;R++)I=l[R](I);return I},pe.parse=function(l,S){return new this(S,l).parse()},pe.parseExpressionAt=function(l,S,I){var R=new this(I,l,S);return R.nextToken(),R.parseExpression()},pe.tokenizer=function(l,S){return new this(S,l)},Object.defineProperties(pe.prototype,Le);var Te=pe.prototype,Jt=/^(?:\'((?:\\\\.|[^\'])*?)\'|"((?:\\\\.|[^"])*?)")/;Te.strictDirective=function(e){for(;;){$.lastIndex=e,e+=$.exec(this.input)[0].length;var l=Jt.exec(this.input.slice(e));if(!l)return!1;if((l[1]||l[2])==="use strict")return!0;e+=l[0].length,$.lastIndex=e,e+=$.exec(this.input)[0].length,this.input[e]===";"&&e++}},Te.eat=function(e){return this.type===e?(this.next(),!0):!1},Te.isContextual=function(e){return this.type===c.name&&this.value===e&&!this.containsEsc},Te.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1},Te.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},Te.canInsertSemicolon=function(){return this.type===c.eof||this.type===c.braceR||C.test(this.input.slice(this.lastTokEnd,this.start))},Te.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Te.semicolon=function(){!this.eat(c.semi)&&!this.insertSemicolon()&&this.unexpected()},Te.afterTrailingComma=function(e,l){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),l||this.next(),!0},Te.expect=function(e){this.eat(e)||this.unexpected()},Te.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};function Be(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Te.checkPatternErrors=function(e,l){if(!!e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var S=l?e.parenthesizedAssign:e.parenthesizedBind;S>-1&&this.raiseRecoverable(S,"Parenthesized pattern")}},Te.checkExpressionErrors=function(e,l){if(!e)return!1;var S=e.shorthandAssign,I=e.doubleProto;if(!l)return S>=0||I>=0;S>=0&&this.raise(S,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},Te.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Te.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var se=pe.prototype;se.parseTopLevel=function(e){var l={};for(e.body||(e.body=[]);this.type!==c.eof;){var S=this.parseStatement(null,!0,l);e.body.push(S)}if(this.inModule)for(var I=0,R=Object.keys(this.undefinedExports);I<R.length;I+=1){var V=R[I];this.raiseRecoverable(this.undefinedExports[V].start,"Export \'"+V+"\' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var at={kind:"loop"},Zt={kind:"switch"};se.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$.lastIndex=this.pos;var l=$.exec(this.input),S=this.pos+l[0].length,I=this.input.charCodeAt(S);if(I===91)return!0;if(e)return!1;if(I===123)return!0;if(A(I,!0)){for(var R=S+1;E(this.input.charCodeAt(R),!0);)++R;var V=this.input.slice(S,R);if(!r.test(V))return!0}return!1},se.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$.lastIndex=this.pos;var e=$.exec(this.input),l=this.pos+e[0].length;return!C.test(this.input.slice(this.pos,l))&&this.input.slice(l,l+8)==="function"&&(l+8===this.input.length||!E(this.input.charAt(l+8)))},se.parseStatement=function(e,l,S){var I=this.type,R=this.startNode(),V;switch(this.isLet(e)&&(I=c._var,V="let"),I){case c._break:case c._continue:return this.parseBreakContinueStatement(R,I.keyword);case c._debugger:return this.parseDebuggerStatement(R);case c._do:return this.parseDoStatement(R);case c._for:return this.parseForStatement(R);case c._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(R,!1,!e);case c._class:return e&&this.unexpected(),this.parseClass(R,!0);case c._if:return this.parseIfStatement(R);case c._return:return this.parseReturnStatement(R);case c._switch:return this.parseSwitchStatement(R);case c._throw:return this.parseThrowStatement(R);case c._try:return this.parseTryStatement(R);case c._const:case c._var:return V=V||this.value,e&&V!=="var"&&this.unexpected(),this.parseVarStatement(R,V);case c._while:return this.parseWhileStatement(R);case c._with:return this.parseWithStatement(R);case c.braceL:return this.parseBlock(!0,R);case c.semi:return this.parseEmptyStatement(R);case c._export:case c._import:if(this.options.ecmaVersion>10&&I===c._import){$.lastIndex=this.pos;var z=$.exec(this.input),U=this.pos+z[0].length,X=this.input.charCodeAt(U);if(X===40)return this.parseExpressionStatement(R,this.parseExpression())}return this.options.allowImportExportEverywhere||(l||this.raise(this.start,"\'import\' and \'export\' may only appear at the top level"),this.inModule||this.raise(this.start,"\'import\' and \'export\' may appear only with \'sourceType: module\'")),I===c._import?this.parseImport(R):this.parseExport(R,S);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(R,!0,!e);var le=this.value,ve=this.parseExpression();return I===c.name&&ve.type==="Identifier"&&this.eat(c.colon)?this.parseLabeledStatement(R,le,ve,e):this.parseExpressionStatement(R,ve)}},se.parseBreakContinueStatement=function(e,l){var S=l==="break";this.next(),this.eat(c.semi)||this.insertSemicolon()?e.label=null:this.type!==c.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var R=this.labels[I];if((e.label==null||R.name===e.label.name)&&(R.kind!=null&&(S||R.kind==="loop")||e.label&&S))break}return I===this.labels.length&&this.raise(e.start,"Unsyntactic "+l),this.finishNode(e,S?"BreakStatement":"ContinueStatement")},se.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},se.parseDoStatement=function(e){return this.next(),this.labels.push(at),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(c._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(c.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},se.parseForStatement=function(e){this.next();var l=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(at),this.enterScope(0),this.expect(c.parenL),this.type===c.semi)return l>-1&&this.unexpected(l),this.parseFor(e,null);var S=this.isLet();if(this.type===c._var||this.type===c._const||S){var I=this.startNode(),R=S?"let":this.value;return this.next(),this.parseVar(I,!0,R),this.finishNode(I,"VariableDeclaration"),(this.type===c._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===c._in?l>-1&&this.unexpected(l):e.await=l>-1),this.parseForIn(e,I)):(l>-1&&this.unexpected(l),this.parseFor(e,I))}var V=new Be,z=this.parseExpression(!0,V);return this.type===c._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===c._in?l>-1&&this.unexpected(l):e.await=l>-1),this.toAssignable(z,!1,V),this.checkLVal(z),this.parseForIn(e,z)):(this.checkExpressionErrors(V,!0),l>-1&&this.unexpected(l),this.parseFor(e,z))},se.parseFunctionStatement=function(e,l,S){return this.next(),this.parseFunction(e,Oe|(S?0:ot),!1,l)},se.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(c._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},se.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"\'return\' outside of function"),this.next(),this.eat(c.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},se.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(c.braceL),this.labels.push(Zt),this.enterScope(0);for(var l,S=!1;this.type!==c.braceR;)if(this.type===c._case||this.type===c._default){var I=this.type===c._case;l&&this.finishNode(l,"SwitchCase"),e.cases.push(l=this.startNode()),l.consequent=[],this.next(),I?l.test=this.parseExpression():(S&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),S=!0,l.test=null),this.expect(c.colon)}else l||this.unexpected(),l.consequent.push(this.parseStatement(null));return this.exitScope(),l&&this.finishNode(l,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},se.parseThrowStatement=function(e){return this.next(),C.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var Qt=[];se.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===c._catch){var l=this.startNode();if(this.next(),this.eat(c.parenL)){l.param=this.parseBindingAtom();var S=l.param.type==="Identifier";this.enterScope(S?ne:0),this.checkLVal(l.param,S?vt:Ie),this.expect(c.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),l.param=null,this.enterScope(0);l.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(l,"CatchClause")}return e.finalizer=this.eat(c._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},se.parseVarStatement=function(e,l){return this.next(),this.parseVar(e,!1,l),this.semicolon(),this.finishNode(e,"VariableDeclaration")},se.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(at),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},se.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"\'with\' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},se.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},se.parseLabeledStatement=function(e,l,S,I){for(var R=0,V=this.labels;R<V.length;R+=1){var z=V[R];z.name===l&&this.raise(S.start,"Label \'"+l+"\' is already declared")}for(var U=this.type.isLoop?"loop":this.type===c._switch?"switch":null,X=this.labels.length-1;X>=0;X--){var le=this.labels[X];if(le.statementStart===e.start)le.statementStart=this.start,le.kind=U;else break}return this.labels.push({name:l,kind:U,statementStart:this.start}),e.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),e.label=S,this.finishNode(e,"LabeledStatement")},se.parseExpressionStatement=function(e,l){return e.expression=l,this.semicolon(),this.finishNode(e,"ExpressionStatement")},se.parseBlock=function(e,l){for(e===void 0&&(e=!0),l===void 0&&(l=this.startNode()),l.body=[],this.expect(c.braceL),e&&this.enterScope(0);!this.eat(c.braceR);){var S=this.parseStatement(null);l.body.push(S)}return e&&this.exitScope(),this.finishNode(l,"BlockStatement")},se.parseFor=function(e,l){return e.init=l,this.expect(c.semi),e.test=this.type===c.semi?null:this.parseExpression(),this.expect(c.semi),e.update=this.type===c.parenR?null:this.parseExpression(),this.expect(c.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},se.parseForIn=function(e,l){var S=this.type===c._in;return this.next(),l.type==="VariableDeclaration"&&l.declarations[0].init!=null&&(!S||this.options.ecmaVersion<8||this.strict||l.kind!=="var"||l.declarations[0].id.type!=="Identifier")?this.raise(l.start,(S?"for-in":"for-of")+" loop variable declaration may not have an initializer"):l.type==="AssignmentPattern"&&this.raise(l.start,"Invalid left-hand side in for-loop"),e.left=l,e.right=S?this.parseExpression():this.parseMaybeAssign(),this.expect(c.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,S?"ForInStatement":"ForOfStatement")},se.parseVar=function(e,l,S){for(e.declarations=[],e.kind=S;;){var I=this.startNode();if(this.parseVarId(I,S),this.eat(c.eq)?I.init=this.parseMaybeAssign(l):S==="const"&&!(this.type===c._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(l&&(this.type===c._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,e.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(c.comma))break}return e},se.parseVarId=function(e,l){e.id=this.parseBindingAtom(),this.checkLVal(e.id,l==="var"?$e:Ie,!1)};var Oe=1,ot=2,_t=4;se.parseFunction=function(e,l,S,I){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===c.star&&l&ot&&this.unexpected(),e.generator=this.eat(c.star)),this.options.ecmaVersion>=8&&(e.async=!!I),l&Oe&&(e.id=l&_t&&this.type!==c.name?null:this.parseIdent(),e.id&&!(l&ot)&&this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?$e:Ie:Tt));var R=this.yieldPos,V=this.awaitPos,z=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(_e(e.async,e.generator)),l&Oe||(e.id=this.type===c.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,S,!1),this.yieldPos=R,this.awaitPos=V,this.awaitIdentPos=z,this.finishNode(e,l&Oe?"FunctionDeclaration":"FunctionExpression")},se.parseFunctionParams=function(e){this.expect(c.parenL),e.params=this.parseBindingList(c.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},se.parseClass=function(e,l){this.next();var S=this.strict;this.strict=!0,this.parseClassId(e,l),this.parseClassSuper(e);var I=this.startNode(),R=!1;for(I.body=[],this.expect(c.braceL);!this.eat(c.braceR);){var V=this.parseClassElement(e.superClass!==null);V&&(I.body.push(V),V.type==="MethodDefinition"&&V.kind==="constructor"&&(R&&this.raise(V.start,"Duplicate constructor in the same class"),R=!0))}return e.body=this.finishNode(I,"ClassBody"),this.strict=S,this.finishNode(e,l?"ClassDeclaration":"ClassExpression")},se.parseClassElement=function(e){var l=this;if(this.eat(c.semi))return null;var S=this.startNode(),I=function(X,le){le===void 0&&(le=!1);var ve=l.start,Fe=l.startLoc;return l.eatContextual(X)?l.type!==c.parenL&&(!le||!l.canInsertSemicolon())?!0:(S.key&&l.unexpected(),S.computed=!1,S.key=l.startNodeAt(ve,Fe),S.key.name=X,l.finishNode(S.key,"Identifier"),!1):!1};S.kind="method",S.static=I("static");var R=this.eat(c.star),V=!1;R||(this.options.ecmaVersion>=8&&I("async",!0)?(V=!0,R=this.options.ecmaVersion>=9&&this.eat(c.star)):I("get")?S.kind="get":I("set")&&(S.kind="set")),S.key||this.parsePropertyName(S);var z=S.key,U=!1;return!S.computed&&!S.static&&(z.type==="Identifier"&&z.name==="constructor"||z.type==="Literal"&&z.value==="constructor")?(S.kind!=="method"&&this.raise(z.start,"Constructor can\'t have get/set modifier"),R&&this.raise(z.start,"Constructor can\'t be a generator"),V&&this.raise(z.start,"Constructor can\'t be an async method"),S.kind="constructor",U=e):S.static&&z.type==="Identifier"&&z.name==="prototype"&&this.raise(z.start,"Classes may not have a static property named prototype"),this.parseClassMethod(S,R,V,U),S.kind==="get"&&S.value.params.length!==0&&this.raiseRecoverable(S.value.start,"getter should have no params"),S.kind==="set"&&S.value.params.length!==1&&this.raiseRecoverable(S.value.start,"setter should have exactly one param"),S.kind==="set"&&S.value.params[0].type==="RestElement"&&this.raiseRecoverable(S.value.params[0].start,"Setter cannot use rest params"),S},se.parseClassMethod=function(e,l,S,I){return e.value=this.parseMethod(l,S,I),this.finishNode(e,"MethodDefinition")},se.parseClassId=function(e,l){this.type===c.name?(e.id=this.parseIdent(),l&&this.checkLVal(e.id,Ie,!1)):(l===!0&&this.unexpected(),e.id=null)},se.parseClassSuper=function(e){e.superClass=this.eat(c._extends)?this.parseExprSubscripts():null},se.parseExport=function(e,l){if(this.next(),this.eat(c.star))return this.expectContextual("from"),this.type!==c.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(c._default)){this.checkExport(l,"default",this.lastTokStart);var S;if(this.type===c._function||(S=this.isAsyncFunction())){var I=this.startNode();this.next(),S&&this.next(),e.declaration=this.parseFunction(I,Oe|_t,!1,S)}else if(this.type===c._class){var R=this.startNode();e.declaration=this.parseClass(R,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(l,e.declaration.declarations):this.checkExport(l,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(l),this.eatContextual("from"))this.type!==c.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var V=0,z=e.specifiers;V<z.length;V+=1){var U=z[V];this.checkUnreserved(U.local),this.checkLocalExport(U.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},se.checkExport=function(e,l,S){!e||(W(e,l)&&this.raiseRecoverable(S,"Duplicate export \'"+l+"\'"),e[l]=!0)},se.checkPatternExport=function(e,l){var S=l.type;if(S==="Identifier")this.checkExport(e,l.name,l.start);else if(S==="ObjectPattern")for(var I=0,R=l.properties;I<R.length;I+=1){var V=R[I];this.checkPatternExport(e,V)}else if(S==="ArrayPattern")for(var z=0,U=l.elements;z<U.length;z+=1){var X=U[z];X&&this.checkPatternExport(e,X)}else S==="Property"?this.checkPatternExport(e,l.value):S==="AssignmentPattern"?this.checkPatternExport(e,l.left):S==="RestElement"?this.checkPatternExport(e,l.argument):S==="ParenthesizedExpression"&&this.checkPatternExport(e,l.expression)},se.checkVariableExport=function(e,l){if(!!e)for(var S=0,I=l;S<I.length;S+=1){var R=I[S];this.checkPatternExport(e,R.id)}},se.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},se.parseExportSpecifiers=function(e){var l=[],S=!0;for(this.expect(c.braceL);!this.eat(c.braceR);){if(S)S=!1;else if(this.expect(c.comma),this.afterTrailingComma(c.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(e,I.exported.name,I.exported.start),l.push(this.finishNode(I,"ExportSpecifier"))}return l},se.parseImport=function(e){return this.next(),this.type===c.string?(e.specifiers=Qt,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===c.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},se.parseImportSpecifiers=function(){var e=[],l=!0;if(this.type===c.name){var S=this.startNode();if(S.local=this.parseIdent(),this.checkLVal(S.local,Ie),e.push(this.finishNode(S,"ImportDefaultSpecifier")),!this.eat(c.comma))return e}if(this.type===c.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,Ie),e.push(this.finishNode(I,"ImportNamespaceSpecifier")),e}for(this.expect(c.braceL);!this.eat(c.braceR);){if(l)l=!1;else if(this.expect(c.comma),this.afterTrailingComma(c.braceR))break;var R=this.startNode();R.imported=this.parseIdent(!0),this.eatContextual("as")?R.local=this.parseIdent():(this.checkUnreserved(R.imported),R.local=R.imported),this.checkLVal(R.local,Ie),e.push(this.finishNode(R,"ImportSpecifier"))}return e},se.adaptDirectivePrologue=function(e){for(var l=0;l<e.length&&this.isDirectiveCandidate(e[l]);++l)e[l].directive=e[l].expression.raw.slice(1,-1)},se.isDirectiveCandidate=function(e){return e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]===\'"\'||this.input[e.start]==="\'")};var De=pe.prototype;De.toAssignable=function(e,l,S){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use \'await\' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",S&&this.checkPatternErrors(S,!0);for(var I=0,R=e.properties;I<R.length;I+=1){var V=R[I];this.toAssignable(V,l),V.type==="RestElement"&&(V.argument.type==="ArrayPattern"||V.argument.type==="ObjectPattern")&&this.raise(V.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can\'t contain getter or setter"),this.toAssignable(e.value,l);break;case"ArrayExpression":e.type="ArrayPattern",S&&this.checkPatternErrors(S,!0),this.toAssignableList(e.elements,l);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,l),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only \'=\' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,l);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,l,S);break;case"MemberExpression":if(!l)break;default:this.raise(e.start,"Assigning to rvalue")}else S&&this.checkPatternErrors(S,!0);return e},De.toAssignableList=function(e,l){for(var S=e.length,I=0;I<S;I++){var R=e[I];R&&this.toAssignable(R,l)}if(S){var V=e[S-1];this.options.ecmaVersion===6&&l&&V&&V.type==="RestElement"&&V.argument.type!=="Identifier"&&this.unexpected(V.argument.start)}return e},De.parseSpread=function(e){var l=this.startNode();return this.next(),l.argument=this.parseMaybeAssign(!1,e),this.finishNode(l,"SpreadElement")},De.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==c.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},De.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case c.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(c.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case c.braceL:return this.parseObj(!0)}return this.parseIdent()},De.parseBindingList=function(e,l,S){for(var I=[],R=!0;!this.eat(e);)if(R?R=!1:this.expect(c.comma),l&&this.type===c.comma)I.push(null);else{if(S&&this.afterTrailingComma(e))break;if(this.type===c.ellipsis){var V=this.parseRestBinding();this.parseBindingListItem(V),I.push(V),this.type===c.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else{var z=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(z),I.push(z)}}return I},De.parseBindingListItem=function(e){return e},De.parseMaybeDefault=function(e,l,S){if(S=S||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(c.eq))return S;var I=this.startNodeAt(e,l);return I.left=S,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},De.checkLVal=function(e,l,S){switch(l===void 0&&(l=ke),e.type){case"Identifier":l===Ie&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(l?"Binding ":"Assigning to ")+e.name+" in strict mode"),S&&(W(S,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),S[e.name]=!0),l!==ke&&l!==St&&this.declareName(e.name,l,e.start);break;case"MemberExpression":l&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,R=e.properties;I<R.length;I+=1){var V=R[I];this.checkLVal(V,l,S)}break;case"Property":this.checkLVal(e.value,l,S);break;case"ArrayPattern":for(var z=0,U=e.elements;z<U.length;z+=1){var X=U[z];X&&this.checkLVal(X,l,S)}break;case"AssignmentPattern":this.checkLVal(e.left,l,S);break;case"RestElement":this.checkLVal(e.argument,l,S);break;case"ParenthesizedExpression":this.checkLVal(e.expression,l,S);break;default:this.raise(e.start,(l?"Binding":"Assigning to")+" rvalue")}};var re=pe.prototype;re.checkPropClash=function(e,l,S){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var I=e.key,R;switch(I.type){case"Identifier":R=I.name;break;case"Literal":R=String(I.value);break;default:return}var V=e.kind;if(this.options.ecmaVersion>=6){R==="__proto__"&&V==="init"&&(l.proto&&(S?S.doubleProto<0&&(S.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),l.proto=!0);return}R="$"+R;var z=l[R];if(z){var U;V==="init"?U=this.strict&&z.init||z.get||z.set:U=z.init||z[V],U&&this.raiseRecoverable(I.start,"Redefinition of property")}else z=l[R]={init:!1,get:!1,set:!1};z[V]=!0}},re.parseExpression=function(e,l){var S=this.start,I=this.startLoc,R=this.parseMaybeAssign(e,l);if(this.type===c.comma){var V=this.startNodeAt(S,I);for(V.expressions=[R];this.eat(c.comma);)V.expressions.push(this.parseMaybeAssign(e,l));return this.finishNode(V,"SequenceExpression")}return R},re.parseMaybeAssign=function(e,l,S){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var I=!1,R=-1,V=-1;l?(R=l.parenthesizedAssign,V=l.trailingComma,l.parenthesizedAssign=l.trailingComma=-1):(l=new Be,I=!0);var z=this.start,U=this.startLoc;(this.type===c.parenL||this.type===c.name)&&(this.potentialArrowAt=this.start);var X=this.parseMaybeConditional(e,l);if(S&&(X=S.call(this,X,z,U)),this.type.isAssign){var le=this.startNodeAt(z,U);return le.operator=this.value,le.left=this.type===c.eq?this.toAssignable(X,!1,l):X,I||(l.parenthesizedAssign=l.trailingComma=l.doubleProto=-1),l.shorthandAssign>=le.left.start&&(l.shorthandAssign=-1),this.checkLVal(X),this.next(),le.right=this.parseMaybeAssign(e),this.finishNode(le,"AssignmentExpression")}else I&&this.checkExpressionErrors(l,!0);return R>-1&&(l.parenthesizedAssign=R),V>-1&&(l.trailingComma=V),X},re.parseMaybeConditional=function(e,l){var S=this.start,I=this.startLoc,R=this.parseExprOps(e,l);if(this.checkExpressionErrors(l))return R;if(this.eat(c.question)){var V=this.startNodeAt(S,I);return V.test=R,V.consequent=this.parseMaybeAssign(),this.expect(c.colon),V.alternate=this.parseMaybeAssign(e),this.finishNode(V,"ConditionalExpression")}return R},re.parseExprOps=function(e,l){var S=this.start,I=this.startLoc,R=this.parseMaybeUnary(l,!1);return this.checkExpressionErrors(l)||R.start===S&&R.type==="ArrowFunctionExpression"?R:this.parseExprOp(R,S,I,-1,e)},re.parseExprOp=function(e,l,S,I,R){var V=this.type.binop;if(V!=null&&(!R||this.type!==c._in)&&V>I){var z=this.type===c.logicalOR||this.type===c.logicalAND,U=this.value;this.next();var X=this.start,le=this.startLoc,ve=this.parseExprOp(this.parseMaybeUnary(null,!1),X,le,V,R),Fe=this.buildBinary(l,S,e,ve,U,z);return this.parseExprOp(Fe,l,S,I,R)}return e},re.buildBinary=function(e,l,S,I,R,V){var z=this.startNodeAt(e,l);return z.left=S,z.operator=R,z.right=I,this.finishNode(z,V?"LogicalExpression":"BinaryExpression")},re.parseMaybeUnary=function(e,l){var S=this.start,I=this.startLoc,R;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))R=this.parseAwait(),l=!0;else if(this.type.prefix){var V=this.startNode(),z=this.type===c.incDec;V.operator=this.value,V.prefix=!0,this.next(),V.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),z?this.checkLVal(V.argument):this.strict&&V.operator==="delete"&&V.argument.type==="Identifier"?this.raiseRecoverable(V.start,"Deleting local variable in strict mode"):l=!0,R=this.finishNode(V,z?"UpdateExpression":"UnaryExpression")}else{if(R=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return R;for(;this.type.postfix&&!this.canInsertSemicolon();){var U=this.startNodeAt(S,I);U.operator=this.value,U.prefix=!1,U.argument=R,this.checkLVal(R),this.next(),R=this.finishNode(U,"UpdateExpression")}}return!l&&this.eat(c.starstar)?this.buildBinary(S,I,R,this.parseMaybeUnary(null,!1),"**",!1):R},re.parseExprSubscripts=function(e){var l=this.start,S=this.startLoc,I=this.parseExprAtom(e);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var R=this.parseSubscripts(I,l,S);return e&&R.type==="MemberExpression"&&(e.parenthesizedAssign>=R.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=R.start&&(e.parenthesizedBind=-1)),R},re.parseSubscripts=function(e,l,S,I){for(var R=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&this.input.slice(e.start,e.end)==="async";;){var V=this.parseSubscript(e,l,S,I,R);if(V===e||V.type==="ArrowFunctionExpression")return V;e=V}},re.parseSubscript=function(e,l,S,I,R){var V=this.eat(c.bracketL);if(V||this.eat(c.dot)){var z=this.startNodeAt(l,S);z.object=e,z.property=V?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),z.computed=!!V,V&&this.expect(c.bracketR),e=this.finishNode(z,"MemberExpression")}else if(!I&&this.eat(c.parenL)){var U=new Be,X=this.yieldPos,le=this.awaitPos,ve=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Fe=this.parseExprList(c.parenR,this.options.ecmaVersion>=8,!1,U);if(R&&!this.canInsertSemicolon()&&this.eat(c.arrow))return this.checkPatternErrors(U,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use \'await\' as identifier inside an async function"),this.yieldPos=X,this.awaitPos=le,this.awaitIdentPos=ve,this.parseArrowExpression(this.startNodeAt(l,S),Fe,!0);this.checkExpressionErrors(U,!0),this.yieldPos=X||this.yieldPos,this.awaitPos=le||this.awaitPos,this.awaitIdentPos=ve||this.awaitIdentPos;var Ve=this.startNodeAt(l,S);Ve.callee=e,Ve.arguments=Fe,e=this.finishNode(Ve,"CallExpression")}else if(this.type===c.backQuote){var Me=this.startNodeAt(l,S);Me.tag=e,Me.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(Me,"TaggedTemplateExpression")}return e},re.parseExprAtom=function(e){this.type===c.slash&&this.readRegexp();var l,S=this.potentialArrowAt===this.start;switch(this.type){case c._super:return this.allowSuper||this.raise(this.start,"\'super\' keyword outside a method"),l=this.startNode(),this.next(),this.type===c.parenL&&!this.allowDirectSuper&&this.raise(l.start,"super() call outside constructor of a subclass"),this.type!==c.dot&&this.type!==c.bracketL&&this.type!==c.parenL&&this.unexpected(),this.finishNode(l,"Super");case c._this:return l=this.startNode(),this.next(),this.finishNode(l,"ThisExpression");case c.name:var I=this.start,R=this.startLoc,V=this.containsEsc,z=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!V&&z.name==="async"&&!this.canInsertSemicolon()&&this.eat(c._function))return this.parseFunction(this.startNodeAt(I,R),0,!1,!0);if(S&&!this.canInsertSemicolon()){if(this.eat(c.arrow))return this.parseArrowExpression(this.startNodeAt(I,R),[z],!1);if(this.options.ecmaVersion>=8&&z.name==="async"&&this.type===c.name&&!V)return z=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(c.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,R),[z],!0)}return z;case c.regexp:var U=this.value;return l=this.parseLiteral(U.value),l.regex={pattern:U.pattern,flags:U.flags},l;case c.num:case c.string:return this.parseLiteral(this.value);case c._null:case c._true:case c._false:return l=this.startNode(),l.value=this.type===c._null?null:this.type===c._true,l.raw=this.type.keyword,this.next(),this.finishNode(l,"Literal");case c.parenL:var X=this.start,le=this.parseParenAndDistinguishExpression(S);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(le)&&(e.parenthesizedAssign=X),e.parenthesizedBind<0&&(e.parenthesizedBind=X)),le;case c.bracketL:return l=this.startNode(),this.next(),l.elements=this.parseExprList(c.bracketR,!0,!0,e),this.finishNode(l,"ArrayExpression");case c.braceL:return this.parseObj(!1,e);case c._function:return l=this.startNode(),this.next(),this.parseFunction(l,0);case c._class:return this.parseClass(this.startNode(),!1);case c._new:return this.parseNew();case c.backQuote:return this.parseTemplate();case c._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},re.parseExprImport=function(){var e=this.startNode();switch(this.next(),this.type){case c.parenL:return this.parseDynamicImport(e);default:this.unexpected()}},re.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(c.parenR)){var l=this.start;this.eat(c.comma)&&this.eat(c.parenR)?this.raiseRecoverable(l,"Trailing comma is not allowed in import()"):this.unexpected(l)}return this.finishNode(e,"ImportExpression")},re.parseLiteral=function(e){var l=this.startNode();return l.value=e,l.raw=this.input.slice(this.start,this.end),l.raw.charCodeAt(l.raw.length-1)===110&&(l.bigint=l.raw.slice(0,-1)),this.next(),this.finishNode(l,"Literal")},re.parseParenExpression=function(){this.expect(c.parenL);var e=this.parseExpression();return this.expect(c.parenR),e},re.parseParenAndDistinguishExpression=function(e){var l=this.start,S=this.startLoc,I,R=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var V=this.start,z=this.startLoc,U=[],X=!0,le=!1,ve=new Be,Fe=this.yieldPos,Ve=this.awaitPos,Me;for(this.yieldPos=0,this.awaitPos=0;this.type!==c.parenR;)if(X?X=!1:this.expect(c.comma),R&&this.afterTrailingComma(c.parenR,!0)){le=!0;break}else if(this.type===c.ellipsis){Me=this.start,U.push(this.parseParenItem(this.parseRestBinding())),this.type===c.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else U.push(this.parseMaybeAssign(!1,ve,this.parseParenItem));var fi=this.start,di=this.startLoc;if(this.expect(c.parenR),e&&!this.canInsertSemicolon()&&this.eat(c.arrow))return this.checkPatternErrors(ve,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Fe,this.awaitPos=Ve,this.parseParenArrowList(l,S,U);(!U.length||le)&&this.unexpected(this.lastTokStart),Me&&this.unexpected(Me),this.checkExpressionErrors(ve,!0),this.yieldPos=Fe||this.yieldPos,this.awaitPos=Ve||this.awaitPos,U.length>1?(I=this.startNodeAt(V,z),I.expressions=U,this.finishNodeAt(I,"SequenceExpression",fi,di)):I=U[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var zt=this.startNodeAt(l,S);return zt.expression=I,this.finishNode(zt,"ParenthesizedExpression")}else return I},re.parseParenItem=function(e){return e},re.parseParenArrowList=function(e,l,S){return this.parseArrowExpression(this.startNodeAt(e,l),S)};var qt=[];re.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),l=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(c.dot)){e.meta=l;var S=this.containsEsc;return e.property=this.parseIdent(!0),(e.property.name!=="target"||S)&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty")}var I=this.start,R=this.startLoc,V=this.type===c._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),I,R,!0),V&&e.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(c.parenL)?e.arguments=this.parseExprList(c.parenR,this.options.ecmaVersion>=8,!1):e.arguments=qt,this.finishNode(e,"NewExpression")},re.parseTemplateElement=function(e){var l=e.isTagged,S=this.startNode();return this.type===c.invalidTemplate?(l||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),S.value={raw:this.value,cooked:null}):S.value={raw:this.input.slice(this.start,this.end).replace(/\\r\\n?/g,`\n`),cooked:this.value},this.next(),S.tail=this.type===c.backQuote,this.finishNode(S,"TemplateElement")},re.parseTemplate=function(e){e===void 0&&(e={});var l=e.isTagged;l===void 0&&(l=!1);var S=this.startNode();this.next(),S.expressions=[];var I=this.parseTemplateElement({isTagged:l});for(S.quasis=[I];!I.tail;)this.type===c.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(c.dollarBraceL),S.expressions.push(this.parseExpression()),this.expect(c.braceR),S.quasis.push(I=this.parseTemplateElement({isTagged:l}));return this.next(),this.finishNode(S,"TemplateLiteral")},re.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===c.name||this.type===c.num||this.type===c.string||this.type===c.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===c.star)&&!C.test(this.input.slice(this.lastTokEnd,this.start))},re.parseObj=function(e,l){var S=this.startNode(),I=!0,R={};for(S.properties=[],this.next();!this.eat(c.braceR);){if(I)I=!1;else if(this.expect(c.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(c.braceR))break;var V=this.parseProperty(e,l);e||this.checkPropClash(V,R,l),S.properties.push(V)}return this.finishNode(S,e?"ObjectPattern":"ObjectExpression")},re.parseProperty=function(e,l){var S=this.startNode(),I,R,V,z;if(this.options.ecmaVersion>=9&&this.eat(c.ellipsis))return e?(S.argument=this.parseIdent(!1),this.type===c.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(S,"RestElement")):(this.type===c.parenL&&l&&(l.parenthesizedAssign<0&&(l.parenthesizedAssign=this.start),l.parenthesizedBind<0&&(l.parenthesizedBind=this.start)),S.argument=this.parseMaybeAssign(!1,l),this.type===c.comma&&l&&l.trailingComma<0&&(l.trailingComma=this.start),this.finishNode(S,"SpreadElement"));this.options.ecmaVersion>=6&&(S.method=!1,S.shorthand=!1,(e||l)&&(V=this.start,z=this.startLoc),e||(I=this.eat(c.star)));var U=this.containsEsc;return this.parsePropertyName(S),!e&&!U&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(S)?(R=!0,I=this.options.ecmaVersion>=9&&this.eat(c.star),this.parsePropertyName(S,l)):R=!1,this.parsePropertyValue(S,e,I,R,V,z,l,U),this.finishNode(S,"Property")},re.parsePropertyValue=function(e,l,S,I,R,V,z,U){if((S||I)&&this.type===c.colon&&this.unexpected(),this.eat(c.colon))e.value=l?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,z),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===c.parenL)l&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(S,I);else if(!l&&!U&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==c.comma&&this.type!==c.braceR){(S||I)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var X=e.kind==="get"?0:1;if(e.value.params.length!==X){var le=e.value.start;e.kind==="get"?this.raiseRecoverable(le,"getter should have no params"):this.raiseRecoverable(le,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((S||I)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=R),e.kind="init",l?e.value=this.parseMaybeDefault(R,V,e.key):this.type===c.eq&&z?(z.shorthandAssign<0&&(z.shorthandAssign=this.start),e.value=this.parseMaybeDefault(R,V,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()},re.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(c.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(c.bracketR),e.key;e.computed=!1}return e.key=this.type===c.num||this.type===c.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},re.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},re.parseMethod=function(e,l,S){var I=this.startNode(),R=this.yieldPos,V=this.awaitPos,z=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=e),this.options.ecmaVersion>=8&&(I.async=!!l),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(_e(l,I.generator)|ue|(S?xe:0)),this.expect(c.parenL),I.params=this.parseBindingList(c.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=R,this.awaitPos=V,this.awaitIdentPos=z,this.finishNode(I,"FunctionExpression")},re.parseArrowExpression=function(e,l,S){var I=this.yieldPos,R=this.awaitPos,V=this.awaitIdentPos;return this.enterScope(_e(S,!1)|me),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!S),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(l,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=I,this.awaitPos=R,this.awaitIdentPos=V,this.finishNode(e,"ArrowFunctionExpression")},re.parseFunctionBody=function(e,l,S){var I=l&&this.type!==c.braceL,R=this.strict,V=!1;if(I)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var z=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!R||z)&&(V=this.strictDirective(this.end),V&&z&&this.raiseRecoverable(e.start,"Illegal \'use strict\' directive in function with non-simple parameter list"));var U=this.labels;this.labels=[],V&&(this.strict=!0),this.checkParams(e,!R&&!V&&!l&&!S&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=U}this.exitScope(),this.strict&&e.id&&this.checkLVal(e.id,St),this.strict=R},re.isSimpleParamList=function(e){for(var l=0,S=e;l<S.length;l+=1){var I=S[l];if(I.type!=="Identifier")return!1}return!0},re.checkParams=function(e,l){for(var S={},I=0,R=e.params;I<R.length;I+=1){var V=R[I];this.checkLVal(V,$e,l?null:S)}},re.parseExprList=function(e,l,S,I){for(var R=[],V=!0;!this.eat(e);){if(V)V=!1;else if(this.expect(c.comma),l&&this.afterTrailingComma(e))break;var z=void 0;S&&this.type===c.comma?z=null:this.type===c.ellipsis?(z=this.parseSpread(I),I&&this.type===c.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):z=this.parseMaybeAssign(!1,I),R.push(z)}return R},re.checkUnreserved=function(e){var l=e.start,S=e.end,I=e.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(l,"Cannot use \'yield\' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(l,"Cannot use \'await\' as identifier inside an async function"),this.keywords.test(I)&&this.raise(l,"Unexpected keyword \'"+I+"\'"),!(this.options.ecmaVersion<6&&this.input.slice(l,S).indexOf("\\\\")!==-1)){var R=this.strict?this.reservedWordsStrict:this.reservedWords;R.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(l,"Cannot use keyword \'await\' outside an async function"),this.raiseRecoverable(l,"The keyword \'"+I+"\' is reserved"))}},re.parseIdent=function(e,l){var S=this.startNode();return this.type===c.name?S.name=this.value:this.type.keyword?(S.name=this.type.keyword,(S.name==="class"||S.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(S,"Identifier"),e||(this.checkUnreserved(S),S.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=S.start)),S},re.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var l=this.startNode();return this.next(),this.type===c.semi||this.canInsertSemicolon()||this.type!==c.star&&!this.type.startsExpr?(l.delegate=!1,l.argument=null):(l.delegate=this.eat(c.star),l.argument=this.parseMaybeAssign(e)),this.finishNode(l,"YieldExpression")},re.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var We=pe.prototype;We.raise=function(e,l){var S=H(this.input,e);l+=" ("+S.line+":"+S.column+")";var I=new SyntaxError(l);throw I.pos=e,I.loc=S,I.raisedAt=this.pos,I},We.raiseRecoverable=We.raise,We.curPosition=function(){if(this.options.locations)return new Q(this.curLine,this.pos-this.lineStart)};var Re=pe.prototype,ei=function(l){this.flags=l,this.var=[],this.lexical=[],this.functions=[]};Re.enterScope=function(e){this.scopeStack.push(new ei(e))},Re.exitScope=function(){this.scopeStack.pop()},Re.treatFunctionsAsVarInScope=function(e){return e.flags&Se||!this.inModule&&e.flags&ie},Re.declareName=function(e,l,S){var I=!1;if(l===Ie){var R=this.currentScope();I=R.lexical.indexOf(e)>-1||R.functions.indexOf(e)>-1||R.var.indexOf(e)>-1,R.lexical.push(e),this.inModule&&R.flags&ie&&delete this.undefinedExports[e]}else if(l===vt){var V=this.currentScope();V.lexical.push(e)}else if(l===Tt){var z=this.currentScope();this.treatFunctionsAsVar?I=z.lexical.indexOf(e)>-1:I=z.lexical.indexOf(e)>-1||z.var.indexOf(e)>-1,z.functions.push(e)}else for(var U=this.scopeStack.length-1;U>=0;--U){var X=this.scopeStack[U];if(X.lexical.indexOf(e)>-1&&!(X.flags&ne&&X.lexical[0]===e)||!this.treatFunctionsAsVarInScope(X)&&X.functions.indexOf(e)>-1){I=!0;break}if(X.var.push(e),this.inModule&&X.flags&ie&&delete this.undefinedExports[e],X.flags&ee)break}I&&this.raiseRecoverable(S,"Identifier \'"+e+"\' has already been declared")},Re.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)},Re.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Re.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var l=this.scopeStack[e];if(l.flags&ee)return l}},Re.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var l=this.scopeStack[e];if(l.flags&ee&&!(l.flags&me))return l}};var je=function(l,S,I){this.type="",this.start=S,this.end=0,l.options.locations&&(this.loc=new te(l,I)),l.options.directSourceFile&&(this.sourceFile=l.options.directSourceFile),l.options.ranges&&(this.range=[S,0])},He=pe.prototype;He.startNode=function(){return new je(this,this.start,this.startLoc)},He.startNodeAt=function(e,l){return new je(this,e,l)};function wt(e,l,S,I){return e.type=l,e.end=S,this.options.locations&&(e.loc.end=I),this.options.ranges&&(e.range[1]=S),e}He.finishNode=function(e,l){return wt.call(this,e,l,this.lastTokEnd,this.lastTokEndLoc)},He.finishNodeAt=function(e,l,S,I){return wt.call(this,e,l,S,I)};var we=function(l,S,I,R,V){this.token=l,this.isExpr=!!S,this.preserveSpace=!!I,this.override=R,this.generator=!!V},de={b_stat:new we("{",!1),b_expr:new we("{",!0),b_tmpl:new we("${",!1),p_stat:new we("(",!1),p_expr:new we("(",!0),q_tmpl:new we("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new we("function",!1),f_expr:new we("function",!0),f_expr_gen:new we("function",!0,!1,null,!0),f_gen:new we("function",!1,!1,null,!0)},Xe=pe.prototype;Xe.initialContext=function(){return[de.b_stat]},Xe.braceIsBlock=function(e){var l=this.curContext();return l===de.f_expr||l===de.f_stat?!0:e===c.colon&&(l===de.b_stat||l===de.b_expr)?!l.isExpr:e===c._return||e===c.name&&this.exprAllowed?C.test(this.input.slice(this.lastTokEnd,this.start)):e===c._else||e===c.semi||e===c.eof||e===c.parenR||e===c.arrow?!0:e===c.braceL?l===de.b_stat:e===c._var||e===c._const||e===c.name?!1:!this.exprAllowed},Xe.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var l=this.context[e];if(l.token==="function")return l.generator}return!1},Xe.updateContext=function(e){var l,S=this.type;S.keyword&&e===c.dot?this.exprAllowed=!1:(l=S.updateContext)?l.call(this,e):this.exprAllowed=S.beforeExpr},c.parenR.updateContext=c.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===de.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr},c.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?de.b_stat:de.b_expr),this.exprAllowed=!0},c.dollarBraceL.updateContext=function(){this.context.push(de.b_tmpl),this.exprAllowed=!0},c.parenL.updateContext=function(e){var l=e===c._if||e===c._for||e===c._with||e===c._while;this.context.push(l?de.p_stat:de.p_expr),this.exprAllowed=!0},c.incDec.updateContext=function(){},c._function.updateContext=c._class.updateContext=function(e){e.beforeExpr&&e!==c.semi&&e!==c._else&&!(e===c._return&&C.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===c.colon||e===c.braceL)&&this.curContext()===de.b_stat)?this.context.push(de.f_expr):this.context.push(de.f_stat),this.exprAllowed=!1},c.backQuote.updateContext=function(){this.curContext()===de.q_tmpl?this.context.pop():this.context.push(de.q_tmpl),this.exprAllowed=!1},c.star.updateContext=function(e){if(e===c._function){var l=this.context.length-1;this.context[l]===de.f_expr?this.context[l]=de.f_expr_gen:this.context[l]=de.f_gen}this.exprAllowed=!0},c.name.updateContext=function(e){var l=!1;this.options.ecmaVersion>=6&&e!==c.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(l=!0),this.exprAllowed=l};var Et="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",At=Et+" Extended_Pictographic",ti=At,ii={9:Et,10:At,11:ti},kt="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",It="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Dt=It+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ni=Dt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",si={9:It,10:Dt,11:ni},Ct={};function ut(e){var l=Ct[e]={binary:J(ii[e]+" "+kt),nonBinary:{General_Category:J(kt),Script:J(si[e])}};l.nonBinary.Script_Extensions=l.nonBinary.Script,l.nonBinary.gc=l.nonBinary.General_Category,l.nonBinary.sc=l.nonBinary.Script,l.nonBinary.scx=l.nonBinary.Script_Extensions}ut(9),ut(10),ut(11);var j=pe.prototype,Ce=function(l){this.parser=l,this.validFlags="gim"+(l.options.ecmaVersion>=6?"uy":"")+(l.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Ct[l.options.ecmaVersion>=11?11:l.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ce.prototype.reset=function(l,S,I){var R=I.indexOf("u")!==-1;this.start=l|0,this.source=S+"",this.flags=I,this.switchU=R&&this.parser.options.ecmaVersion>=6,this.switchN=R&&this.parser.options.ecmaVersion>=9},Ce.prototype.raise=function(l){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+l)},Ce.prototype.at=function(l){var S=this.source,I=S.length;if(l>=I)return-1;var R=S.charCodeAt(l);if(!this.switchU||R<=55295||R>=57344||l+1>=I)return R;var V=S.charCodeAt(l+1);return V>=56320&&V<=57343?(R<<10)+V-56613888:R},Ce.prototype.nextIndex=function(l){var S=this.source,I=S.length;if(l>=I)return I;var R=S.charCodeAt(l),V;return!this.switchU||R<=55295||R>=57344||l+1>=I||(V=S.charCodeAt(l+1))<56320||V>57343?l+1:l+2},Ce.prototype.current=function(){return this.at(this.pos)},Ce.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},Ce.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},Ce.prototype.eat=function(l){return this.current()===l?(this.advance(),!0):!1};function Ye(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}j.validateRegExpFlags=function(e){for(var l=e.validFlags,S=e.flags,I=0;I<S.length;I++){var R=S.charAt(I);l.indexOf(R)===-1&&this.raise(e.start,"Invalid regular expression flag"),S.indexOf(R,I+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},j.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},j.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched \')\'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var l=0,S=e.backReferenceNames;l<S.length;l+=1){var I=S[l];e.groupNames.indexOf(I)===-1&&e.raise("Invalid named capture referenced")}},j.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},j.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},j.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1},j.regexp_eatAssertion=function(e){var l=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=l}if(e.eat(40)&&e.eat(63)){var S=!1;if(this.options.ecmaVersion>=9&&(S=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!S,!0}return e.pos=l,!1},j.regexp_eatQuantifier=function(e,l){return l===void 0&&(l=!1),this.regexp_eatQuantifierPrefix(e,l)?(e.eat(63),!0):!1},j.regexp_eatQuantifierPrefix=function(e,l){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,l)},j.regexp_eatBracedQuantifier=function(e,l){var S=e.pos;if(e.eat(123)){var I=0,R=-1;if(this.regexp_eatDecimalDigits(e)&&(I=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(R=e.lastIntValue),e.eat(125)))return R!==-1&&R<I&&!l&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!l&&e.raise("Incomplete quantifier"),e.pos=S}return!1},j.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},j.regexp_eatReverseSolidusAtomEscape=function(e){var l=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=l}return!1},j.regexp_eatUncapturingGroup=function(e){var l=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=l}return!1},j.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},j.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},j.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},j.regexp_eatSyntaxCharacter=function(e){var l=e.current();return Ft(l)?(e.lastIntValue=l,e.advance(),!0):!1};function Ft(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}j.regexp_eatPatternCharacters=function(e){for(var l=e.pos,S=0;(S=e.current())!==-1&&!Ft(S);)e.advance();return e.pos!==l},j.regexp_eatExtendedPatternCharacter=function(e){var l=e.current();return l!==-1&&l!==36&&!(l>=40&&l<=43)&&l!==46&&l!==63&&l!==91&&l!==94&&l!==124?(e.advance(),!0):!1},j.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e)){e.groupNames.indexOf(e.lastStringValue)!==-1&&e.raise("Duplicate capture group name"),e.groupNames.push(e.lastStringValue);return}e.raise("Invalid group")}},j.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},j.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Ye(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Ye(e.lastIntValue);return!0}return!1},j.regexp_eatRegExpIdentifierStart=function(e){var l=e.pos,S=e.current();return e.advance(),S===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(S=e.lastIntValue),ri(S)?(e.lastIntValue=S,!0):(e.pos=l,!1)};function ri(e){return A(e,!0)||e===36||e===95}j.regexp_eatRegExpIdentifierPart=function(e){var l=e.pos,S=e.current();return e.advance(),S===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(S=e.lastIntValue),ai(S)?(e.lastIntValue=S,!0):(e.pos=l,!1)};function ai(e){return E(e,!0)||e===36||e===95||e===8204||e===8205}j.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},j.regexp_eatBackReference=function(e){var l=e.pos;if(this.regexp_eatDecimalEscape(e)){var S=e.lastIntValue;if(e.switchU)return S>e.maxBackReference&&(e.maxBackReference=S),!0;if(S<=e.numCapturingParens)return!0;e.pos=l}return!1},j.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},j.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},j.regexp_eatCControlLetter=function(e){var l=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=l}return!1},j.regexp_eatZero=function(e){return e.current()===48&&!Je(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1},j.regexp_eatControlEscape=function(e){var l=e.current();return l===116?(e.lastIntValue=9,e.advance(),!0):l===110?(e.lastIntValue=10,e.advance(),!0):l===118?(e.lastIntValue=11,e.advance(),!0):l===102?(e.lastIntValue=12,e.advance(),!0):l===114?(e.lastIntValue=13,e.advance(),!0):!1},j.regexp_eatControlLetter=function(e){var l=e.current();return Rt(l)?(e.lastIntValue=l%32,e.advance(),!0):!1};function Rt(e){return e>=65&&e<=90||e>=97&&e<=122}j.regexp_eatRegExpUnicodeEscapeSequence=function(e){var l=e.pos;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var S=e.lastIntValue;if(e.switchU&&S>=55296&&S<=56319){var I=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var R=e.lastIntValue;if(R>=56320&&R<=57343)return e.lastIntValue=(S-55296)*1024+(R-56320)+65536,!0}e.pos=I,e.lastIntValue=S}return!0}if(e.switchU&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&oi(e.lastIntValue))return!0;e.switchU&&e.raise("Invalid unicode escape"),e.pos=l}return!1};function oi(e){return e>=0&&e<=1114111}j.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var l=e.current();return l!==99&&(!e.switchN||l!==107)?(e.lastIntValue=l,e.advance(),!0):!1},j.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var l=e.current();if(l>=49&&l<=57){do e.lastIntValue=10*e.lastIntValue+(l-48),e.advance();while((l=e.current())>=48&&l<=57);return!0}return!1},j.regexp_eatCharacterClassEscape=function(e){var l=e.current();if(ui(l))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(l===80||l===112)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1};function ui(e){return e===100||e===68||e===115||e===83||e===119||e===87}j.regexp_eatUnicodePropertyValueExpression=function(e){var l=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var S=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var I=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,S,I),!0}}if(e.pos=l,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var R=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,R),!0}return!1},j.regexp_validateUnicodePropertyNameAndValue=function(e,l,S){W(e.unicodeProperties.nonBinary,l)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[l].test(S)||e.raise("Invalid property value")},j.regexp_validateUnicodePropertyNameOrValue=function(e,l){e.unicodeProperties.binary.test(l)||e.raise("Invalid property name")},j.regexp_eatUnicodePropertyName=function(e){var l=0;for(e.lastStringValue="";Lt(l=e.current());)e.lastStringValue+=Ye(l),e.advance();return e.lastStringValue!==""};function Lt(e){return Rt(e)||e===95}j.regexp_eatUnicodePropertyValue=function(e){var l=0;for(e.lastStringValue="";li(l=e.current());)e.lastStringValue+=Ye(l),e.advance();return e.lastStringValue!==""};function li(e){return Lt(e)||Je(e)}j.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},j.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},j.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var l=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var S=e.lastIntValue;e.switchU&&(l===-1||S===-1)&&e.raise("Invalid character class"),l!==-1&&S!==-1&&l>S&&e.raise("Range out of order in character class")}}},j.regexp_eatClassAtom=function(e){var l=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var S=e.current();(S===99||Vt(S))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=l}var I=e.current();return I!==93?(e.lastIntValue=I,e.advance(),!0):!1},j.regexp_eatClassEscape=function(e){var l=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=l}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},j.regexp_eatClassControlLetter=function(e){var l=e.current();return Je(l)||l===95?(e.lastIntValue=l%32,e.advance(),!0):!1},j.regexp_eatHexEscapeSequence=function(e){var l=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=l}return!1},j.regexp_eatDecimalDigits=function(e){var l=e.pos,S=0;for(e.lastIntValue=0;Je(S=e.current());)e.lastIntValue=10*e.lastIntValue+(S-48),e.advance();return e.pos!==l};function Je(e){return e>=48&&e<=57}j.regexp_eatHexDigits=function(e){var l=e.pos,S=0;for(e.lastIntValue=0;Mt(S=e.current());)e.lastIntValue=16*e.lastIntValue+$t(S),e.advance();return e.pos!==l};function Mt(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function $t(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}j.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var l=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var S=e.lastIntValue;l<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=l*64+S*8+e.lastIntValue:e.lastIntValue=l*8+S}else e.lastIntValue=l;return!0}return!1},j.regexp_eatOctalDigit=function(e){var l=e.current();return Vt(l)?(e.lastIntValue=l-48,e.advance(),!0):(e.lastIntValue=0,!1)};function Vt(e){return e>=48&&e<=55}j.regexp_eatFixedHexDigits=function(e,l){var S=e.pos;e.lastIntValue=0;for(var I=0;I<l;++I){var R=e.current();if(!Mt(R))return e.pos=S,!1;e.lastIntValue=16*e.lastIntValue+$t(R),e.advance()}return!0};var Ze=function(l){this.type=l.type,this.value=l.value,this.start=l.start,this.end=l.end,l.options.locations&&(this.loc=new te(l,l.startLoc,l.endLoc)),l.options.ranges&&(this.range=[l.start,l.end])},ae=pe.prototype;ae.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ze(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ae.getToken=function(){return this.next(),new Ze(this)},typeof Symbol<"u"&&(ae[Symbol.iterator]=function(){var e=this;return{next:function(){var l=e.getToken();return{done:l.type===c.eof,value:l}}}}),ae.curContext=function(){return this.context[this.context.length-1]},ae.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(c.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())},ae.readToken=function(e){return A(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)},ae.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;var l=this.input.charCodeAt(this.pos+1);return(e<<10)+l-56613888},ae.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),l=this.pos,S=this.input.indexOf("*/",this.pos+=2);if(S===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=S+2,this.options.locations){F.lastIndex=l;for(var I;(I=F.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(l+2,S),l,this.pos,e,this.curPosition())},ae.skipLineComment=function(e){for(var l=this.pos,S=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!P(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(l+e,this.pos),l,this.pos,S,this.curPosition())},ae.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&M.test(String.fromCharCode(e)))++this.pos;else break e}}},ae.finishToken=function(e,l){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var S=this.type;this.type=e,this.value=l,this.updateContext(S)},ae.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var l=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&l===46?(this.pos+=3,this.finishToken(c.ellipsis)):(++this.pos,this.finishToken(c.dot))},ae.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(c.assign,2):this.finishOp(c.slash,1)},ae.readToken_mult_modulo_exp=function(e){var l=this.input.charCodeAt(this.pos+1),S=1,I=e===42?c.star:c.modulo;return this.options.ecmaVersion>=7&&e===42&&l===42&&(++S,I=c.starstar,l=this.input.charCodeAt(this.pos+2)),l===61?this.finishOp(c.assign,S+1):this.finishOp(I,S)},ae.readToken_pipe_amp=function(e){var l=this.input.charCodeAt(this.pos+1);return l===e?this.finishOp(e===124?c.logicalOR:c.logicalAND,2):l===61?this.finishOp(c.assign,2):this.finishOp(e===124?c.bitwiseOR:c.bitwiseAND,1)},ae.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(c.assign,2):this.finishOp(c.bitwiseXOR,1)},ae.readToken_plus_min=function(e){var l=this.input.charCodeAt(this.pos+1);return l===e?l===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||C.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(c.incDec,2):l===61?this.finishOp(c.assign,2):this.finishOp(c.plusMin,1)},ae.readToken_lt_gt=function(e){var l=this.input.charCodeAt(this.pos+1),S=1;return l===e?(S=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+S)===61?this.finishOp(c.assign,S+1):this.finishOp(c.bitShift,S)):l===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(l===61&&(S=2),this.finishOp(c.relational,S))},ae.readToken_eq_excl=function(e){var l=this.input.charCodeAt(this.pos+1);return l===61?this.finishOp(c.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&l===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(c.arrow)):this.finishOp(e===61?c.eq:c.prefix,1)},ae.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(c.parenL);case 41:return++this.pos,this.finishToken(c.parenR);case 59:return++this.pos,this.finishToken(c.semi);case 44:return++this.pos,this.finishToken(c.comma);case 91:return++this.pos,this.finishToken(c.bracketL);case 93:return++this.pos,this.finishToken(c.bracketR);case 123:return++this.pos,this.finishToken(c.braceL);case 125:return++this.pos,this.finishToken(c.braceR);case 58:return++this.pos,this.finishToken(c.colon);case 63:return++this.pos,this.finishToken(c.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(c.backQuote);case 48:var l=this.input.charCodeAt(this.pos+1);if(l===120||l===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(l===111||l===79)return this.readRadixNumber(8);if(l===98||l===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(c.prefix,1)}this.raise(this.pos,"Unexpected character \'"+lt(e)+"\'")},ae.finishOp=function(e,l){var S=this.input.slice(this.pos,this.pos+l);return this.pos+=l,this.finishToken(e,S)},ae.readRegexp=function(){for(var e,l,S=this.pos;;){this.pos>=this.input.length&&this.raise(S,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(C.test(I)&&this.raise(S,"Unterminated regular expression"),e)e=!1;else{if(I==="[")l=!0;else if(I==="]"&&l)l=!1;else if(I==="/"&&!l)break;e=I==="\\\\"}++this.pos}var R=this.input.slice(S,this.pos);++this.pos;var V=this.pos,z=this.readWord1();this.containsEsc&&this.unexpected(V);var U=this.regexpState||(this.regexpState=new Ce(this));U.reset(S,R,z),this.validateRegExpFlags(U),this.validateRegExpPattern(U);var X=null;try{X=new RegExp(R,z)}catch{}return this.finishToken(c.regexp,{pattern:R,flags:z,value:X})},ae.readInt=function(e,l){for(var S=this.pos,I=0,R=0,V=l??1/0;R<V;++R){var z=this.input.charCodeAt(this.pos),U=void 0;if(z>=97?U=z-97+10:z>=65?U=z-65+10:z>=48&&z<=57?U=z-48:U=1/0,U>=e)break;++this.pos,I=I*e+U}return this.pos===S||l!=null&&this.pos-S!==l?null:I},ae.readRadixNumber=function(e){var l=this.pos;this.pos+=2;var S=this.readInt(e);return S==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(S=typeof BigInt<"u"?BigInt(this.input.slice(l,this.pos)):null,++this.pos):A(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(c.num,S)},ae.readNumber=function(e){var l=this.pos;!e&&this.readInt(10)===null&&this.raise(l,"Invalid number");var S=this.pos-l>=2&&this.input.charCodeAt(l)===48;S&&this.strict&&this.raise(l,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!S&&!e&&this.options.ecmaVersion>=11&&I===110){var R=this.input.slice(l,this.pos),V=typeof BigInt<"u"?BigInt(R):null;return++this.pos,A(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(c.num,V)}S&&/[89]/.test(this.input.slice(l,this.pos))&&(S=!1),I===46&&!S&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!S&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(l,"Invalid number")),A(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var z=this.input.slice(l,this.pos),U=S?parseInt(z,8):parseFloat(z);return this.finishToken(c.num,U)},ae.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),l;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var S=++this.pos;l=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,l>1114111&&this.invalidStringToken(S,"Code point out of bounds")}else l=this.readHexChar(4);return l};function lt(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}ae.readString=function(e){for(var l="",S=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===e)break;I===92?(l+=this.input.slice(S,this.pos),l+=this.readEscapedChar(!1),S=this.pos):(P(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return l+=this.input.slice(S,this.pos++),this.finishToken(c.string,l)};var Nt={};ae.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===Nt)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1},ae.invalidStringToken=function(e,l){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Nt;this.raise(e,l)},ae.readTmplToken=function(){for(var e="",l=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var S=this.input.charCodeAt(this.pos);if(S===96||S===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===c.template||this.type===c.invalidTemplate)?S===36?(this.pos+=2,this.finishToken(c.dollarBraceL)):(++this.pos,this.finishToken(c.backQuote)):(e+=this.input.slice(l,this.pos),this.finishToken(c.template,e));if(S===92)e+=this.input.slice(l,this.pos),e+=this.readEscapedChar(!0),l=this.pos;else if(P(S)){switch(e+=this.input.slice(l,this.pos),++this.pos,S){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`\n`;break;default:e+=String.fromCharCode(S);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),l=this.pos}else++this.pos}},ae.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(c.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ae.readEscapedChar=function(e){var l=this.input.charCodeAt(++this.pos);switch(++this.pos,l){case 110:return`\n`;case 114:return"\\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return lt(this.readCodePoint());case 116:return"	";case 98:return"\\b";case 118:return"\\v";case 102:return"\\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var S=this.pos-1;return this.invalidStringToken(S,"Invalid escape sequence in template string"),null}default:if(l>=48&&l<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],R=parseInt(I,8);return R>255&&(I=I.slice(0,-1),R=parseInt(I,8)),this.pos+=I.length-1,l=this.input.charCodeAt(this.pos),(I!=="0"||l===56||l===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-I.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(R)}return P(l)?"":String.fromCharCode(l)}},ae.readHexChar=function(e){var l=this.pos,S=this.readInt(16,e);return S===null&&this.invalidStringToken(l,"Bad character escape sequence"),S},ae.readWord1=function(){this.containsEsc=!1;for(var e="",l=!0,S=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var R=this.fullCharCodeAtPos();if(E(R,I))this.pos+=R<=65535?1:2;else if(R===92){this.containsEsc=!0,e+=this.input.slice(S,this.pos);var V=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\\\uXXXX"),++this.pos;var z=this.readCodePoint();(l?A:E)(z,I)||this.invalidStringToken(V,"Invalid Unicode escape"),e+=lt(z),S=this.pos}else break;l=!1}return e+this.input.slice(S,this.pos)},ae.readWord=function(){var e=this.readWord1(),l=c.name;return this.keywords.test(e)&&(l=N[e]),this.finishToken(l,e)};var Ot="7.1.0";pe.acorn={Parser:pe,version:Ot,defaultOptions:B,Position:Q,SourceLocation:te,getLineInfo:H,Node:je,TokenType:y,tokTypes:c,keywordTypes:N,TokContext:we,tokContexts:de,isIdentifierChar:E,isIdentifierStart:A,Token:Ze,isNewLine:P,lineBreak:C,lineBreakG:F,nonASCIIwhitespace:M};function hi(e,l){return pe.parse(e,l)}function ci(e,l,S){return pe.parseExpressionAt(e,l,S)}function pi(e,l){return pe.tokenizer(e,l)}u.Node=je,u.Parser=pe,u.Position=Q,u.SourceLocation=te,u.TokContext=we,u.Token=Ze,u.TokenType=y,u.defaultOptions=B,u.getLineInfo=H,u.isIdentifierChar=E,u.isIdentifierStart=A,u.isNewLine=P,u.keywordTypes=N,u.lineBreak=C,u.lineBreakG=F,u.nonASCIIwhitespace=M,u.parse=hi,u.parseExpressionAt=ci,u.tokContexts=de,u.tokTypes=c,u.tokenizer=pi,u.version=Ot,Object.defineProperty(u,"__esModule",{value:!0})})},{}],2:[function(i,o,m){},{}],3:[function(i,o,m){function u(a,t={}){let{contextName:n="gl",throwGetError:g,useTrackablePrimitives:v,readPixelsFile:k,recording:T=[],variables:A={},onReadPixels:E,onUnrecognizedArgumentLookup:y}=t,_=new Proxy(a,{get:C}),w=[],L={},N=0,b="",c;return _;function C(H,B){switch(B){case"addComment":return W;case"checkThrowError":return K;case"getReadPixelsVariableName":return c;case"insertVariable":return M;case"reset":return P;case"setIndent":return G;case"toString":return F;case"getContextVariableName":return te}return typeof a[B]=="function"?function(){switch(B){case"getError":return g?T.push(`${b}if (${n}.getError() !== ${n}.NONE) throw new Error(\'error\');`):T.push(`${b}${n}.getError();`),a.getError();case"getExtension":{let ee=`${n}Variables${w.length}`;T.push(`${b}const ${ee} = ${n}.getExtension(\'${arguments[0]}\');`);let ce=a.getExtension(arguments[0]);if(ce&&typeof ce=="object"){let fe=p(ce,{getEntity:$,useTrackablePrimitives:v,recording:T,contextName:ee,contextVariables:w,variables:A,indent:b,onUnrecognizedArgumentLookup:y});return w.push(fe),fe}else w.push(null);return ce}case"readPixels":let Z=w.indexOf(arguments[6]),ie;if(Z===-1){let ee=Q(arguments[6]);ee?(ie=ee,T.push(`${b}${ee}`)):(ie=`${n}Variable${w.length}`,w.push(arguments[6]),T.push(`${b}const ${ie} = new ${arguments[6].constructor.name}(${arguments[6].length});`))}else ie=`${n}Variable${Z}`;c=ie;let Se=[arguments[0],arguments[1],arguments[2],arguments[3],$(arguments[4]),$(arguments[5]),ie];return T.push(`${b}${n}.readPixels(${Se.join(", ")});`),k&&Y(arguments[2],arguments[3]),E&&E(ie,Se),a.readPixels.apply(a,arguments);case"drawBuffers":return T.push(`${b}${n}.drawBuffers([${d(arguments[0],{contextName:n,contextVariables:w,getEntity:$,addVariable:O,variables:A,onUnrecognizedArgumentLookup:y})}]);`),a.drawBuffers(arguments[0])}let he=a[B].apply(a,arguments);switch(typeof he){case"undefined":T.push(`${b}${J(B,arguments)};`);return;case"number":case"boolean":if(v&&w.indexOf(r(he))===-1){T.push(`${b}const ${n}Variable${w.length} = ${J(B,arguments)};`),w.push(he=r(he));break}default:he===null?T.push(`${J(B,arguments)};`):T.push(`${b}const ${n}Variable${w.length} = ${J(B,arguments)};`),w.push(he)}return he}:(L[a[B]]=B,a[B])}function F(){return T.join(`\n`)}function P(){for(;T.length>0;)T.pop()}function M(H,B){A[H]=B}function $(H){let B=L[H];return B?n+"."+B:H}function G(H){b=" ".repeat(H)}function O(H,B){let he=`${n}Variable${w.length}`;return T.push(`${b}const ${he} = ${B};`),w.push(H),he}function Y(H,B){let he=`${n}Variable${w.length}`,Z=`imageDatum${N}`;T.push(`${b}let ${Z} = ["P3\\\\n# ${k}.ppm\\\\n", ${H}, \' \', ${B}, "\\\\n255\\\\n"].join("");`),T.push(`${b}for (let i = 0; i < ${Z}.length; i += 4) {`),T.push(`${b}  ${Z} += ${he}[i] + \' \' + ${he}[i + 1] + \' \' + ${he}[i + 2] + \' \';`),T.push(`${b}}`),T.push(`${b}if (typeof require !== "undefined") {`),T.push(`${b}  require(\'fs\').writeFileSync(\'./${k}.ppm\', ${Z});`),T.push(`${b}}`),N++}function W(H){T.push(`${b}// ${H}`)}function K(){T.push(`${b}(() => {\n      ${b}const error = ${n}.getError();\n      ${b}if (error !== ${n}.NONE) {\n      ${b}  const names = Object.getOwnPropertyNames(gl);\n      ${b}  for (let i = 0; i < names.length; i++) {\n      ${b}    const name = names[i];\n      ${b}    if (${n}[name] === error) {\n      ${b}      throw new Error(\'${n} threw \' + name);\n      ${b}    }\n      ${b}  }\n      ${b}}\n      ${b}})();`)}function J(H,B){return`${n}.${H}(${d(B,{contextName:n,contextVariables:w,getEntity:$,addVariable:O,variables:A,onUnrecognizedArgumentLookup:y})})`}function Q(H){if(A){for(let B in A)if(A[B]===H)return B}return null}function te(H){let B=w.indexOf(H);return B!==-1?`${n}Variable${B}`:null}}function p(a,t){let n=new Proxy(a,{get:L}),g={},{contextName:v,contextVariables:k,getEntity:T,useTrackablePrimitives:A,recording:E,variables:y,indent:_,onUnrecognizedArgumentLookup:w}=t;return n;function L(C,F){return typeof C[F]=="function"?function(){switch(F){case"drawBuffersWEBGL":return E.push(`${_}${v}.drawBuffersWEBGL([${d(arguments[0],{contextName:v,contextVariables:k,getEntity:N,addVariable:c,variables:y,onUnrecognizedArgumentLookup:w})}]);`),a.drawBuffersWEBGL(arguments[0])}let P=a[F].apply(a,arguments);switch(typeof P){case"undefined":E.push(`${_}${b(F,arguments)};`);return;case"number":case"boolean":A&&k.indexOf(r(P))===-1?(E.push(`${_}const ${v}Variable${k.length} = ${b(F,arguments)};`),k.push(P=r(P))):(E.push(`${_}const ${v}Variable${k.length} = ${b(F,arguments)};`),k.push(P));break;default:P===null?E.push(`${b(F,arguments)};`):E.push(`${_}const ${v}Variable${k.length} = ${b(F,arguments)};`),k.push(P)}return P}:(g[a[F]]=F,a[F])}function N(C){return g.hasOwnProperty(C)?`${v}.${g[C]}`:T(C)}function b(C,F){return`${v}.${C}(${d(F,{contextName:v,contextVariables:k,getEntity:N,addVariable:c,variables:y,onUnrecognizedArgumentLookup:w})})`}function c(C,F){let P=`${v}Variable${k.length}`;return k.push(C),E.push(`${_}const ${P} = ${F};`),P}}function d(a,t){let{variables:n,onUnrecognizedArgumentLookup:g}=t;return Array.from(a).map(k=>{let T=v(k);return T||f(k,t)}).join(", ");function v(k){if(n){for(let T in n)if(!!n.hasOwnProperty(T)&&n[T]===k)return T}return g?g(k):null}}function f(a,t){let{contextName:n,contextVariables:g,getEntity:v,addVariable:k,onUnrecognizedArgumentLookup:T}=t;if(typeof a>"u")return"undefined";if(a===null)return"null";let A=g.indexOf(a);if(A>-1)return`${n}Variable${A}`;switch(a.constructor.name){case"String":let E=/\\n/.test(a),y=/\'/.test(a),_=/"/.test(a);return E?"`"+a+"`":y&&!_?\'"\'+a+\'"\':"\'"+a+"\'";case"Number":return v(a);case"Boolean":return v(a);case"Array":return k(a,`new ${a.constructor.name}([${Array.from(a).join(",")}])`);case"Float32Array":case"Uint8Array":case"Uint16Array":case"Int32Array":return k(a,`new ${a.constructor.name}(${JSON.stringify(Array.from(a))})`);default:if(T){let w=T(a);if(w)return w}throw new Error(`unrecognized argument type ${a.constructor.name}`)}}function r(a){return new a.constructor(a)}typeof o<"u"&&(o.exports={glWiretap:u,glExtensionWiretap:p}),typeof window<"u"&&(u.glExtensionWiretap=p,window.glWiretap=u)},{}],4:[function(i,o,m){function u(k){let T=new Array(k.length);for(let A=0;A<k.length;A++){let E=k[A];E.toArray?T[A]=E.toArray():T[A]=E}return T}function p(){let k=u(arguments),T=new Float32Array(this.output.x);for(let A=0;A<this.output.x;A++)this.thread.x=A,this.thread.y=0,this.thread.z=0,T[A]=this._fn.apply(this,k);return T}function d(){let k=u(arguments),T=new Array(this.output.y);for(let A=0;A<this.output.y;A++){let E=new Float32Array(this.output.x);for(let y=0;y<this.output.x;y++)this.thread.x=y,this.thread.y=A,this.thread.z=0,E[y]=this._fn.apply(this,k);T[A]=E}return T}function f(){let k=u(arguments);for(let T=0;T<this.output.y;T++)for(let A=0;A<this.output.x;A++)this.thread.x=A,this.thread.y=T,this.thread.z=0,this._fn.apply(this,k)}function r(){let k=u(arguments),T=new Array(this.output.z);for(let A=0;A<this.output.z;A++){let E=new Array(this.output.y);for(let y=0;y<this.output.y;y++){let _=new Float32Array(this.output.x);for(let w=0;w<this.output.x;w++)this.thread.x=w,this.thread.y=y,this.thread.z=A,_[w]=this._fn.apply(this,k);E[y]=_}T[A]=E}return T}function a(k){k.setOutput=E=>{k.output=n(E),k.graphical&&t(k)},k.toJSON=()=>{throw new Error("Not usable with gpuMock")},k.setConstants=E=>(k.constants=E,k),k.setGraphical=E=>(k.graphical=E,k),k.setCanvas=E=>(k.canvas=E,k),k.setContext=E=>(k.context=E,k),k.destroy=()=>{},k.validateSettings=()=>{},k.graphical&&k.output&&t(k),k.exec=function(){return new Promise((E,y)=>{try{E(k.apply(k,arguments))}catch(_){y(_)}})},k.getPixels=E=>{let{x:y,y:_}=k.output;return E?v(k._imageData.data,y,_):k._imageData.data.slice(0)},k.color=function(E,y,_,w){typeof w>"u"&&(w=1),E=Math.floor(E*255),y=Math.floor(y*255),_=Math.floor(_*255),w=Math.floor(w*255);let L=k.output.x,N=k.output.y,b=k.thread.x,c=N-k.thread.y-1,C=b+c*L;k._colorData[C*4+0]=E,k._colorData[C*4+1]=y,k._colorData[C*4+2]=_,k._colorData[C*4+3]=w};let T=()=>k,A=["setWarnVarUsage","setArgumentTypes","setTactic","setOptimizeFloatMemory","setDebug","setLoopMaxIterations","setConstantTypes","setFunctions","setNativeFunctions","setInjectedNative","setPipeline","setPrecision","setOutputToTexture","setImmutable","setStrictIntegers","setDynamicOutput","setHardcodeConstants","setDynamicArguments","setUseLegacyEncoder","setWarnVarUsage","addSubKernel"];for(let E=0;E<A.length;E++)k[A[E]]=T;return k}function t(k){let{x:T,y:A}=k.output;if(k.context&&k.context.createImageData){let E=new Uint8ClampedArray(T*A*4);k._imageData=k.context.createImageData(T,A),k._colorData=E}else{let E=new Uint8ClampedArray(T*A*4);k._imageData={data:E},k._colorData=E}}function n(k){let T=null;if(k.length)if(k.length===3){let[A,E,y]=k;T={x:A,y:E,z:y}}else if(k.length===2){let[A,E]=k;T={x:A,y:E}}else{let[A]=k;T={x:A}}else T=k;return T}function g(k,T={}){let A=T.output?n(T.output):null;function E(){return E.output.z?r.apply(E,arguments):E.output.y?E.graphical?f.apply(E,arguments):d.apply(E,arguments):p.apply(E,arguments)}return E._fn=k,E.constants=T.constants||null,E.context=T.context||null,E.canvas=T.canvas||null,E.graphical=T.graphical||!1,E._imageData=null,E._colorData=null,E.output=A,E.thread={x:0,y:0,z:0},a(E)}function v(k,T,A){let E=A/2|0,y=T*4,_=new Uint8ClampedArray(T*4),w=k.slice(0);for(let L=0;L<E;++L){let N=L*y,b=(A-L-1)*y;_.set(w.subarray(N,N+y)),w.copyWithin(N,b,b+y),w.set(_,b)}return w}o.exports={gpuMock:g}},{}],5:[function(i,o,m){let{utils:u}=i("./utils");function p(d,f){let r=f.toString();return new Function(`return function ${d} (${u.getArgumentNamesFromString(r).join(", ")}) {\n        ${u.getFunctionBodyFromString(r)}\n      }`)()}o.exports={alias:p}},{"./utils":114}],6:[function(i,o,m){let{FunctionNode:u}=i("../function-node");class p extends u{astFunction(f,r){if(!this.isRootKernel){r.push("function"),r.push(" "),r.push(this.name),r.push("(");for(let a=0;a<this.argumentNames.length;++a){let t=this.argumentNames[a];a>0&&r.push(", "),r.push("user_"),r.push(t)}r.push(`) {\n`)}for(let a=0;a<f.body.body.length;++a)this.astGeneric(f.body.body[a],r),r.push(`\n`);return this.isRootKernel||r.push(`}\n`),r}astReturnStatement(f,r){let a=this.returnType||this.getType(f.argument);return this.returnType||(this.returnType=a),this.isRootKernel?(r.push(this.leadingReturnStatement),this.astGeneric(f.argument,r),r.push(`;\n`),r.push(this.followingReturnStatement),r.push(`continue;\n`)):this.isSubKernel?(r.push(`subKernelResult_${this.name} = `),this.astGeneric(f.argument,r),r.push(";"),r.push(`return subKernelResult_${this.name};`)):(r.push("return "),this.astGeneric(f.argument,r),r.push(";")),r}astLiteral(f,r){if(isNaN(f.value))throw this.astErrorOutput("Non-numeric literal not supported : "+f.value,f);return r.push(f.value),r}astBinaryExpression(f,r){return r.push("("),this.astGeneric(f.left,r),r.push(f.operator),this.astGeneric(f.right,r),r.push(")"),r}astIdentifierExpression(f,r){if(f.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",f);switch(f.name){case"Infinity":r.push("Infinity");break;default:this.constants&&this.constants.hasOwnProperty(f.name)?r.push("constants_"+f.name):r.push("user_"+f.name)}return r}astForStatement(f,r){if(f.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",f);let a=[],t=[],n=[],g=[],v=null;if(f.init){this.pushState("in-for-loop-init"),this.astGeneric(f.init,a);for(let k=0;k<a.length;k++)a[k].includes&&a[k].includes(",")&&(v=!1);this.popState("in-for-loop-init")}else v=!1;if(f.test?this.astGeneric(f.test,t):v=!1,f.update?this.astGeneric(f.update,n):v=!1,f.body&&(this.pushState("loop-body"),this.astGeneric(f.body,g),this.popState("loop-body")),v===null&&(v=this.isSafe(f.init)&&this.isSafe(f.test)),v)r.push(`for (${a.join("")};${t.join("")};${n.join("")}){\n`),r.push(g.join("")),r.push(`}\n`);else{let k=this.getInternalVariableName("safeI");a.length>0&&r.push(a.join(""),`;\n`),r.push(`for (let ${k}=0;${k}<LOOP_MAX;${k}++){\n`),t.length>0&&r.push(`if (!${t.join("")}) break;\n`),r.push(g.join("")),r.push(`\n${n.join("")};`),r.push(`}\n`)}return r}astWhileStatement(f,r){if(f.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",f);return r.push("for (let i = 0; i < LOOP_MAX; i++) {"),r.push("if ("),this.astGeneric(f.test,r),r.push(`) {\n`),this.astGeneric(f.body,r),r.push(`} else {\n`),r.push(`break;\n`),r.push(`}\n`),r.push(`}\n`),r}astDoWhileStatement(f,r){if(f.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",f);return r.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(f.body,r),r.push("if (!"),this.astGeneric(f.test,r),r.push(`) {\n`),r.push(`break;\n`),r.push(`}\n`),r.push(`}\n`),r}astAssignmentExpression(f,r){let a=this.getDeclaration(f.left);if(a&&!a.assignable)throw this.astErrorOutput(`Variable ${f.left.name} is not assignable here`,f);return this.astGeneric(f.left,r),r.push(f.operator),this.astGeneric(f.right,r),r}astBlockStatement(f,r){if(this.isState("loop-body")){this.pushState("block-body");for(let a=0;a<f.body.length;a++)this.astGeneric(f.body[a],r);this.popState("block-body")}else{r.push(`{\n`);for(let a=0;a<f.body.length;a++)this.astGeneric(f.body[a],r);r.push(`}\n`)}return r}astVariableDeclaration(f,r){r.push(`${f.kind} `);let{declarations:a}=f;for(let t=0;t<a.length;t++){t>0&&r.push(",");let n=a[t],g=this.getDeclaration(n.id);g.valueType||(g.valueType=this.getType(n.init)),this.astGeneric(n,r)}return this.isState("in-for-loop-init")||r.push(";"),r}astIfStatement(f,r){return r.push("if ("),this.astGeneric(f.test,r),r.push(")"),f.consequent.type==="BlockStatement"?this.astGeneric(f.consequent,r):(r.push(` {\n`),this.astGeneric(f.consequent,r),r.push(`\n}\n`)),f.alternate&&(r.push("else "),f.alternate.type==="BlockStatement"||f.alternate.type==="IfStatement"?this.astGeneric(f.alternate,r):(r.push(` {\n`),this.astGeneric(f.alternate,r),r.push(`\n}\n`))),r}astSwitchStatement(f,r){let{discriminant:a,cases:t}=f;r.push("switch ("),this.astGeneric(a,r),r.push(`) {\n`);for(let n=0;n<t.length;n++){if(t[n].test===null){r.push(`default:\n`),this.astGeneric(t[n].consequent,r),t[n].consequent&&t[n].consequent.length>0&&r.push(`break;\n`);continue}r.push("case "),this.astGeneric(t[n].test,r),r.push(`:\n`),t[n].consequent&&t[n].consequent.length>0&&(this.astGeneric(t[n].consequent,r),r.push(`break;\n`))}r.push(`\n}`)}astThisExpression(f,r){return r.push("_this"),r}astMemberExpression(f,r){let{signature:a,type:t,property:n,xProperty:g,yProperty:v,zProperty:k,name:T,origin:A}=this.getMemberExpressionDetails(f);switch(a){case"this.thread.value":return r.push(`_this.thread.${T}`),r;case"this.output.value":switch(T){case"x":r.push("outputX");break;case"y":r.push("outputY");break;case"z":r.push("outputZ");break;default:throw this.astErrorOutput("Unexpected expression",f)}return r;case"value":throw this.astErrorOutput("Unexpected expression",f);case"value[]":case"value[][]":case"value[][][]":case"value.value":if(A==="Math")return r.push(Math[T]),r;switch(n){case"r":return r.push(`user_${T}[0]`),r;case"g":return r.push(`user_${T}[1]`),r;case"b":return r.push(`user_${T}[2]`),r;case"a":return r.push(`user_${T}[3]`),r}break;case"this.constants.value":case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":break;case"fn()[]":return this.astGeneric(f.object,r),r.push("["),this.astGeneric(f.property,r),r.push("]"),r;case"fn()[][]":return this.astGeneric(f.object.object,r),r.push("["),this.astGeneric(f.object.property,r),r.push("]"),r.push("["),this.astGeneric(f.property,r),r.push("]"),r;default:throw this.astErrorOutput("Unexpected expression",f)}if(!f.computed)switch(t){case"Number":case"Integer":case"Float":case"Boolean":return r.push(`${A}_${T}`),r}let E=`${A}_${T}`;switch(t){case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"HTMLImageArray":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"HTMLImage":default:let y,_;if(A==="constants"){let w=this.constants[T];_=this.constantTypes[T]==="Input",y=_?w.size:null}else _=this.isInput(T),y=_?this.argumentSizes[this.argumentNames.indexOf(T)]:null;r.push(`${E}`),k&&v?_?(r.push("[("),this.astGeneric(k,r),r.push(`*${this.dynamicArguments?"(outputY * outputX)":y[1]*y[0]})+(`),this.astGeneric(v,r),r.push(`*${this.dynamicArguments?"outputX":y[0]})+`),this.astGeneric(g,r),r.push("]")):(r.push("["),this.astGeneric(k,r),r.push("]"),r.push("["),this.astGeneric(v,r),r.push("]"),r.push("["),this.astGeneric(g,r),r.push("]")):v?_?(r.push("[("),this.astGeneric(v,r),r.push(`*${this.dynamicArguments?"outputX":y[0]})+`),this.astGeneric(g,r),r.push("]")):(r.push("["),this.astGeneric(v,r),r.push("]"),r.push("["),this.astGeneric(g,r),r.push("]")):typeof g<"u"&&(r.push("["),this.astGeneric(g,r),r.push("]"))}return r}astCallExpression(f,r){if(f.type!=="CallExpression")throw this.astErrorOutput("Unknown CallExpression",f);let a=this.astMemberExpressionUnroll(f.callee);this.calledFunctions.indexOf(a)<0&&this.calledFunctions.push(a);let t=this.isAstMathFunction(f);this.onFunctionCall&&this.onFunctionCall(this.name,a,f.arguments),r.push(a),r.push("(");let n=this.lookupFunctionArgumentTypes(a)||[];for(let g=0;g<f.arguments.length;++g){let v=f.arguments[g],k=this.getType(v);n[g]||this.triggerImplyArgumentType(a,g,k,this),g>0&&r.push(", "),this.astGeneric(v,r)}return r.push(")"),r}astArrayExpression(f,r){let a=this.getType(f),t=f.elements.length,n=[];for(let g=0;g<t;++g){let v=[];this.astGeneric(f.elements[g],v),n.push(v.join(""))}switch(a){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":r.push(`[${n.join(", ")}]`);break;default:r.push(`new Float32Array([${n.join(", ")}])`)}return r}astDebuggerStatement(f,r){return r.push("debugger;"),r}}o.exports={CPUFunctionNode:p}},{"../function-node":10}],7:[function(i,o,m){let{utils:u}=i("../../utils");function p(f,r){let a=[];for(let t in r){if(!r.hasOwnProperty(t))continue;let n=r[t],g=f[t];switch(n){case"Number":case"Integer":case"Float":case"Boolean":a.push(`${t}:${g}`);break;case"Array(2)":case"Array(3)":case"Array(4)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":a.push(`${t}:new ${g.constructor.name}(${JSON.stringify(Array.from(g))})`);break}}return`{ ${a.join()} }`}function d(f,r){let a=[],t=[],n=[],g=!/^function/.test(f.color.toString());if(a.push("  const { context, canvas, constants: incomingConstants } = settings;",`  const output = new Int32Array(${JSON.stringify(Array.from(f.output))});`,`  const _constantTypes = ${JSON.stringify(f.constantTypes)};`,`  const _constants = ${p(f.constants,f.constantTypes)};`),t.push("    constants: _constants,","    context,","    output,","    thread: {x: 0, y: 0, z: 0},"),f.graphical){a.push(`  const _imageData = context.createImageData(${f.output[0]}, ${f.output[1]});`),a.push(`  const _colorData = new Uint8ClampedArray(${f.output[0]} * ${f.output[1]} * 4);`);let T=u.flattenFunctionToString((g?"function ":"")+f.color.toString(),{thisLookup:E=>{switch(E){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(f[E])},findDependency:(E,y)=>null}),A=u.flattenFunctionToString((g?"function ":"")+f.getPixels.toString(),{thisLookup:E=>{switch(E){case"_colorData":return"_colorData";case"_imageData":return"_imageData";case"output":return"output";case"thread":return"this.thread"}return JSON.stringify(f[E])},findDependency:()=>null});t.push("    _imageData,","    _colorData,",`    color: ${T},`),n.push(`  kernel.getPixels = ${A};`)}let v=[],k=Object.keys(f.constantTypes);for(let T=0;T<k.length;T++)v.push(f.constantTypes[k]);if(f.argumentTypes.indexOf("HTMLImageArray")!==-1||v.indexOf("HTMLImageArray")!==-1){let T=u.flattenFunctionToString((g?"function ":"")+f._imageTo3DArray.toString(),{doNotDefine:["canvas"],findDependency:(A,E)=>A==="this"?(g?"function ":"")+f[E].toString():null,thisLookup:A=>{switch(A){case"canvas":return;case"context":return"context"}}});n.push(T),t.push("    _mediaTo2DArray,"),t.push("    _imageTo3DArray,")}else if(f.argumentTypes.indexOf("HTMLImage")!==-1||v.indexOf("HTMLImage")!==-1){let T=u.flattenFunctionToString((g?"function ":"")+f._mediaTo2DArray.toString(),{findDependency:(A,E)=>null,thisLookup:A=>{switch(A){case"canvas":return"settings.canvas";case"context":return"settings.context"}throw new Error("unhandled thisLookup")}});n.push(T),t.push("    _mediaTo2DArray,")}return`function(settings) {\n      ${a.join(`\n`)}\n        for (const p in _constantTypes) {\n          if (!_constantTypes.hasOwnProperty(p)) continue;\n          const type = _constantTypes[p];\n          switch (type) {\n            case \'Number\':\n            case \'Integer\':\n            case \'Float\':\n            case \'Boolean\':\n            case \'Array(2)\':\n            case \'Array(3)\':\n            case \'Array(4)\':\n            case \'Matrix(2)\':\n            case \'Matrix(3)\':\n            case \'Matrix(4)\':\n              if (incomingConstants.hasOwnProperty(p)) {\n                console.warn(\'constant \' + p + \' of type \' + type + \' cannot be resigned\');\n              }\n              continue;\n          }\n          if (!incomingConstants.hasOwnProperty(p)) {\n            throw new Error(\'constant \' + p + \' not found\');\n          }\n          _constants[p] = incomingConstants[p];\n        }\n        const kernel = (function() {\n      ${f._kernelString}\n        })\n          .apply({ ${t.join(`\n`)} });\n        ${n.join(`\n`)}\n        return kernel;\n      }`}o.exports={cpuKernelString:d}},{"../../utils":114}],8:[function(i,o,m){let{Kernel:u}=i("../kernel"),{FunctionBuilder:p}=i("../function-builder"),{CPUFunctionNode:d}=i("./function-node"),{utils:f}=i("../../utils"),{cpuKernelString:r}=i("./kernel-string");class a extends u{static getFeatures(){return this.features}static get features(){return Object.freeze({kernelMap:!0,isIntegerDivisionAccurate:!0})}static get isSupported(){return!0}static isContextMatch(n){return!1}static get mode(){return"cpu"}static nativeFunctionArguments(){return null}static nativeFunctionReturnType(){throw new Error(`Looking up native function return type not supported on ${this.name}`)}static combineKernels(n){return n}static getSignature(n,g){return"cpu"+(g.length>0?":"+g.join(","):"")}constructor(n,g){super(n,g),this.mergeSettings(n.settings||g),this._imageData=null,this._colorData=null,this._kernelString=null,this._prependedString=[],this.thread={x:0,y:0,z:0},this.translatedSources=null}initCanvas(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){return this.canvas?this.canvas.getContext("2d"):null}initPlugins(n){return[]}validateSettings(n){if(!this.output||this.output.length===0){if(n.length!==1)throw new Error("Auto output only supported for kernels with only one input");let g=f.getVariableType(n[0],this.strictIntegers);if(g==="Array")this.output=f.getDimensions(g);else if(g==="NumberTexture"||g==="ArrayTexture(4)")this.output=n[0].output;else throw new Error("Auto output not supported for input type: "+g)}if(this.graphical&&this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.checkOutput()}translateSource(){if(this.leadingReturnStatement=this.output.length>1?"resultX[x] = ":"result[x] = ",this.subKernels){let g=[];for(let v=0;v<this.subKernels.length;v++){let{name:k}=this.subKernels[v];g.push(this.output.length>1?`resultX_${k}[x] = subKernelResult_${k};\n`:`result_${k}[x] = subKernelResult_${k};\n`)}this.followingReturnStatement=g.join("")}let n=p.fromKernel(this,d);this.translatedSources=n.getPrototypes("kernel"),!this.graphical&&!this.returnType&&(this.returnType=n.getKernelResultType())}build(){if(this.built)return;if(this.setupConstants(),this.setupArguments(arguments),this.validateSettings(arguments),this.translateSource(),this.graphical){let{canvas:g,output:v}=this;if(!g)throw new Error("no canvas available for using graphical output");let k=v[0],T=v[1]||1;g.width=k,g.height=T,this._imageData=this.context.createImageData(k,T),this._colorData=new Uint8ClampedArray(k*T*4)}let n=this.getKernelString();this.kernelString=n,this.debug&&(console.log("Function output:"),console.log(n));try{this.run=new Function([],n).bind(this)()}catch(g){console.error("An error occurred compiling the javascript: ",g)}this.buildSignature(arguments),this.built=!0}color(n,g,v,k){typeof k>"u"&&(k=1),n=Math.floor(n*255),g=Math.floor(g*255),v=Math.floor(v*255),k=Math.floor(k*255);let T=this.output[0],A=this.output[1],E=this.thread.x,y=A-this.thread.y-1,_=E+y*T;this._colorData[_*4+0]=n,this._colorData[_*4+1]=g,this._colorData[_*4+2]=v,this._colorData[_*4+3]=k}getKernelString(){if(this._kernelString!==null)return this._kernelString;let n=null,{translatedSources:g}=this;return g.length>1?g=g.filter(v=>/^function/.test(v)?v:(n=v,!1)):n=g.shift(),this._kernelString=`  const LOOP_MAX = ${this._getLoopMaxString()};\n        ${this.injectedNative||""}\n        const _this = this;\n        ${this._resultKernelHeader()}\n        ${this._processConstants()}\n        return (${this.argumentNames.map(v=>"user_"+v).join(", ")}) => {\n          ${this._prependedString.join("")}\n          ${this._earlyThrows()}\n          ${this._processArguments()}\n          ${this.graphical?this._graphicalKernelBody(n):this._resultKernelBody(n)}\n          ${g.length>0?g.join(`\n`):""}\n        };`}toString(){return r(this)}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};`:" 1000;"}_processConstants(){if(!this.constants)return"";let n=[];for(let g in this.constants)switch(this.constantTypes[g]){case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":n.push(`    const constants_${g} = this._mediaTo2DArray(this.constants.${g});\n`);break;case"HTMLImageArray":n.push(`    const constants_${g} = this._imageTo3DArray(this.constants.${g});\n`);break;case"Input":n.push(`    const constants_${g} = this.constants.${g}.value;\n`);break;default:n.push(`    const constants_${g} = this.constants.${g};\n`)}return n.join("")}_earlyThrows(){if(this.graphical||this.immutable||!this.pipeline)return"";let n=[];for(let v=0;v<this.argumentTypes.length;v++)this.argumentTypes[v]==="Array"&&n.push(this.argumentNames[v]);if(n.length===0)return"";let g=[];for(let v=0;v<n.length;v++){let k=n[v],T=this._mapSubKernels(A=>`user_${k} === result_${A.name}`).join(" || ");g.push(`user_${k} === result${T?` || ${T}`:""}`)}return`if (${g.join(" || ")}) throw new Error(\'Source and destination arrays are the same.  Use immutable = true\');`}_processArguments(){let n=[];for(let g=0;g<this.argumentTypes.length;g++){let v=`user_${this.argumentNames[g]}`;switch(this.argumentTypes[g]){case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":n.push(`    ${v} = this._mediaTo2DArray(${v});\n`);break;case"HTMLImageArray":n.push(`    ${v} = this._imageTo3DArray(${v});\n`);break;case"Input":n.push(`    ${v} = ${v}.value;\n`);break;case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"NumberTexture":case"MemoryOptimizedNumberTexture":n.push(`\n          if (${v}.toArray) {\n            if (!_this.textureCache) {\n              _this.textureCache = [];\n              _this.arrayCache = [];\n            }\n            const textureIndex = _this.textureCache.indexOf(${v});\n            if (textureIndex !== -1) {\n              ${v} = _this.arrayCache[textureIndex];\n            } else {\n              _this.textureCache.push(${v});\n              ${v} = ${v}.toArray();\n              _this.arrayCache.push(${v});\n            }\n          }`);break}}return n.join("")}_mediaTo2DArray(n){let g=this.canvas,v=n.width>0?n.width:n.videoWidth,k=n.height>0?n.height:n.videoHeight;g.width<v&&(g.width=v),g.height<k&&(g.height=k);let T=this.context;T.drawImage(n,0,0,v,k);let A=T.getImageData(0,0,v,k).data,E=new Array(k),y=0;for(let _=k-1;_>=0;_--){let w=E[_]=new Array(v);for(let L=0;L<v;L++){let N=new Float32Array(4);N[0]=A[y++]/255,N[1]=A[y++]/255,N[2]=A[y++]/255,N[3]=A[y++]/255,w[L]=N}}return E}getPixels(n){let[g,v]=this.output;return n?f.flipPixels(this._imageData.data,g,v):this._imageData.data.slice(0)}_imageTo3DArray(n){let g=new Array(n.length);for(let v=0;v<n.length;v++)g[v]=this._mediaTo2DArray(n[v]);return g}_resultKernelHeader(){if(this.graphical||this.immutable||!this.pipeline)return"";switch(this.output.length){case 1:return this._mutableKernel1DResults();case 2:return this._mutableKernel2DResults();case 3:return this._mutableKernel3DResults()}}_resultKernelBody(n){switch(this.output.length){case 1:return(!this.immutable&&this.pipeline?this._resultMutableKernel1DLoop(n):this._resultImmutableKernel1DLoop(n))+this._kernelOutput();case 2:return(!this.immutable&&this.pipeline?this._resultMutableKernel2DLoop(n):this._resultImmutableKernel2DLoop(n))+this._kernelOutput();case 3:return(!this.immutable&&this.pipeline?this._resultMutableKernel3DLoop(n):this._resultImmutableKernel3DLoop(n))+this._kernelOutput();default:throw new Error("unsupported size kernel")}}_graphicalKernelBody(n){switch(this.output.length){case 2:return this._graphicalKernel2DLoop(n)+this._graphicalOutput();default:throw new Error("unsupported size kernel")}}_graphicalOutput(){return`\n          this._imageData.data.set(this._colorData);\n          this.context.putImageData(this._imageData, 0, 0);\n          return;`}_getKernelResultTypeConstructorString(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return"Float32Array";case"Array(2)":case"Array(3)":case"Array(4)":return"Array";default:if(this.graphical)return"Float32Array";throw new Error(`unhandled returnType ${this.returnType}`)}}_resultImmutableKernel1DLoop(n){let g=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const result = new ${g}(outputX);\n          ${this._mapSubKernels(v=>`const result_${v.name} = new ${g}(outputX);\n`).join("    ")}\n          ${this._mapSubKernels(v=>`let subKernelResult_${v.name};\n`).join("    ")}\n          for (let x = 0; x < outputX; x++) {\n            this.thread.x = x;\n            this.thread.y = 0;\n            this.thread.z = 0;\n            ${n}\n          }`}_mutableKernel1DResults(){let n=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const result = new ${n}(outputX);\n          ${this._mapSubKernels(g=>`const result_${g.name} = new ${n}(outputX);\n`).join("    ")}\n          ${this._mapSubKernels(g=>`let subKernelResult_${g.name};\n`).join("    ")}`}_resultMutableKernel1DLoop(n){return`  const outputX = _this.output[0];\n          for (let x = 0; x < outputX; x++) {\n            this.thread.x = x;\n            this.thread.y = 0;\n            this.thread.z = 0;\n            ${n}\n          }`}_resultImmutableKernel2DLoop(n){let g=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          const result = new Array(outputY);\n          ${this._mapSubKernels(v=>`const result_${v.name} = new Array(outputY);\n`).join("    ")}\n          ${this._mapSubKernels(v=>`let subKernelResult_${v.name};\n`).join("    ")}\n          for (let y = 0; y < outputY; y++) {\n            this.thread.z = 0;\n            this.thread.y = y;\n            const resultX = result[y] = new ${g}(outputX);\n            ${this._mapSubKernels(v=>`const resultX_${v.name} = result_${v.name}[y] = new ${g}(outputX);\n`).join("")}\n            for (let x = 0; x < outputX; x++) {\n              this.thread.x = x;\n              ${n}\n            }\n          }`}_mutableKernel2DResults(){let n=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          const result = new Array(outputY);\n          ${this._mapSubKernels(g=>`const result_${g.name} = new Array(outputY);\n`).join("    ")}\n          ${this._mapSubKernels(g=>`let subKernelResult_${g.name};\n`).join("    ")}\n          for (let y = 0; y < outputY; y++) {\n            const resultX = result[y] = new ${n}(outputX);\n            ${this._mapSubKernels(g=>`const resultX_${g.name} = result_${g.name}[y] = new ${n}(outputX);\n`).join("")}\n          }`}_resultMutableKernel2DLoop(n){let g=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          for (let y = 0; y < outputY; y++) {\n            this.thread.z = 0;\n            this.thread.y = y;\n            const resultX = result[y];\n            ${this._mapSubKernels(v=>`const resultX_${v.name} = result_${v.name}[y] = new ${g}(outputX);\n`).join("")}\n            for (let x = 0; x < outputX; x++) {\n              this.thread.x = x;\n              ${n}\n            }\n          }`}_graphicalKernel2DLoop(n){return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          for (let y = 0; y < outputY; y++) {\n            this.thread.z = 0;\n            this.thread.y = y;\n            for (let x = 0; x < outputX; x++) {\n              this.thread.x = x;\n              ${n}\n            }\n          }`}_resultImmutableKernel3DLoop(n){let g=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          const outputZ = _this.output[2];\n          const result = new Array(outputZ);\n          ${this._mapSubKernels(v=>`const result_${v.name} = new Array(outputZ);\n`).join("    ")}\n          ${this._mapSubKernels(v=>`let subKernelResult_${v.name};\n`).join("    ")}\n          for (let z = 0; z < outputZ; z++) {\n            this.thread.z = z;\n            const resultY = result[z] = new Array(outputY);\n            ${this._mapSubKernels(v=>`const resultY_${v.name} = result_${v.name}[z] = new Array(outputY);\n`).join("      ")}\n            for (let y = 0; y < outputY; y++) {\n              this.thread.y = y;\n              const resultX = resultY[y] = new ${g}(outputX);\n              ${this._mapSubKernels(v=>`const resultX_${v.name} = resultY_${v.name}[y] = new ${g}(outputX);\n`).join("        ")}\n              for (let x = 0; x < outputX; x++) {\n                this.thread.x = x;\n                ${n}\n              }\n            }\n          }`}_mutableKernel3DResults(){let n=this._getKernelResultTypeConstructorString();return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          const outputZ = _this.output[2];\n          const result = new Array(outputZ);\n          ${this._mapSubKernels(g=>`const result_${g.name} = new Array(outputZ);\n`).join("    ")}\n          ${this._mapSubKernels(g=>`let subKernelResult_${g.name};\n`).join("    ")}\n          for (let z = 0; z < outputZ; z++) {\n            const resultY = result[z] = new Array(outputY);\n            ${this._mapSubKernels(g=>`const resultY_${g.name} = result_${g.name}[z] = new Array(outputY);\n`).join("      ")}\n            for (let y = 0; y < outputY; y++) {\n              const resultX = resultY[y] = new ${n}(outputX);\n              ${this._mapSubKernels(g=>`const resultX_${g.name} = resultY_${g.name}[y] = new ${n}(outputX);\n`).join("        ")}\n            }\n          }`}_resultMutableKernel3DLoop(n){return`  const outputX = _this.output[0];\n          const outputY = _this.output[1];\n          const outputZ = _this.output[2];\n          for (let z = 0; z < outputZ; z++) {\n            this.thread.z = z;\n            const resultY = result[z];\n            for (let y = 0; y < outputY; y++) {\n              this.thread.y = y;\n              const resultX = resultY[y];\n              for (let x = 0; x < outputX; x++) {\n                this.thread.x = x;\n                ${n}\n              }\n            }\n          }`}_kernelOutput(){return this.subKernels?`\n    return {\n            result: result,\n            ${this.subKernels.map(n=>`${n.property}: result_${n.name}`).join(`,\n      `)}\n          };`:`\n    return result;`}_mapSubKernels(n){return this.subKernels===null?[""]:this.subKernels.map(n)}destroy(n){n&&delete this.canvas}static destroyContext(n){}toJSON(){let n=super.toJSON();return n.functionNodes=p.fromKernel(this,d).toJSON(),n}setOutput(n){super.setOutput(n);let[g,v]=this.output;this.graphical&&(this._imageData=this.context.createImageData(g,v),this._colorData=new Uint8ClampedArray(g*v*4))}prependString(n){if(this._kernelString)throw new Error("Kernel already built");this._prependedString.push(n)}hasPrependString(n){return this._prependedString.indexOf(n)>-1}}o.exports={CPUKernel:a}},{"../../utils":114,"../function-builder":9,"../kernel":36,"./function-node":6,"./kernel-string":7}],9:[function(i,o,m){class u{static fromKernel(d,f,r){let{kernelArguments:a,kernelConstants:t,argumentNames:n,argumentSizes:g,argumentBitRatios:v,constants:k,constantBitRatios:T,debug:A,loopMaxIterations:E,nativeFunctions:y,output:_,optimizeFloatMemory:w,precision:L,plugins:N,source:b,subKernels:c,functions:C,leadingReturnStatement:F,followingReturnStatement:P,dynamicArguments:M,dynamicOutput:$}=d,G=new Array(a.length),O={};for(let ne=0;ne<a.length;ne++)G[ne]=a[ne].type;for(let ne=0;ne<t.length;ne++){let ue=t[ne];O[ue.name]=ue.type}let Y=(ne,ue)=>me.needsArgumentType(ne,ue),W=(ne,ue,xe)=>{me.assignArgumentType(ne,ue,xe)},K=(ne,ue,xe)=>me.lookupReturnType(ne,ue,xe),J=ne=>me.lookupFunctionArgumentTypes(ne),Q=(ne,ue)=>me.lookupFunctionArgumentName(ne,ue),te=(ne,ue)=>me.lookupFunctionArgumentBitRatio(ne,ue),H=(ne,ue,xe,_e)=>{me.assignArgumentType(ne,ue,xe,_e)},B=(ne,ue,xe,_e)=>{me.assignArgumentBitRatio(ne,ue,xe,_e)},he=(ne,ue,xe)=>{me.trackFunctionCall(ne,ue,xe)},Z=(ne,ue)=>{let xe=[];for(let ke=0;ke<ne.params.length;ke++)xe.push(ne.params[ke].name);let _e=new f(ue,Object.assign({},ie,{returnType:null,ast:ne,name:ne.id.name,argumentNames:xe,lookupReturnType:K,lookupFunctionArgumentTypes:J,lookupFunctionArgumentName:Q,lookupFunctionArgumentBitRatio:te,needsArgumentType:Y,assignArgumentType:W,triggerImplyArgumentType:H,triggerImplyArgumentBitRatio:B,onFunctionCall:he}));_e.traceFunctionAST(ne),me.addFunctionNode(_e)},ie=Object.assign({isRootKernel:!1,onNestedFunction:Z,lookupReturnType:K,lookupFunctionArgumentTypes:J,lookupFunctionArgumentName:Q,lookupFunctionArgumentBitRatio:te,needsArgumentType:Y,assignArgumentType:W,triggerImplyArgumentType:H,triggerImplyArgumentBitRatio:B,onFunctionCall:he,optimizeFloatMemory:w,precision:L,constants:k,constantTypes:O,constantBitRatios:T,debug:A,loopMaxIterations:E,output:_,plugins:N,dynamicArguments:M,dynamicOutput:$},r||{}),Se=Object.assign({},ie,{isRootKernel:!0,name:"kernel",argumentNames:n,argumentTypes:G,argumentSizes:g,argumentBitRatios:v,leadingReturnStatement:F,followingReturnStatement:P});if(typeof b=="object"&&b.functionNodes)return new u().fromJSON(b.functionNodes,f);let ee=new f(b,Se),ce=null;C&&(ce=C.map(ne=>new f(ne.source,{returnType:ne.returnType,argumentTypes:ne.argumentTypes,output:_,plugins:N,constants:k,constantTypes:O,constantBitRatios:T,optimizeFloatMemory:w,precision:L,lookupReturnType:K,lookupFunctionArgumentTypes:J,lookupFunctionArgumentName:Q,lookupFunctionArgumentBitRatio:te,needsArgumentType:Y,assignArgumentType:W,triggerImplyArgumentType:H,triggerImplyArgumentBitRatio:B,onFunctionCall:he,onNestedFunction:Z})));let fe=null;c&&(fe=c.map(ne=>{let{name:ue,source:xe}=ne;return new f(xe,Object.assign({},ie,{name:ue,isSubKernel:!0,isRootKernel:!1}))}));let me=new u({kernel:d,rootNode:ee,functionNodes:ce,nativeFunctions:y,subKernelNodes:fe});return me}constructor(d){if(d=d||{},this.kernel=d.kernel,this.rootNode=d.rootNode,this.functionNodes=d.functionNodes||[],this.subKernelNodes=d.subKernelNodes||[],this.nativeFunctions=d.nativeFunctions||[],this.functionMap={},this.nativeFunctionNames=[],this.lookupChain=[],this.functionNodeDependencies={},this.functionCalls={},this.rootNode&&(this.functionMap.kernel=this.rootNode),this.functionNodes)for(let f=0;f<this.functionNodes.length;f++)this.functionMap[this.functionNodes[f].name]=this.functionNodes[f];if(this.subKernelNodes)for(let f=0;f<this.subKernelNodes.length;f++)this.functionMap[this.subKernelNodes[f].name]=this.subKernelNodes[f];if(this.nativeFunctions)for(let f=0;f<this.nativeFunctions.length;f++){let r=this.nativeFunctions[f];this.nativeFunctionNames.push(r.name)}}addFunctionNode(d){if(!d.name)throw new Error("functionNode.name needs set");this.functionMap[d.name]=d,d.isRootKernel&&(this.rootNode=d)}traceFunctionCalls(d,f){if(d=d||"kernel",f=f||[],this.nativeFunctionNames.indexOf(d)>-1){let a=f.indexOf(d);if(a===-1)f.push(d);else{let t=f.splice(a,1)[0];f.push(t)}return f}let r=this.functionMap[d];if(r){let a=f.indexOf(d);if(a===-1){f.push(d),r.toString();for(let t=0;t<r.calledFunctions.length;++t)this.traceFunctionCalls(r.calledFunctions[t],f)}else{let t=f.splice(a,1)[0];f.push(t)}}return f}getPrototypeString(d){return this.getPrototypes(d).join(`\n`)}getPrototypes(d){return this.rootNode&&this.rootNode.toString(),d?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(d,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.functionMap))}getStringFromFunctionNames(d){let f=[];for(let r=0;r<d.length;++r)this.functionMap[d[r]]&&f.push(this.functionMap[d[r]].toString());return f.join(`\n`)}getPrototypesFromFunctionNames(d){let f=[];for(let r=0;r<d.length;++r){let a=d[r],t=this.nativeFunctionNames.indexOf(a);if(t>-1){f.push(this.nativeFunctions[t].source);continue}let n=this.functionMap[a];n&&f.push(n.toString())}return f}toJSON(){return this.traceFunctionCalls(this.rootNode.name).reverse().map(d=>{let f=this.nativeFunctions.indexOf(d);if(f>-1)return{name:d,source:this.nativeFunctions[f].source};if(this.functionMap[d])return this.functionMap[d].toJSON();throw new Error(`function ${d} not found`)})}fromJSON(d,f){this.functionMap={};for(let r=0;r<d.length;r++){let a=d[r];this.functionMap[a.settings.name]=new f(a.ast,a.settings)}return this}getString(d){return d?this.getStringFromFunctionNames(this.traceFunctionCalls(d).reverse()):this.getStringFromFunctionNames(Object.keys(this.functionMap))}lookupReturnType(d,f,r){if(f.type!=="CallExpression")throw new Error(`expected ast type of "CallExpression", but is ${f.type}`);if(this._isNativeFunction(d))return this._lookupNativeFunctionReturnType(d);if(this._isFunction(d)){let a=this._getFunction(d);if(a.returnType)return a.returnType;{for(let n=0;n<this.lookupChain.length;n++)if(this.lookupChain[n].ast===f){if(a.argumentTypes.length===0&&f.arguments.length>0){let g=f.arguments;for(let v=0;v<g.length;v++)this.lookupChain.push({name:r.name,ast:g[n],requestingNode:r}),a.argumentTypes[v]=r.getType(g[v]),this.lookupChain.pop();return a.returnType=a.getType(a.getJsAST())}throw new Error("circlical logic detected!")}this.lookupChain.push({name:r.name,ast:f,requestingNode:r});let t=a.getType(a.getJsAST());return this.lookupChain.pop(),a.returnType=t}}return null}_getFunction(d){return this._isFunction(d)||new Error(`Function ${d} not found`),this.functionMap[d]}_isFunction(d){return Boolean(this.functionMap[d])}_getNativeFunction(d){for(let f=0;f<this.nativeFunctions.length;f++)if(this.nativeFunctions[f].name===d)return this.nativeFunctions[f];return null}_isNativeFunction(d){return Boolean(this._getNativeFunction(d))}_lookupNativeFunctionReturnType(d){let f=this._getNativeFunction(d);if(f)return f.returnType;throw new Error(`Native function ${d} not found`)}lookupFunctionArgumentTypes(d){return this._isNativeFunction(d)?this._getNativeFunction(d).argumentTypes:this._isFunction(d)?this._getFunction(d).argumentTypes:null}lookupFunctionArgumentName(d,f){return this._getFunction(d).argumentNames[f]}lookupFunctionArgumentBitRatio(d,f){if(!this._isFunction(d))throw new Error("function not found");if(this.rootNode.name===d){let n=this.rootNode.argumentNames.indexOf(f);if(n!==-1)return this.rootNode.argumentBitRatios[n]}let r=this._getFunction(d),a=r.argumentNames.indexOf(f);if(a===-1)throw new Error("argument not found");let t=r.argumentBitRatios[a];if(typeof t!="number")throw new Error("argument bit ratio not found");return t}needsArgumentType(d,f){return this._isFunction(d)?!this._getFunction(d).argumentTypes[f]:!1}assignArgumentType(d,f,r,a){if(!this._isFunction(d))return;let t=this._getFunction(d);t.argumentTypes[f]||(t.argumentTypes[f]=r)}assignArgumentBitRatio(d,f,r,a){let t=this._getFunction(d);if(this._isNativeFunction(r))return null;let n=this._getFunction(r),g=t.argumentNames.indexOf(f);if(g===-1)throw new Error(`Argument ${f} not found in arguments from function ${d}`);let v=t.argumentBitRatios[g];if(typeof v!="number")throw new Error(`Bit ratio for argument ${f} not found in function ${d}`);n.argumentBitRatios||(n.argumentBitRatios=new Array(n.argumentNames.length));let k=n.argumentBitRatios[g];if(typeof k=="number"){if(k!==v)throw new Error(`Incompatible bit ratio found at function ${d} at argument ${f}`);return k}return n.argumentBitRatios[g]=v,v}trackFunctionCall(d,f,r){this.functionNodeDependencies[d]||(this.functionNodeDependencies[d]=new Set,this.functionCalls[d]=[]),this.functionNodeDependencies[d].add(f),this.functionCalls[d].push(r)}getKernelResultType(){return this.rootNode.returnType||this.rootNode.getType(this.rootNode.ast)}getSubKernelResultType(d){let f=this.subKernelNodes[d],r=!1;for(let a=0;a<this.rootNode.functionCalls.length;a++)this.rootNode.functionCalls[a].ast.callee.name===f.name&&(r=!0);if(!r)throw new Error(`SubKernel ${f.name} never called by kernel`);return f.returnType||f.getType(f.getJsAST())}getReturnTypes(){let d={[this.rootNode.name]:this.rootNode.getType(this.rootNode.ast)},f=this.traceFunctionCalls(this.rootNode.name);for(let r=0;r<f.length;r++){let a=f[r],t=this.functionMap[a];d[a]=t.getType(t.ast)}return d}}o.exports={FunctionBuilder:u}},{}],10:[function(i,o,m){let u=i("acorn"),{utils:p}=i("../utils"),{FunctionTracer:d}=i("./function-tracer");class f{constructor(t,n){if(!t&&!n.ast)throw new Error("source parameter is missing");if(n=n||{},this.source=t,this.ast=null,this.name=typeof t=="string"?n.isRootKernel?"kernel":n.name||p.getFunctionNameFromString(t):null,this.calledFunctions=[],this.constants={},this.constantTypes={},this.constantBitRatios={},this.isRootKernel=!1,this.isSubKernel=!1,this.debug=null,this.functions=null,this.identifiers=null,this.contexts=null,this.functionCalls=null,this.states=[],this.needsArgumentType=null,this.assignArgumentType=null,this.lookupReturnType=null,this.lookupFunctionArgumentTypes=null,this.lookupFunctionArgumentBitRatio=null,this.triggerImplyArgumentType=null,this.triggerImplyArgumentBitRatio=null,this.onNestedFunction=null,this.onFunctionCall=null,this.optimizeFloatMemory=null,this.precision=null,this.loopMaxIterations=null,this.argumentNames=typeof this.source=="string"?p.getArgumentNamesFromString(this.source):null,this.argumentTypes=[],this.argumentSizes=[],this.argumentBitRatios=null,this.returnType=null,this.output=[],this.plugins=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.dynamicOutput=null,this.dynamicArguments=null,this.strictTypingChecking=!1,this.fixIntegerDivisionAccuracy=null,n)for(let g in n)!n.hasOwnProperty(g)||!this.hasOwnProperty(g)||(this[g]=n[g]);this.literalTypes={},this.validate(),this._string=null,this._internalVariableNames={}}validate(){if(typeof this.source!="string"&&!this.ast)throw new Error("this.source not a string");if(!this.ast&&!p.isFunctionString(this.source))throw new Error("this.source not a function string");if(!this.name)throw new Error("this.name could not be set");if(this.argumentTypes.length>0&&this.argumentTypes.length!==this.argumentNames.length)throw new Error(`argumentTypes count of ${this.argumentTypes.length} exceeds ${this.argumentNames.length}`);if(this.output.length<1)throw new Error("this.output is not big enough")}isIdentifierConstant(t){return this.constants?this.constants.hasOwnProperty(t):!1}isInput(t){return this.argumentTypes[this.argumentNames.indexOf(t)]==="Input"}pushState(t){this.states.push(t)}popState(t){if(this.state!==t)throw new Error(`Cannot popState ${t} when in ${this.state}`);this.states.pop()}isState(t){return this.state===t}get state(){return this.states[this.states.length-1]}astMemberExpressionUnroll(t){if(t.type==="Identifier")return t.name;if(t.type==="ThisExpression")return"this";if(t.type==="MemberExpression"&&t.object&&t.property)return t.object.hasOwnProperty("name")&&t.object.name!=="Math"?this.astMemberExpressionUnroll(t.property):this.astMemberExpressionUnroll(t.object)+"."+this.astMemberExpressionUnroll(t.property);if(t.hasOwnProperty("expressions")){let n=t.expressions[0];if(n.type==="Literal"&&n.value===0&&t.expressions.length===2)return this.astMemberExpressionUnroll(t.expressions[1])}throw this.astErrorOutput("Unknown astMemberExpressionUnroll",t)}getJsAST(t){if(this.ast)return this.ast;if(typeof this.source=="object")return this.traceFunctionAST(this.source),this.ast=this.source;if(t=t||u,t===null)throw new Error("Missing JS to AST parser");let n=Object.freeze(t.parse(`const parser_${this.name} = ${this.source};`,{locations:!0})),g=n.body[0].declarations[0].init;if(this.traceFunctionAST(g),!n)throw new Error("Failed to parse JS code");return this.ast=g}traceFunctionAST(t){let{contexts:n,declarations:g,functions:v,identifiers:k,functionCalls:T}=new d(t);this.contexts=n,this.identifiers=k,this.functionCalls=T,this.functions=v;for(let A=0;A<g.length;A++){let E=g[A],{ast:y,inForLoopInit:_,inForLoopTest:w}=E,{init:L}=y,N=this.getDependencies(L),b=null;if(_&&w)b="Integer";else if(L){let c=this.getType(L);switch(c){case"Integer":case"Float":case"Number":L.type==="MemberExpression"?b=c:b="Number";break;case"LiteralInteger":b="Number";break;default:b=c}}E.valueType=b,E.dependencies=N,E.isSafe=this.isSafeDependencies(N)}for(let A=0;A<v.length;A++)this.onNestedFunction(v[A],this.source)}getDeclaration(t){for(let n=0;n<this.identifiers.length;n++){let g=this.identifiers[n];if(t===g.ast)return g.declaration}return null}getVariableType(t){if(t.type!=="Identifier")throw new Error(`ast of ${t.type} not "Identifier"`);let n=null,g=this.argumentNames.indexOf(t.name);if(g===-1){let v=this.getDeclaration(t);if(v)return v.valueType}else{let v=this.argumentTypes[g];v&&(n=v)}if(!n&&this.strictTypingChecking)throw new Error(`Declaration of ${name} not found`);return n}getLookupType(t){if(!r.hasOwnProperty(t))throw new Error(`unknown typeLookupMap ${t}`);return r[t]}getConstantType(t){if(this.constantTypes[t]){let n=this.constantTypes[t];return n==="Float"?"Number":n}throw new Error(`Type for constant "${t}" not declared`)}toString(){return this._string?this._string:this._string=this.astGeneric(this.getJsAST(),[]).join("").trim()}toJSON(){let t={source:this.source,name:this.name,constants:this.constants,constantTypes:this.constantTypes,isRootKernel:this.isRootKernel,isSubKernel:this.isSubKernel,debug:this.debug,output:this.output,loopMaxIterations:this.loopMaxIterations,argumentNames:this.argumentNames,argumentTypes:this.argumentTypes,argumentSizes:this.argumentSizes,returnType:this.returnType,leadingReturnStatement:this.leadingReturnStatement,followingReturnStatement:this.followingReturnStatement};return{ast:this.ast,settings:t}}getType(t){if(Array.isArray(t))return this.getType(t[t.length-1]);switch(t.type){case"BlockStatement":return this.getType(t.body);case"ArrayExpression":switch(this.getType(t.elements[0])){case"Array(2)":case"Array(3)":case"Array(4)":return`Matrix(${t.elements.length})`}return`Array(${t.elements.length})`;case"Literal":let g=this.astKey(t);return this.literalTypes[g]?this.literalTypes[g]:Number.isInteger(t.value)?"LiteralInteger":t.value===!0||t.value===!1?"Boolean":"Number";case"AssignmentExpression":return this.getType(t.left);case"CallExpression":if(this.isAstMathFunction(t))return"Number";if(!t.callee||!t.callee.name){if(t.callee.type==="SequenceExpression"&&t.callee.expressions[t.callee.expressions.length-1].property.name){let E=t.callee.expressions[t.callee.expressions.length-1].property.name;return this.inferArgumentTypesIfNeeded(E,t.arguments),this.lookupReturnType(E,t,this)}if(this.getVariableSignature(t.callee,!0)==="this.color")return null;if(t.callee.type==="MemberExpression"&&t.callee.object&&t.callee.property&&t.callee.property.name&&t.arguments){let E=t.callee.property.name;return this.inferArgumentTypesIfNeeded(E,t.arguments),this.lookupReturnType(E,t,this)}throw this.astErrorOutput("Unknown call expression",t)}if(t.callee&&t.callee.name){let E=t.callee.name;return this.inferArgumentTypesIfNeeded(E,t.arguments),this.lookupReturnType(E,t,this)}throw this.astErrorOutput(`Unhandled getType Type "${t.type}"`,t);case"LogicalExpression":return"Boolean";case"BinaryExpression":switch(t.operator){case"%":case"/":if(this.fixIntegerDivisionAccuracy)return"Number";break;case">":case"<":return"Boolean";case"&":case"|":case"^":case"<<":case">>":case">>>":return"Integer"}let v=this.getType(t.left);if(this.isState("skip-literal-correction"))return v;if(v==="LiteralInteger"){let E=this.getType(t.right);return E==="LiteralInteger"?t.left.value%1===0?"Integer":"Float":E}return r[v]||v;case"UpdateExpression":return this.getType(t.argument);case"UnaryExpression":return t.operator==="~"?"Integer":this.getType(t.argument);case"VariableDeclaration":{let E=t.declarations,y;for(let _=0;_<E.length;_++){let w=E[_];y=this.getType(w)}if(!y)throw this.astErrorOutput("Unable to find type for declaration",t);return y}case"VariableDeclarator":let k=this.getDeclaration(t.id);if(!k)throw this.astErrorOutput("Unable to find declarator",t);if(!k.valueType)throw this.astErrorOutput("Unable to find declarator valueType",t);return k.valueType;case"Identifier":if(t.name==="Infinity")return"Number";if(this.isAstVariable(t)&&this.getVariableSignature(t)==="value")return this.getCheckVariableType(t);let T=this.findIdentifierOrigin(t);return T&&T.init?this.getType(T.init):null;case"ReturnStatement":return this.getType(t.argument);case"MemberExpression":if(this.isAstMathFunction(t)){switch(t.property.name){case"ceil":return"Integer";case"floor":return"Integer";case"round":return"Integer"}return"Number"}if(this.isAstVariable(t)){switch(this.getVariableSignature(t)){case"value[]":return this.getLookupType(this.getCheckVariableType(t.object));case"value[][]":return this.getLookupType(this.getCheckVariableType(t.object.object));case"value[][][]":return this.getLookupType(this.getCheckVariableType(t.object.object.object));case"value[][][][]":return this.getLookupType(this.getCheckVariableType(t.object.object.object.object));case"value.thread.value":case"this.thread.value":return"Integer";case"this.output.value":return this.dynamicOutput?"Integer":"LiteralInteger";case"this.constants.value":return this.getConstantType(t.property.name);case"this.constants.value[]":return this.getLookupType(this.getConstantType(t.object.property.name));case"this.constants.value[][]":return this.getLookupType(this.getConstantType(t.object.object.property.name));case"this.constants.value[][][]":return this.getLookupType(this.getConstantType(t.object.object.object.property.name));case"this.constants.value[][][][]":return this.getLookupType(this.getConstantType(t.object.object.object.object.property.name));case"fn()[]":case"fn()[][]":case"fn()[][][]":return this.getLookupType(this.getType(t.object));case"value.value":if(this.isAstMathVariable(t))return"Number";switch(t.property.name){case"r":case"g":case"b":case"a":return this.getLookupType(this.getCheckVariableType(t.object))}case"[][]":return"Number"}throw this.astErrorOutput("Unhandled getType MemberExpression",t)}throw this.astErrorOutput("Unhandled getType MemberExpression",t);case"ConditionalExpression":return this.getType(t.consequent);case"FunctionDeclaration":case"FunctionExpression":let A=this.findLastReturn(t.body);return A?this.getType(A):null;case"IfStatement":return this.getType(t.consequent);case"SequenceExpression":return this.getType(t.expressions[t.expressions.length-1]);default:throw this.astErrorOutput(`Unhandled getType Type "${t.type}"`,t)}}getCheckVariableType(t){let n=this.getVariableType(t);if(!n)throw this.astErrorOutput(`${t.type} is not defined`,t);return n}inferArgumentTypesIfNeeded(t,n){for(let g=0;g<n.length;g++){if(!this.needsArgumentType(t,g))continue;let v=this.getType(n[g]);if(!v)throw this.astErrorOutput(`Unable to infer argument ${g}`,n[g]);this.assignArgumentType(t,g,v)}}isAstMathVariable(t){let n=["E","PI","SQRT2","SQRT1_2","LN2","LN10","LOG2E","LOG10E"];return t.type==="MemberExpression"&&t.object&&t.object.type==="Identifier"&&t.object.name==="Math"&&t.property&&t.property.type==="Identifier"&&n.indexOf(t.property.name)>-1}isAstMathFunction(t){let n=["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","expm1","exp","floor","fround","imul","log","log2","log10","log1p","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"];return t.type==="CallExpression"&&t.callee&&t.callee.type==="MemberExpression"&&t.callee.object&&t.callee.object.type==="Identifier"&&t.callee.object.name==="Math"&&t.callee.property&&t.callee.property.type==="Identifier"&&n.indexOf(t.callee.property.name)>-1}isAstVariable(t){return t.type==="Identifier"||t.type==="MemberExpression"}isSafe(t){return this.isSafeDependencies(this.getDependencies(t))}isSafeDependencies(t){return t&&t.every?t.every(n=>n.isSafe):!0}getDependencies(t,n,g){if(n||(n=[]),!t)return null;if(Array.isArray(t)){for(let v=0;v<t.length;v++)this.getDependencies(t[v],n,g);return n}switch(t.type){case"AssignmentExpression":return this.getDependencies(t.left,n,g),this.getDependencies(t.right,n,g),n;case"ConditionalExpression":return this.getDependencies(t.test,n,g),this.getDependencies(t.alternate,n,g),this.getDependencies(t.consequent,n,g),n;case"Literal":n.push({origin:"literal",value:t.value,isSafe:g===!0?!1:t.value>-1/0&&t.value<1/0&&!isNaN(t.value)});break;case"VariableDeclarator":return this.getDependencies(t.init,n,g);case"Identifier":let v=this.getDeclaration(t);if(v)n.push({name:t.name,origin:"declaration",isSafe:g?!1:this.isSafeDependencies(v.dependencies)});else if(this.argumentNames.indexOf(t.name)>-1)n.push({name:t.name,origin:"argument",isSafe:!1});else if(this.strictTypingChecking)throw new Error(`Cannot find identifier origin "${t.name}"`);break;case"FunctionDeclaration":return this.getDependencies(t.body.body[t.body.body.length-1],n,g);case"ReturnStatement":return this.getDependencies(t.argument,n);case"BinaryExpression":case"LogicalExpression":return g=t.operator==="/"||t.operator==="*",this.getDependencies(t.left,n,g),this.getDependencies(t.right,n,g),n;case"UnaryExpression":case"UpdateExpression":return this.getDependencies(t.argument,n,g);case"VariableDeclaration":return this.getDependencies(t.declarations,n,g);case"ArrayExpression":return n.push({origin:"declaration",isSafe:!0}),n;case"CallExpression":return n.push({origin:"function",isSafe:!0}),n;case"MemberExpression":let k=this.getMemberExpressionDetails(t);switch(k.signature){case"value[]":this.getDependencies(t.object,n,g);break;case"value[][]":this.getDependencies(t.object.object,n,g);break;case"value[][][]":this.getDependencies(t.object.object.object,n,g);break;case"this.output.value":this.dynamicOutput&&n.push({name:k.name,origin:"output",isSafe:!1});break}if(k)return k.property&&this.getDependencies(k.property,n,g),k.xProperty&&this.getDependencies(k.xProperty,n,g),k.yProperty&&this.getDependencies(k.yProperty,n,g),k.zProperty&&this.getDependencies(k.zProperty,n,g),n;case"SequenceExpression":return this.getDependencies(t.expressions,n,g);default:throw this.astErrorOutput(`Unhandled type ${t.type} in getDependencies`,t)}return n}getVariableSignature(t,n){if(!this.isAstVariable(t))throw new Error(`ast of type "${t.type}" is not a variable signature`);if(t.type==="Identifier")return"value";let g=[];for(;t;)t.computed?g.push("[]"):t.type==="ThisExpression"?g.unshift("this"):t.property&&t.property.name?t.property.name==="x"||t.property.name==="y"||t.property.name==="z"?g.unshift(n?"."+t.property.name:".value"):t.property.name==="constants"||t.property.name==="thread"||t.property.name==="output"?g.unshift("."+t.property.name):g.unshift(n?"."+t.property.name:".value"):t.name?g.unshift(n?t.name:"value"):t.callee&&t.callee.name?g.unshift(n?t.callee.name+"()":"fn()"):t.elements?g.unshift("[]"):g.unshift("unknown"),t=t.object;let v=g.join("");return n||["value","value[]","value[][]","value[][][]","value[][][][]","value.value","value.thread.value","this.thread.value","this.output.value","this.constants.value","this.constants.value[]","this.constants.value[][]","this.constants.value[][][]","this.constants.value[][][][]","fn()[]","fn()[][]","fn()[][][]","[][]"].indexOf(v)>-1?v:null}build(){return this.toString().length>0}astGeneric(t,n){if(t===null)throw this.astErrorOutput("NULL ast",t);if(Array.isArray(t)){for(let g=0;g<t.length;g++)this.astGeneric(t[g],n);return n}switch(t.type){case"FunctionDeclaration":return this.astFunctionDeclaration(t,n);case"FunctionExpression":return this.astFunctionExpression(t,n);case"ReturnStatement":return this.astReturnStatement(t,n);case"Literal":return this.astLiteral(t,n);case"BinaryExpression":return this.astBinaryExpression(t,n);case"Identifier":return this.astIdentifierExpression(t,n);case"AssignmentExpression":return this.astAssignmentExpression(t,n);case"ExpressionStatement":return this.astExpressionStatement(t,n);case"EmptyStatement":return this.astEmptyStatement(t,n);case"BlockStatement":return this.astBlockStatement(t,n);case"IfStatement":return this.astIfStatement(t,n);case"SwitchStatement":return this.astSwitchStatement(t,n);case"BreakStatement":return this.astBreakStatement(t,n);case"ContinueStatement":return this.astContinueStatement(t,n);case"ForStatement":return this.astForStatement(t,n);case"WhileStatement":return this.astWhileStatement(t,n);case"DoWhileStatement":return this.astDoWhileStatement(t,n);case"VariableDeclaration":return this.astVariableDeclaration(t,n);case"VariableDeclarator":return this.astVariableDeclarator(t,n);case"ThisExpression":return this.astThisExpression(t,n);case"SequenceExpression":return this.astSequenceExpression(t,n);case"UnaryExpression":return this.astUnaryExpression(t,n);case"UpdateExpression":return this.astUpdateExpression(t,n);case"LogicalExpression":return this.astLogicalExpression(t,n);case"MemberExpression":return this.astMemberExpression(t,n);case"CallExpression":return this.astCallExpression(t,n);case"ArrayExpression":return this.astArrayExpression(t,n);case"DebuggerStatement":return this.astDebuggerStatement(t,n);case"ConditionalExpression":return this.astConditionalExpression(t,n)}throw this.astErrorOutput("Unknown ast type : "+t.type,t)}astErrorOutput(t,n){if(typeof this.source!="string")return new Error(t);let g=p.getAstString(this.source,n),k=this.source.substr(n.start).split(/\\n/),T=k.length>0?k[k.length-1]:0;return new Error(`${t} on line ${k.length}, position ${T.length}:\n ${g}`)}astDebuggerStatement(t,n){return n}astConditionalExpression(t,n){if(t.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",t);return n.push("("),this.astGeneric(t.test,n),n.push("?"),this.astGeneric(t.consequent,n),n.push(":"),this.astGeneric(t.alternate,n),n.push(")"),n}astFunction(t,n){throw new Error(`"astFunction" not defined on ${this.constructor.name}`)}astFunctionDeclaration(t,n){return this.isChildFunction(t)?n:this.astFunction(t,n)}astFunctionExpression(t,n){return this.isChildFunction(t)?n:this.astFunction(t,n)}isChildFunction(t){for(let n=0;n<this.functions.length;n++)if(this.functions[n]===t)return!0;return!1}astReturnStatement(t,n){return n}astLiteral(t,n){return this.literalTypes[this.astKey(t)]="Number",n}astBinaryExpression(t,n){return n}astIdentifierExpression(t,n){return n}astAssignmentExpression(t,n){return n}astExpressionStatement(t,n){return this.astGeneric(t.expression,n),n.push(";"),n}astEmptyStatement(t,n){return n}astBlockStatement(t,n){return n}astIfStatement(t,n){return n}astSwitchStatement(t,n){return n}astBreakStatement(t,n){return n.push("break;"),n}astContinueStatement(t,n){return n.push(`continue;\n`),n}astForStatement(t,n){return n}astWhileStatement(t,n){return n}astDoWhileStatement(t,n){return n}astVariableDeclarator(t,n){return this.astGeneric(t.id,n),t.init!==null&&(n.push("="),this.astGeneric(t.init,n)),n}astThisExpression(t,n){return n}astSequenceExpression(t,n){let{expressions:g}=t,v=[];for(let k=0;k<g.length;k++){let T=g[k],A=[];this.astGeneric(T,A),v.push(A.join(""))}return v.length>1?n.push("(",v.join(","),")"):n.push(v[0]),n}astUnaryExpression(t,n){return this.checkAndUpconvertBitwiseUnary(t,n)||(t.prefix?(n.push(t.operator),this.astGeneric(t.argument,n)):(this.astGeneric(t.argument,n),n.push(t.operator))),n}checkAndUpconvertBitwiseUnary(t,n){}astUpdateExpression(t,n){return t.prefix?(n.push(t.operator),this.astGeneric(t.argument,n)):(this.astGeneric(t.argument,n),n.push(t.operator)),n}astLogicalExpression(t,n){return n.push("("),this.astGeneric(t.left,n),n.push(t.operator),this.astGeneric(t.right,n),n.push(")"),n}astMemberExpression(t,n){return n}astCallExpression(t,n){return n}astArrayExpression(t,n){return n}getMemberExpressionDetails(t){if(t.type!=="MemberExpression")throw this.astErrorOutput(`Expression ${t.type} not a MemberExpression`,t);let n=null,g=null,v=this.getVariableSignature(t);switch(v){case"value":return null;case"value.thread.value":case"this.thread.value":case"this.output.value":return{signature:v,type:"Integer",name:t.property.name};case"value[]":if(typeof t.object.name!="string")throw this.astErrorOutput("Unexpected expression",t);return n=t.object.name,{name:n,origin:"user",signature:v,type:this.getVariableType(t.object),xProperty:t.property};case"value[][]":if(typeof t.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",t);return n=t.object.object.name,{name:n,origin:"user",signature:v,type:this.getVariableType(t.object.object),yProperty:t.object.property,xProperty:t.property};case"value[][][]":if(typeof t.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",t);return n=t.object.object.object.name,{name:n,origin:"user",signature:v,type:this.getVariableType(t.object.object.object),zProperty:t.object.object.property,yProperty:t.object.property,xProperty:t.property};case"value[][][][]":if(typeof t.object.object.object.object.name!="string")throw this.astErrorOutput("Unexpected expression",t);return n=t.object.object.object.object.name,{name:n,origin:"user",signature:v,type:this.getVariableType(t.object.object.object.object),zProperty:t.object.object.property,yProperty:t.object.property,xProperty:t.property};case"value.value":if(typeof t.property.name!="string")throw this.astErrorOutput("Unexpected expression",t);if(this.isAstMathVariable(t))return n=t.property.name,{name:n,origin:"Math",type:"Number",signature:v};switch(t.property.name){case"r":case"g":case"b":case"a":return n=t.object.name,{name:n,property:t.property.name,origin:"user",signature:v,type:"Number"};default:throw this.astErrorOutput("Unexpected expression",t)}case"this.constants.value":if(typeof t.property.name!="string")throw this.astErrorOutput("Unexpected expression",t);if(n=t.property.name,g=this.getConstantType(n),!g)throw this.astErrorOutput("Constant has no type",t);return{name:n,type:g,origin:"constants",signature:v};case"this.constants.value[]":if(typeof t.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",t);if(n=t.object.property.name,g=this.getConstantType(n),!g)throw this.astErrorOutput("Constant has no type",t);return{name:n,type:g,origin:"constants",signature:v,xProperty:t.property};case"this.constants.value[][]":{if(typeof t.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",t);if(n=t.object.object.property.name,g=this.getConstantType(n),!g)throw this.astErrorOutput("Constant has no type",t);return{name:n,type:g,origin:"constants",signature:v,yProperty:t.object.property,xProperty:t.property}}case"this.constants.value[][][]":{if(typeof t.object.object.object.property.name!="string")throw this.astErrorOutput("Unexpected expression",t);if(n=t.object.object.object.property.name,g=this.getConstantType(n),!g)throw this.astErrorOutput("Constant has no type",t);return{name:n,type:g,origin:"constants",signature:v,zProperty:t.object.object.property,yProperty:t.object.property,xProperty:t.property}}case"fn()[]":case"fn()[][]":case"[][]":return{signature:v,property:t.property};default:throw this.astErrorOutput("Unexpected expression",t)}}findIdentifierOrigin(t){let n=[this.ast];for(;n.length>0;){let g=n[0];if(g.type==="VariableDeclarator"&&g.id&&g.id.name&&g.id.name===t.name)return g;if(n.shift(),g.argument)n.push(g.argument);else if(g.body)n.push(g.body);else if(g.declarations)n.push(g.declarations);else if(Array.isArray(g))for(let v=0;v<g.length;v++)n.push(g[v])}return null}findLastReturn(t){let n=[t||this.ast];for(;n.length>0;){let g=n.pop();if(g.type==="ReturnStatement")return g;if(g.type!=="FunctionDeclaration")if(g.argument)n.push(g.argument);else if(g.body)n.push(g.body);else if(g.declarations)n.push(g.declarations);else if(Array.isArray(g))for(let v=0;v<g.length;v++)n.push(g[v]);else g.consequent?n.push(g.consequent):g.cases&&n.push(g.cases)}return null}getInternalVariableName(t){return this._internalVariableNames.hasOwnProperty(t)||(this._internalVariableNames[t]=0),this._internalVariableNames[t]++,this._internalVariableNames[t]===1?t:t+this._internalVariableNames[t]}astKey(t,n=","){if(!t.start||!t.end)throw new Error("AST start and end needed");return`${t.start}${n}${t.end}`}}let r={Number:"Number",Float:"Float",Integer:"Integer",Array:"Number","Array(2)":"Number","Array(3)":"Number","Array(4)":"Number","Matrix(2)":"Number","Matrix(3)":"Number","Matrix(4)":"Number",Array2D:"Number",Array3D:"Number",Input:"Number",HTMLCanvas:"Array(4)",HTMLImage:"Array(4)",HTMLVideo:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number",MemoryOptimizedNumberTexture:"Number","Array1D(2)":"Array(2)","Array1D(3)":"Array(3)","Array1D(4)":"Array(4)","Array2D(2)":"Array(2)","Array2D(3)":"Array(3)","Array2D(4)":"Array(4)","Array3D(2)":"Array(2)","Array3D(3)":"Array(3)","Array3D(4)":"Array(4)","ArrayTexture(1)":"Number","ArrayTexture(2)":"Array(2)","ArrayTexture(3)":"Array(3)","ArrayTexture(4)":"Array(4)"};o.exports={FunctionNode:f}},{"../utils":114,"./function-tracer":11,acorn:1}],11:[function(i,o,m){let{utils:u}=i("../utils");function p(r){return r.length>0?r[r.length-1]:null}let d={trackIdentifiers:"trackIdentifiers",memberExpression:"memberExpression",inForLoopInit:"inForLoopInit"};class f{constructor(a){this.runningContexts=[],this.functionContexts=[],this.contexts=[],this.functionCalls=[],this.declarations=[],this.identifiers=[],this.functions=[],this.returnStatements=[],this.trackedIdentifiers=null,this.states=[],this.newFunctionContext(),this.scan(a)}isState(a){return this.states[this.states.length-1]===a}hasState(a){return this.states.indexOf(a)>-1}pushState(a){this.states.push(a)}popState(a){if(this.isState(a))this.states.pop();else throw new Error(`Cannot pop the non-active state "${a}"`)}get currentFunctionContext(){return p(this.functionContexts)}get currentContext(){return p(this.runningContexts)}newFunctionContext(){let a={"@contextType":"function"};this.contexts.push(a),this.functionContexts.push(a)}newContext(a){let t=Object.assign({"@contextType":"const/let"},this.currentContext);this.contexts.push(t),this.runningContexts.push(t),a();let{currentFunctionContext:n}=this;for(let g in n)!n.hasOwnProperty(g)||t.hasOwnProperty(g)||(t[g]=n[g]);return this.runningContexts.pop(),t}useFunctionContext(a){let t=p(this.functionContexts);this.runningContexts.push(t),a(),this.runningContexts.pop()}getIdentifiers(a){let t=this.trackedIdentifiers=[];return this.pushState(d.trackIdentifiers),a(),this.trackedIdentifiers=null,this.popState(d.trackIdentifiers),t}getDeclaration(a){let{currentContext:t,currentFunctionContext:n,runningContexts:g}=this,v=t[a]||n[a]||null;if(!v&&t===n&&g.length>0){let k=g[g.length-2];if(k[a])return k[a]}return v}scan(a){if(!!a){if(Array.isArray(a)){for(let t=0;t<a.length;t++)this.scan(a[t]);return}switch(a.type){case"Program":this.useFunctionContext(()=>{this.scan(a.body)});break;case"BlockStatement":this.newContext(()=>{this.scan(a.body)});break;case"AssignmentExpression":case"LogicalExpression":this.scan(a.left),this.scan(a.right);break;case"BinaryExpression":this.scan(a.left),this.scan(a.right);break;case"UpdateExpression":if(a.operator==="++"){let t=this.getDeclaration(a.argument.name);t&&(t.suggestedType="Integer")}this.scan(a.argument);break;case"UnaryExpression":this.scan(a.argument);break;case"VariableDeclaration":a.kind==="var"?this.useFunctionContext(()=>{a.declarations=u.normalizeDeclarations(a),this.scan(a.declarations)}):(a.declarations=u.normalizeDeclarations(a),this.scan(a.declarations));break;case"VariableDeclarator":{let{currentContext:t}=this,n=this.hasState(d.inForLoopInit),g={ast:a,context:t,name:a.id.name,origin:"declaration",inForLoopInit:n,inForLoopTest:null,assignable:t===this.currentFunctionContext||!n&&!t.hasOwnProperty(a.id.name),suggestedType:null,valueType:null,dependencies:null,isSafe:null};t[a.id.name]||(t[a.id.name]=g),this.declarations.push(g),this.scan(a.id),this.scan(a.init);break}case"FunctionExpression":case"FunctionDeclaration":this.runningContexts.length===0?this.scan(a.body):this.functions.push(a);break;case"IfStatement":this.scan(a.test),this.scan(a.consequent),a.alternate&&this.scan(a.alternate);break;case"ForStatement":{let t,n=this.newContext(()=>{this.pushState(d.inForLoopInit),this.scan(a.init),this.popState(d.inForLoopInit),t=this.getIdentifiers(()=>{this.scan(a.test)}),this.scan(a.update),this.newContext(()=>{this.scan(a.body)})});if(t)for(let g in n)g!=="@contextType"&&t.indexOf(g)>-1&&(n[g].inForLoopTest=!0);break}case"DoWhileStatement":case"WhileStatement":this.newContext(()=>{this.scan(a.body),this.scan(a.test)});break;case"Identifier":{this.isState(d.trackIdentifiers)&&this.trackedIdentifiers.push(a.name),this.identifiers.push({context:this.currentContext,declaration:this.getDeclaration(a.name),ast:a});break}case"ReturnStatement":this.returnStatements.push(a),this.scan(a.argument);break;case"MemberExpression":this.pushState(d.memberExpression),this.scan(a.object),this.scan(a.property),this.popState(d.memberExpression);break;case"ExpressionStatement":this.scan(a.expression);break;case"SequenceExpression":this.scan(a.expressions);break;case"CallExpression":this.functionCalls.push({context:this.currentContext,ast:a}),this.scan(a.arguments);break;case"ArrayExpression":this.scan(a.elements);break;case"ConditionalExpression":this.scan(a.test),this.scan(a.alternate),this.scan(a.consequent);break;case"SwitchStatement":this.scan(a.discriminant),this.scan(a.cases);break;case"SwitchCase":this.scan(a.test),this.scan(a.consequent);break;case"ThisExpression":case"Literal":case"DebuggerStatement":case"EmptyStatement":case"BreakStatement":case"ContinueStatement":break;default:throw new Error(`unhandled type "${a.type}"`)}}}}o.exports={FunctionTracer:f}},{"../utils":114}],12:[function(i,o,m){let{glWiretap:u}=i("gl-wiretap"),{utils:p}=i("../../utils");function d(g){return g.toString().replace("=>","").replace(/^function /,"").replace(/utils[.]/g,"/*utils.*/")}function f(g,v,k,T,A){k.built||k.build.apply(k,v),v=v?Array.from(v).map(ee=>{switch(typeof ee){case"boolean":return new Boolean(ee);case"number":return new Number(ee);default:return ee}}):null;let E=[],y=[],_=u(k.context,{useTrackablePrimitives:!0,onReadPixels:ee=>{if(Z.subKernels){if(!w)y.push(`    const result = { result: ${r(ee,Z)} };`),w=!0;else{let ce=Z.subKernels[L++].property;y.push(`    result${isNaN(ce)?"."+ce:`[${ce}]`} = ${r(ee,Z)};`)}L===Z.subKernels.length&&y.push("    return result;");return}ee?y.push(`    return ${r(ee,Z)};`):y.push("    return null;")},onUnrecognizedArgumentLookup:ee=>{let ce=n(ee,Z.kernelArguments,[],_,E);if(ce)return ce;let fe=n(ee,Z.kernelConstants,M?Object.keys(M).map(me=>M[me]):[],_,E);return fe||null}}),w=!1,L=0,{source:N,canvas:b,output:c,pipeline:C,graphical:F,loopMaxIterations:P,constants:M,optimizeFloatMemory:$,precision:G,fixIntegerDivisionAccuracy:O,functions:Y,nativeFunctions:W,subKernels:K,immutable:J,argumentTypes:Q,constantTypes:te,kernelArguments:H,kernelConstants:B,tactic:he}=k,Z=new g(N,{canvas:b,context:_,checkContext:!1,output:c,pipeline:C,graphical:F,loopMaxIterations:P,constants:M,optimizeFloatMemory:$,precision:G,fixIntegerDivisionAccuracy:O,functions:Y,nativeFunctions:W,subKernels:K,immutable:J,argumentTypes:Q,constantTypes:te,tactic:he}),ie=[];if(_.setIndent(2),Z.build.apply(Z,v),ie.push(_.toString()),_.reset(),Z.kernelArguments.forEach((ee,ce)=>{switch(ee.type){case"Integer":case"Boolean":case"Number":case"Float":case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":_.insertVariable(`uploadValue_${ee.name}`,ee.uploadValue);break;case"HTMLImageArray":for(let fe=0;fe<v[ce].length;fe++){let me=v[ce];_.insertVariable(`uploadValue_${ee.name}[${fe}]`,me[fe])}break;case"Input":_.insertVariable(`uploadValue_${ee.name}`,ee.uploadValue);break;case"MemoryOptimizedNumberTexture":case"NumberTexture":case"Array1D(2)":case"Array1D(3)":case"Array1D(4)":case"Array2D(2)":case"Array2D(3)":case"Array2D(4)":case"Array3D(2)":case"Array3D(3)":case"Array3D(4)":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":_.insertVariable(`uploadValue_${ee.name}`,v[ce].texture);break;default:throw new Error(`unhandled kernelArgumentType insertion for glWiretap of type ${ee.type}`)}}),ie.push("/** start of injected functions **/"),ie.push(`function ${d(p.flattenTo)}`),ie.push(`function ${d(p.flatten2dArrayTo)}`),ie.push(`function ${d(p.flatten3dArrayTo)}`),ie.push(`function ${d(p.flatten4dArrayTo)}`),ie.push(`function ${d(p.isArray)}`),Z.renderOutput!==Z.renderTexture&&Z.formatValues&&ie.push(`  const renderOutput = function ${d(Z.formatValues)};`),ie.push("/** end of injected functions **/"),ie.push(`  const innerKernel = function (${Z.kernelArguments.map(ee=>ee.varName).join(", ")}) {`),_.setIndent(4),Z.run.apply(Z,v),Z.renderKernels?Z.renderKernels():Z.renderOutput&&Z.renderOutput(),ie.push("    /** start setup uploads for kernel values **/"),Z.kernelArguments.forEach(ee=>{ie.push("    "+ee.getStringValueHandler().split(`\n`).join(`\n    `))}),ie.push("    /** end setup uploads for kernel values **/"),ie.push(_.toString()),Z.renderOutput===Z.renderTexture){_.reset();let ee=_.getContextVariableName(Z.framebuffer);if(Z.renderKernels){let ce=Z.renderKernels(),fe=_.getContextVariableName(Z.texture.texture);ie.push(`    return {\n            result: {\n              texture: ${fe},\n              type: \'${ce.result.type}\',\n              toArray: ${t(ce.result,fe,ee)}\n            },`);let{subKernels:me,mappedTextures:ne}=Z;for(let ue=0;ue<me.length;ue++){let xe=ne[ue],_e=me[ue],ke=ce[_e.property],$e=_.getContextVariableName(xe.texture);ie.push(`\n            ${_e.property}: {\n              texture: ${$e},\n              type: \'${ke.type}\',\n              toArray: ${t(ke,$e,ee)}\n            },`)}ie.push("    };")}else{let ce=Z.renderOutput(),fe=_.getContextVariableName(Z.texture.texture);ie.push(`    return {\n              texture: ${fe},\n              type: \'${ce.type}\',\n              toArray: ${t(ce,fe,ee)}\n            };`)}}ie.push(`    ${A?`\n`+A+"    ":""}`),ie.push(y.join(`\n`)),ie.push("  };"),Z.graphical&&(ie.push(a(Z)),ie.push("  innerKernel.getPixels = getPixels;")),ie.push("  return innerKernel;");let Se=[];return B.forEach(ee=>{Se.push(`${ee.getStringValueHandler()}`)}),`function kernel(settings) {\n        const { context, constants } = settings;\n        ${Se.join("")}\n        ${T||""}\n      ${ie.join(`\n`)}\n      }`}function r(g,v){let k=v.precision==="single"?g:`new Float32Array(${g}.buffer)`;return v.output[2]?`renderOutput(${k}, ${v.output[0]}, ${v.output[1]}, ${v.output[2]})`:v.output[1]?`renderOutput(${k}, ${v.output[0]}, ${v.output[1]})`:`renderOutput(${k}, ${v.output[0]})`}function a(g){let v=g.getPixels.toString(),k=!/^function/.test(v);return p.flattenFunctionToString(`${k?"function ":""}${v}`,{findDependency:(T,A)=>T==="utils"?`const ${A} = ${p[A].toString()};`:null,thisLookup:T=>{if(T==="context")return null;if(g.hasOwnProperty(T))return JSON.stringify(g[T]);throw new Error(`unhandled thisLookup ${T}`)}})}function t(g,v,k){let T=g.toArray.toString(),A=!/^function/.test(T),E=p.flattenFunctionToString(`${A?"function ":""}${T}`,{findDependency:(y,_)=>{if(y==="utils")return`const ${_} = ${p[_].toString()};`;if(y==="this")return _==="framebuffer"?"":`${A?"function ":""}${g[_].toString()}`;throw new Error("unhandled fromObject")},thisLookup:(y,_)=>{if(y==="texture")return v;if(y==="context")return _?null:"gl";if(g.hasOwnProperty(y))return JSON.stringify(g[y]);throw new Error(`unhandled thisLookup ${y}`)}});return`() => {\n        function framebuffer() { return ${k}; };\n        ${E}\n        return toArray();\n        }`}function n(g,v,k,T,A){if(g===null||v===null)return null;switch(typeof g){case"boolean":case"number":return null}if(typeof HTMLImageElement<"u"&&g instanceof HTMLImageElement)for(let E=0;E<v.length;E++){let y=v[E];if(y.type!=="HTMLImageArray"&&y||y.uploadValue!==g)continue;let _=k[E].indexOf(g);if(_===-1)continue;let w=`uploadValue_${y.name}[${_}]`;return T.insertVariable(w,g),w}for(let E=0;E<v.length;E++){let y=v[E];if(g!==y.uploadValue)continue;let _=`uploadValue_${y.name}`;return T.insertVariable(_,y),_}return null}o.exports={glKernelString:f}},{"../../utils":114,"gl-wiretap":3}],13:[function(i,o,m){let{Kernel:u}=i("../kernel"),{utils:p}=i("../../utils"),{GLTextureArray2Float:d}=i("./texture/array-2-float"),{GLTextureArray2Float2D:f}=i("./texture/array-2-float-2d"),{GLTextureArray2Float3D:r}=i("./texture/array-2-float-3d"),{GLTextureArray3Float:a}=i("./texture/array-3-float"),{GLTextureArray3Float2D:t}=i("./texture/array-3-float-2d"),{GLTextureArray3Float3D:n}=i("./texture/array-3-float-3d"),{GLTextureArray4Float:g}=i("./texture/array-4-float"),{GLTextureArray4Float2D:v}=i("./texture/array-4-float-2d"),{GLTextureArray4Float3D:k}=i("./texture/array-4-float-3d"),{GLTextureFloat:T}=i("./texture/float"),{GLTextureFloat2D:A}=i("./texture/float-2d"),{GLTextureFloat3D:E}=i("./texture/float-3d"),{GLTextureMemoryOptimized:y}=i("./texture/memory-optimized"),{GLTextureMemoryOptimized2D:_}=i("./texture/memory-optimized-2d"),{GLTextureMemoryOptimized3D:w}=i("./texture/memory-optimized-3d"),{GLTextureUnsigned:L}=i("./texture/unsigned"),{GLTextureUnsigned2D:N}=i("./texture/unsigned-2d"),{GLTextureUnsigned3D:b}=i("./texture/unsigned-3d"),{GLTextureGraphical:c}=i("./texture/graphical");class C extends u{static get mode(){return"gpu"}static getIsFloatRead(){let M=`function kernelFunction() {\n            return 1;\n          }`,$=new this(M,{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[1],precision:"single",returnType:"Number",tactic:"speed"});$.build(),$.run();let G=$.renderOutput();return $.destroy(!0),G[0]===1}static getIsIntegerDivisionAccurate(){function M(Y,W){return Y[this.thread.x]/W[this.thread.x]}let $=new this(M.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[2],returnType:"Number",precision:"unsigned",tactic:"speed"}),G=[[6,6030401],[3,3991]];$.build.apply($,G),$.run.apply($,G);let O=$.renderOutput();return $.destroy(!0),O[0]===2&&O[1]===1511}static getIsSpeedTacticSupported(){function M(Y){return Y[this.thread.x]}let $=new this(M.toString(),{context:this.testContext,canvas:this.testCanvas,validate:!1,output:[4],returnType:"Number",precision:"unsigned",tactic:"speed"}),G=[[0,1,2,3]];$.build.apply($,G),$.run.apply($,G);let O=$.renderOutput();return $.destroy(!0),Math.round(O[0])===0&&Math.round(O[1])===1&&Math.round(O[2])===2&&Math.round(O[3])===3}static get testCanvas(){throw new Error(`"testCanvas" not defined on ${this.name}`)}static get testContext(){throw new Error(`"testContext" not defined on ${this.name}`)}static getFeatures(){let M=this.testContext,$=this.getIsDrawBuffers();return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),isTextureFloat:this.getIsTextureFloat(),isDrawBuffers:$,kernelMap:$,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.LOW_INT),lowFloatPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.LOW_FLOAT),mediumIntPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.MEDIUM_INT),mediumFloatPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.MEDIUM_FLOAT),highIntPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.HIGH_INT),highFloatPrecision:M.getShaderPrecisionFormat(M.FRAGMENT_SHADER,M.HIGH_FLOAT)})}static setupFeatureChecks(){throw new Error(`"setupFeatureChecks" not defined on ${this.name}`)}static getSignature(M,$){return M.getVariablePrecisionString()+($.length>0?":"+$.join(","):"")}setFixIntegerDivisionAccuracy(M){return this.fixIntegerDivisionAccuracy=M,this}setPrecision(M){return this.precision=M,this}setFloatTextures(M){return p.warnDeprecated("method","setFloatTextures","setOptimizeFloatMemory"),this.floatTextures=M,this}static nativeFunctionArguments(M){let $=[],G=[],O=[],Y=/^[a-zA-Z_]/,W=/[a-zA-Z_0-9]/,K=0,J=null,Q=null;for(;K<M.length;){let te=M[K],H=M[K+1],B=O.length>0?O[O.length-1]:null;if(B==="FUNCTION_ARGUMENTS"&&te==="/"&&H==="*"){O.push("MULTI_LINE_COMMENT"),K+=2;continue}else if(B==="MULTI_LINE_COMMENT"&&te==="*"&&H==="/"){O.pop(),K+=2;continue}else if(B==="FUNCTION_ARGUMENTS"&&te==="/"&&H==="/"){O.push("COMMENT"),K+=2;continue}else if(B==="COMMENT"&&te===`\n`){O.pop(),K++;continue}else if(B===null&&te==="("){O.push("FUNCTION_ARGUMENTS"),K++;continue}else if(B==="FUNCTION_ARGUMENTS"){if(te===")"){O.pop();break}if(te==="f"&&H==="l"&&M[K+2]==="o"&&M[K+3]==="a"&&M[K+4]==="t"&&M[K+5]===" "){O.push("DECLARE_VARIABLE"),Q="float",J="",K+=6;continue}else if(te==="i"&&H==="n"&&M[K+2]==="t"&&M[K+3]===" "){O.push("DECLARE_VARIABLE"),Q="int",J="",K+=4;continue}else if(te==="v"&&H==="e"&&M[K+2]==="c"&&M[K+3]==="2"&&M[K+4]===" "){O.push("DECLARE_VARIABLE"),Q="vec2",J="",K+=5;continue}else if(te==="v"&&H==="e"&&M[K+2]==="c"&&M[K+3]==="3"&&M[K+4]===" "){O.push("DECLARE_VARIABLE"),Q="vec3",J="",K+=5;continue}else if(te==="v"&&H==="e"&&M[K+2]==="c"&&M[K+3]==="4"&&M[K+4]===" "){O.push("DECLARE_VARIABLE"),Q="vec4",J="",K+=5;continue}}else if(B==="DECLARE_VARIABLE"){if(J===""){if(te===" "){K++;continue}if(!Y.test(te))throw new Error("variable name is not expected string")}J+=te,W.test(H)||(O.pop(),G.push(J),$.push(F[Q]))}K++}if(O.length>0)throw new Error("GLSL function was not parsable");return{argumentNames:G,argumentTypes:$}}static nativeFunctionReturnType(M){return F[M.match(/int|float|vec[2-4]/)[0]]}static combineKernels(M,$){M.apply(null,arguments);let{texSize:G,context:O,threadDim:Y}=$.texSize,W;if($.precision==="single"){let K=G[0],J=Math.ceil(G[1]/4);W=new Float32Array(K*J*4*4),O.readPixels(0,0,K,J*4,O.RGBA,O.FLOAT,W)}else{let K=new Uint8Array(G[0]*G[1]*4);O.readPixels(0,0,G[0],G[1],O.RGBA,O.UNSIGNED_BYTE,K),W=new Float32Array(K.buffer)}if(W=W.subarray(0,Y[0]*Y[1]*Y[2]),$.output.length===1)return W;if($.output.length===2)return p.splitArray(W,$.output[0]);if($.output.length===3)return p.splitArray(W,$.output[0]*$.output[1]).map(function(J){return p.splitArray(J,$.output[0])})}constructor(M,$){super(M,$),this.transferValues=null,this.formatValues=null,this.TextureConstructor=null,this.renderOutput=null,this.renderRawOutput=null,this.texSize=null,this.translatedSource=null,this.compiledFragmentShader=null,this.compiledVertexShader=null,this.switchingKernels=null,this._textureSwitched=null,this._mappedTextureSwitched=null}checkTextureSize(){let{features:M}=this.constructor;if(this.texSize[0]>M.maxTextureSize||this.texSize[1]>M.maxTextureSize)throw new Error(`Texture size [${this.texSize[0]},${this.texSize[1]}] generated by kernel is larger than supported size [${M.maxTextureSize},${M.maxTextureSize}]`)}translateSource(){throw new Error(`"translateSource" not defined on ${this.constructor.name}`)}pickRenderStrategy(M){if(this.graphical)return this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=$=>$,this.TextureConstructor=c,null;if(this.precision==="unsigned")if(this.renderRawOutput=this.readPackedPixelsToUint8Array,this.transferValues=this.readPackedPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=b,null):this.output[1]>0?(this.TextureConstructor=N,null):(this.TextureConstructor=L,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(M)}else switch(this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.renderOutput=this.renderValues,this.output[2]>0?(this.TextureConstructor=b,this.formatValues=p.erect3DPackedFloat,null):this.output[1]>0?(this.TextureConstructor=N,this.formatValues=p.erect2DPackedFloat,null):(this.TextureConstructor=L,this.formatValues=p.erectPackedFloat,null);case"Array(2)":case"Array(3)":case"Array(4)":return this.requestFallback(M)}else if(this.precision==="single"){if(this.renderRawOutput=this.readFloatPixelsToFloat32Array,this.transferValues=this.readFloatPixelsToFloat32Array,this.pipeline)switch(this.renderOutput=this.renderTexture,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToTextures),this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.optimizeFloatMemory?this.output[2]>0?(this.TextureConstructor=w,null):this.output[1]>0?(this.TextureConstructor=_,null):(this.TextureConstructor=y,null):this.output[2]>0?(this.TextureConstructor=E,null):this.output[1]>0?(this.TextureConstructor=A,null):(this.TextureConstructor=T,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=r,null):this.output[1]>0?(this.TextureConstructor=f,null):(this.TextureConstructor=d,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=n,null):this.output[1]>0?(this.TextureConstructor=t,null):(this.TextureConstructor=a,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=k,null):this.output[1]>0?(this.TextureConstructor=v,null):(this.TextureConstructor=g,null)}if(this.renderOutput=this.renderValues,this.subKernels!==null&&(this.renderKernels=this.renderKernelsToArrays),this.optimizeFloatMemory)switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=w,this.formatValues=p.erectMemoryOptimized3DFloat,null):this.output[1]>0?(this.TextureConstructor=_,this.formatValues=p.erectMemoryOptimized2DFloat,null):(this.TextureConstructor=y,this.formatValues=p.erectMemoryOptimizedFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=r,this.formatValues=p.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=f,this.formatValues=p.erect2DArray2,null):(this.TextureConstructor=d,this.formatValues=p.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=n,this.formatValues=p.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=t,this.formatValues=p.erect2DArray3,null):(this.TextureConstructor=a,this.formatValues=p.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=k,this.formatValues=p.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=v,this.formatValues=p.erect2DArray4,null):(this.TextureConstructor=g,this.formatValues=p.erectArray4,null)}else switch(this.returnType){case"LiteralInteger":case"Float":case"Number":case"Integer":return this.output[2]>0?(this.TextureConstructor=E,this.formatValues=p.erect3DFloat,null):this.output[1]>0?(this.TextureConstructor=A,this.formatValues=p.erect2DFloat,null):(this.TextureConstructor=T,this.formatValues=p.erectFloat,null);case"Array(2)":return this.output[2]>0?(this.TextureConstructor=r,this.formatValues=p.erect3DArray2,null):this.output[1]>0?(this.TextureConstructor=f,this.formatValues=p.erect2DArray2,null):(this.TextureConstructor=d,this.formatValues=p.erectArray2,null);case"Array(3)":return this.output[2]>0?(this.TextureConstructor=n,this.formatValues=p.erect3DArray3,null):this.output[1]>0?(this.TextureConstructor=t,this.formatValues=p.erect2DArray3,null):(this.TextureConstructor=a,this.formatValues=p.erectArray3,null);case"Array(4)":return this.output[2]>0?(this.TextureConstructor=k,this.formatValues=p.erect3DArray4,null):this.output[1]>0?(this.TextureConstructor=v,this.formatValues=p.erect2DArray4,null):(this.TextureConstructor=g,this.formatValues=p.erectArray4,null)}}else throw new Error(`unhandled precision of "${this.precision}"`);throw new Error(`unhandled return type "${this.returnType}"`)}getKernelString(){throw new Error("abstract method call")}getMainResultTexture(){switch(this.returnType){case"LiteralInteger":case"Float":case"Integer":case"Number":return this.getMainResultNumberTexture();case"Array(2)":return this.getMainResultArray2Texture();case"Array(3)":return this.getMainResultArray3Texture();case"Array(4)":return this.getMainResultArray4Texture();default:throw new Error(`unhandled returnType type ${this.returnType}`)}}getMainResultKernelNumberTexture(){throw new Error("abstract method call")}getMainResultSubKernelNumberTexture(){throw new Error("abstract method call")}getMainResultKernelArray2Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray2Texture(){throw new Error("abstract method call")}getMainResultKernelArray3Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray3Texture(){throw new Error("abstract method call")}getMainResultKernelArray4Texture(){throw new Error("abstract method call")}getMainResultSubKernelArray4Texture(){throw new Error("abstract method call")}getMainResultGraphical(){throw new Error("abstract method call")}getMainResultMemoryOptimizedFloats(){throw new Error("abstract method call")}getMainResultPackedPixels(){throw new Error("abstract method call")}getMainResultString(){return this.graphical?this.getMainResultGraphical():this.precision==="single"?this.optimizeFloatMemory?this.getMainResultMemoryOptimizedFloats():this.getMainResultTexture():this.getMainResultPackedPixels()}getMainResultNumberTexture(){return p.linesToString(this.getMainResultKernelNumberTexture())+p.linesToString(this.getMainResultSubKernelNumberTexture())}getMainResultArray2Texture(){return p.linesToString(this.getMainResultKernelArray2Texture())+p.linesToString(this.getMainResultSubKernelArray2Texture())}getMainResultArray3Texture(){return p.linesToString(this.getMainResultKernelArray3Texture())+p.linesToString(this.getMainResultSubKernelArray3Texture())}getMainResultArray4Texture(){return p.linesToString(this.getMainResultKernelArray4Texture())+p.linesToString(this.getMainResultSubKernelArray4Texture())}getFloatTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} float;\n`}getIntTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic,!0)} int;\n`}getSampler2DTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2D;\n`}getSampler2DArrayTacticDeclaration(){return`precision ${this.getVariablePrecisionString(this.texSize,this.tactic)} sampler2DArray;\n`}renderTexture(){return this.immutable?this.texture.clone():this.texture}readPackedPixelsToUint8Array(){if(this.precision!=="unsigned")throw new Error(\'Requires this.precision to be "unsigned"\');let{texSize:M,context:$}=this,G=new Uint8Array(M[0]*M[1]*4);return $.readPixels(0,0,M[0],M[1],$.RGBA,$.UNSIGNED_BYTE,G),G}readPackedPixelsToFloat32Array(){return new Float32Array(this.readPackedPixelsToUint8Array().buffer)}readFloatPixelsToFloat32Array(){if(this.precision!=="single")throw new Error(\'Requires this.precision to be "single"\');let{texSize:M,context:$}=this,G=M[0],O=M[1],Y=new Float32Array(G*O*4);return $.readPixels(0,0,G,O,$.RGBA,$.FLOAT,Y),Y}getPixels(M){let{context:$,output:G}=this,[O,Y]=G,W=new Uint8Array(O*Y*4);return $.readPixels(0,0,O,Y,$.RGBA,$.UNSIGNED_BYTE,W),new Uint8ClampedArray((M?W:p.flipPixels(W,O,Y)).buffer)}renderKernelsToArrays(){let M={result:this.renderOutput()};for(let $=0;$<this.subKernels.length;$++)M[this.subKernels[$].property]=this.mappedTextures[$].toArray();return M}renderKernelsToTextures(){let M={result:this.renderOutput()};if(this.immutable)for(let $=0;$<this.subKernels.length;$++)M[this.subKernels[$].property]=this.mappedTextures[$].clone();else for(let $=0;$<this.subKernels.length;$++)M[this.subKernels[$].property]=this.mappedTextures[$];return M}resetSwitchingKernels(){let M=this.switchingKernels;return this.switchingKernels=null,M}setOutput(M){let $=this.toKernelOutput(M);if(this.program){if(!this.dynamicOutput)throw new Error("Resizing a kernel with dynamicOutput: false is not possible");let G=[$[0],$[1]||1,$[2]||1],O=p.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},G),Y=this.texSize;if(Y){let K=this.getVariablePrecisionString(Y,this.tactic),J=this.getVariablePrecisionString(O,this.tactic);if(K!==J){this.debug&&console.warn("Precision requirement changed, asking GPU instance to recompile"),this.switchKernels({type:"outputPrecisionMismatch",precision:J,needed:M});return}}this.output=$,this.threadDim=G,this.texSize=O;let{context:W}=this;if(W.bindFramebuffer(W.FRAMEBUFFER,this.framebuffer),this.updateMaxTexSize(),this.framebuffer.width=this.texSize[0],this.framebuffer.height=this.texSize[1],W.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),this.canvas.width=this.maxTexSize[0],this.canvas.height=this.maxTexSize[1],this.texture&&this.texture.delete(),this.texture=null,this._setupOutputTexture(),this.mappedTextures&&this.mappedTextures.length>0){for(let K=0;K<this.mappedTextures.length;K++)this.mappedTextures[K].delete();this.mappedTextures=null,this._setupSubOutputTextures()}}else this.output=$;return this}renderValues(){return this.formatValues(this.transferValues(),this.output[0],this.output[1],this.output[2])}switchKernels(M){this.switchingKernels?this.switchingKernels.push(M):this.switchingKernels=[M]}getVariablePrecisionString(M=this.texSize,$=this.tactic,G=!1){if(!$){if(!this.constructor.features.isSpeedTacticSupported)return"highp";let O=this.constructor.features[G?"lowIntPrecision":"lowFloatPrecision"],Y=this.constructor.features[G?"mediumIntPrecision":"mediumFloatPrecision"],W=this.constructor.features[G?"highIntPrecision":"highFloatPrecision"],K=Math.log2(M[0]*M[1]);if(K<=O.rangeMax)return"lowp";if(K<=Y.rangeMax)return"mediump";if(K<=W.rangeMax)return"highp";throw new Error("The required size exceeds that of the ability of your system")}switch($){case"speed":return"lowp";case"balanced":return"mediump";case"precision":return"highp";default:throw new Error(`Unknown tactic "${$}" use "speed", "balanced", "precision", or empty for auto`)}}updateTextureArgumentRefs(M,$){if(!!this.immutable){if(this.texture.texture===$.texture){let{prevArg:G}=M;G&&(G.texture._refs===1&&(this.texture.delete(),this.texture=G.clone(),this._textureSwitched=!0),G.delete()),M.prevArg=$.clone()}else if(this.mappedTextures&&this.mappedTextures.length>0){let{mappedTextures:G}=this;for(let O=0;O<G.length;O++){let Y=G[O];if(Y.texture===$.texture){let{prevArg:W}=M;W&&(W.texture._refs===1&&(Y.delete(),G[O]=W.clone(),this._mappedTextureSwitched[O]=!0),W.delete()),M.prevArg=$.clone();return}}}}}onActivate(M){if(this._textureSwitched=!0,this.texture=M.texture,this.mappedTextures){for(let $=0;$<this.mappedTextures.length;$++)this._mappedTextureSwitched[$]=!0;this.mappedTextures=M.mappedTextures}}initCanvas(){}}let F={int:"Integer",float:"Number",vec2:"Array(2)",vec3:"Array(3)",vec4:"Array(4)"};o.exports={GLKernel:C}},{"../../utils":114,"../kernel":36,"./texture/array-2-float":16,"./texture/array-2-float-2d":14,"./texture/array-2-float-3d":15,"./texture/array-3-float":19,"./texture/array-3-float-2d":17,"./texture/array-3-float-3d":18,"./texture/array-4-float":22,"./texture/array-4-float-2d":20,"./texture/array-4-float-3d":21,"./texture/float":25,"./texture/float-2d":23,"./texture/float-3d":24,"./texture/graphical":26,"./texture/memory-optimized":30,"./texture/memory-optimized-2d":28,"./texture/memory-optimized-3d":29,"./texture/unsigned":33,"./texture/unsigned-2d":31,"./texture/unsigned-3d":32}],14:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(2)"}toArray(){return u.erect2DArray2(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureArray2Float2D:d}},{"../../../utils":114,"./float":25}],15:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(2)"}toArray(){return u.erect3DArray2(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureArray2Float3D:d}},{"../../../utils":114,"./float":25}],16:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(2)"}toArray(){return u.erectArray2(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureArray2Float:d}},{"../../../utils":114,"./float":25}],17:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(3)"}toArray(){return u.erect2DArray3(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureArray3Float2D:d}},{"../../../utils":114,"./float":25}],18:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(3)"}toArray(){return u.erect3DArray3(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureArray3Float3D:d}},{"../../../utils":114,"./float":25}],19:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(3)"}toArray(){return u.erectArray3(this.renderValues(),this.output[0])}}o.exports={GLTextureArray3Float:d}},{"../../../utils":114,"./float":25}],20:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(4)"}toArray(){return u.erect2DArray4(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureArray4Float2D:d}},{"../../../utils":114,"./float":25}],21:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(4)"}toArray(){return u.erect3DArray4(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureArray4Float3D:d}},{"../../../utils":114,"./float":25}],22:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(4)"}toArray(){return u.erectArray4(this.renderValues(),this.output[0])}}o.exports={GLTextureArray4Float:d}},{"../../../utils":114,"./float":25}],23:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(1)"}toArray(){return u.erect2DFloat(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureFloat2D:d}},{"../../../utils":114,"./float":25}],24:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="ArrayTexture(1)"}toArray(){return u.erect3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureFloat3D:d}},{"../../../utils":114,"./float":25}],25:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTexture:p}=i("./index");class d extends p{get textureType(){return this.context.FLOAT}constructor(r){super(r),this.type="ArrayTexture(1)"}renderRawOutput(){let r=this.context,a=this.size;r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer()),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture,0);let t=new Float32Array(a[0]*a[1]*4);return r.readPixels(0,0,a[0],a[1],r.RGBA,r.FLOAT,t),t}renderValues(){return this._deleted?null:this.renderRawOutput()}toArray(){return u.erectFloat(this.renderValues(),this.output[0])}}o.exports={GLTextureFloat:d}},{"../../../utils":114,"./index":27}],26:[function(i,o,m){let{GLTextureUnsigned:u}=i("./unsigned");class p extends u{constructor(f){super(f),this.type="ArrayTexture(4)"}toArray(){return this.renderValues()}}o.exports={GLTextureGraphical:p}},{"./unsigned":33}],27:[function(i,o,m){let{Texture:u}=i("../../../texture");class p extends u{get textureType(){throw new Error(`"textureType" not implemented on ${this.name}`)}clone(){return new this.constructor(this)}beforeMutate(){return this.texture._refs>1?(this.newTexture(),!0):!1}cloneTexture(){this.texture._refs--;let{context:r,size:a,texture:t,kernel:n}=this;n.debug&&console.warn("cloning internal texture"),r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer()),d(r,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);let g=r.createTexture();d(r,g),r.texImage2D(r.TEXTURE_2D,0,this.internalFormat,a[0],a[1],0,this.textureFormat,this.textureType,null),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,0,0,a[0],a[1]),g._refs=1,this.texture=g}newTexture(){this.texture._refs--;let r=this.context,a=this.size;this.kernel.debug&&console.warn("new internal texture");let n=r.createTexture();d(r,n),r.texImage2D(r.TEXTURE_2D,0,this.internalFormat,a[0],a[1],0,this.textureFormat,this.textureType,null),n._refs=1,this.texture=n}clear(){if(this.texture._refs){this.texture._refs--;let t=this.context,n=this.texture=t.createTexture();d(t,n);let g=this.size;n._refs=1,t.texImage2D(t.TEXTURE_2D,0,this.internalFormat,g[0],g[1],0,this.textureFormat,this.textureType,null)}let{context:r,texture:a}=this;r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer()),r.bindTexture(r.TEXTURE_2D,a),d(r,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)}delete(){this._deleted||(this._deleted=!0,!(this.texture._refs&&(this.texture._refs--,this.texture._refs))&&this.context.deleteTexture(this.texture))}framebuffer(){return this._framebuffer||(this._framebuffer=this.kernel.getRawValueFramebuffer(this.size[0],this.size[1])),this._framebuffer}}function d(f,r){f.activeTexture(f.TEXTURE15),f.bindTexture(f.TEXTURE_2D,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST)}o.exports={GLTexture:p}},{"../../../texture":113}],28:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="MemoryOptimizedNumberTexture"}toArray(){return u.erectMemoryOptimized2DFloat(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureMemoryOptimized2D:d}},{"../../../utils":114,"./float":25}],29:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="MemoryOptimizedNumberTexture"}toArray(){return u.erectMemoryOptimized3DFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureMemoryOptimized3D:d}},{"../../../utils":114,"./float":25}],30:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureFloat:p}=i("./float");class d extends p{constructor(r){super(r),this.type="MemoryOptimizedNumberTexture"}toArray(){return u.erectMemoryOptimizedFloat(this.renderValues(),this.output[0])}}o.exports={GLTextureMemoryOptimized:d}},{"../../../utils":114,"./float":25}],31:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureUnsigned:p}=i("./unsigned");class d extends p{constructor(r){super(r),this.type="NumberTexture"}toArray(){return u.erect2DPackedFloat(this.renderValues(),this.output[0],this.output[1])}}o.exports={GLTextureUnsigned2D:d}},{"../../../utils":114,"./unsigned":33}],32:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTextureUnsigned:p}=i("./unsigned");class d extends p{constructor(r){super(r),this.type="NumberTexture"}toArray(){return u.erect3DPackedFloat(this.renderValues(),this.output[0],this.output[1],this.output[2])}}o.exports={GLTextureUnsigned3D:d}},{"../../../utils":114,"./unsigned":33}],33:[function(i,o,m){let{utils:u}=i("../../../utils"),{GLTexture:p}=i("./index");class d extends p{get textureType(){return this.context.UNSIGNED_BYTE}constructor(r){super(r),this.type="NumberTexture"}renderRawOutput(){let{context:r}=this;r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer()),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.texture,0);let a=new Uint8Array(this.size[0]*this.size[1]*4);return r.readPixels(0,0,this.size[0],this.size[1],r.RGBA,r.UNSIGNED_BYTE,a),a}renderValues(){return this._deleted?null:new Float32Array(this.renderRawOutput().buffer)}toArray(){return u.erectPackedFloat(this.renderValues(),this.output[0])}}o.exports={GLTextureUnsigned:d}},{"../../../utils":114,"./index":27}],34:[function(i,o,m){let u=i("gl"),{WebGLKernel:p}=i("../web-gl/kernel"),{glKernelString:d}=i("../gl/kernel-string"),f=null,r=null,a=null,t=null,n=null;class g extends p{static get isSupported(){return f!==null||(this.setupFeatureChecks(),f=a!==null),f}static setupFeatureChecks(){if(r=null,t=null,typeof u=="function")try{if(a=u(2,2,{preserveDrawingBuffer:!0}),!a||!a.getExtension)return;t={STACKGL_resize_drawingbuffer:a.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:a.getExtension("STACKGL_destroy_context"),OES_texture_float:a.getExtension("OES_texture_float"),OES_texture_float_linear:a.getExtension("OES_texture_float_linear"),OES_element_index_uint:a.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:a.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:a.getExtension("WEBGL_color_buffer_float")},n=this.getFeatures()}catch(k){console.warn(k)}}static isContextMatch(k){try{return k.getParameter(k.RENDERER)==="ANGLE"}catch{return!1}}static getIsTextureFloat(){return Boolean(t.OES_texture_float)}static getIsDrawBuffers(){return Boolean(t.WEBGL_draw_buffers)}static getChannelCount(){return t.WEBGL_draw_buffers?a.getParameter(t.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return a.getParameter(a.MAX_TEXTURE_SIZE)}static get testCanvas(){return r}static get testContext(){return a}static get features(){return n}initCanvas(){return{}}initContext(){return u(2,2,{preserveDrawingBuffer:!0})}initExtensions(){this.extensions={STACKGL_resize_drawingbuffer:this.context.getExtension("STACKGL_resize_drawingbuffer"),STACKGL_destroy_context:this.context.getExtension("STACKGL_destroy_context"),OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers")}}build(){super.build.apply(this,arguments),this.fallbackRequested||this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1])}destroyExtensions(){this.extensions.STACKGL_resize_drawingbuffer=null,this.extensions.STACKGL_destroy_context=null,this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(k){let T=k.getExtension("STACKGL_destroy_context");T&&T.destroy&&T.destroy()}toString(){let k=`const gl = context || require(\'gl\')(1, 1);\n`,T=`    if (!context) { gl.getExtension(\'STACKGL_destroy_context\').destroy(); }\n`;return d(this.constructor,arguments,this,k,T)}setOutput(k){return super.setOutput(k),this.graphical&&this.extensions.STACKGL_resize_drawingbuffer&&this.extensions.STACKGL_resize_drawingbuffer.resize(this.maxTexSize[0],this.maxTexSize[1]),this}}o.exports={HeadlessGLKernel:g}},{"../gl/kernel-string":12,"../web-gl/kernel":70,gl:2}],35:[function(i,o,m){class u{constructor(d,f){let{name:r,kernel:a,context:t,checkContext:n,onRequestContextHandle:g,onUpdateValueMismatch:v,origin:k,strictIntegers:T,type:A,tactic:E}=f;if(!r)throw new Error("name not set");if(!A)throw new Error("type not set");if(!k)throw new Error("origin not set");if(k!=="user"&&k!=="constants")throw new Error(`origin must be "user" or "constants" value is "${k}"`);if(!g)throw new Error("onRequestContextHandle is not set");this.name=r,this.origin=k,this.tactic=E,this.varName=k==="constants"?`constants.${r}`:r,this.kernel=a,this.strictIntegers=T,this.type=d.type||A,this.size=d.size||null,this.index=null,this.context=t,this.checkContext=n??!0,this.contextHandle=null,this.onRequestContextHandle=g,this.onUpdateValueMismatch=v,this.forceUploadEachRun=null}get id(){return`${this.origin}_${name}`}getSource(){throw new Error(`"getSource" not defined on ${this.constructor.name}`)}updateValue(d){throw new Error(`"updateValue" not defined on ${this.constructor.name}`)}}o.exports={KernelValue:u}},{}],36:[function(i,o,m){let{utils:u}=i("../utils"),{Input:p}=i("../input");class d{static get isSupported(){throw new Error(`"isSupported" not implemented on ${this.name}`)}static isContextMatch(a){throw new Error(`"isContextMatch" not implemented on ${this.name}`)}static getFeatures(){throw new Error(`"getFeatures" not implemented on ${this.name}`)}static destroyContext(a){throw new Error(`"destroyContext" called on ${this.name}`)}static nativeFunctionArguments(){throw new Error(`"nativeFunctionArguments" called on ${this.name}`)}static nativeFunctionReturnType(){throw new Error(`"nativeFunctionReturnType" called on ${this.name}`)}static combineKernels(){throw new Error(`"combineKernels" called on ${this.name}`)}constructor(a,t){if(typeof a!="object"){if(typeof a!="string")throw new Error("source not a string");if(!u.isFunctionString(a))throw new Error("source not a function string")}this.useLegacyEncoder=!1,this.fallbackRequested=!1,this.onRequestFallback=null,this.argumentNames=typeof a=="string"?u.getArgumentNamesFromString(a):null,this.argumentTypes=null,this.argumentSizes=null,this.argumentBitRatios=null,this.kernelArguments=null,this.kernelConstants=null,this.forceUploadKernelConstants=null,this.source=a,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.constantTypes=null,this.constantBitRatios=null,this.dynamicArguments=!1,this.dynamicOutput=!1,this.canvas=null,this.context=null,this.checkContext=null,this.gpu=null,this.functions=null,this.nativeFunctions=null,this.injectedNative=null,this.subKernels=null,this.validate=!0,this.immutable=!1,this.pipeline=!1,this.precision=null,this.tactic=null,this.plugins=null,this.returnType=null,this.leadingReturnStatement=null,this.followingReturnStatement=null,this.optimizeFloatMemory=null,this.strictIntegers=!1,this.fixIntegerDivisionAccuracy=null,this.built=!1,this.signature=null}mergeSettings(a){for(let t in a)if(!(!a.hasOwnProperty(t)||!this.hasOwnProperty(t))){switch(t){case"output":if(!Array.isArray(a.output)){this.setOutput(a.output);continue}break;case"functions":this.functions=[];for(let n=0;n<a.functions.length;n++)this.addFunction(a.functions[n]);continue;case"graphical":a[t]&&!a.hasOwnProperty("precision")&&(this.precision="unsigned"),this[t]=a[t];continue;case"nativeFunctions":if(!a.nativeFunctions)continue;this.nativeFunctions=[];for(let n=0;n<a.nativeFunctions.length;n++){let g=a.nativeFunctions[n],{name:v,source:k}=g;this.addNativeFunction(v,k,g)}continue}this[t]=a[t]}this.canvas||(this.canvas=this.initCanvas()),this.context||(this.context=this.initContext()),this.plugins||(this.plugins=this.initPlugins(a))}build(){throw new Error(`"build" not defined on ${this.constructor.name}`)}run(){throw new Error(`"run" not defined on ${this.constructor.name}`)}initCanvas(){throw new Error(`"initCanvas" not defined on ${this.constructor.name}`)}initContext(){throw new Error(`"initContext" not defined on ${this.constructor.name}`)}initPlugins(a){throw new Error(`"initPlugins" not defined on ${this.constructor.name}`)}addFunction(a,t={}){if(a.name&&a.source&&a.argumentTypes&&"returnType"in a)this.functions.push(a);else if("settings"in a&&"source"in a)this.functions.push(this.functionToIGPUFunction(a.source,a.settings));else if(typeof a=="string"||typeof a=="function")this.functions.push(this.functionToIGPUFunction(a,t));else throw new Error("function not properly defined");return this}addNativeFunction(a,t,n={}){let{argumentTypes:g,argumentNames:v}=n.argumentTypes?f(n.argumentTypes):this.constructor.nativeFunctionArguments(t)||{};return this.nativeFunctions.push({name:a,source:t,settings:n,argumentTypes:g,argumentNames:v,returnType:n.returnType||this.constructor.nativeFunctionReturnType(t)}),this}setupArguments(a){if(this.kernelArguments=[],this.argumentTypes)for(let t=0;t<this.argumentTypes.length;t++)this.kernelArguments.push({type:this.argumentTypes[t]});else if(!this.argumentTypes){this.argumentTypes=[];for(let t=0;t<a.length;t++){let n=u.getVariableType(a[t],this.strictIntegers),g=n==="Integer"?"Number":n;this.argumentTypes.push(g),this.kernelArguments.push({type:g})}}this.argumentSizes=new Array(a.length),this.argumentBitRatios=new Int32Array(a.length);for(let t=0;t<a.length;t++){let n=a[t];this.argumentSizes[t]=n.constructor===p?n.size:null,this.argumentBitRatios[t]=this.getBitRatio(n)}if(this.argumentNames.length!==a.length)throw new Error("arguments are miss-aligned")}setupConstants(){this.kernelConstants=[];let a=this.constantTypes===null;if(a&&(this.constantTypes={}),this.constantBitRatios={},this.constants)for(let t in this.constants){if(a){let n=u.getVariableType(this.constants[t],this.strictIntegers);this.constantTypes[t]=n,this.kernelConstants.push({name:t,type:n})}else this.kernelConstants.push({name:t,type:this.constantTypes[t]});this.constantBitRatios[t]=this.getBitRatio(this.constants[t])}}setOptimizeFloatMemory(a){return this.optimizeFloatMemory=a,this}toKernelOutput(a){return a.hasOwnProperty("x")?a.hasOwnProperty("y")?a.hasOwnProperty("z")?[a.x,a.y,a.z]:[a.x,a.y]:[a.x]:a}setOutput(a){return this.output=this.toKernelOutput(a),this}setDebug(a){return this.debug=a,this}setGraphical(a){return this.graphical=a,this.precision="unsigned",this}setLoopMaxIterations(a){return this.loopMaxIterations=a,this}setConstants(a){return this.constants=a,this}setConstantTypes(a){return this.constantTypes=a,this}setFunctions(a){for(let t=0;t<a.length;t++)this.addFunction(a[t]);return this}setNativeFunctions(a){for(let t=0;t<a.length;t++){let n=a[t],{name:g,source:v}=n;this.addNativeFunction(g,v,n)}return this}setInjectedNative(a){return this.injectedNative=a,this}setPipeline(a){return this.pipeline=a,this}setPrecision(a){return this.precision=a,this}setDimensions(a){return u.warnDeprecated("method","setDimensions","setOutput"),this.output=a,this}setOutputToTexture(a){return u.warnDeprecated("method","setOutputToTexture","setPipeline"),this.pipeline=a,this}setImmutable(a){return this.immutable=a,this}setCanvas(a){return this.canvas=a,this}setStrictIntegers(a){return this.strictIntegers=a,this}setDynamicOutput(a){return this.dynamicOutput=a,this}setHardcodeConstants(a){return u.warnDeprecated("method","setHardcodeConstants"),this.setDynamicOutput(a),this.setDynamicArguments(a),this}setDynamicArguments(a){return this.dynamicArguments=a,this}setUseLegacyEncoder(a){return this.useLegacyEncoder=a,this}setWarnVarUsage(a){return u.warnDeprecated("method","setWarnVarUsage"),this}getCanvas(){return u.warnDeprecated("method","getCanvas"),this.canvas}getWebGl(){return u.warnDeprecated("method","getWebGl"),this.context}setContext(a){return this.context=a,this}setArgumentTypes(a){if(Array.isArray(a))this.argumentTypes=a;else{this.argumentTypes=[];for(let t in a){if(!a.hasOwnProperty(t))continue;let n=this.argumentNames.indexOf(t);if(n===-1)throw new Error(`unable to find argument ${t}`);this.argumentTypes[n]=a[t]}}return this}setTactic(a){return this.tactic=a,this}requestFallback(a){if(!this.onRequestFallback)throw new Error(`"onRequestFallback" not defined on ${this.constructor.name}`);return this.fallbackRequested=!0,this.onRequestFallback(a)}validateSettings(){throw new Error(`"validateSettings" not defined on ${this.constructor.name}`)}addSubKernel(a){if(this.subKernels===null&&(this.subKernels=[]),!a.source)throw new Error(\'subKernel missing "source" property\');if(!a.property&&isNaN(a.property))throw new Error(\'subKernel missing "property" property\');if(!a.name)throw new Error(\'subKernel missing "name" property\');return this.subKernels.push(a),this}destroy(a){throw new Error(`"destroy" called on ${this.constructor.name}`)}getBitRatio(a){if(this.precision==="single")return 4;if(Array.isArray(a[0]))return this.getBitRatio(a[0]);if(a.constructor===p)return this.getBitRatio(a.value);switch(a.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}getPixels(a){throw new Error(`"getPixels" called on ${this.constructor.name}`)}checkOutput(){if(!this.output||!u.isArray(this.output))throw new Error("kernel.output not an array");if(this.output.length<1)throw new Error("kernel.output is empty, needs at least 1 value");for(let a=0;a<this.output.length;a++)if(isNaN(this.output[a])||this.output[a]<1)throw new Error(`${this.constructor.name}.output[${a}] incorrectly defined as \\`${this.output[a]}\\`, needs to be numeric, and greater than 0`)}prependString(a){throw new Error(`"prependString" called on ${this.constructor.name}`)}hasPrependString(a){throw new Error(`"hasPrependString" called on ${this.constructor.name}`)}toJSON(){return{settings:{output:this.output,pipeline:this.pipeline,argumentNames:this.argumentNames,argumentsTypes:this.argumentTypes,constants:this.constants,pluginNames:this.plugins?this.plugins.map(a=>a.name):null,returnType:this.returnType}}}buildSignature(a){let t=this.constructor;this.signature=t.getSignature(this,t.getArgumentTypes(this,a))}static getArgumentTypes(a,t){let n=new Array(t.length);for(let g=0;g<t.length;g++){let v=t[g],k=a.argumentTypes[g];if(v.type)n[g]=v.type;else switch(k){case"Number":case"Integer":case"Float":case"ArrayTexture(1)":n[g]=u.getVariableType(v);break;default:n[g]=k}}return n}static getSignature(a,t){throw new Error(`"getSignature" not implemented on ${this.name}`)}functionToIGPUFunction(a,t={}){if(typeof a!="string"&&typeof a!="function")throw new Error("source not a string or function");let n=typeof a=="string"?a:a.toString(),g=[];return Array.isArray(t.argumentTypes)?g=t.argumentTypes:typeof t.argumentTypes=="object"?g=u.getArgumentNamesFromString(n).map(v=>t.argumentTypes[v])||[]:g=t.argumentTypes||[],{name:u.getFunctionNameFromString(n)||null,source:n,argumentTypes:g,returnType:t.returnType||null}}onActivate(a){}}function f(r){let a=Object.keys(r),t=[];for(let n=0;n<a.length;n++){let g=a[n];t.push(r[g])}return{argumentTypes:t,argumentNames:a}}o.exports={Kernel:d}},{"../input":110,"../utils":114}],37:[function(i,o,m){let u=`__HEADER__;\n      __FLOAT_TACTIC_DECLARATION__;\n      __INT_TACTIC_DECLARATION__;\n      __SAMPLER_2D_TACTIC_DECLARATION__;\n      \n      const int LOOP_MAX = __LOOP_MAX__;\n      \n      __PLUGINS__;\n      __CONSTANTS__;\n      \n      varying vec2 vTexCoord;\n      \n      float acosh(float x) {\n        return log(x + sqrt(x * x - 1.0));\n      }\n      \n      float sinh(float x) {\n        return (pow(${Math.E}, x) - pow(${Math.E}, -x)) / 2.0;\n      }\n      \n      float asinh(float x) {\n        return log(x + sqrt(x * x + 1.0));\n      }\n      \n      float atan2(float v1, float v2) {\n        if (v1 == 0.0 || v2 == 0.0) return 0.0;\n        return atan(v1 / v2);\n      }\n      \n      float atanh(float x) {\n        x = (x + 1.0) / (x - 1.0);\n        if (x < 0.0) {\n          return 0.5 * log(-x);\n        }\n        return 0.5 * log(x);\n      }\n      \n      float cbrt(float x) {\n        if (x >= 0.0) {\n          return pow(x, 1.0 / 3.0);\n        } else {\n          return -pow(x, 1.0 / 3.0);\n        }\n      }\n      \n      float cosh(float x) {\n        return (pow(${Math.E}, x) + pow(${Math.E}, -x)) / 2.0; \n      }\n      \n      float expm1(float x) {\n        return pow(${Math.E}, x) - 1.0; \n      }\n      \n      float fround(highp float x) {\n        return x;\n      }\n      \n      float imul(float v1, float v2) {\n        return float(int(v1) * int(v2));\n      }\n      \n      float log10(float x) {\n        return log2(x) * (1.0 / log2(10.0));\n      }\n      \n      float log1p(float x) {\n        return log(1.0 + x);\n      }\n      \n      float _pow(float v1, float v2) {\n        if (v2 == 0.0) return 1.0;\n        return pow(v1, v2);\n      }\n      \n      float tanh(float x) {\n        float e = exp(2.0 * x);\n        return (e - 1.0) / (e + 1.0);\n      }\n      \n      float trunc(float x) {\n        if (x >= 0.0) {\n          return floor(x); \n        } else {\n          return ceil(x);\n        }\n      }\n      \n      vec4 _round(vec4 x) {\n        return floor(x + 0.5);\n      }\n      \n      float _round(float x) {\n        return floor(x + 0.5);\n      }\n      \n      const int BIT_COUNT = 32;\n      int modi(int x, int y) {\n        return x - y * (x / y);\n      }\n      \n      int bitwiseOr(int a, int b) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 || b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseXOR(int a, int b) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 || b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseAnd(int a, int b) {\n        int result = 0;\n        int n = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 && b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseNot(int a) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (modi(a, 2) == 0) {\n            result += n;    \n          }\n          a = a / 2;\n          n = n * 2;\n        }\n        return result;\n      }\n      int bitwiseZeroFillLeftShift(int n, int shift) {\n        int maxBytes = BIT_COUNT;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (maxBytes >= n) {\n            break;\n          }\n          maxBytes *= 2;\n        }\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= shift) {\n            break;\n          }\n          n *= 2;\n        }\n      \n        int result = 0;\n        int byteVal = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= maxBytes) break;\n          if (modi(n, 2) > 0) { result += byteVal; }\n          n = int(n / 2);\n          byteVal *= 2;\n        }\n        return result;\n      }\n      \n      int bitwiseSignedRightShift(int num, int shifts) {\n        return int(floor(float(num) / pow(2.0, float(shifts))));\n      }\n      \n      int bitwiseZeroFillRightShift(int n, int shift) {\n        int maxBytes = BIT_COUNT;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (maxBytes >= n) {\n            break;\n          }\n          maxBytes *= 2;\n        }\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= shift) {\n            break;\n          }\n          n /= 2;\n        }\n        int result = 0;\n        int byteVal = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= maxBytes) break;\n          if (modi(n, 2) > 0) { result += byteVal; }\n          n = int(n / 2);\n          byteVal *= 2;\n        }\n        return result;\n      }\n      \n      vec2 integerMod(vec2 x, float y) {\n        vec2 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      vec3 integerMod(vec3 x, float y) {\n        vec3 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      vec4 integerMod(vec4 x, vec4 y) {\n        vec4 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      float integerMod(float x, float y) {\n        float res = floor(mod(x, y));\n        return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n      }\n      \n      int integerMod(int x, int y) {\n        return x - (y * int(x / y));\n      }\n      \n      __DIVIDE_WITH_INTEGER_CHECK__;\n      \n      // Here be dragons!\n      // DO NOT OPTIMIZE THIS CODE\n      // YOU WILL BREAK SOMETHING ON SOMEBODY\'S MACHINE\n      // LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\n      const vec2 MAGIC_VEC = vec2(1.0, -256.0);\n      const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\n      const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\n      float decode32(vec4 texel) {\n        __DECODE32_ENDIANNESS__;\n        texel *= 255.0;\n        vec2 gte128;\n        gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n        gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n        float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n        float res = exp2(_round(exponent));\n        texel.b = texel.b - 128.0 * gte128.x;\n        res = dot(texel, SCALE_FACTOR) * exp2(_round(exponent-23.0)) + res;\n        res *= gte128.y * -2.0 + 1.0;\n        return res;\n      }\n      \n      float decode16(vec4 texel, int index) {\n        int channel = integerMod(index, 2);\n        if (channel == 0) return texel.r * 255.0 + texel.g * 65280.0;\n        if (channel == 1) return texel.b * 255.0 + texel.a * 65280.0;\n        return 0.0;\n      }\n      \n      float decode8(vec4 texel, int index) {\n        int channel = integerMod(index, 4);\n        if (channel == 0) return texel.r * 255.0;\n        if (channel == 1) return texel.g * 255.0;\n        if (channel == 2) return texel.b * 255.0;\n        if (channel == 3) return texel.a * 255.0;\n        return 0.0;\n      }\n      \n      vec4 legacyEncode32(float f) {\n        float F = abs(f);\n        float sign = f < 0.0 ? 1.0 : 0.0;\n        float exponent = floor(log2(F));\n        float mantissa = (exp2(-exponent) * F);\n        // exponent += floor(log2(mantissa));\n        vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n        texel.rg = integerMod(texel.rg, 256.0);\n        texel.b = integerMod(texel.b, 128.0);\n        texel.a = exponent*0.5 + 63.5;\n        texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n        texel = floor(texel);\n        texel *= 0.003921569; // 1/255\n        __ENCODE32_ENDIANNESS__;\n        return texel;\n      }\n      \n      // https://github.com/gpujs/gpu.js/wiki/Encoder-details\n      vec4 encode32(float value) {\n        if (value == 0.0) return vec4(0, 0, 0, 0);\n      \n        float exponent;\n        float mantissa;\n        vec4  result;\n        float sgn;\n      \n        sgn = step(0.0, -value);\n        value = abs(value);\n      \n        exponent = floor(log2(value));\n      \n        mantissa = value*pow(2.0, -exponent)-1.0;\n        exponent = exponent+127.0;\n        result   = vec4(0,0,0,0);\n      \n        result.a = floor(exponent/2.0);\n        exponent = exponent - result.a*2.0;\n        result.a = result.a + 128.0*sgn;\n      \n        result.b = floor(mantissa * 128.0);\n        mantissa = mantissa - result.b / 128.0;\n        result.b = result.b + exponent*128.0;\n      \n        result.g = floor(mantissa*32768.0);\n        mantissa = mantissa - result.g/32768.0;\n      \n        result.r = floor(mantissa*8388608.0);\n        return result/255.0;\n      }\n      // Dragons end here\n      \n      int index;\n      ivec3 threadId;\n      \n      ivec3 indexTo3D(int idx, ivec3 texDim) {\n        int z = int(idx / (texDim.x * texDim.y));\n        idx -= z * int(texDim.x * texDim.y);\n        int y = int(idx / texDim.x);\n        int x = int(integerMod(idx, texDim.x));\n        return ivec3(x, y, z);\n      }\n      \n      float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize));\n        return decode32(texel);\n      }\n      \n      float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x * 2;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize.x * 2, texSize.y));\n        return decode16(texel, index);\n      }\n      \n      float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x * 4;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize.x * 4, texSize.y));\n        return decode8(texel, index);\n      }\n      \n      float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int channel = integerMod(index, 4);\n        index = index / 4;\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize));\n        if (channel == 0) return texel.r;\n        if (channel == 1) return texel.g;\n        if (channel == 2) return texel.b;\n        if (channel == 3) return texel.a;\n        return 0.0;\n      }\n      \n      vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        return texture2D(tex, st / vec2(texSize));\n      }\n      \n      float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return result[0];\n      }\n      \n      vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return vec2(result[0], result[1]);\n      }\n      \n      vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + (texDim.x * (y + (texDim.y * z)));\n        int channel = integerMod(index, 2);\n        index = index / 2;\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize));\n        if (channel == 0) return vec2(texel.r, texel.g);\n        if (channel == 1) return vec2(texel.b, texel.a);\n        return vec2(0.0, 0.0);\n      }\n      \n      vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return vec3(result[0], result[1], result[2]);\n      }\n      \n      vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n        int vectorIndex = fieldIndex / 4;\n        int vectorOffset = fieldIndex - vectorIndex * 4;\n        int readY = vectorIndex / texSize.x;\n        int readX = vectorIndex - readY * texSize.x;\n        vec4 tex1 = texture2D(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n        \n        if (vectorOffset == 0) {\n          return tex1.xyz;\n        } else if (vectorOffset == 1) {\n          return tex1.yzw;\n        } else {\n          readX++;\n          if (readX >= texSize.x) {\n            readX = 0;\n            readY++;\n          }\n          vec4 tex2 = texture2D(tex, vec2(readX, readY) / vec2(texSize));\n          if (vectorOffset == 2) {\n            return vec3(tex1.z, tex1.w, tex2.x);\n          } else {\n            return vec3(tex1.w, tex2.x, tex2.y);\n          }\n        }\n      }\n      \n      vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        return getImage2D(tex, texSize, texDim, z, y, x);\n      }\n      \n      vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int channel = integerMod(index, 2);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture2D(tex, st / vec2(texSize));\n        return vec4(texel.r, texel.g, texel.b, texel.a);\n      }\n      \n      vec4 actualColor;\n      void color(float r, float g, float b, float a) {\n        actualColor = vec4(r,g,b,a);\n      }\n      \n      void color(float r, float g, float b) {\n        color(r,g,b,1.0);\n      }\n      \n      void color(sampler2D image) {\n        actualColor = texture2D(image, vTexCoord);\n      }\n      \n      float modulo(float number, float divisor) {\n        if (number < 0.0) {\n          number = abs(number);\n          if (divisor < 0.0) {\n            divisor = abs(divisor);\n          }\n          return -mod(number, divisor);\n        }\n        if (divisor < 0.0) {\n          divisor = abs(divisor);\n        }\n        return mod(number, divisor);\n      }\n      \n      __INJECTED_NATIVE__;\n      __MAIN_CONSTANTS__;\n      __MAIN_ARGUMENTS__;\n      __KERNEL__;\n      \n      void main(void) {\n        index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n        __MAIN_RESULT__;\n      }`;o.exports={fragmentShader:u}},{}],38:[function(i,o,m){let{utils:u}=i("../../utils"),{FunctionNode:p}=i("../function-node");class d extends p{constructor(t,n){super(t,n),n&&n.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=n.fixIntegerDivisionAccuracy)}astConditionalExpression(t,n){if(t.type!=="ConditionalExpression")throw this.astErrorOutput("Not a conditional expression",t);let g=this.getType(t.consequent),v=this.getType(t.alternate);return g===null&&v===null?(n.push("if ("),this.astGeneric(t.test,n),n.push(") {"),this.astGeneric(t.consequent,n),n.push(";"),n.push("} else {"),this.astGeneric(t.alternate,n),n.push(";"),n.push("}"),n):(n.push("("),this.astGeneric(t.test,n),n.push("?"),this.astGeneric(t.consequent,n),n.push(":"),this.astGeneric(t.alternate,n),n.push(")"),n)}astFunction(t,n){if(this.isRootKernel)n.push("void");else{this.returnType||this.findLastReturn()&&(this.returnType=this.getType(t.body),this.returnType==="LiteralInteger"&&(this.returnType="Number"));let{returnType:g}=this;if(!g)n.push("void");else{let v=f[g];if(!v)throw new Error(`unknown type ${g}`);n.push(v)}}if(n.push(" "),n.push(this.name),n.push("("),!this.isRootKernel)for(let g=0;g<this.argumentNames.length;++g){let v=this.argumentNames[g];g>0&&n.push(", ");let k=this.argumentTypes[this.argumentNames.indexOf(v)];if(!k)throw this.astErrorOutput(`Unknown argument ${v} type`,t);k==="LiteralInteger"&&(this.argumentTypes[g]=k="Number");let T=f[k];if(!T)throw this.astErrorOutput("Unexpected expression",t);let A=u.sanitizeName(v);T==="sampler2D"||T==="sampler2DArray"?n.push(`${T} user_${A},ivec2 user_${A}Size,ivec3 user_${A}Dim`):n.push(`${T} user_${A}`)}n.push(`) {\n`);for(let g=0;g<t.body.body.length;++g)this.astGeneric(t.body.body[g],n),n.push(`\n`);return n.push(`}\n`),n}astReturnStatement(t,n){if(!t.argument)throw this.astErrorOutput("Unexpected return statement",t);this.pushState("skip-literal-correction");let g=this.getType(t.argument);this.popState("skip-literal-correction");let v=[];switch(this.returnType||(g==="LiteralInteger"||g==="Integer"?this.returnType="Number":this.returnType=g),this.returnType){case"LiteralInteger":case"Number":case"Float":switch(g){case"Integer":v.push("float("),this.astGeneric(t.argument,v),v.push(")");break;case"LiteralInteger":this.castLiteralToFloat(t.argument,v),this.getType(t)==="Integer"&&(v.unshift("float("),v.push(")"));break;default:this.astGeneric(t.argument,v)}break;case"Integer":switch(g){case"Float":case"Number":this.castValueToInteger(t.argument,v);break;case"LiteralInteger":this.castLiteralToInteger(t.argument,v);break;default:this.astGeneric(t.argument,v)}break;case"Array(4)":case"Array(3)":case"Array(2)":case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":case"Input":this.astGeneric(t.argument,v);break;default:throw this.astErrorOutput(`unhandled return type ${this.returnType}`,t)}return this.isRootKernel?(n.push(`kernelResult = ${v.join("")};`),n.push("return;")):this.isSubKernel?(n.push(`subKernelResult_${this.name} = ${v.join("")};`),n.push(`return subKernelResult_${this.name};`)):n.push(`return ${v.join("")};`),n}astLiteral(t,n){if(isNaN(t.value))throw this.astErrorOutput("Non-numeric literal not supported : "+t.value,t);let g=this.astKey(t);return Number.isInteger(t.value)?this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[g]="Integer",n.push(`${t.value}`)):this.isState("casting-to-float")||this.isState("building-float")?(this.literalTypes[g]="Number",n.push(`${t.value}.0`)):(this.literalTypes[g]="Number",n.push(`${t.value}.0`)):this.isState("casting-to-integer")||this.isState("building-integer")?(this.literalTypes[g]="Integer",n.push(Math.round(t.value))):(this.literalTypes[g]="Number",n.push(`${t.value}`)),n}astBinaryExpression(t,n){if(this.checkAndUpconvertOperator(t,n))return n;if(this.fixIntegerDivisionAccuracy&&t.operator==="/"){switch(n.push("divWithIntCheck("),this.pushState("building-float"),this.getType(t.left)){case"Integer":this.castValueToFloat(t.left,n);break;case"LiteralInteger":this.castLiteralToFloat(t.left,n);break;default:this.astGeneric(t.left,n)}switch(n.push(", "),this.getType(t.right)){case"Integer":this.castValueToFloat(t.right,n);break;case"LiteralInteger":this.castLiteralToFloat(t.right,n);break;default:this.astGeneric(t.right,n)}return this.popState("building-float"),n.push(")"),n}n.push("(");let g=this.getType(t.left)||"Number",v=this.getType(t.right)||"Number";if(!g||!v)throw this.astErrorOutput("Unhandled binary expression",t);let k=g+" & "+v;switch(k){case"Integer & Integer":this.pushState("building-integer"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-integer");break;case"Number & Float":case"Float & Number":case"Float & Float":case"Number & Number":this.pushState("building-float"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-float");break;case"LiteralInteger & LiteralInteger":this.isState("casting-to-integer")||this.isState("building-integer")?(this.pushState("building-integer"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-integer")):(this.pushState("building-float"),this.castLiteralToFloat(t.left,n),n.push(r[t.operator]||t.operator),this.castLiteralToFloat(t.right,n),this.popState("building-float"));break;case"Integer & Float":case"Integer & Number":if((t.operator===">"||t.operator==="<"&&t.right.type==="Literal")&&!Number.isInteger(t.right.value)){this.pushState("building-float"),this.castValueToFloat(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-float");break}if(this.pushState("building-integer"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.pushState("casting-to-integer"),t.right.type==="Literal"){let T=[];if(this.astGeneric(t.right,T),this.getType(t.right)==="Integer")n.push(T.join(""));else throw this.astErrorOutput("Unhandled binary expression with literal",t)}else n.push("int("),this.astGeneric(t.right,n),n.push(")");this.popState("casting-to-integer"),this.popState("building-integer");break;case"Integer & LiteralInteger":this.pushState("building-integer"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.castLiteralToInteger(t.right,n),this.popState("building-integer");break;case"Number & Integer":this.pushState("building-float"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.castValueToFloat(t.right,n),this.popState("building-float");break;case"Float & LiteralInteger":case"Number & LiteralInteger":this.pushState("building-float"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.castLiteralToFloat(t.right,n),this.popState("building-float");break;case"LiteralInteger & Float":case"LiteralInteger & Number":this.isState("casting-to-integer")?(this.pushState("building-integer"),this.castLiteralToInteger(t.left,n),n.push(r[t.operator]||t.operator),this.castValueToInteger(t.right,n),this.popState("building-integer")):(this.pushState("building-float"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.pushState("casting-to-float"),this.astGeneric(t.right,n),this.popState("casting-to-float"),this.popState("building-float"));break;case"LiteralInteger & Integer":this.pushState("building-integer"),this.castLiteralToInteger(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-integer");break;case"Boolean & Boolean":this.pushState("building-boolean"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.astGeneric(t.right,n),this.popState("building-boolean");break;case"Float & Integer":this.pushState("building-float"),this.astGeneric(t.left,n),n.push(r[t.operator]||t.operator),this.castValueToFloat(t.right,n),this.popState("building-float");break;default:throw this.astErrorOutput(`Unhandled binary expression between ${k}`,t)}return n.push(")"),n}checkAndUpconvertOperator(t,n){let g=this.checkAndUpconvertBitwiseOperators(t,n);if(g)return g;let k={"%":this.fixIntegerDivisionAccuracy?"integerCorrectionModulo":"modulo","**":"pow"}[t.operator];if(!k)return null;switch(n.push(k),n.push("("),this.getType(t.left)){case"Integer":this.castValueToFloat(t.left,n);break;case"LiteralInteger":this.castLiteralToFloat(t.left,n);break;default:this.astGeneric(t.left,n)}switch(n.push(","),this.getType(t.right)){case"Integer":this.castValueToFloat(t.right,n);break;case"LiteralInteger":this.castLiteralToFloat(t.right,n);break;default:this.astGeneric(t.right,n)}return n.push(")"),n}checkAndUpconvertBitwiseOperators(t,n){let v={"&":"bitwiseAnd","|":"bitwiseOr","^":"bitwiseXOR","<<":"bitwiseZeroFillLeftShift",">>":"bitwiseSignedRightShift",">>>":"bitwiseZeroFillRightShift"}[t.operator];if(!v)return null;switch(n.push(v),n.push("("),this.getType(t.left)){case"Number":case"Float":this.castValueToInteger(t.left,n);break;case"LiteralInteger":this.castLiteralToInteger(t.left,n);break;default:this.astGeneric(t.left,n)}switch(n.push(","),this.getType(t.right)){case"Number":case"Float":this.castValueToInteger(t.right,n);break;case"LiteralInteger":this.castLiteralToInteger(t.right,n);break;default:this.astGeneric(t.right,n)}return n.push(")"),n}checkAndUpconvertBitwiseUnary(t,n){let v={"~":"bitwiseNot"}[t.operator];if(!v)return null;switch(n.push(v),n.push("("),this.getType(t.argument)){case"Number":case"Float":this.castValueToInteger(t.argument,n);break;case"LiteralInteger":this.castLiteralToInteger(t.argument,n);break;default:this.astGeneric(t.argument,n)}return n.push(")"),n}castLiteralToInteger(t,n){return this.pushState("casting-to-integer"),this.astGeneric(t,n),this.popState("casting-to-integer"),n}castLiteralToFloat(t,n){return this.pushState("casting-to-float"),this.astGeneric(t,n),this.popState("casting-to-float"),n}castValueToInteger(t,n){return this.pushState("casting-to-integer"),n.push("int("),this.astGeneric(t,n),n.push(")"),this.popState("casting-to-integer"),n}castValueToFloat(t,n){return this.pushState("casting-to-float"),n.push("float("),this.astGeneric(t,n),n.push(")"),this.popState("casting-to-float"),n}astIdentifierExpression(t,n){if(t.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);let g=this.getType(t),v=u.sanitizeName(t.name);return t.name==="Infinity"?n.push("3.402823466e+38"):g==="Boolean"?this.argumentNames.indexOf(v)>-1?n.push(`bool(user_${v})`):n.push(`user_${v}`):n.push(`user_${v}`),n}astForStatement(t,n){if(t.type!=="ForStatement")throw this.astErrorOutput("Invalid for statement",t);let g=[],v=[],k=[],T=[],A=null;if(t.init){let{declarations:E}=t.init;E.length>1&&(A=!1),this.astGeneric(t.init,g);for(let y=0;y<E.length;y++)E[y].init&&E[y].init.type!=="Literal"&&(A=!1)}else A=!1;if(t.test?this.astGeneric(t.test,v):A=!1,t.update?this.astGeneric(t.update,k):A=!1,t.body&&(this.pushState("loop-body"),this.astGeneric(t.body,T),this.popState("loop-body")),A===null&&(A=this.isSafe(t.init)&&this.isSafe(t.test)),A){let E=g.join(""),y=E[E.length-1]!==";";n.push(`for (${E}${y?";":""}${v.join("")};${k.join("")}){\n`),n.push(T.join("")),n.push(`}\n`)}else{let E=this.getInternalVariableName("safeI");g.length>0&&n.push(g.join(""),`\n`),n.push(`for (int ${E}=0;${E}<LOOP_MAX;${E}++){\n`),v.length>0&&n.push(`if (!${v.join("")}) break;\n`),n.push(T.join("")),n.push(`\n${k.join("")};`),n.push(`}\n`)}return n}astWhileStatement(t,n){if(t.type!=="WhileStatement")throw this.astErrorOutput("Invalid while statement",t);let g=this.getInternalVariableName("safeI");return n.push(`for (int ${g}=0;${g}<LOOP_MAX;${g}++){\n`),n.push("if (!"),this.astGeneric(t.test,n),n.push(`) break;\n`),this.astGeneric(t.body,n),n.push(`}\n`),n}astDoWhileStatement(t,n){if(t.type!=="DoWhileStatement")throw this.astErrorOutput("Invalid while statement",t);let g=this.getInternalVariableName("safeI");return n.push(`for (int ${g}=0;${g}<LOOP_MAX;${g}++){\n`),this.astGeneric(t.body,n),n.push("if (!"),this.astGeneric(t.test,n),n.push(`) break;\n`),n.push(`}\n`),n}astAssignmentExpression(t,n){if(t.operator==="%=")this.astGeneric(t.left,n),n.push("="),n.push("mod("),this.astGeneric(t.left,n),n.push(","),this.astGeneric(t.right,n),n.push(")");else if(t.operator==="**=")this.astGeneric(t.left,n),n.push("="),n.push("pow("),this.astGeneric(t.left,n),n.push(","),this.astGeneric(t.right,n),n.push(")");else{let g=this.getType(t.left),v=this.getType(t.right);return this.astGeneric(t.left,n),n.push(t.operator),g!=="Integer"&&v==="Integer"?(n.push("float("),this.astGeneric(t.right,n),n.push(")")):this.astGeneric(t.right,n),n}}astBlockStatement(t,n){if(this.isState("loop-body")){this.pushState("block-body");for(let g=0;g<t.body.length;g++)this.astGeneric(t.body[g],n);this.popState("block-body")}else{n.push(`{\n`);for(let g=0;g<t.body.length;g++)this.astGeneric(t.body[g],n);n.push(`}\n`)}return n}astVariableDeclaration(t,n){let g=t.declarations;if(!g||!g[0]||!g[0].init)throw this.astErrorOutput("Unexpected expression",t);let v=[],k=null,T=[],A=[];for(let E=0;E<g.length;E++){let y=g[E],_=y.init,w=this.getDeclaration(y.id),L=this.getType(y.init),N=L;N==="LiteralInteger"&&(w.suggestedType==="Integer"?N="Integer":N="Number");let b=f[N];if(!b)throw this.astErrorOutput(`Markup type ${N} not handled`,t);let c=[];if(L==="Integer"&&N==="Integer"){if(w.valueType="Number",E===0||k===null)c.push("float ");else if(N!==k)throw new Error("Unhandled declaration");k=N,c.push(`user_${u.sanitizeName(y.id.name)}=`),c.push("float("),this.astGeneric(_,c),c.push(")")}else w.valueType=N,E===0||k===null?c.push(`${b} `):N!==k&&(T.push(A.join(",")),A=[],c.push(`${b} `)),k=N,c.push(`user_${u.sanitizeName(y.id.name)}=`),L==="Number"&&N==="Integer"?_.left&&_.left.type==="Literal"?this.astGeneric(_,c):(c.push("int("),this.astGeneric(_,c),c.push(")")):L==="LiteralInteger"&&N==="Integer"?this.castLiteralToInteger(_,c):this.astGeneric(_,c);A.push(c.join(""))}return A.length>0&&T.push(A.join(",")),v.push(T.join(";")),n.push(v.join("")),n.push(";"),n}astIfStatement(t,n){return n.push("if ("),this.astGeneric(t.test,n),n.push(")"),t.consequent.type==="BlockStatement"?this.astGeneric(t.consequent,n):(n.push(` {\n`),this.astGeneric(t.consequent,n),n.push(`\n}\n`)),t.alternate&&(n.push("else "),t.alternate.type==="BlockStatement"||t.alternate.type==="IfStatement"?this.astGeneric(t.alternate,n):(n.push(` {\n`),this.astGeneric(t.alternate,n),n.push(`\n}\n`))),n}astSwitchStatement(t,n){if(t.type!=="SwitchStatement")throw this.astErrorOutput("Invalid switch statement",t);let{discriminant:g,cases:v}=t,k=this.getType(g),T=`switchDiscriminant${this.astKey(t,"_")}`;switch(k){case"Float":case"Number":n.push(`float ${T} = `),this.astGeneric(g,n),n.push(`;\n`);break;case"Integer":n.push(`int ${T} = `),this.astGeneric(g,n),n.push(`;\n`);break}if(v.length===1&&!v[0].test)return this.astGeneric(v[0].consequent,n),n;let A=!1,E=[],y=!1,_=!1;for(let w=0;w<v.length;w++){if(v[w].test){if(w===0||!_?(_=!0,n.push(`if (${T} == `)):A?(n.push(`${T} == `),A=!1):n.push(` else if (${T} == `),k==="Integer")switch(this.getType(v[w].test)){case"Number":case"Float":this.castValueToInteger(v[w].test,n);break;case"LiteralInteger":this.castLiteralToInteger(v[w].test,n);break}else if(k==="Float")switch(this.getType(v[w].test)){case"LiteralInteger":this.castLiteralToFloat(v[w].test,n);break;case"Integer":this.castValueToFloat(v[w].test,n);break}else throw new Error("unhanlded");if(!v[w].consequent||v[w].consequent.length===0){A=!0,n.push(" || ");continue}n.push(`) {\n`)}else if(v.length>w+1){y=!0,this.astGeneric(v[w].consequent,E);continue}else n.push(` else {\n`);this.astGeneric(v[w].consequent,n),n.push(`\n}`)}return y&&(n.push(" else {"),n.push(E.join("")),n.push("}")),n}astThisExpression(t,n){return n.push("this"),n}astMemberExpression(t,n){let{property:g,name:v,signature:k,origin:T,type:A,xProperty:E,yProperty:y,zProperty:_}=this.getMemberExpressionDetails(t);switch(k){case"value.thread.value":case"this.thread.value":if(v!=="x"&&v!=="y"&&v!=="z")throw this.astErrorOutput("Unexpected expression, expected `this.thread.x`, `this.thread.y`, or `this.thread.z`",t);return n.push(`threadId.${v}`),n;case"this.output.value":if(this.dynamicOutput)switch(v){case"x":this.isState("casting-to-float")?n.push("float(uOutputDim.x)"):n.push("uOutputDim.x");break;case"y":this.isState("casting-to-float")?n.push("float(uOutputDim.y)"):n.push("uOutputDim.y");break;case"z":this.isState("casting-to-float")?n.push("float(uOutputDim.z)"):n.push("uOutputDim.z");break;default:throw this.astErrorOutput("Unexpected expression",t)}else switch(v){case"x":this.isState("casting-to-integer")?n.push(this.output[0]):n.push(this.output[0],".0");break;case"y":this.isState("casting-to-integer")?n.push(this.output[1]):n.push(this.output[1],".0");break;case"z":this.isState("casting-to-integer")?n.push(this.output[2]):n.push(this.output[2],".0");break;default:throw this.astErrorOutput("Unexpected expression",t)}return n;case"value":throw this.astErrorOutput("Unexpected expression",t);case"value[]":case"value[][]":case"value[][][]":case"value[][][][]":case"value.value":if(T==="Math")return n.push(Math[v]),n;let L=u.sanitizeName(v);switch(g){case"r":return n.push(`user_${L}.r`),n;case"g":return n.push(`user_${L}.g`),n;case"b":return n.push(`user_${L}.b`),n;case"a":return n.push(`user_${L}.a`),n}break;case"this.constants.value":if(typeof E>"u")switch(A){case"Array(2)":case"Array(3)":case"Array(4)":return n.push(`constants_${u.sanitizeName(v)}`),n}case"this.constants.value[]":case"this.constants.value[][]":case"this.constants.value[][][]":case"this.constants.value[][][][]":break;case"fn()[]":return this.astCallExpression(t.object,n),n.push("["),n.push(this.memberExpressionPropertyMarkup(g)),n.push("]"),n;case"fn()[][]":return this.astCallExpression(t.object.object,n),n.push("["),n.push(this.memberExpressionPropertyMarkup(t.object.property)),n.push("]"),n.push("["),n.push(this.memberExpressionPropertyMarkup(t.property)),n.push("]"),n;case"[][]":return this.astArrayExpression(t.object,n),n.push("["),n.push(this.memberExpressionPropertyMarkup(g)),n.push("]"),n;default:throw this.astErrorOutput("Unexpected expression",t)}if(t.computed===!1)switch(A){case"Number":case"Integer":case"Float":case"Boolean":return n.push(`${T}_${u.sanitizeName(v)}`),n}let w=`${T}_${u.sanitizeName(v)}`;switch(A){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(t.object,n),n.push("["),n.push(this.memberExpressionPropertyMarkup(E)),n.push("]");break;case"HTMLImageArray":n.push(`getImage3D(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"ArrayTexture(1)":n.push(`getFloatFromSampler2D(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"Array1D(2)":case"Array2D(2)":case"Array3D(2)":n.push(`getMemoryOptimizedVec2(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"ArrayTexture(2)":n.push(`getVec2FromSampler2D(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"Array1D(3)":case"Array2D(3)":case"Array3D(3)":n.push(`getMemoryOptimizedVec3(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"ArrayTexture(3)":n.push(`getVec3FromSampler2D(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"Array1D(4)":case"Array2D(4)":case"Array3D(4)":n.push(`getMemoryOptimizedVec4(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"ArrayTexture(4)":case"HTMLCanvas":case"HTMLImage":case"HTMLVideo":n.push(`getVec4FromSampler2D(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"NumberTexture":case"Array":case"Array2D":case"Array3D":case"Array4D":case"Input":case"Number":case"Float":case"Integer":if(this.precision==="single")n.push(`getMemoryOptimized32(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");else{let L=T==="user"?this.lookupFunctionArgumentBitRatio(this.name,v):this.constantBitRatios[v];switch(L){case 1:n.push(`get8(${w}, ${w}Size, ${w}Dim, `);break;case 2:n.push(`get16(${w}, ${w}Size, ${w}Dim, `);break;case 4:case 0:n.push(`get32(${w}, ${w}Size, ${w}Dim, `);break;default:throw new Error(`unhandled bit ratio of ${L}`)}this.memberExpressionXYZ(E,y,_,n),n.push(")")}break;case"MemoryOptimizedNumberTexture":n.push(`getMemoryOptimized32(${w}, ${w}Size, ${w}Dim, `),this.memberExpressionXYZ(E,y,_,n),n.push(")");break;case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":n.push(`${w}[${this.memberExpressionPropertyMarkup(y)}]`),y&&n.push(`[${this.memberExpressionPropertyMarkup(E)}]`);break;default:throw new Error(`unhandled member expression "${A}"`)}return n}astCallExpression(t,n){if(!t.callee)throw this.astErrorOutput("Unknown CallExpression",t);let g=null,v=this.isAstMathFunction(t);if(v||t.callee.object&&t.callee.object.type==="ThisExpression"?g=t.callee.property.name:t.callee.type==="SequenceExpression"&&t.callee.expressions[0].type==="Literal"&&!isNaN(t.callee.expressions[0].raw)?g=t.callee.expressions[1].property.name:g=t.callee.name,!g)throw this.astErrorOutput("Unhandled function, couldn\'t find name",t);switch(g){case"pow":g="_pow";break;case"round":g="_round";break}if(this.calledFunctions.indexOf(g)<0&&this.calledFunctions.push(g),g==="random"&&this.plugins&&this.plugins.length>0)for(let k=0;k<this.plugins.length;k++){let T=this.plugins[k];if(T.functionMatch==="Math.random()"&&T.functionReplace)return n.push(T.functionReplace),n}if(this.onFunctionCall&&this.onFunctionCall(this.name,g,t.arguments),n.push(g),n.push("("),v)for(let k=0;k<t.arguments.length;++k){let T=t.arguments[k],A=this.getType(T);switch(k>0&&n.push(", "),A){case"Integer":this.castValueToFloat(T,n);break;default:this.astGeneric(T,n);break}}else{let k=this.lookupFunctionArgumentTypes(g)||[];for(let T=0;T<t.arguments.length;++T){let A=t.arguments[T],E=k[T];T>0&&n.push(", ");let y=this.getType(A);switch(E||(this.triggerImplyArgumentType(g,T,y,this),E=y),y){case"Boolean":this.astGeneric(A,n);continue;case"Number":case"Float":if(E==="Integer"){n.push("int("),this.astGeneric(A,n),n.push(")");continue}else if(E==="Number"||E==="Float"){this.astGeneric(A,n);continue}else if(E==="LiteralInteger"){this.castLiteralToFloat(A,n);continue}break;case"Integer":if(E==="Number"||E==="Float"){n.push("float("),this.astGeneric(A,n),n.push(")");continue}else if(E==="Integer"){this.astGeneric(A,n);continue}break;case"LiteralInteger":if(E==="Integer"){this.castLiteralToInteger(A,n);continue}else if(E==="Number"||E==="Float"){this.castLiteralToFloat(A,n);continue}else if(E==="LiteralInteger"){this.astGeneric(A,n);continue}break;case"Array(2)":case"Array(3)":case"Array(4)":if(E===y){if(A.type==="Identifier")n.push(`user_${u.sanitizeName(A.name)}`);else if(A.type==="ArrayExpression"||A.type==="MemberExpression"||A.type==="CallExpression")this.astGeneric(A,n);else throw this.astErrorOutput(`Unhandled argument type ${A.type}`,t);continue}break;case"HTMLCanvas":case"HTMLImage":case"HTMLImageArray":case"HTMLVideo":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":case"Array":case"Input":if(E===y){if(A.type!=="Identifier")throw this.astErrorOutput(`Unhandled argument type ${A.type}`,t);this.triggerImplyArgumentBitRatio(this.name,A.name,g,T);let _=u.sanitizeName(A.name);n.push(`user_${_},user_${_}Size,user_${_}Dim`);continue}break}throw this.astErrorOutput(`Unhandled argument combination of ${y} and ${E} for argument named "${A.name}"`,t)}}return n.push(")"),n}astArrayExpression(t,n){let g=this.getType(t),v=t.elements.length;switch(g){case"Matrix(2)":case"Matrix(3)":case"Matrix(4)":n.push(`mat${v}(`);break;default:n.push(`vec${v}(`)}for(let k=0;k<v;++k){k>0&&n.push(", ");let T=t.elements[k];this.astGeneric(T,n)}return n.push(")"),n}memberExpressionXYZ(t,n,g,v){return g?v.push(this.memberExpressionPropertyMarkup(g),", "):v.push("0, "),n?v.push(this.memberExpressionPropertyMarkup(n),", "):v.push("0, "),v.push(this.memberExpressionPropertyMarkup(t)),v}memberExpressionPropertyMarkup(t){if(!t)throw new Error("Property not set");let n=this.getType(t),g=[];switch(n){case"Number":case"Float":this.castValueToInteger(t,g);break;case"LiteralInteger":this.castLiteralToInteger(t,g);break;default:this.astGeneric(t,g)}return g.join("")}}let f={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4","Matrix(2)":"mat2","Matrix(3)":"mat3","Matrix(4)":"mat4",Array2D:"sampler2D",Array3D:"sampler2D",Boolean:"bool",Float:"float",Input:"sampler2D",Integer:"int",Number:"float",LiteralInteger:"float",NumberTexture:"sampler2D",MemoryOptimizedNumberTexture:"sampler2D","ArrayTexture(1)":"sampler2D","ArrayTexture(2)":"sampler2D","ArrayTexture(3)":"sampler2D","ArrayTexture(4)":"sampler2D",HTMLVideo:"sampler2D",HTMLCanvas:"sampler2D",HTMLImage:"sampler2D",HTMLImageArray:"sampler2DArray"},r={"===":"==","!==":"!="};o.exports={WebGLFunctionNode:d}},{"../../utils":114,"../function-node":10}],39:[function(i,o,m){let{WebGLKernelValueBoolean:u}=i("./kernel-value/boolean"),{WebGLKernelValueFloat:p}=i("./kernel-value/float"),{WebGLKernelValueInteger:d}=i("./kernel-value/integer"),{WebGLKernelValueHTMLImage:f}=i("./kernel-value/html-image"),{WebGLKernelValueDynamicHTMLImage:r}=i("./kernel-value/dynamic-html-image"),{WebGLKernelValueHTMLVideo:a}=i("./kernel-value/html-video"),{WebGLKernelValueDynamicHTMLVideo:t}=i("./kernel-value/dynamic-html-video"),{WebGLKernelValueSingleInput:n}=i("./kernel-value/single-input"),{WebGLKernelValueDynamicSingleInput:g}=i("./kernel-value/dynamic-single-input"),{WebGLKernelValueUnsignedInput:v}=i("./kernel-value/unsigned-input"),{WebGLKernelValueDynamicUnsignedInput:k}=i("./kernel-value/dynamic-unsigned-input"),{WebGLKernelValueMemoryOptimizedNumberTexture:T}=i("./kernel-value/memory-optimized-number-texture"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:A}=i("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGLKernelValueNumberTexture:E}=i("./kernel-value/number-texture"),{WebGLKernelValueDynamicNumberTexture:y}=i("./kernel-value/dynamic-number-texture"),{WebGLKernelValueSingleArray:_}=i("./kernel-value/single-array"),{WebGLKernelValueDynamicSingleArray:w}=i("./kernel-value/dynamic-single-array"),{WebGLKernelValueSingleArray1DI:L}=i("./kernel-value/single-array1d-i"),{WebGLKernelValueDynamicSingleArray1DI:N}=i("./kernel-value/dynamic-single-array1d-i"),{WebGLKernelValueSingleArray2DI:b}=i("./kernel-value/single-array2d-i"),{WebGLKernelValueDynamicSingleArray2DI:c}=i("./kernel-value/dynamic-single-array2d-i"),{WebGLKernelValueSingleArray3DI:C}=i("./kernel-value/single-array3d-i"),{WebGLKernelValueDynamicSingleArray3DI:F}=i("./kernel-value/dynamic-single-array3d-i"),{WebGLKernelValueSingleArray2:P}=i("./kernel-value/single-array2"),{WebGLKernelValueSingleArray3:M}=i("./kernel-value/single-array3"),{WebGLKernelValueSingleArray4:$}=i("./kernel-value/single-array4"),{WebGLKernelValueUnsignedArray:G}=i("./kernel-value/unsigned-array"),{WebGLKernelValueDynamicUnsignedArray:O}=i("./kernel-value/dynamic-unsigned-array"),Y={unsigned:{dynamic:{Boolean:u,Integer:d,Float:p,Array:O,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:k,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:A,HTMLCanvas:r,HTMLImage:r,HTMLImageArray:!1,HTMLVideo:t},static:{Boolean:u,Float:p,Integer:d,Array:G,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:v,NumberTexture:E,"ArrayTexture(1)":E,"ArrayTexture(2)":E,"ArrayTexture(3)":E,"ArrayTexture(4)":E,MemoryOptimizedNumberTexture:T,HTMLCanvas:f,HTMLImage:f,HTMLImageArray:!1,HTMLVideo:a}},single:{dynamic:{Boolean:u,Integer:d,Float:p,Array:w,"Array(2)":P,"Array(3)":M,"Array(4)":$,"Array1D(2)":N,"Array1D(3)":N,"Array1D(4)":N,"Array2D(2)":c,"Array2D(3)":c,"Array2D(4)":c,"Array3D(2)":F,"Array3D(3)":F,"Array3D(4)":F,Input:g,NumberTexture:y,"ArrayTexture(1)":y,"ArrayTexture(2)":y,"ArrayTexture(3)":y,"ArrayTexture(4)":y,MemoryOptimizedNumberTexture:A,HTMLCanvas:r,HTMLImage:r,HTMLImageArray:!1,HTMLVideo:t},static:{Boolean:u,Float:p,Integer:d,Array:_,"Array(2)":P,"Array(3)":M,"Array(4)":$,"Array1D(2)":L,"Array1D(3)":L,"Array1D(4)":L,"Array2D(2)":b,"Array2D(3)":b,"Array2D(4)":b,"Array3D(2)":C,"Array3D(3)":C,"Array3D(4)":C,Input:n,NumberTexture:E,"ArrayTexture(1)":E,"ArrayTexture(2)":E,"ArrayTexture(3)":E,"ArrayTexture(4)":E,MemoryOptimizedNumberTexture:T,HTMLCanvas:f,HTMLImage:f,HTMLImageArray:!1,HTMLVideo:a}}};function W(K,J,Q,te){if(!K)throw new Error("type missing");if(!J)throw new Error("dynamic missing");if(!Q)throw new Error("precision missing");te.type&&(K=te.type);let H=Y[Q][J];if(H[K]===!1)return null;if(H[K]===void 0)throw new Error(`Could not find a KernelValue for ${K}`);return H[K]}o.exports={lookupKernelValueType:W,kernelValueMaps:Y}},{"./kernel-value/boolean":41,"./kernel-value/dynamic-html-image":42,"./kernel-value/dynamic-html-video":43,"./kernel-value/dynamic-memory-optimized-number-texture":44,"./kernel-value/dynamic-number-texture":45,"./kernel-value/dynamic-single-array":46,"./kernel-value/dynamic-single-array1d-i":47,"./kernel-value/dynamic-single-array2d-i":48,"./kernel-value/dynamic-single-array3d-i":49,"./kernel-value/dynamic-single-input":50,"./kernel-value/dynamic-unsigned-array":51,"./kernel-value/dynamic-unsigned-input":52,"./kernel-value/float":53,"./kernel-value/html-image":54,"./kernel-value/html-video":55,"./kernel-value/integer":57,"./kernel-value/memory-optimized-number-texture":58,"./kernel-value/number-texture":59,"./kernel-value/single-array":60,"./kernel-value/single-array1d-i":61,"./kernel-value/single-array2":62,"./kernel-value/single-array2d-i":63,"./kernel-value/single-array3":64,"./kernel-value/single-array3d-i":65,"./kernel-value/single-array4":66,"./kernel-value/single-input":67,"./kernel-value/unsigned-array":68,"./kernel-value/unsigned-input":69}],40:[function(i,o,m){let{WebGLKernelValue:u}=i("./index"),{Input:p}=i("../../../input");class d extends u{checkSize(r,a){if(!this.kernel.validate)return;let{maxTextureSize:t}=this.kernel.constructor.features;if(r>t||a>t)throw r>a?new Error(`Argument texture width of ${r} larger than maximum size of ${t} for your GPU`):r<a?new Error(`Argument texture height of ${a} larger than maximum size of ${t} for your GPU`):new Error(`Argument texture height and width of ${a} larger than maximum size of ${t} for your GPU`)}setup(){this.requestTexture(),this.setupTexture(),this.defineTexture()}requestTexture(){this.texture=this.onRequestTexture()}defineTexture(){let{context:r}=this;r.activeTexture(this.contextHandle),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)}setupTexture(){this.contextHandle=this.onRequestContextHandle(),this.index=this.onRequestIndex(),this.dimensionsId=this.id+"Dim",this.sizeId=this.id+"Size"}getBitRatio(r){if(Array.isArray(r[0]))return this.getBitRatio(r[0]);if(r.constructor===p)return this.getBitRatio(r.value);switch(r.constructor){case Uint8ClampedArray:case Uint8Array:case Int8Array:return 1;case Uint16Array:case Int16Array:return 2;case Float32Array:case Int32Array:default:return 4}}destroy(){this.prevArg&&this.prevArg.delete(),this.context.deleteTexture(this.texture)}}o.exports={WebGLKernelArray:d}},{"../../../input":110,"./index":56}],41:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getSource(r){return this.origin==="constants"?`const bool ${this.id} = ${r};\n`:`uniform bool ${this.id};\n`}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueBoolean:d}},{"../../../utils":114,"./index":56}],42:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueHTMLImage:p}=i("./html-image");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){let{width:a,height:t}=r;this.checkSize(a,t),this.dimensions=[a,t,1],this.textureSize=[a,t],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicHTMLImage:d}},{"../../../utils":114,"./html-image":54}],43:[function(i,o,m){let{WebGLKernelValueDynamicHTMLImage:u}=i("./dynamic-html-image");class p extends u{}o.exports={WebGLKernelValueDynamicHTMLVideo:p}},{"./dynamic-html-image":42}],44:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:p}=i("./memory-optimized-number-texture");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.dimensions=r.dimensions,this.checkSize(r.size[0],r.size[1]),this.textureSize=r.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicMemoryOptimizedNumberTexture:d}},{"../../../utils":114,"./memory-optimized-number-texture":58}],45:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueNumberTexture:p}=i("./number-texture");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.dimensions=r.dimensions,this.checkSize(r.size[0],r.size[1]),this.textureSize=r.size,this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicNumberTexture:d}},{"../../../utils":114,"./number-texture":59}],46:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray:p}=i("./single-array");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.dimensions=u.getDimensions(r,!0),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicSingleArray:d}},{"../../../utils":114,"./single-array":60}],47:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray1DI:p}=i("./single-array1d-i");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicSingleArray1DI:d}},{"../../../utils":114,"./single-array1d-i":61}],48:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray2DI:p}=i("./single-array2d-i");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicSingleArray2DI:d}},{"../../../utils":114,"./single-array2d-i":63}],49:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray3DI:p}=i("./single-array3d-i");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicSingleArray3DI:d}},{"../../../utils":114,"./single-array3d-i":65}],50:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleInput:p}=i("./single-input");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){let[a,t,n]=r.size;this.dimensions=new Int32Array([a||1,t||1,n||1]),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicSingleInput:d}},{"../../../utils":114,"./single-input":67}],51:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueUnsignedArray:p}=i("./unsigned-array");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){this.dimensions=u.getDimensions(r,!0),this.textureSize=u.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);let a=this.getTransferArrayType(r);this.preUploadValue=new a(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicUnsignedArray:d}},{"../../../utils":114,"./unsigned-array":68}],52:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueUnsignedInput:p}=i("./unsigned-input");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}updateValue(r){let[a,t,n]=r.size;this.dimensions=new Int32Array([a||1,t||1,n||1]),this.textureSize=u.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]);let g=this.getTransferArrayType(r.value);this.preUploadValue=new g(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGLKernelValueDynamicUnsignedInput:d}},{"../../../utils":114,"./unsigned-input":69}],53:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(r){return this.origin==="constants"?Number.isInteger(r)?`const float ${this.id} = ${r}.0;\n`:`const float ${this.id} = ${r};\n`:`uniform float ${this.id};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform1f(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueFloat:d}},{"../../../utils":114,"./index":56}],54:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a);let{width:t,height:n}=r;this.checkSize(t,n),this.dimensions=[t,n,1],this.textureSize=[t,n],this.uploadValue=r}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.uploadValue=r),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueHTMLImage:d}},{"../../../utils":114,"./array":40}],55:[function(i,o,m){let{WebGLKernelValueHTMLImage:u}=i("./html-image");class p extends u{}o.exports={WebGLKernelValueHTMLVideo:p}},{"./html-image":54}],56:[function(i,o,m){let{utils:u}=i("../../../utils"),{KernelValue:p}=i("../../kernel-value");class d extends p{constructor(r,a){super(r,a),this.dimensionsId=null,this.sizeId=null,this.initialValueConstructor=r.constructor,this.onRequestTexture=a.onRequestTexture,this.onRequestIndex=a.onRequestIndex,this.uploadValue=null,this.textureSize=null,this.bitRatio=null,this.prevArg=null}get id(){return`${this.origin}_${u.sanitizeName(this.name)}`}setup(){}getTransferArrayType(r){if(Array.isArray(r[0]))return this.getTransferArrayType(r[0]);switch(r.constructor){case Array:case Int32Array:case Int16Array:case Int8Array:return Float32Array;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:case Float32Array:case Float64Array:return r.constructor}return console.warn("Unfamiliar constructor type.  Will go ahead and use, but likley this may result in a transfer of zeros"),r.constructor}getStringValueHandler(){throw new Error(`"getStringValueHandler" not implemented on ${this.constructor.name}`)}getVariablePrecisionString(){return this.kernel.getVariablePrecisionString(this.textureSize||void 0,this.tactic||void 0)}destroy(){}}o.exports={WebGLKernelValue:d}},{"../../../utils":114,"../../kernel-value":35}],57:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(r){return this.origin==="constants"?`const int ${this.id} = ${parseInt(r)};\n`:`uniform int ${this.id};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueInteger:d}},{"../../../utils":114,"./index":56}],58:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array"),d="Source and destination textures are the same.  Use immutable = true and manually cleanup kernel output texture memory with texture.delete()";class f extends p{constructor(a,t){super(a,t);let[n,g]=a.size;this.checkSize(n,g),this.dimensions=a.dimensions,this.textureSize=a.size,this.uploadValue=a.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(a){if(a.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(a.constructor);return}if(this.checkContext&&a.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);let{kernel:t,context:n}=this;if(t.pipeline)if(t.immutable)t.updateTextureArgumentRefs(this,a);else{if(t.texture.texture===a.texture)throw new Error(d);if(t.mappedTextures){let{mappedTextures:g}=t;for(let v=0;v<g.length;v++)if(g[v].texture===a.texture)throw new Error(d)}}n.activeTexture(this.contextHandle),n.bindTexture(n.TEXTURE_2D,this.uploadValue=a.texture),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueMemoryOptimizedNumberTexture:f,sameError:d}},{"../../../utils":114,"./array":40}],59:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array"),{sameError:d}=i("./memory-optimized-number-texture");class f extends p{constructor(a,t){super(a,t);let[n,g]=a.size;this.checkSize(n,g);let{size:v,dimensions:k}=a;this.bitRatio=this.getBitRatio(a),this.dimensions=k,this.textureSize=v,this.uploadValue=a.texture,this.forceUploadEachRun=!0}setup(){this.setupTexture()}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName}.texture;\n`}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(a){if(a.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(a.constructor);return}if(this.checkContext&&a.context!==this.context)throw new Error(`Value ${this.name} (${this.type}) must be from same context`);let{kernel:t,context:n}=this;if(t.pipeline)if(t.immutable)t.updateTextureArgumentRefs(this,a);else{if(t.texture.texture===a.texture)throw new Error(d);if(t.mappedTextures){let{mappedTextures:g}=t;for(let v=0;v<g.length;v++)if(g[v].texture===a.texture)throw new Error(d)}}n.activeTexture(this.contextHandle),n.bindTexture(n.TEXTURE_2D,this.uploadValue=a.texture),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueNumberTexture:f}},{"../../../utils":114,"./array":40,"./memory-optimized-number-texture":58}],60:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=4,this.dimensions=u.getDimensions(r,!0),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return u.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueSingleArray:d}},{"../../../utils":114,"./array":40}],61:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=4,this.setShape(r)}setShape(r){let a=u.getDimensions(r,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(a,this.bitRatio),this.dimensions=new Int32Array([a[1],1,1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return u.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flatten2dArrayTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueSingleArray1DI:d}},{"../../../utils":114,"./array":40}],62:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getSource(r){return this.origin==="constants"?`const vec2 ${this.id} = vec2(${r[0]},${r[1]});\n`:`uniform vec2 ${this.id};\n`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform2fv(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueSingleArray2:d}},{"../../../utils":114,"./index":56}],63:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=4,this.setShape(r)}setShape(r){let a=u.getDimensions(r,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(a,this.bitRatio),this.dimensions=new Int32Array([a[1],a[2],1]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return u.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flatten3dArrayTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueSingleArray2DI:d}},{"../../../utils":114,"./array":40}],64:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getSource(r){return this.origin==="constants"?`const vec3 ${this.id} = vec3(${r[0]},${r[1]},${r[2]});\n`:`uniform vec3 ${this.id};\n`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform3fv(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueSingleArray3:d}},{"../../../utils":114,"./index":56}],65:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=4,this.setShape(r)}setShape(r){let a=u.getDimensions(r,!0);this.textureSize=u.getMemoryOptimizedFloatTextureSize(a,this.bitRatio),this.dimensions=new Int32Array([a[1],a[2],a[3]]),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return u.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}, uploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flatten4dArrayTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueSingleArray3DI:d}},{"../../../utils":114,"./array":40}],66:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValue:p}=i("./index");class d extends p{constructor(r,a){super(r,a),this.uploadValue=r}getSource(r){return this.origin==="constants"?`const vec4 ${this.id} = vec4(${r[0]},${r[1]},${r[2]},${r[3]});\n`:`uniform vec4 ${this.id};\n`}getStringValueHandler(){return this.origin==="constants"?"":`const uploadValue_${this.name} = ${this.varName};\n`}updateValue(r){this.origin!=="constants"&&this.kernel.setUniform4fv(this.id,this.uploadValue=r)}}o.exports={WebGLKernelValueSingleArray4:d}},{"../../../utils":114,"./index":56}],67:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=4;let[t,n,g]=r.size;this.dimensions=new Int32Array([t||1,n||1,g||1]),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength)}getStringValueHandler(){return u.linesToString([`const uploadValue_${this.name} = new Float32Array(${this.uploadArrayLength})`,`flattenTo(${this.varName}.value, uploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r.value,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueSingleInput:d}},{"../../../utils":114,"./array":40}],68:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=this.getBitRatio(r),this.dimensions=u.getDimensions(r,!0),this.textureSize=u.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(r),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return u.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}, preUploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.preUploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueUnsignedArray:d}},{"../../../utils":114,"./array":40}],69:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("./array");class d extends p{constructor(r,a){super(r,a),this.bitRatio=this.getBitRatio(r);let[t,n,g]=r.size;this.dimensions=new Int32Array([t||1,n||1,g||1]),this.textureSize=u.getMemoryOptimizedPackedTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*(4/this.bitRatio),this.checkSize(this.textureSize[0],this.textureSize[1]),this.TranserArrayType=this.getTransferArrayType(r.value),this.preUploadValue=new this.TranserArrayType(this.uploadArrayLength),this.uploadValue=new Uint8Array(this.preUploadValue.buffer)}getStringValueHandler(){return u.linesToString([`const preUploadValue_${this.name} = new ${this.TranserArrayType.name}(${this.uploadArrayLength})`,`const uploadValue_${this.name} = new Uint8Array(preUploadValue_${this.name}.buffer)`,`flattenTo(${this.varName}.value, preUploadValue_${this.name})`])}getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(value.constructor);return}let{context:a}=this;u.flattenTo(r.value,this.preUploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.UNSIGNED_BYTE,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGLKernelValueUnsignedInput:d}},{"../../../utils":114,"./array":40}],70:[function(i,o,m){let{GLKernel:u}=i("../gl/kernel"),{FunctionBuilder:p}=i("../function-builder"),{WebGLFunctionNode:d}=i("./function-node"),{utils:f}=i("../../utils"),r=i("../../plugins/math-random-uniformly-distributed"),{fragmentShader:a}=i("./fragment-shader"),{vertexShader:t}=i("./vertex-shader"),{glKernelString:n}=i("../gl/kernel-string"),{lookupKernelValueType:g}=i("./kernel-value-maps"),v=null,k=null,T=null,A=null,E=null,y=[r],_=[],w={};class L extends u{static get isSupported(){return v!==null||(this.setupFeatureChecks(),v=this.isContextMatch(T)),v}static setupFeatureChecks(){typeof document<"u"?k=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(k=new OffscreenCanvas(0,0)),k&&(T=k.getContext("webgl")||k.getContext("experimental-webgl"),!(!T||!T.getExtension)&&(A={OES_texture_float:T.getExtension("OES_texture_float"),OES_texture_float_linear:T.getExtension("OES_texture_float_linear"),OES_element_index_uint:T.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:T.getExtension("WEBGL_draw_buffers")},E=this.getFeatures()))}static isContextMatch(b){return typeof WebGLRenderingContext<"u"?b instanceof WebGLRenderingContext:!1}static getIsTextureFloat(){return Boolean(A.OES_texture_float)}static getIsDrawBuffers(){return Boolean(A.WEBGL_draw_buffers)}static getChannelCount(){return A.WEBGL_draw_buffers?T.getParameter(A.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1}static getMaxTextureSize(){return T.getParameter(T.MAX_TEXTURE_SIZE)}static lookupKernelValueType(b,c,C,F){return g(b,c,C,F)}static get testCanvas(){return k}static get testContext(){return T}static get features(){return E}static get fragmentShader(){return a}static get vertexShader(){return t}constructor(b,c){super(b,c),this.program=null,this.pipeline=c.pipeline,this.endianness=f.systemEndianness(),this.extensions={},this.argumentTextureCount=0,this.constantTextureCount=0,this.fragShader=null,this.vertShader=null,this.drawBuffersMap=null,this.maxTexSize=null,this.onRequestSwitchKernel=null,this.texture=null,this.mappedTextures=null,this.mergeSettings(b.settings||c),this.threadDim=null,this.framebuffer=null,this.buffer=null,this.textureCache=[],this.programUniformLocationCache={},this.uniform1fCache={},this.uniform1iCache={},this.uniform2fCache={},this.uniform2fvCache={},this.uniform2ivCache={},this.uniform3fvCache={},this.uniform3ivCache={},this.uniform4fvCache={},this.uniform4ivCache={}}initCanvas(){if(typeof document<"u"){let b=document.createElement("canvas");return b.width=2,b.height=2,b}else if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0)}initContext(){let b={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl",b)||this.canvas.getContext("experimental-webgl",b)}initPlugins(b){let c=[],{source:C}=this;if(typeof C=="string")for(let F=0;F<y.length;F++){let P=y[F];C.match(P.functionMatch)&&c.push(P)}else if(typeof C=="object"&&b.pluginNames)for(let F=0;F<y.length;F++){let P=y[F];b.pluginNames.some($=>$===P.name)&&c.push(P)}return c}initExtensions(){this.extensions={OES_texture_float:this.context.getExtension("OES_texture_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear"),OES_element_index_uint:this.context.getExtension("OES_element_index_uint"),WEBGL_draw_buffers:this.context.getExtension("WEBGL_draw_buffers"),WEBGL_color_buffer_float:this.context.getExtension("WEBGL_color_buffer_float")}}validateSettings(b){if(!this.validate){this.texSize=f.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}let{features:c}=this.constructor;if(this.optimizeFloatMemory===!0&&!c.isTextureFloat)throw new Error("Float textures are not supported");if(this.precision==="single"&&!c.isFloatRead)throw new Error("Single precision not supported");if(!this.graphical&&this.precision===null&&c.isTextureFloat&&(this.precision=c.isFloatRead?"single":"unsigned"),this.subKernels&&this.subKernels.length>0&&!this.extensions.WEBGL_draw_buffers)throw new Error("could not instantiate draw buffers extension");if(this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!c.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&c.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if(b.length!==1)throw new Error("Auto output only supported for kernels with only one input");let C=f.getVariableType(b[0],this.strictIntegers);switch(C){case"Array":this.output=f.getDimensions(C);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=b[0].output;break;default:throw new Error("Auto output not supported for input type: "+C)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="precision"&&(this.precision="unsigned",console.warn("Cannot use graphical mode and single precision at the same time")),this.texSize=f.clone(this.output);return}else this.precision===null&&c.isTextureFloat&&(this.precision="single");this.texSize=f.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}updateMaxTexSize(){let{texSize:b,canvas:c}=this;if(this.maxTexSize===null){let C=_.indexOf(c);C===-1&&(C=_.length,_.push(c),w[C]=[b[0],b[1]]),this.maxTexSize=w[C]}this.maxTexSize[0]<b[0]&&(this.maxTexSize[0]=b[0]),this.maxTexSize[1]<b[1]&&(this.maxTexSize[1]=b[1])}setupArguments(b){this.kernelArguments=[],this.argumentTextureCount=0;let c=this.argumentTypes===null;if(c&&(this.argumentTypes=[]),this.argumentSizes=[],this.argumentBitRatios=[],b.length<this.argumentNames.length)throw new Error("not enough arguments for kernel");if(b.length>this.argumentNames.length)throw new Error("too many arguments for kernel");let{context:C}=this,F=0,P=()=>this.createTexture(),M=()=>this.constantTextureCount+F++,$=O=>{this.switchKernels({type:"argumentMismatch",needed:O})},G=()=>C.TEXTURE0+this.constantTextureCount+this.argumentTextureCount++;for(let O=0;O<b.length;O++){let Y=b[O],W=this.argumentNames[O],K;c?(K=f.getVariableType(Y,this.strictIntegers),this.argumentTypes.push(K)):K=this.argumentTypes[O];let J=this.constructor.lookupKernelValueType(K,this.dynamicArguments?"dynamic":"static",this.precision,b[O]);if(J===null)return this.requestFallback(b);let Q=new J(Y,{name:W,type:K,tactic:this.tactic,origin:"user",context:C,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:P,onRequestIndex:M,onUpdateValueMismatch:$,onRequestContextHandle:G});this.kernelArguments.push(Q),Q.setup(),this.argumentSizes.push(Q.textureSize),this.argumentBitRatios[O]=Q.bitRatio}}createTexture(){let b=this.context.createTexture();return this.textureCache.push(b),b}setupConstants(b){let{context:c}=this;this.kernelConstants=[],this.forceUploadKernelConstants=[];let C=this.constantTypes===null;C&&(this.constantTypes={}),this.constantBitRatios={};let F=0;for(let P in this.constants){let M=this.constants[P],$;C?($=f.getVariableType(M,this.strictIntegers),this.constantTypes[P]=$):$=this.constantTypes[P];let G=this.constructor.lookupKernelValueType($,"static",this.precision,M);if(G===null)return this.requestFallback(b);let O=new G(M,{name:P,type:$,tactic:this.tactic,origin:"constants",context:this.context,checkContext:this.checkContext,kernel:this,strictIntegers:this.strictIntegers,onRequestTexture:()=>this.createTexture(),onRequestIndex:()=>F++,onRequestContextHandle:()=>c.TEXTURE0+this.constantTextureCount++});this.constantBitRatios[P]=O.bitRatio,this.kernelConstants.push(O),O.setup(),O.forceUploadEachRun&&this.forceUploadKernelConstants.push(O)}}build(){if(this.built||(this.initExtensions(),this.validateSettings(arguments),this.setupConstants(arguments),this.fallbackRequested)||(this.setupArguments(arguments),this.fallbackRequested))return;this.updateMaxTexSize(),this.translateSource();let b=this.pickRenderStrategy(arguments);if(b)return b;let{texSize:c,context:C,canvas:F}=this;C.enable(C.SCISSOR_TEST),this.pipeline&&this.precision==="single"?(C.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),F.width=this.maxTexSize[0],F.height=this.maxTexSize[1]):(C.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),F.width=this.maxTexSize[0],F.height=this.maxTexSize[1]);let P=this.threadDim=Array.from(this.output);for(;P.length<3;)P.push(1);let M=this.getVertexShader(arguments),$=C.createShader(C.VERTEX_SHADER);C.shaderSource($,M),C.compileShader($),this.vertShader=$;let G=this.getFragmentShader(arguments),O=C.createShader(C.FRAGMENT_SHADER);if(C.shaderSource(O,G),C.compileShader(O),this.fragShader=O,this.debug&&(console.log("GLSL Shader Output:"),console.log(G)),!C.getShaderParameter($,C.COMPILE_STATUS))throw new Error("Error compiling vertex shader: "+C.getShaderInfoLog($));if(!C.getShaderParameter(O,C.COMPILE_STATUS))throw new Error("Error compiling fragment shader: "+C.getShaderInfoLog(O));let Y=this.program=C.createProgram();C.attachShader(Y,$),C.attachShader(Y,O),C.linkProgram(Y),this.framebuffer=C.createFramebuffer(),this.framebuffer.width=c[0],this.framebuffer.height=c[1],this.rawValueFramebuffers={};let W=new Float32Array([-1,-1,1,-1,-1,1,1,1]),K=new Float32Array([0,0,1,0,0,1,1,1]),J=W.byteLength,Q=this.buffer;Q?C.bindBuffer(C.ARRAY_BUFFER,Q):(Q=this.buffer=C.createBuffer(),C.bindBuffer(C.ARRAY_BUFFER,Q),C.bufferData(C.ARRAY_BUFFER,W.byteLength+K.byteLength,C.STATIC_DRAW)),C.bufferSubData(C.ARRAY_BUFFER,0,W),C.bufferSubData(C.ARRAY_BUFFER,J,K);let te=C.getAttribLocation(this.program,"aPos");C.enableVertexAttribArray(te),C.vertexAttribPointer(te,2,C.FLOAT,!1,0,0);let H=C.getAttribLocation(this.program,"aTexCoord");C.enableVertexAttribArray(H),C.vertexAttribPointer(H,2,C.FLOAT,!1,0,J),C.bindFramebuffer(C.FRAMEBUFFER,this.framebuffer);let B=0;C.useProgram(this.program);for(let he in this.constants)this.kernelConstants[B++].updateValue(this.constants[he]);this._setupOutputTexture(),this.subKernels!==null&&this.subKernels.length>0&&(this._mappedTextureSwitched={},this._setupSubOutputTextures()),this.buildSignature(arguments),this.built=!0}translateSource(){let b=p.fromKernel(this,d,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=b.getPrototypeString("kernel"),this.setupReturnTypes(b)}setupReturnTypes(b){if(!this.graphical&&!this.returnType&&(this.returnType=b.getKernelResultType()),this.subKernels&&this.subKernels.length>0)for(let c=0;c<this.subKernels.length;c++){let C=this.subKernels[c];C.returnType||(C.returnType=b.getSubKernelResultType(c))}}run(){let{kernelArguments:b,texSize:c,forceUploadKernelConstants:C,context:F}=this;F.useProgram(this.program),F.scissor(0,0,c[0],c[1]),this.dynamicOutput&&(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",c)),this.setUniform2f("ratio",c[0]/this.maxTexSize[0],c[1]/this.maxTexSize[1]);for(let P=0;P<C.length;P++){let M=C[P];if(M.updateValue(this.constants[M.name]),this.switchingKernels)return}for(let P=0;P<b.length;P++)if(b[P].updateValue(arguments[P]),this.switchingKernels)return;if(this.plugins)for(let P=0;P<this.plugins.length;P++){let M=this.plugins[P];M.onBeforeRun&&M.onBeforeRun(this)}if(this.graphical){if(this.pipeline)return F.bindRenderbuffer(F.RENDERBUFFER,null),F.bindFramebuffer(F.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),F.drawArrays(F.TRIANGLE_STRIP,0,4),this.immutable?this.texture.clone():this.texture;F.bindRenderbuffer(F.RENDERBUFFER,null),F.bindFramebuffer(F.FRAMEBUFFER,null),F.drawArrays(F.TRIANGLE_STRIP,0,4);return}F.bindFramebuffer(F.FRAMEBUFFER,this.framebuffer),this.immutable&&this._replaceOutputTexture(),this.subKernels!==null&&(this.immutable&&this._replaceSubOutputTextures(),this.drawBuffers()),F.drawArrays(F.TRIANGLE_STRIP,0,4)}drawBuffers(){this.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(this.drawBuffersMap)}getInternalFormat(){return this.context.RGBA}getTextureFormat(){let{context:b}=this;switch(this.getInternalFormat()){case b.RGBA:return b.RGBA;default:throw new Error("Unknown internal format")}}_replaceOutputTexture(){if(this.texture.beforeMutate()||this._textureSwitched){let b=this.context;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture.texture,0),this._textureSwitched=!1}}_setupOutputTexture(){let b=this.context,c=this.texSize;if(this.texture){b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this.texture.texture,0);return}let C=this.createTexture();b.activeTexture(b.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),b.bindTexture(b.TEXTURE_2D,C),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);let F=this.getInternalFormat();this.precision==="single"?b.texImage2D(b.TEXTURE_2D,0,F,c[0],c[1],0,b.RGBA,b.FLOAT,null):b.texImage2D(b.TEXTURE_2D,0,F,c[0],c[1],0,F,b.UNSIGNED_BYTE,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,C,0),this.texture=new this.TextureConstructor({texture:C,size:c,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_replaceSubOutputTextures(){let b=this.context;for(let c=0;c<this.mappedTextures.length;c++){let C=this.mappedTextures[c];(C.beforeMutate()||this._mappedTextureSwitched[c])&&(b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+c+1,b.TEXTURE_2D,C.texture,0),this._mappedTextureSwitched[c]=!1)}}_setupSubOutputTextures(){let b=this.context;if(this.mappedTextures){for(let C=0;C<this.subKernels.length;C++)b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+C+1,b.TEXTURE_2D,this.mappedTextures[C].texture,0);return}let c=this.texSize;this.drawBuffersMap=[b.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let C=0;C<this.subKernels.length;C++){let F=this.createTexture();this.drawBuffersMap.push(b.COLOR_ATTACHMENT0+C+1),b.activeTexture(b.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+C),b.bindTexture(b.TEXTURE_2D,F),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),this.precision==="single"?b.texImage2D(b.TEXTURE_2D,0,b.RGBA,c[0],c[1],0,b.RGBA,b.FLOAT,null):b.texImage2D(b.TEXTURE_2D,0,b.RGBA,c[0],c[1],0,b.RGBA,b.UNSIGNED_BYTE,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+C+1,b.TEXTURE_2D,F,0),this.mappedTextures.push(new this.TextureConstructor({texture:F,size:c,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}setUniform1f(b,c){if(this.uniform1fCache.hasOwnProperty(b)){let F=this.uniform1fCache[b];if(c===F)return}this.uniform1fCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform1f(C,c)}setUniform1i(b,c){if(this.uniform1iCache.hasOwnProperty(b)){let F=this.uniform1iCache[b];if(c===F)return}this.uniform1iCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform1i(C,c)}setUniform2f(b,c,C){if(this.uniform2fCache.hasOwnProperty(b)){let P=this.uniform2fCache[b];if(c===P[0]&&C===P[1])return}this.uniform2fCache[b]=[c,C];let F=this.getUniformLocation(b);this.context.uniform2f(F,c,C)}setUniform2fv(b,c){if(this.uniform2fvCache.hasOwnProperty(b)){let F=this.uniform2fvCache[b];if(c[0]===F[0]&&c[1]===F[1])return}this.uniform2fvCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform2fv(C,c)}setUniform2iv(b,c){if(this.uniform2ivCache.hasOwnProperty(b)){let F=this.uniform2ivCache[b];if(c[0]===F[0]&&c[1]===F[1])return}this.uniform2ivCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform2iv(C,c)}setUniform3fv(b,c){if(this.uniform3fvCache.hasOwnProperty(b)){let F=this.uniform3fvCache[b];if(c[0]===F[0]&&c[1]===F[1]&&c[2]===F[2])return}this.uniform3fvCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform3fv(C,c)}setUniform3iv(b,c){if(this.uniform3ivCache.hasOwnProperty(b)){let F=this.uniform3ivCache[b];if(c[0]===F[0]&&c[1]===F[1]&&c[2]===F[2])return}this.uniform3ivCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform3iv(C,c)}setUniform4fv(b,c){if(this.uniform4fvCache.hasOwnProperty(b)){let F=this.uniform4fvCache[b];if(c[0]===F[0]&&c[1]===F[1]&&c[2]===F[2]&&c[3]===F[3])return}this.uniform4fvCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform4fv(C,c)}setUniform4iv(b,c){if(this.uniform4ivCache.hasOwnProperty(b)){let F=this.uniform4ivCache[b];if(c[0]===F[0]&&c[1]===F[1]&&c[2]===F[2]&&c[3]===F[3])return}this.uniform4ivCache[b]=c;let C=this.getUniformLocation(b);this.context.uniform4iv(C,c)}getUniformLocation(b){return this.programUniformLocationCache.hasOwnProperty(b)?this.programUniformLocationCache[b]:this.programUniformLocationCache[b]=this.context.getUniformLocation(this.program,b)}_getFragShaderArtifactMap(b){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),PLUGINS:this._getPluginsString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),INJECTED_NATIVE:this._getInjectedNative(),MAIN_CONSTANTS:this._getMainConstantsString(),MAIN_ARGUMENTS:this._getMainArgumentsString(b),KERNEL:this.getKernelString(),MAIN_RESULT:this.getMainResultString(),FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getVertShaderArtifactMap(b){return{FLOAT_TACTIC_DECLARATION:this.getFloatTacticDeclaration(),INT_TACTIC_DECLARATION:this.getIntTacticDeclaration(),SAMPLER_2D_TACTIC_DECLARATION:this.getSampler2DTacticDeclaration(),SAMPLER_2D_ARRAY_TACTIC_DECLARATION:this.getSampler2DArrayTacticDeclaration()}}_getHeaderString(){return this.subKernels!==null?`#extension GL_EXT_draw_buffers : require\n`:""}_getLoopMaxString(){return this.loopMaxIterations?` ${parseInt(this.loopMaxIterations)};\n`:` 1000;\n`}_getPluginsString(){return this.plugins?this.plugins.map(b=>b.source&&this.source.match(b.functionMatch)?b.source:"").join(`\n`):`\n`}_getConstantsString(){let b=[],{threadDim:c,texSize:C}=this;return this.dynamicOutput?b.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"):b.push(`ivec3 uOutputDim = ivec3(${c[0]}, ${c[1]}, ${c[2]})`,`ivec2 uTexSize = ivec2(${C[0]}, ${C[1]})`),f.linesToString(b)}_getTextureCoordinate(){let b=this.subKernels;return b===null||b.length<1?`varying vec2 vTexCoord;\n`:`out vec2 vTexCoord;\n`}_getDecode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;\n`}_getEncode32EndiannessString(){return this.endianness==="LE"?"":`  texel.rgba = texel.abgr;\n`}_getDivideWithIntegerCheckString(){return this.fixIntegerDivisionAccuracy?`float divWithIntCheck(float x, float y) {\n        if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n          return float(int(x) / int(y));\n        }\n        return x / y;\n      }\n      \n      float integerCorrectionModulo(float number, float divisor) {\n        if (number < 0.0) {\n          number = abs(number);\n          if (divisor < 0.0) {\n            divisor = abs(divisor);\n          }\n          return -(number - (divisor * floor(divWithIntCheck(number, divisor))));\n        }\n        if (divisor < 0.0) {\n          divisor = abs(divisor);\n        }\n        return number - (divisor * floor(divWithIntCheck(number, divisor)));\n      }`:""}_getMainArgumentsString(b){let c=[],{argumentNames:C}=this;for(let F=0;F<C.length;F++)c.push(this.kernelArguments[F].getSource(b[F]));return c.join("")}_getInjectedNative(){return this.injectedNative||""}_getMainConstantsString(){let b=[],{constants:c}=this;if(c){let C=0;for(let F in c)!this.constants.hasOwnProperty(F)||b.push(this.kernelConstants[C++].getSource(this.constants[F]))}return b.join("")}getRawValueFramebuffer(b,c){if(this.rawValueFramebuffers[b]||(this.rawValueFramebuffers[b]={}),!this.rawValueFramebuffers[b][c]){let C=this.context.createFramebuffer();C.width=b,C.height=c,this.rawValueFramebuffers[b][c]=C}return this.rawValueFramebuffers[b][c]}getKernelResultDeclaration(){switch(this.returnType){case"Array(2)":return"vec2 kernelResult";case"Array(3)":return"vec3 kernelResult";case"Array(4)":return"vec4 kernelResult";case"LiteralInteger":case"Float":case"Number":case"Integer":return"float kernelResult";default:if(this.graphical)return"float kernelResult";throw new Error(`unrecognized output type "${this.returnType}"`)}}getKernelString(){let b=[this.getKernelResultDeclaration()],{subKernels:c}=this;if(c!==null)switch(this.returnType){case"Number":case"Float":case"Integer":for(let C=0;C<c.length;C++){let F=c[C];b.push(F.returnType==="Integer"?`int subKernelResult_${F.name} = 0`:`float subKernelResult_${F.name} = 0.0`)}break;case"Array(2)":for(let C=0;C<c.length;C++)b.push(`vec2 subKernelResult_${c[C].name}`);break;case"Array(3)":for(let C=0;C<c.length;C++)b.push(`vec3 subKernelResult_${c[C].name}`);break;case"Array(4)":for(let C=0;C<c.length;C++)b.push(`vec4 subKernelResult_${c[C].name}`);break}return f.linesToString(b)+this.translatedSource}getMainResultGraphical(){return f.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return f.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){let b=[];if(!this.subKernels)return"";for(let c=0;c<this.subKernels.length;c++)this.subKernels[c].returnType==="Integer"?b.push(`  gl_FragData[${c+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[c].name}))`):b.push(`  gl_FragData[${c+1}] = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[c].name})`);return f.linesToString(b)}getMainResultMemoryOptimizedFloats(){let b=["  index *= 4"];switch(this.returnType){case"Number":case"Integer":case"Float":let c=["r","g","b","a"];for(let C=0;C<c.length;C++){let F=c[C];this.getMainResultKernelMemoryOptimizedFloats(b,F),this.getMainResultSubKernelMemoryOptimizedFloats(b,F),C+1<c.length&&b.push("  index += 1")}break;default:throw new Error(`optimized output only usable with Numbers, ${this.returnType} specified`)}return f.linesToString(b)}getMainResultKernelMemoryOptimizedFloats(b,c){b.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  gl_FragData[0].${c} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(b,c){if(!this.subKernels)return b;for(let C=0;C<this.subKernels.length;C++)this.subKernels[C].returnType==="Integer"?b.push(`  gl_FragData[${C+1}].${c} = float(subKernelResult_${this.subKernels[C].name})`):b.push(`  gl_FragData[${C+1}].${c} = subKernelResult_${this.subKernels[C].name}`)}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult"]}getMainResultSubKernelNumberTexture(){let b=[];if(!this.subKernels)return b;for(let c=0;c<this.subKernels.length;++c){let C=this.subKernels[c];C.returnType==="Integer"?b.push(`  gl_FragData[${c+1}][0] = float(subKernelResult_${C.name})`):b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${C.name}`)}return b}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){let b=[];if(!this.subKernels)return b;for(let c=0;c<this.subKernels.length;++c)b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${this.subKernels[c].name}[0]`,`  gl_FragData[${c+1}][1] = subKernelResult_${this.subKernels[c].name}[1]`);return b}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0][0] = kernelResult[0]","  gl_FragData[0][1] = kernelResult[1]","  gl_FragData[0][2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){let b=[];if(!this.subKernels)return b;for(let c=0;c<this.subKernels.length;++c)b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${this.subKernels[c].name}[0]`,`  gl_FragData[${c+1}][1] = subKernelResult_${this.subKernels[c].name}[1]`,`  gl_FragData[${c+1}][2] = subKernelResult_${this.subKernels[c].name}[2]`);return b}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragData[0] = kernelResult"]}getMainResultSubKernelArray4Texture(){let b=[];if(!this.subKernels)return b;switch(this.returnType){case"Number":case"Float":case"Integer":for(let c=0;c<this.subKernels.length;++c)this.subKernels[c].returnType==="Integer"?b.push(`  gl_FragData[${c+1}] = float(subKernelResult_${this.subKernels[c].name})`):b.push(`  gl_FragData[${c+1}] = subKernelResult_${this.subKernels[c].name}`);break;case"Array(2)":for(let c=0;c<this.subKernels.length;++c)b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${this.subKernels[c].name}[0]`,`  gl_FragData[${c+1}][1] = subKernelResult_${this.subKernels[c].name}[1]`);break;case"Array(3)":for(let c=0;c<this.subKernels.length;++c)b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${this.subKernels[c].name}[0]`,`  gl_FragData[${c+1}][1] = subKernelResult_${this.subKernels[c].name}[1]`,`  gl_FragData[${c+1}][2] = subKernelResult_${this.subKernels[c].name}[2]`);break;case"Array(4)":for(let c=0;c<this.subKernels.length;++c)b.push(`  gl_FragData[${c+1}][0] = subKernelResult_${this.subKernels[c].name}[0]`,`  gl_FragData[${c+1}][1] = subKernelResult_${this.subKernels[c].name}[1]`,`  gl_FragData[${c+1}][2] = subKernelResult_${this.subKernels[c].name}[2]`,`  gl_FragData[${c+1}][3] = subKernelResult_${this.subKernels[c].name}[3]`);break}return b}replaceArtifacts(b,c){return b.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z]*[0-9]?)*)__;\\n/g,(C,F)=>{if(c.hasOwnProperty(F))return c[F];throw`unhandled artifact ${F}`})}getFragmentShader(b){return this.compiledFragmentShader!==null?this.compiledFragmentShader:this.compiledFragmentShader=this.replaceArtifacts(this.constructor.fragmentShader,this._getFragShaderArtifactMap(b))}getVertexShader(b){return this.compiledVertexShader!==null?this.compiledVertexShader:this.compiledVertexShader=this.replaceArtifacts(this.constructor.vertexShader,this._getVertShaderArtifactMap(b))}toString(){let b=f.linesToString(["const gl = context"]);return n(this.constructor,arguments,this,b)}destroy(b){if(!this.context)return;this.buffer&&this.context.deleteBuffer(this.buffer),this.framebuffer&&this.context.deleteFramebuffer(this.framebuffer);for(let C in this.rawValueFramebuffers){for(let F in this.rawValueFramebuffers[C])this.context.deleteFramebuffer(this.rawValueFramebuffers[C][F]),delete this.rawValueFramebuffers[C][F];delete this.rawValueFramebuffers[C]}if(this.vertShader&&this.context.deleteShader(this.vertShader),this.fragShader&&this.context.deleteShader(this.fragShader),this.program&&this.context.deleteProgram(this.program),this.texture){this.texture.delete();let C=this.textureCache.indexOf(this.texture.texture);C>-1&&this.textureCache.splice(C,1),this.texture=null}if(this.mappedTextures&&this.mappedTextures.length){for(let C=0;C<this.mappedTextures.length;C++){let F=this.mappedTextures[C];F.delete();let P=this.textureCache.indexOf(F.texture);P>-1&&this.textureCache.splice(P,1)}this.mappedTextures=null}if(this.kernelArguments)for(let C=0;C<this.kernelArguments.length;C++)this.kernelArguments[C].destroy();if(this.kernelConstants)for(let C=0;C<this.kernelConstants.length;C++)this.kernelConstants[C].destroy();for(;this.textureCache.length>0;){let C=this.textureCache.pop();this.context.deleteTexture(C)}if(b){let C=_.indexOf(this.canvas);C>=0&&(_[C]=null,w[C]=null)}if(this.destroyExtensions(),delete this.context,delete this.canvas,!this.gpu)return;let c=this.gpu.kernels.indexOf(this);c!==-1&&this.gpu.kernels.splice(c,1)}destroyExtensions(){this.extensions.OES_texture_float=null,this.extensions.OES_texture_float_linear=null,this.extensions.OES_element_index_uint=null,this.extensions.WEBGL_draw_buffers=null}static destroyContext(b){let c=b.getExtension("WEBGL_lose_context");c&&c.loseContext()}toJSON(){let b=super.toJSON();return b.functionNodes=p.fromKernel(this,d).toJSON(),b.settings.threadDim=this.threadDim,b}}o.exports={WebGLKernel:L}},{"../../plugins/math-random-uniformly-distributed":112,"../../utils":114,"../function-builder":9,"../gl/kernel":13,"../gl/kernel-string":12,"./fragment-shader":37,"./function-node":38,"./kernel-value-maps":39,"./vertex-shader":71}],71:[function(i,o,m){let u=`__FLOAT_TACTIC_DECLARATION__;\n      __INT_TACTIC_DECLARATION__;\n      __SAMPLER_2D_TACTIC_DECLARATION__;\n      \n      attribute vec2 aPos;\n      attribute vec2 aTexCoord;\n      \n      varying vec2 vTexCoord;\n      uniform vec2 ratio;\n      \n      void main(void) {\n        gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n        vTexCoord = aTexCoord;\n      }`;o.exports={vertexShader:u}},{}],72:[function(i,o,m){let u=`#version 300 es\n      __HEADER__;\n      __FLOAT_TACTIC_DECLARATION__;\n      __INT_TACTIC_DECLARATION__;\n      __SAMPLER_2D_TACTIC_DECLARATION__;\n      __SAMPLER_2D_ARRAY_TACTIC_DECLARATION__;\n      \n      const int LOOP_MAX = __LOOP_MAX__;\n      \n      __PLUGINS__;\n      __CONSTANTS__;\n      \n      in vec2 vTexCoord;\n      \n      float atan2(float v1, float v2) {\n        if (v1 == 0.0 || v2 == 0.0) return 0.0;\n        return atan(v1 / v2);\n      }\n      \n      float cbrt(float x) {\n        if (x >= 0.0) {\n          return pow(x, 1.0 / 3.0);\n        } else {\n          return -pow(x, 1.0 / 3.0);\n        }\n      }\n      \n      float expm1(float x) {\n        return pow(${Math.E}, x) - 1.0; \n      }\n      \n      float fround(highp float x) {\n        return x;\n      }\n      \n      float imul(float v1, float v2) {\n        return float(int(v1) * int(v2));\n      }\n      \n      float log10(float x) {\n        return log2(x) * (1.0 / log2(10.0));\n      }\n      \n      float log1p(float x) {\n        return log(1.0 + x);\n      }\n      \n      float _pow(float v1, float v2) {\n        if (v2 == 0.0) return 1.0;\n        return pow(v1, v2);\n      }\n      \n      float _round(float x) {\n        return floor(x + 0.5);\n      }\n      \n      \n      const int BIT_COUNT = 32;\n      int modi(int x, int y) {\n        return x - y * (x / y);\n      }\n      \n      int bitwiseOr(int a, int b) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 || b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseXOR(int a, int b) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 || b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseAnd(int a, int b) {\n        int result = 0;\n        int n = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n            result += n;\n          }\n          a = a / 2;\n          b = b / 2;\n          n = n * 2;\n          if(!(a > 0 && b > 0)) {\n            break;\n          }\n        }\n        return result;\n      }\n      int bitwiseNot(int a) {\n        int result = 0;\n        int n = 1;\n        \n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (modi(a, 2) == 0) {\n            result += n;    \n          }\n          a = a / 2;\n          n = n * 2;\n        }\n        return result;\n      }\n      int bitwiseZeroFillLeftShift(int n, int shift) {\n        int maxBytes = BIT_COUNT;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (maxBytes >= n) {\n            break;\n          }\n          maxBytes *= 2;\n        }\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= shift) {\n            break;\n          }\n          n *= 2;\n        }\n      \n        int result = 0;\n        int byteVal = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= maxBytes) break;\n          if (modi(n, 2) > 0) { result += byteVal; }\n          n = int(n / 2);\n          byteVal *= 2;\n        }\n        return result;\n      }\n      \n      int bitwiseSignedRightShift(int num, int shifts) {\n        return int(floor(float(num) / pow(2.0, float(shifts))));\n      }\n      \n      int bitwiseZeroFillRightShift(int n, int shift) {\n        int maxBytes = BIT_COUNT;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (maxBytes >= n) {\n            break;\n          }\n          maxBytes *= 2;\n        }\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= shift) {\n            break;\n          }\n          n /= 2;\n        }\n        int result = 0;\n        int byteVal = 1;\n        for (int i = 0; i < BIT_COUNT; i++) {\n          if (i >= maxBytes) break;\n          if (modi(n, 2) > 0) { result += byteVal; }\n          n = int(n / 2);\n          byteVal *= 2;\n        }\n        return result;\n      }\n      \n      vec2 integerMod(vec2 x, float y) {\n        vec2 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      vec3 integerMod(vec3 x, float y) {\n        vec3 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      vec4 integerMod(vec4 x, vec4 y) {\n        vec4 res = floor(mod(x, y));\n        return res * step(1.0 - floor(y), -res);\n      }\n      \n      float integerMod(float x, float y) {\n        float res = floor(mod(x, y));\n        return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n      }\n      \n      int integerMod(int x, int y) {\n        return x - (y * int(x/y));\n      }\n      \n      __DIVIDE_WITH_INTEGER_CHECK__;\n      \n      // Here be dragons!\n      // DO NOT OPTIMIZE THIS CODE\n      // YOU WILL BREAK SOMETHING ON SOMEBODY\'S MACHINE\n      // LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\n      const vec2 MAGIC_VEC = vec2(1.0, -256.0);\n      const vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\n      const vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\n      float decode32(vec4 texel) {\n        __DECODE32_ENDIANNESS__;\n        texel *= 255.0;\n        vec2 gte128;\n        gte128.x = texel.b >= 128.0 ? 1.0 : 0.0;\n        gte128.y = texel.a >= 128.0 ? 1.0 : 0.0;\n        float exponent = 2.0 * texel.a - 127.0 + dot(gte128, MAGIC_VEC);\n        float res = exp2(round(exponent));\n        texel.b = texel.b - 128.0 * gte128.x;\n        res = dot(texel, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n        res *= gte128.y * -2.0 + 1.0;\n        return res;\n      }\n      \n      float decode16(vec4 texel, int index) {\n        int channel = integerMod(index, 2);\n        return texel[channel*2] * 255.0 + texel[channel*2 + 1] * 65280.0;\n      }\n      \n      float decode8(vec4 texel, int index) {\n        int channel = integerMod(index, 4);\n        return texel[channel] * 255.0;\n      }\n      \n      vec4 legacyEncode32(float f) {\n        float F = abs(f);\n        float sign = f < 0.0 ? 1.0 : 0.0;\n        float exponent = floor(log2(F));\n        float mantissa = (exp2(-exponent) * F);\n        // exponent += floor(log2(mantissa));\n        vec4 texel = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n        texel.rg = integerMod(texel.rg, 256.0);\n        texel.b = integerMod(texel.b, 128.0);\n        texel.a = exponent*0.5 + 63.5;\n        texel.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n        texel = floor(texel);\n        texel *= 0.003921569; // 1/255\n        __ENCODE32_ENDIANNESS__;\n        return texel;\n      }\n      \n      // https://github.com/gpujs/gpu.js/wiki/Encoder-details\n      vec4 encode32(float value) {\n        if (value == 0.0) return vec4(0, 0, 0, 0);\n      \n        float exponent;\n        float mantissa;\n        vec4  result;\n        float sgn;\n      \n        sgn = step(0.0, -value);\n        value = abs(value);\n      \n        exponent = floor(log2(value));\n      \n        mantissa = value*pow(2.0, -exponent)-1.0;\n        exponent = exponent+127.0;\n        result   = vec4(0,0,0,0);\n      \n        result.a = floor(exponent/2.0);\n        exponent = exponent - result.a*2.0;\n        result.a = result.a + 128.0*sgn;\n      \n        result.b = floor(mantissa * 128.0);\n        mantissa = mantissa - result.b / 128.0;\n        result.b = result.b + exponent*128.0;\n      \n        result.g = floor(mantissa*32768.0);\n        mantissa = mantissa - result.g/32768.0;\n      \n        result.r = floor(mantissa*8388608.0);\n        return result/255.0;\n      }\n      // Dragons end here\n      \n      int index;\n      ivec3 threadId;\n      \n      ivec3 indexTo3D(int idx, ivec3 texDim) {\n        int z = int(idx / (texDim.x * texDim.y));\n        idx -= z * int(texDim.x * texDim.y);\n        int y = int(idx / texDim.x);\n        int x = int(integerMod(idx, texDim.x));\n        return ivec3(x, y, z);\n      }\n      \n      float get32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture(tex, st / vec2(texSize));\n        return decode32(texel);\n      }\n      \n      float get16(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + (texDim.x * (y + (texDim.y * z)));\n        int w = texSize.x * 2;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture(tex, st / vec2(texSize.x * 2, texSize.y));\n        return decode16(texel, index);\n      }\n      \n      float get8(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + (texDim.x * (y + (texDim.y * z)));\n        int w = texSize.x * 4;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture(tex, st / vec2(texSize.x * 4, texSize.y));\n        return decode8(texel, index);\n      }\n      \n      float getMemoryOptimized32(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + (texDim.x * (y + (texDim.y * z)));\n        int channel = integerMod(index, 4);\n        index = index / 4;\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        index = index / 4;\n        vec4 texel = texture(tex, st / vec2(texSize));\n        return texel[channel];\n      }\n      \n      vec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        return texture(tex, st / vec2(texSize));\n      }\n      \n      vec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        return texture(tex, vec3(st / vec2(texSize), z));\n      }\n      \n      float getFloatFromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return result[0];\n      }\n      \n      vec2 getVec2FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return vec2(result[0], result[1]);\n      }\n      \n      vec2 getMemoryOptimizedVec2(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int channel = integerMod(index, 2);\n        index = index / 2;\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture(tex, st / vec2(texSize));\n        if (channel == 0) return vec2(texel.r, texel.g);\n        if (channel == 1) return vec2(texel.b, texel.a);\n        return vec2(0.0, 0.0);\n      }\n      \n      vec3 getVec3FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        vec4 result = getImage2D(tex, texSize, texDim, z, y, x);\n        return vec3(result[0], result[1], result[2]);\n      }\n      \n      vec3 getMemoryOptimizedVec3(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int fieldIndex = 3 * (x + texDim.x * (y + texDim.y * z));\n        int vectorIndex = fieldIndex / 4;\n        int vectorOffset = fieldIndex - vectorIndex * 4;\n        int readY = vectorIndex / texSize.x;\n        int readX = vectorIndex - readY * texSize.x;\n        vec4 tex1 = texture(tex, (vec2(readX, readY) + 0.5) / vec2(texSize));\n      \n        if (vectorOffset == 0) {\n          return tex1.xyz;\n        } else if (vectorOffset == 1) {\n          return tex1.yzw;\n        } else {\n          readX++;\n          if (readX >= texSize.x) {\n            readX = 0;\n            readY++;\n          }\n          vec4 tex2 = texture(tex, vec2(readX, readY) / vec2(texSize));\n          if (vectorOffset == 2) {\n            return vec3(tex1.z, tex1.w, tex2.x);\n          } else {\n            return vec3(tex1.w, tex2.x, tex2.y);\n          }\n        }\n      }\n      \n      vec4 getVec4FromSampler2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        return getImage2D(tex, texSize, texDim, z, y, x);\n      }\n      \n      vec4 getMemoryOptimizedVec4(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n        int index = x + texDim.x * (y + texDim.y * z);\n        int channel = integerMod(index, 2);\n        int w = texSize.x;\n        vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n        vec4 texel = texture(tex, st / vec2(texSize));\n        return vec4(texel.r, texel.g, texel.b, texel.a);\n      }\n      \n      vec4 actualColor;\n      void color(float r, float g, float b, float a) {\n        actualColor = vec4(r,g,b,a);\n      }\n      \n      void color(float r, float g, float b) {\n        color(r,g,b,1.0);\n      }\n      \n      float modulo(float number, float divisor) {\n        if (number < 0.0) {\n          number = abs(number);\n          if (divisor < 0.0) {\n            divisor = abs(divisor);\n          }\n          return -mod(number, divisor);\n        }\n        if (divisor < 0.0) {\n          divisor = abs(divisor);\n        }\n        return mod(number, divisor);\n      }\n      \n      __INJECTED_NATIVE__;\n      __MAIN_CONSTANTS__;\n      __MAIN_ARGUMENTS__;\n      __KERNEL__;\n      \n      void main(void) {\n        index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n        __MAIN_RESULT__;\n      }`;o.exports={fragmentShader:u}},{}],73:[function(i,o,m){let{utils:u}=i("../../utils"),{WebGLFunctionNode:p}=i("../web-gl/function-node");class d extends p{astIdentifierExpression(r,a){if(r.type!=="Identifier")throw this.astErrorOutput("IdentifierExpression - not an Identifier",r);let t=this.getType(r),n=u.sanitizeName(r.name);return r.name==="Infinity"?a.push("intBitsToFloat(2139095039)"):t==="Boolean"?this.argumentNames.indexOf(n)>-1?a.push(`bool(user_${n})`):a.push(`user_${n}`):a.push(`user_${n}`),a}}o.exports={WebGL2FunctionNode:d}},{"../../utils":114,"../web-gl/function-node":38}],74:[function(i,o,m){let{WebGL2KernelValueBoolean:u}=i("./kernel-value/boolean"),{WebGL2KernelValueFloat:p}=i("./kernel-value/float"),{WebGL2KernelValueInteger:d}=i("./kernel-value/integer"),{WebGL2KernelValueHTMLImage:f}=i("./kernel-value/html-image"),{WebGL2KernelValueDynamicHTMLImage:r}=i("./kernel-value/dynamic-html-image"),{WebGL2KernelValueHTMLImageArray:a}=i("./kernel-value/html-image-array"),{WebGL2KernelValueDynamicHTMLImageArray:t}=i("./kernel-value/dynamic-html-image-array"),{WebGL2KernelValueHTMLVideo:n}=i("./kernel-value/html-video"),{WebGL2KernelValueDynamicHTMLVideo:g}=i("./kernel-value/dynamic-html-video"),{WebGL2KernelValueSingleInput:v}=i("./kernel-value/single-input"),{WebGL2KernelValueDynamicSingleInput:k}=i("./kernel-value/dynamic-single-input"),{WebGL2KernelValueUnsignedInput:T}=i("./kernel-value/unsigned-input"),{WebGL2KernelValueDynamicUnsignedInput:A}=i("./kernel-value/dynamic-unsigned-input"),{WebGL2KernelValueMemoryOptimizedNumberTexture:E}=i("./kernel-value/memory-optimized-number-texture"),{WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:y}=i("./kernel-value/dynamic-memory-optimized-number-texture"),{WebGL2KernelValueNumberTexture:_}=i("./kernel-value/number-texture"),{WebGL2KernelValueDynamicNumberTexture:w}=i("./kernel-value/dynamic-number-texture"),{WebGL2KernelValueSingleArray:L}=i("./kernel-value/single-array"),{WebGL2KernelValueDynamicSingleArray:N}=i("./kernel-value/dynamic-single-array"),{WebGL2KernelValueSingleArray1DI:b}=i("./kernel-value/single-array1d-i"),{WebGL2KernelValueDynamicSingleArray1DI:c}=i("./kernel-value/dynamic-single-array1d-i"),{WebGL2KernelValueSingleArray2DI:C}=i("./kernel-value/single-array2d-i"),{WebGL2KernelValueDynamicSingleArray2DI:F}=i("./kernel-value/dynamic-single-array2d-i"),{WebGL2KernelValueSingleArray3DI:P}=i("./kernel-value/single-array3d-i"),{WebGL2KernelValueDynamicSingleArray3DI:M}=i("./kernel-value/dynamic-single-array3d-i"),{WebGL2KernelValueSingleArray2:$}=i("./kernel-value/single-array2"),{WebGL2KernelValueSingleArray3:G}=i("./kernel-value/single-array3"),{WebGL2KernelValueSingleArray4:O}=i("./kernel-value/single-array4"),{WebGL2KernelValueUnsignedArray:Y}=i("./kernel-value/unsigned-array"),{WebGL2KernelValueDynamicUnsignedArray:W}=i("./kernel-value/dynamic-unsigned-array"),K={unsigned:{dynamic:{Boolean:u,Integer:d,Float:p,Array:W,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:A,NumberTexture:w,"ArrayTexture(1)":w,"ArrayTexture(2)":w,"ArrayTexture(3)":w,"ArrayTexture(4)":w,MemoryOptimizedNumberTexture:y,HTMLCanvas:r,HTMLImage:r,HTMLImageArray:t,HTMLVideo:g},static:{Boolean:u,Float:p,Integer:d,Array:Y,"Array(2)":!1,"Array(3)":!1,"Array(4)":!1,"Array1D(2)":!1,"Array1D(3)":!1,"Array1D(4)":!1,"Array2D(2)":!1,"Array2D(3)":!1,"Array2D(4)":!1,"Array3D(2)":!1,"Array3D(3)":!1,"Array3D(4)":!1,Input:T,NumberTexture:_,"ArrayTexture(1)":_,"ArrayTexture(2)":_,"ArrayTexture(3)":_,"ArrayTexture(4)":_,MemoryOptimizedNumberTexture:y,HTMLCanvas:f,HTMLImage:f,HTMLImageArray:a,HTMLVideo:n}},single:{dynamic:{Boolean:u,Integer:d,Float:p,Array:N,"Array(2)":$,"Array(3)":G,"Array(4)":O,"Array1D(2)":c,"Array1D(3)":c,"Array1D(4)":c,"Array2D(2)":F,"Array2D(3)":F,"Array2D(4)":F,"Array3D(2)":M,"Array3D(3)":M,"Array3D(4)":M,Input:k,NumberTexture:w,"ArrayTexture(1)":w,"ArrayTexture(2)":w,"ArrayTexture(3)":w,"ArrayTexture(4)":w,MemoryOptimizedNumberTexture:y,HTMLCanvas:r,HTMLImage:r,HTMLImageArray:t,HTMLVideo:g},static:{Boolean:u,Float:p,Integer:d,Array:L,"Array(2)":$,"Array(3)":G,"Array(4)":O,"Array1D(2)":b,"Array1D(3)":b,"Array1D(4)":b,"Array2D(2)":C,"Array2D(3)":C,"Array2D(4)":C,"Array3D(2)":P,"Array3D(3)":P,"Array3D(4)":P,Input:v,NumberTexture:_,"ArrayTexture(1)":_,"ArrayTexture(2)":_,"ArrayTexture(3)":_,"ArrayTexture(4)":_,MemoryOptimizedNumberTexture:E,HTMLCanvas:f,HTMLImage:f,HTMLImageArray:a,HTMLVideo:n}}};function J(Q,te,H,B){if(!Q)throw new Error("type missing");if(!te)throw new Error("dynamic missing");if(!H)throw new Error("precision missing");B.type&&(Q=B.type);let he=K[H][te];if(he[Q]===!1)return null;if(he[Q]===void 0)throw new Error(`Could not find a KernelValue for ${Q}`);return he[Q]}o.exports={kernelValueMaps:K,lookupKernelValueType:J}},{"./kernel-value/boolean":75,"./kernel-value/dynamic-html-image":77,"./kernel-value/dynamic-html-image-array":76,"./kernel-value/dynamic-html-video":78,"./kernel-value/dynamic-memory-optimized-number-texture":79,"./kernel-value/dynamic-number-texture":80,"./kernel-value/dynamic-single-array":81,"./kernel-value/dynamic-single-array1d-i":82,"./kernel-value/dynamic-single-array2d-i":83,"./kernel-value/dynamic-single-array3d-i":84,"./kernel-value/dynamic-single-input":85,"./kernel-value/dynamic-unsigned-array":86,"./kernel-value/dynamic-unsigned-input":87,"./kernel-value/float":88,"./kernel-value/html-image":90,"./kernel-value/html-image-array":89,"./kernel-value/html-video":91,"./kernel-value/integer":92,"./kernel-value/memory-optimized-number-texture":93,"./kernel-value/number-texture":94,"./kernel-value/single-array":95,"./kernel-value/single-array1d-i":96,"./kernel-value/single-array2":97,"./kernel-value/single-array2d-i":98,"./kernel-value/single-array3":99,"./kernel-value/single-array3d-i":100,"./kernel-value/single-array4":101,"./kernel-value/single-input":102,"./kernel-value/unsigned-array":103,"./kernel-value/unsigned-input":104}],75:[function(i,o,m){let{WebGLKernelValueBoolean:u}=i("../../web-gl/kernel-value/boolean");class p extends u{}o.exports={WebGL2KernelValueBoolean:p}},{"../../web-gl/kernel-value/boolean":41}],76:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueHTMLImageArray:p}=i("./html-image-array");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2DArray ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){let{width:a,height:t}=r[0];this.checkSize(a,t),this.dimensions=[a,t,r.length],this.textureSize=[a,t],this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicHTMLImageArray:d}},{"../../../utils":114,"./html-image-array":89}],77:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueDynamicHTMLImage:p}=i("../../web-gl/kernel-value/dynamic-html-image");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}}o.exports={WebGL2KernelValueDynamicHTMLImage:d}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-html-image":42}],78:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueDynamicHTMLImage:p}=i("./dynamic-html-image");class d extends p{}o.exports={WebGL2KernelValueDynamicHTMLVideo:d}},{"../../../utils":114,"./dynamic-html-image":77}],79:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueDynamicMemoryOptimizedNumberTexture:p}=i("../../web-gl/kernel-value/dynamic-memory-optimized-number-texture");class d extends p{getSource(){return u.linesToString([`uniform sampler2D ${this.id}`,`uniform ivec2 ${this.sizeId}`,`uniform ivec3 ${this.dimensionsId}`])}}o.exports={WebGL2KernelValueDynamicMemoryOptimizedNumberTexture:d}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-memory-optimized-number-texture":44}],80:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueDynamicNumberTexture:p}=i("../../web-gl/kernel-value/dynamic-number-texture");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}}o.exports={WebGL2KernelValueDynamicNumberTexture:d}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-number-texture":45}],81:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueSingleArray:p}=i("../../web-gl2/kernel-value/single-array");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){this.dimensions=u.getDimensions(r,!0),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicSingleArray:d}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array":95}],82:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueSingleArray1DI:p}=i("../../web-gl2/kernel-value/single-array1d-i");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicSingleArray1DI:d}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array1d-i":96}],83:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueSingleArray2DI:p}=i("../../web-gl2/kernel-value/single-array2d-i");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicSingleArray2DI:d}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array2d-i":98}],84:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueSingleArray3DI:p}=i("../../web-gl2/kernel-value/single-array3d-i");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){this.setShape(r),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicSingleArray3DI:d}},{"../../../utils":114,"../../web-gl2/kernel-value/single-array3d-i":100}],85:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueSingleInput:p}=i("../../web-gl2/kernel-value/single-input");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}updateValue(r){let[a,t,n]=r.size;this.dimensions=new Int32Array([a||1,t||1,n||1]),this.textureSize=u.getMemoryOptimizedFloatTextureSize(this.dimensions,this.bitRatio),this.uploadArrayLength=this.textureSize[0]*this.textureSize[1]*this.bitRatio,this.checkSize(this.textureSize[0],this.textureSize[1]),this.uploadValue=new Float32Array(this.uploadArrayLength),this.kernel.setUniform3iv(this.dimensionsId,this.dimensions),this.kernel.setUniform2iv(this.sizeId,this.textureSize),super.updateValue(r)}}o.exports={WebGL2KernelValueDynamicSingleInput:d}},{"../../../utils":114,"../../web-gl2/kernel-value/single-input":102}],86:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueDynamicUnsignedArray:p}=i("../../web-gl/kernel-value/dynamic-unsigned-array");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}}o.exports={WebGL2KernelValueDynamicUnsignedArray:d}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-array":51}],87:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueDynamicUnsignedInput:p}=i("../../web-gl/kernel-value/dynamic-unsigned-input");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`uniform ${r} ivec2 ${this.sizeId}`,`uniform ${r} ivec3 ${this.dimensionsId}`])}}o.exports={WebGL2KernelValueDynamicUnsignedInput:d}},{"../../../utils":114,"../../web-gl/kernel-value/dynamic-unsigned-input":52}],88:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueFloat:p}=i("../../web-gl/kernel-value/float");class d extends p{}o.exports={WebGL2KernelValueFloat:d}},{"../../../utils":114,"../../web-gl/kernel-value/float":53}],89:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelArray:p}=i("../../web-gl/kernel-value/array");class d extends p{constructor(r,a){super(r,a),this.checkSize(r[0].width,r[0].height),this.dimensions=[r[0].width,r[0].height,r.length],this.textureSize=[r[0].width,r[0].height]}defineTexture(){let{context:r}=this;r.activeTexture(this.contextHandle),r.bindTexture(r.TEXTURE_2D_ARRAY,this.texture),r.texParameteri(r.TEXTURE_2D_ARRAY,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D_ARRAY,r.TEXTURE_MIN_FILTER,r.NEAREST)}getStringValueHandler(){return`const uploadValue_${this.name} = ${this.varName};\n`}getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2DArray ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){let{context:a}=this;a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D_ARRAY,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage3D(a.TEXTURE_2D_ARRAY,0,a.RGBA,r[0].width,r[0].height,r.length,0,a.RGBA,a.UNSIGNED_BYTE,null);for(let t=0;t<r.length;t++)a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,t,r[t].width,r[t].height,1,a.RGBA,a.UNSIGNED_BYTE,this.uploadValue=r[t]);this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueHTMLImageArray:d}},{"../../../utils":114,"../../web-gl/kernel-value/array":40}],90:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueHTMLImage:p}=i("../../web-gl/kernel-value/html-image");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}o.exports={WebGL2KernelValueHTMLImage:d}},{"../../../utils":114,"../../web-gl/kernel-value/html-image":54}],91:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGL2KernelValueHTMLImage:p}=i("./html-image");class d extends p{}o.exports={WebGL2KernelValueHTMLVideo:d}},{"../../../utils":114,"./html-image":90}],92:[function(i,o,m){let{WebGLKernelValueInteger:u}=i("../../web-gl/kernel-value/integer");class p extends u{getSource(f){let r=this.getVariablePrecisionString();return this.origin==="constants"?`const ${r} int ${this.id} = ${parseInt(f)};\n`:`uniform ${r} int ${this.id};\n`}updateValue(f){this.origin!=="constants"&&this.kernel.setUniform1i(this.id,this.uploadValue=f)}}o.exports={WebGL2KernelValueInteger:p}},{"../../web-gl/kernel-value/integer":57}],93:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueMemoryOptimizedNumberTexture:p}=i("../../web-gl/kernel-value/memory-optimized-number-texture");class d extends p{getSource(){let{id:r,sizeId:a,textureSize:t,dimensionsId:n,dimensions:g}=this,v=this.getVariablePrecisionString();return u.linesToString([`uniform sampler2D ${r}`,`${v} ivec2 ${a} = ivec2(${t[0]}, ${t[1]})`,`${v} ivec3 ${n} = ivec3(${g[0]}, ${g[1]}, ${g[2]})`])}}o.exports={WebGL2KernelValueMemoryOptimizedNumberTexture:d}},{"../../../utils":114,"../../web-gl/kernel-value/memory-optimized-number-texture":58}],94:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueNumberTexture:p}=i("../../web-gl/kernel-value/number-texture");class d extends p{getSource(){let{id:r,sizeId:a,textureSize:t,dimensionsId:n,dimensions:g}=this,v=this.getVariablePrecisionString();return u.linesToString([`uniform ${v} sampler2D ${r}`,`${v} ivec2 ${a} = ivec2(${t[0]}, ${t[1]})`,`${v} ivec3 ${n} = ivec3(${g[0]}, ${g[1]}, ${g[2]})`])}}o.exports={WebGL2KernelValueNumberTexture:d}},{"../../../utils":114,"../../web-gl/kernel-value/number-texture":59}],95:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray:p}=i("../../web-gl/kernel-value/single-array");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA32F,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueSingleArray:d}},{"../../../utils":114,"../../web-gl/kernel-value/single-array":60}],96:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray1DI:p}=i("../../web-gl/kernel-value/single-array1d-i");class d extends p{updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA32F,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueSingleArray1DI:d}},{"../../../utils":114,"../../web-gl/kernel-value/single-array1d-i":61}],97:[function(i,o,m){let{WebGLKernelValueSingleArray2:u}=i("../../web-gl/kernel-value/single-array2");class p extends u{}o.exports={WebGL2KernelValueSingleArray2:p}},{"../../web-gl/kernel-value/single-array2":62}],98:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray2DI:p}=i("../../web-gl/kernel-value/single-array2d-i");class d extends p{updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA32F,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueSingleArray2DI:d}},{"../../../utils":114,"../../web-gl/kernel-value/single-array2d-i":63}],99:[function(i,o,m){let{WebGLKernelValueSingleArray3:u}=i("../../web-gl/kernel-value/single-array3");class p extends u{}o.exports={WebGL2KernelValueSingleArray3:p}},{"../../web-gl/kernel-value/single-array3":64}],100:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleArray3DI:p}=i("../../web-gl/kernel-value/single-array3d-i");class d extends p{updateValue(r){if(r.constructor!==this.initialValueConstructor){this.onUpdateValueMismatch(r.constructor);return}let{context:a}=this;u.flattenTo(r,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA32F,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueSingleArray3DI:d}},{"../../../utils":114,"../../web-gl/kernel-value/single-array3d-i":65}],101:[function(i,o,m){let{WebGLKernelValueSingleArray4:u}=i("../../web-gl/kernel-value/single-array4");class p extends u{}o.exports={WebGL2KernelValueSingleArray4:p}},{"../../web-gl/kernel-value/single-array4":66}],102:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueSingleInput:p}=i("../../web-gl/kernel-value/single-input");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}updateValue(r){let{context:a}=this;u.flattenTo(r.value,this.uploadValue),a.activeTexture(this.contextHandle),a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA32F,this.textureSize[0],this.textureSize[1],0,a.RGBA,a.FLOAT,this.uploadValue),this.kernel.setUniform1i(this.id,this.index)}}o.exports={WebGL2KernelValueSingleInput:d}},{"../../../utils":114,"../../web-gl/kernel-value/single-input":67}],103:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueUnsignedArray:p}=i("../../web-gl/kernel-value/unsigned-array");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}o.exports={WebGL2KernelValueUnsignedArray:d}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-array":68}],104:[function(i,o,m){let{utils:u}=i("../../../utils"),{WebGLKernelValueUnsignedInput:p}=i("../../web-gl/kernel-value/unsigned-input");class d extends p{getSource(){let r=this.getVariablePrecisionString();return u.linesToString([`uniform ${r} sampler2D ${this.id}`,`${r} ivec2 ${this.sizeId} = ivec2(${this.textureSize[0]}, ${this.textureSize[1]})`,`${r} ivec3 ${this.dimensionsId} = ivec3(${this.dimensions[0]}, ${this.dimensions[1]}, ${this.dimensions[2]})`])}}o.exports={WebGL2KernelValueUnsignedInput:d}},{"../../../utils":114,"../../web-gl/kernel-value/unsigned-input":69}],105:[function(i,o,m){let{WebGLKernel:u}=i("../web-gl/kernel"),{WebGL2FunctionNode:p}=i("./function-node"),{FunctionBuilder:d}=i("../function-builder"),{utils:f}=i("../../utils"),{fragmentShader:r}=i("./fragment-shader"),{vertexShader:a}=i("./vertex-shader"),{lookupKernelValueType:t}=i("./kernel-value-maps"),n=null,g=null,v=null,k=null,T=null;class A extends u{static get isSupported(){return n!==null||(this.setupFeatureChecks(),n=this.isContextMatch(v)),n}static setupFeatureChecks(){typeof document<"u"?g=document.createElement("canvas"):typeof OffscreenCanvas<"u"&&(g=new OffscreenCanvas(0,0)),g&&(v=g.getContext("webgl2"),!(!v||!v.getExtension)&&(k={EXT_color_buffer_float:v.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:v.getExtension("OES_texture_float_linear")},T=this.getFeatures()))}static isContextMatch(y){return typeof WebGL2RenderingContext<"u"?y instanceof WebGL2RenderingContext:!1}static getFeatures(){let y=this.testContext;return Object.freeze({isFloatRead:this.getIsFloatRead(),isIntegerDivisionAccurate:this.getIsIntegerDivisionAccurate(),isSpeedTacticSupported:this.getIsSpeedTacticSupported(),kernelMap:!0,isTextureFloat:!0,isDrawBuffers:!0,channelCount:this.getChannelCount(),maxTextureSize:this.getMaxTextureSize(),lowIntPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.LOW_INT),lowFloatPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.LOW_FLOAT),mediumIntPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_INT),mediumFloatPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.MEDIUM_FLOAT),highIntPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_INT),highFloatPrecision:y.getShaderPrecisionFormat(y.FRAGMENT_SHADER,y.HIGH_FLOAT)})}static getIsTextureFloat(){return!0}static getChannelCount(){return v.getParameter(v.MAX_DRAW_BUFFERS)}static getMaxTextureSize(){return v.getParameter(v.MAX_TEXTURE_SIZE)}static lookupKernelValueType(y,_,w,L){return t(y,_,w,L)}static get testCanvas(){return g}static get testContext(){return v}static get features(){return T}static get fragmentShader(){return r}static get vertexShader(){return a}initContext(){let y={alpha:!1,depth:!1,antialias:!1};return this.canvas.getContext("webgl2",y)}initExtensions(){this.extensions={EXT_color_buffer_float:this.context.getExtension("EXT_color_buffer_float"),OES_texture_float_linear:this.context.getExtension("OES_texture_float_linear")}}validateSettings(y){if(!this.validate){this.texSize=f.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output);return}let{features:_}=this.constructor;if(this.precision==="single"&&!_.isFloatRead)throw new Error("Float texture outputs are not supported");if(!this.graphical&&this.precision===null&&(this.precision=_.isFloatRead?"single":"unsigned"),this.fixIntegerDivisionAccuracy===null?this.fixIntegerDivisionAccuracy=!_.isIntegerDivisionAccurate:this.fixIntegerDivisionAccuracy&&_.isIntegerDivisionAccurate&&(this.fixIntegerDivisionAccuracy=!1),this.checkOutput(),!this.output||this.output.length===0){if(y.length!==1)throw new Error("Auto output only supported for kernels with only one input");let w=f.getVariableType(y[0],this.strictIntegers);switch(w){case"Array":this.output=f.getDimensions(w);break;case"NumberTexture":case"MemoryOptimizedNumberTexture":case"ArrayTexture(1)":case"ArrayTexture(2)":case"ArrayTexture(3)":case"ArrayTexture(4)":this.output=y[0].output;break;default:throw new Error("Auto output not supported for input type: "+w)}}if(this.graphical){if(this.output.length!==2)throw new Error("Output must have 2 dimensions on graphical mode");this.precision==="single"&&(console.warn("Cannot use graphical mode and single precision at the same time"),this.precision="unsigned"),this.texSize=f.clone(this.output);return}else!this.graphical&&this.precision===null&&_.isTextureFloat&&(this.precision="single");this.texSize=f.getKernelTextureSize({optimizeFloatMemory:this.optimizeFloatMemory,precision:this.precision},this.output),this.checkTextureSize()}translateSource(){let y=d.fromKernel(this,p,{fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy});this.translatedSource=y.getPrototypeString("kernel"),this.setupReturnTypes(y)}drawBuffers(){this.context.drawBuffers(this.drawBuffersMap)}getTextureFormat(){let{context:y}=this;switch(this.getInternalFormat()){case y.R32F:return y.RED;case y.RG32F:return y.RG;case y.RGBA32F:return y.RGBA;case y.RGBA:return y.RGBA;default:throw new Error("Unknown internal format")}}getInternalFormat(){let{context:y}=this;if(this.precision==="single"){if(this.pipeline)switch(this.returnType){case"Number":case"Float":case"Integer":return this.optimizeFloatMemory?y.RGBA32F:y.R32F;case"Array(2)":return y.RG32F;case"Array(3)":case"Array(4)":return y.RGBA32F;default:throw new Error("Unhandled return type")}return y.RGBA32F}return y.RGBA}_setupOutputTexture(){let y=this.context;if(this.texture){y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,this.texture.texture,0);return}y.bindFramebuffer(y.FRAMEBUFFER,this.framebuffer);let _=y.createTexture(),w=this.texSize;y.activeTexture(y.TEXTURE0+this.constantTextureCount+this.argumentTextureCount),y.bindTexture(y.TEXTURE_2D,_),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST);let L=this.getInternalFormat();this.precision==="single"?y.texStorage2D(y.TEXTURE_2D,1,L,w[0],w[1]):y.texImage2D(y.TEXTURE_2D,0,L,w[0],w[1],0,L,y.UNSIGNED_BYTE,null),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,_,0),this.texture=new this.TextureConstructor({texture:_,size:w,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this})}_setupSubOutputTextures(){let y=this.context;if(this.mappedTextures){for(let w=0;w<this.subKernels.length;w++)y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0+w+1,y.TEXTURE_2D,this.mappedTextures[w].texture,0);return}let _=this.texSize;this.drawBuffersMap=[y.COLOR_ATTACHMENT0],this.mappedTextures=[];for(let w=0;w<this.subKernels.length;w++){let L=this.createTexture();this.drawBuffersMap.push(y.COLOR_ATTACHMENT0+w+1),y.activeTexture(y.TEXTURE0+this.constantTextureCount+this.argumentTextureCount+w),y.bindTexture(y.TEXTURE_2D,L),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.NEAREST),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.NEAREST);let N=this.getInternalFormat();this.precision==="single"?y.texStorage2D(y.TEXTURE_2D,1,N,_[0],_[1]):y.texImage2D(y.TEXTURE_2D,0,y.RGBA,_[0],_[1],0,y.RGBA,y.UNSIGNED_BYTE,null),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0+w+1,y.TEXTURE_2D,L,0),this.mappedTextures.push(new this.TextureConstructor({texture:L,size:_,dimensions:this.threadDim,output:this.output,context:this.context,internalFormat:this.getInternalFormat(),textureFormat:this.getTextureFormat(),kernel:this}))}}_getHeaderString(){return""}_getTextureCoordinate(){let y=this.subKernels,_=this.getVariablePrecisionString(this.texSize,this.tactic);return y===null||y.length<1?`in ${_} vec2 vTexCoord;\n`:`out ${_} vec2 vTexCoord;\n`}_getMainArgumentsString(y){let _=[],w=this.argumentNames;for(let L=0;L<w.length;L++)_.push(this.kernelArguments[L].getSource(y[L]));return _.join("")}getKernelString(){let y=[this.getKernelResultDeclaration()],_=this.subKernels;if(_!==null)switch(y.push("layout(location = 0) out vec4 data0"),this.returnType){case"Number":case"Float":case"Integer":for(let w=0;w<_.length;w++){let L=_[w];y.push(L.returnType==="Integer"?`int subKernelResult_${L.name} = 0`:`float subKernelResult_${L.name} = 0.0`,`layout(location = ${w+1}) out vec4 data${w+1}`)}break;case"Array(2)":for(let w=0;w<_.length;w++)y.push(`vec2 subKernelResult_${_[w].name}`,`layout(location = ${w+1}) out vec4 data${w+1}`);break;case"Array(3)":for(let w=0;w<_.length;w++)y.push(`vec3 subKernelResult_${_[w].name}`,`layout(location = ${w+1}) out vec4 data${w+1}`);break;case"Array(4)":for(let w=0;w<_.length;w++)y.push(`vec4 subKernelResult_${_[w].name}`,`layout(location = ${w+1}) out vec4 data${w+1}`);break}else y.push("out vec4 data0");return f.linesToString(y)+this.translatedSource}getMainResultGraphical(){return f.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor"])}getMainResultPackedPixels(){switch(this.returnType){case"LiteralInteger":case"Number":case"Integer":case"Float":return this.getMainResultKernelPackedPixels()+this.getMainResultSubKernelPackedPixels();default:throw new Error(`packed output only usable with Numbers, "${this.returnType}" specified`)}}getMainResultKernelPackedPixels(){return f.linesToString(["  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0 = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(kernelResult)`])}getMainResultSubKernelPackedPixels(){let y=[];if(!this.subKernels)return"";for(let _=0;_<this.subKernels.length;_++)this.subKernels[_].returnType==="Integer"?y.push(`  data${_+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(float(subKernelResult_${this.subKernels[_].name}))`):y.push(`  data${_+1} = ${this.useLegacyEncoder?"legacyEncode32":"encode32"}(subKernelResult_${this.subKernels[_].name})`);return f.linesToString(y)}getMainResultKernelMemoryOptimizedFloats(y,_){y.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()",`  data0.${_} = kernelResult`)}getMainResultSubKernelMemoryOptimizedFloats(y,_){if(!this.subKernels)return y;for(let w=0;w<this.subKernels.length;w++){let L=this.subKernels[w];L.returnType==="Integer"?y.push(`  data${w+1}.${_} = float(subKernelResult_${L.name})`):y.push(`  data${w+1}.${_} = subKernelResult_${L.name}`)}}getMainResultKernelNumberTexture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult"]}getMainResultSubKernelNumberTexture(){let y=[];if(!this.subKernels)return y;for(let _=0;_<this.subKernels.length;++_){let w=this.subKernels[_];w.returnType==="Integer"?y.push(`  data${_+1}[0] = float(subKernelResult_${w.name})`):y.push(`  data${_+1}[0] = subKernelResult_${w.name}`)}return y}getMainResultKernelArray2Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]"]}getMainResultSubKernelArray2Texture(){let y=[];if(!this.subKernels)return y;for(let _=0;_<this.subKernels.length;++_){let w=this.subKernels[_];y.push(`  data${_+1}[0] = subKernelResult_${w.name}[0]`,`  data${_+1}[1] = subKernelResult_${w.name}[1]`)}return y}getMainResultKernelArray3Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0[0] = kernelResult[0]","  data0[1] = kernelResult[1]","  data0[2] = kernelResult[2]"]}getMainResultSubKernelArray3Texture(){let y=[];if(!this.subKernels)return y;for(let _=0;_<this.subKernels.length;++_){let w=this.subKernels[_];y.push(`  data${_+1}[0] = subKernelResult_${w.name}[0]`,`  data${_+1}[1] = subKernelResult_${w.name}[1]`,`  data${_+1}[2] = subKernelResult_${w.name}[2]`)}return y}getMainResultKernelArray4Texture(){return["  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = kernelResult"]}getMainResultSubKernelArray4Texture(){let y=[];if(!this.subKernels)return y;for(let _=0;_<this.subKernels.length;++_)y.push(`  data${_+1} = subKernelResult_${this.subKernels[_].name}`);return y}destroyExtensions(){this.extensions.EXT_color_buffer_float=null,this.extensions.OES_texture_float_linear=null}toJSON(){let y=super.toJSON();return y.functionNodes=d.fromKernel(this,p).toJSON(),y.settings.threadDim=this.threadDim,y}}o.exports={WebGL2Kernel:A}},{"../../utils":114,"../function-builder":9,"../web-gl/kernel":70,"./fragment-shader":72,"./function-node":73,"./kernel-value-maps":74,"./vertex-shader":106}],106:[function(i,o,m){let u=`#version 300 es\n      __FLOAT_TACTIC_DECLARATION__;\n      __INT_TACTIC_DECLARATION__;\n      __SAMPLER_2D_TACTIC_DECLARATION__;\n      \n      in vec2 aPos;\n      in vec2 aTexCoord;\n      \n      out vec2 vTexCoord;\n      uniform vec2 ratio;\n      \n      void main(void) {\n        gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n        vTexCoord = aTexCoord;\n      }`;o.exports={vertexShader:u}},{}],107:[function(i,o,m){let u=i("./index"),p=u.GPU;for(let f in u)!u.hasOwnProperty(f)||f!=="GPU"&&(p[f]=u[f]);typeof window<"u"&&d(window),typeof self<"u"&&d(self);function d(f){f.GPU||Object.defineProperty(f,"GPU",{get(){return p}})}o.exports=u},{"./index":109}],108:[function(i,o,m){let{gpuMock:u}=i("gpu-mock.js"),{utils:p}=i("./utils"),{Kernel:d}=i("./backend/kernel"),{CPUKernel:f}=i("./backend/cpu/kernel"),{HeadlessGLKernel:r}=i("./backend/headless-gl/kernel"),{WebGL2Kernel:a}=i("./backend/web-gl2/kernel"),{WebGLKernel:t}=i("./backend/web-gl/kernel"),{kernelRunShortcut:n}=i("./kernel-run-shortcut"),g=[r,a,t],v=["gpu","cpu"],k={headlessgl:r,webgl2:a,webgl:t},T=!0;class A{static disableValidation(){T=!1}static enableValidation(){T=!0}static get isGPUSupported(){return g.some(_=>_.isSupported)}static get isKernelMapSupported(){return g.some(_=>_.isSupported&&_.features.kernelMap)}static get isOffscreenCanvasSupported(){return typeof Worker<"u"&&typeof OffscreenCanvas<"u"||typeof importScripts<"u"}static get isWebGLSupported(){return t.isSupported}static get isWebGL2Supported(){return a.isSupported}static get isHeadlessGLSupported(){return r.isSupported}static get isCanvasSupported(){return typeof HTMLCanvasElement<"u"}static get isGPUHTMLImageArraySupported(){return a.isSupported}static get isSinglePrecisionSupported(){return g.some(_=>_.isSupported&&_.features.isFloatRead&&_.features.isTextureFloat)}constructor(_){if(_=_||{},this.canvas=_.canvas||null,this.context=_.context||null,this.mode=_.mode,this.Kernel=null,this.kernels=[],this.functions=[],this.nativeFunctions=[],this.injectedNative=null,this.mode!=="dev"){if(this.chooseKernel(),_.functions)for(let w=0;w<_.functions.length;w++)this.addFunction(_.functions[w]);if(_.nativeFunctions)for(let w in _.nativeFunctions){if(!_.nativeFunctions.hasOwnProperty(w))continue;let L=_.nativeFunctions[w],{name:N,source:b}=L;this.addNativeFunction(N,b,L)}}}chooseKernel(){if(this.Kernel)return;let _=null;if(this.context){for(let w=0;w<g.length;w++){let L=g[w];if(L.isContextMatch(this.context)){if(!L.isSupported)throw new Error(`Kernel type ${L.name} not supported`);_=L;break}}if(_===null)throw new Error("unknown Context")}else if(this.mode){if(this.mode in k)(!T||k[this.mode].isSupported)&&(_=k[this.mode]);else if(this.mode==="gpu"){for(let w=0;w<g.length;w++)if(g[w].isSupported){_=g[w];break}}else this.mode==="cpu"&&(_=f);if(!_)throw new Error(`A requested mode of "${this.mode}" and is not supported`)}else{for(let w=0;w<g.length;w++)if(g[w].isSupported){_=g[w];break}_||(_=f)}this.mode||(this.mode=_.mode),this.Kernel=_}createKernel(_,w){if(typeof _>"u")throw new Error("Missing source parameter");if(typeof _!="object"&&!p.isFunction(_)&&typeof _!="string")throw new Error("source parameter not a function");let L=this.kernels;if(this.mode==="dev"){let $=u(_,E(w));return L.push($),$}_=typeof _=="function"?_.toString():_;let N={},b=E(w)||{};w&&typeof w.argumentTypes=="object"&&(b.argumentTypes=Object.keys(w.argumentTypes).map($=>w.argumentTypes[$]));function c($){console.warn("Falling back to CPU");let G=new f(_,{argumentTypes:M.argumentTypes,constantTypes:M.constantTypes,graphical:M.graphical,loopMaxIterations:M.loopMaxIterations,constants:M.constants,dynamicOutput:M.dynamicOutput,dynamicArgument:M.dynamicArguments,output:M.output,precision:M.precision,pipeline:M.pipeline,immutable:M.immutable,optimizeFloatMemory:M.optimizeFloatMemory,fixIntegerDivisionAccuracy:M.fixIntegerDivisionAccuracy,functions:M.functions,nativeFunctions:M.nativeFunctions,injectedNative:M.injectedNative,subKernels:M.subKernels,strictIntegers:M.strictIntegers,debug:M.debug});G.build.apply(G,$);let O=G.run.apply(G,$);return M.replaceKernel(G),O}function C($,G,O){O.debug&&console.warn("Switching kernels");let Y=null;if(O.signature&&!N[O.signature]&&(N[O.signature]=O),O.dynamicOutput)for(let H=$.length-1;H>=0;H--){let B=$[H];B.type==="outputPrecisionMismatch"&&(Y=B.needed)}let W=O.constructor,K=W.getArgumentTypes(O,G),J=W.getSignature(O,K),Q=N[J];if(Q)return Q.onActivate(O),Q;let te=N[J]=new W(_,{argumentTypes:K,constantTypes:O.constantTypes,graphical:O.graphical,loopMaxIterations:O.loopMaxIterations,constants:O.constants,dynamicOutput:O.dynamicOutput,dynamicArgument:O.dynamicArguments,context:O.context,canvas:O.canvas,output:Y||O.output,precision:O.precision,pipeline:O.pipeline,immutable:O.immutable,optimizeFloatMemory:O.optimizeFloatMemory,fixIntegerDivisionAccuracy:O.fixIntegerDivisionAccuracy,functions:O.functions,nativeFunctions:O.nativeFunctions,injectedNative:O.injectedNative,subKernels:O.subKernels,strictIntegers:O.strictIntegers,debug:O.debug,gpu:O.gpu,validate:T,returnType:O.returnType,tactic:O.tactic,onRequestFallback:c,onRequestSwitchKernel:C,texture:O.texture,mappedTextures:O.mappedTextures,drawBuffersMap:O.drawBuffersMap});return te.build.apply(te,G),M.replaceKernel(te),L.push(te),te}let F=Object.assign({context:this.context,canvas:this.canvas,functions:this.functions,nativeFunctions:this.nativeFunctions,injectedNative:this.injectedNative,gpu:this,validate:T,onRequestFallback:c,onRequestSwitchKernel:C},b),P=new this.Kernel(_,F),M=n(P);return this.canvas||(this.canvas=P.canvas),this.context||(this.context=P.context),L.push(P),M}createKernelMap(){let _,w,L=typeof arguments[arguments.length-2];if(L==="function"||L==="string"?(_=arguments[arguments.length-2],w=arguments[arguments.length-1]):_=arguments[arguments.length-1],this.mode!=="dev"&&(!this.Kernel.isSupported||!this.Kernel.features.kernelMap)&&this.mode&&v.indexOf(this.mode)<0)throw new Error(`kernelMap not supported on ${this.Kernel.name}`);let N=E(w);if(w&&typeof w.argumentTypes=="object"&&(N.argumentTypes=Object.keys(w.argumentTypes).map(b=>w.argumentTypes[b])),Array.isArray(arguments[0])){N.subKernels=[];let b=arguments[0];for(let c=0;c<b.length;c++){let C=b[c].toString(),F=p.getFunctionNameFromString(C);N.subKernels.push({name:F,source:C,property:c})}}else{N.subKernels=[];let b=arguments[0];for(let c in b){if(!b.hasOwnProperty(c))continue;let C=b[c].toString(),F=p.getFunctionNameFromString(C);N.subKernels.push({name:F||c,source:C,property:c})}}return this.createKernel(_,N)}combineKernels(){let _=arguments[0],w=arguments[arguments.length-1];if(_.kernel.constructor.mode==="cpu")return w;let L=arguments[0].canvas,N=arguments[0].context,b=arguments.length-1;for(let c=0;c<b;c++)arguments[c].setCanvas(L).setContext(N).setPipeline(!0);return function(){let c=w.apply(this,arguments);return c.toArray?c.toArray():c}}setFunctions(_){return this.functions=_,this}setNativeFunctions(_){return this.nativeFunctions=_,this}addFunction(_,w){return this.functions.push({source:_,settings:w}),this}addNativeFunction(_,w,L){if(this.kernels.length>0)throw new Error(\'Cannot call "addNativeFunction" after "createKernels" has been called.\');return this.nativeFunctions.push(Object.assign({name:_,source:w},L)),this}injectNative(_){return this.injectedNative=_,this}destroy(){return new Promise((_,w)=>{this.kernels||_(),setTimeout(()=>{try{for(let N=0;N<this.kernels.length;N++)this.kernels[N].destroy(!0);let L=this.kernels[0];L&&(L.kernel&&(L=L.kernel),L.constructor.destroyContext&&L.constructor.destroyContext(this.context))}catch(L){w(L)}_()},0)})}}function E(y){if(!y)return{};let _=Object.assign({},y);return y.hasOwnProperty("floatOutput")&&(p.warnDeprecated("setting","floatOutput","precision"),_.precision=y.floatOutput?"single":"unsigned"),y.hasOwnProperty("outputToTexture")&&(p.warnDeprecated("setting","outputToTexture","pipeline"),_.pipeline=Boolean(y.outputToTexture)),y.hasOwnProperty("outputImmutable")&&(p.warnDeprecated("setting","outputImmutable","immutable"),_.immutable=Boolean(y.outputImmutable)),y.hasOwnProperty("floatTextures")&&(p.warnDeprecated("setting","floatTextures","optimizeFloatMemory"),_.optimizeFloatMemory=Boolean(y.floatTextures)),_}o.exports={GPU:A,kernelOrder:g,kernelTypes:v}},{"./backend/cpu/kernel":8,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/kernel":70,"./backend/web-gl2/kernel":105,"./kernel-run-shortcut":111,"./utils":114,"gpu-mock.js":4}],109:[function(i,o,m){let{GPU:u}=i("./gpu"),{alias:p}=i("./alias"),{utils:d}=i("./utils"),{Input:f,input:r}=i("./input"),{Texture:a}=i("./texture"),{FunctionBuilder:t}=i("./backend/function-builder"),{FunctionNode:n}=i("./backend/function-node"),{CPUFunctionNode:g}=i("./backend/cpu/function-node"),{CPUKernel:v}=i("./backend/cpu/kernel"),{HeadlessGLKernel:k}=i("./backend/headless-gl/kernel"),{WebGLFunctionNode:T}=i("./backend/web-gl/function-node"),{WebGLKernel:A}=i("./backend/web-gl/kernel"),{kernelValueMaps:E}=i("./backend/web-gl/kernel-value-maps"),{WebGL2FunctionNode:y}=i("./backend/web-gl2/function-node"),{WebGL2Kernel:_}=i("./backend/web-gl2/kernel"),{kernelValueMaps:w}=i("./backend/web-gl2/kernel-value-maps"),{GLKernel:L}=i("./backend/gl/kernel"),{Kernel:N}=i("./backend/kernel"),{FunctionTracer:b}=i("./backend/function-tracer"),c=i("./plugins/math-random-uniformly-distributed");o.exports={alias:p,CPUFunctionNode:g,CPUKernel:v,GPU:u,FunctionBuilder:t,FunctionNode:n,HeadlessGLKernel:k,Input:f,input:r,Texture:a,utils:d,WebGL2FunctionNode:y,WebGL2Kernel:_,webGL2KernelValueMaps:w,WebGLFunctionNode:T,WebGLKernel:A,webGLKernelValueMaps:E,GLKernel:L,Kernel:N,FunctionTracer:b,plugins:{mathRandom:c}}},{"./alias":5,"./backend/cpu/function-node":6,"./backend/cpu/kernel":8,"./backend/function-builder":9,"./backend/function-node":10,"./backend/function-tracer":11,"./backend/gl/kernel":13,"./backend/headless-gl/kernel":34,"./backend/kernel":36,"./backend/web-gl/function-node":38,"./backend/web-gl/kernel":70,"./backend/web-gl/kernel-value-maps":39,"./backend/web-gl2/function-node":73,"./backend/web-gl2/kernel":105,"./backend/web-gl2/kernel-value-maps":74,"./gpu":108,"./input":110,"./plugins/math-random-uniformly-distributed":112,"./texture":113,"./utils":114}],110:[function(i,o,m){class u{constructor(f,r){this.value=f,Array.isArray(r)?this.size=r:(this.size=new Int32Array(3),r.z?this.size=new Int32Array([r.x,r.y,r.z]):r.y?this.size=new Int32Array([r.x,r.y]):this.size=new Int32Array([r.x]));let[a,t,n]=this.size;if(n){if(this.value.length!==a*t*n)throw new Error(`Input size ${this.value.length} does not match ${a} * ${t} * ${n} = ${t*a*n}`)}else if(t){if(this.value.length!==a*t)throw new Error(`Input size ${this.value.length} does not match ${a} * ${t} = ${t*a}`)}else if(this.value.length!==a)throw new Error(`Input size ${this.value.length} does not match ${a}`)}toArray(){let{utils:f}=i("./utils"),[r,a,t]=this.size;return t?f.erectMemoryOptimized3DFloat(this.value.subarray?this.value:new Float32Array(this.value),r,a,t):a?f.erectMemoryOptimized2DFloat(this.value.subarray?this.value:new Float32Array(this.value),r,a):this.value}}function p(d,f){return new u(d,f)}o.exports={Input:u,input:p}},{"./utils":114}],111:[function(i,o,m){let{utils:u}=i("./utils");function p(f){let r=function(){return f.build.apply(f,arguments),r=function(){let t=f.run.apply(f,arguments);if(f.switchingKernels){let n=f.resetSwitchingKernels(),g=f.onRequestSwitchKernel(n,arguments,f);a.kernel=f=g,t=g.run.apply(g,arguments)}return f.renderKernels?f.renderKernels():f.renderOutput?f.renderOutput():t},r.apply(f,arguments)},a=function(){return r.apply(f,arguments)};return a.exec=function(){return new Promise((t,n)=>{try{t(r.apply(this,arguments))}catch(g){n(g)}})},a.replaceKernel=function(t){f=t,d(f,a)},d(f,a),a}function d(f,r){if(r.kernel){r.kernel=f;return}let a=u.allPropertiesOf(f);for(let t=0;t<a.length;t++){let n=a[t];n[0]==="_"&&n[1]==="_"||(typeof f[n]=="function"?n.substring(0,3)==="add"||n.substring(0,3)==="set"?r[n]=function(){return r.kernel[n].apply(r.kernel,arguments),r}:r[n]=function(){return r.kernel[n].apply(r.kernel,arguments)}:(r.__defineGetter__(n,()=>r.kernel[n]),r.__defineSetter__(n,g=>{r.kernel[n]=g})))}r.kernel=f}o.exports={kernelRunShortcut:p}},{"./utils":114}],112:[function(i,o,m){let t={name:"math-random-uniformly-distributed",onBeforeRun:n=>{n.setUniform1f("randomSeed1",Math.random()),n.setUniform1f("randomSeed2",Math.random())},functionMatch:"Math.random()",functionReplace:"nrand(vTexCoord)",functionReturnType:"Number",source:`// https://www.shadertoy.com/view/4t2SDh\n      //note: uniformly distributed, normalized rand, [0,1]\n      highp float randomSeedShift = 1.0;\n      highp float slide = 1.0;\n      uniform highp float randomSeed1;\n      uniform highp float randomSeed2;\n      \n      highp float nrand(highp vec2 n) {\n        highp float result = fract(sin(dot((n.xy + 1.0) * vec2(randomSeed1 * slide, randomSeed2 * randomSeedShift), vec2(12.9898, 78.233))) * 43758.5453);\n        randomSeedShift = result;\n        if (randomSeedShift > 0.5) {\n          slide += 0.00009; \n        } else {\n          slide += 0.0009;\n        }\n        return result;\n      }`};o.exports=t},{}],113:[function(i,o,m){class u{constructor(d){let{texture:f,size:r,dimensions:a,output:t,context:n,type:g="NumberTexture",kernel:v,internalFormat:k,textureFormat:T}=d;if(!t)throw new Error(\'settings property "output" required.\');if(!n)throw new Error(\'settings property "context" required.\');if(!f)throw new Error(\'settings property "texture" required.\');if(!v)throw new Error(\'settings property "kernel" required.\');this.texture=f,f._refs?f._refs++:f._refs=1,this.size=r,this.dimensions=a,this.output=t,this.context=n,this.kernel=v,this.type=g,this._deleted=!1,this.internalFormat=k,this.textureFormat=T}toArray(){throw new Error(`Not implemented on ${this.constructor.name}`)}clone(){throw new Error(`Not implemented on ${this.constructor.name}`)}delete(){throw new Error(`Not implemented on ${this.constructor.name}`)}clear(){throw new Error(`Not implemented on ${this.constructor.name}`)}}o.exports={Texture:u}},{}],114:[function(i,o,m){let u=i("acorn"),{Input:p}=i("./input"),{Texture:d}=i("./texture"),f=/function ([^(]*)/,r=/((\\/\\/.*$)|(\\/\\*[\\s\\S]*?\\*\\/))/mg,a=/([^\\s,]+)/g,t={systemEndianness(){return k},getSystemEndianness(){let T=new ArrayBuffer(4),A=new Uint32Array(T),E=new Uint8Array(T);if(A[0]=3735928559,E[0]===239)return"LE";if(E[0]===222)return"BE";throw new Error("unknown endianness")},isFunction(T){return typeof T=="function"},isFunctionString(T){return typeof T=="string"?T.slice(0,8).toLowerCase()==="function":!1},getFunctionNameFromString(T){let A=f.exec(T);return!A||A.length===0?null:A[1].trim()},getFunctionBodyFromString(T){return T.substring(T.indexOf("{")+1,T.lastIndexOf("}"))},getArgumentNamesFromString(T){let A=T.replace(r,""),E=A.slice(A.indexOf("(")+1,A.indexOf(")")).match(a);return E===null&&(E=[]),E},clone(T){if(T===null||typeof T!="object"||T.hasOwnProperty("isActiveClone"))return T;let A=T.constructor();for(let E in T)Object.prototype.hasOwnProperty.call(T,E)&&(T.isActiveClone=null,A[E]=t.clone(T[E]),delete T.isActiveClone);return A},isArray(T){return!isNaN(T.length)},getVariableType(T,A){if(t.isArray(T))return T.length>0&&T[0].nodeName==="IMG"?"HTMLImageArray":"Array";switch(T.constructor){case Boolean:return"Boolean";case Number:return A&&Number.isInteger(T)?"Integer":"Float";case d:return T.type;case p:return"Input"}switch(T.nodeName){case"IMG":return"HTMLImage";case"CANVAS":return"HTMLImage";case"VIDEO":return"HTMLVideo"}return T.hasOwnProperty("type")?T.type:"Unknown"},getKernelTextureSize(T,A){let[E,y,_]=A,w=(E||1)*(y||1)*(_||1);return T.optimizeFloatMemory&&T.precision==="single"&&(E=w=Math.ceil(w/4)),y>1&&E*y===w?new Int32Array([E,y]):t.closestSquareDimensions(w)},closestSquareDimensions(T){let A=Math.sqrt(T),E=Math.ceil(A),y=Math.floor(A);for(;E*y<T;)E--,y=Math.ceil(T/E);return new Int32Array([y,Math.ceil(T/y)])},getMemoryOptimizedFloatTextureSize(T,A){let y=t.roundTo((T[0]||1)*(T[1]||1)*(T[2]||1)*(T[3]||1),4)/A;return t.closestSquareDimensions(y)},getMemoryOptimizedPackedTextureSize(T,A){let[E,y,_]=T,L=t.roundTo((E||1)*(y||1)*(_||1),4)/(4/A);return t.closestSquareDimensions(L)},roundTo(T,A){return Math.floor((T+A-1)/A)*A},getDimensions(T,A){let E;if(t.isArray(T)){let y=[],_=T;for(;t.isArray(_);)y.push(_.length),_=_[0];E=y.reverse()}else if(T instanceof d)E=T.output;else if(T instanceof p)E=T.size;else throw new Error(`Unknown dimensions of ${T}`);if(A)for(E=Array.from(E);E.length<3;)E.push(1);return new Int32Array(E)},flatten2dArrayTo(T,A){let E=0;for(let y=0;y<T.length;y++)A.set(T[y],E),E+=T[y].length},flatten3dArrayTo(T,A){let E=0;for(let y=0;y<T.length;y++)for(let _=0;_<T[y].length;_++)A.set(T[y][_],E),E+=T[y][_].length},flatten4dArrayTo(T,A){let E=0;for(let y=0;y<T.length;y++)for(let _=0;_<T[y].length;_++)for(let w=0;w<T[y][_].length;w++)A.set(T[y][_][w],E),E+=T[y][_][w].length},flattenTo(T,A){t.isArray(T[0])?t.isArray(T[0][0])?t.isArray(T[0][0][0])?t.flatten4dArrayTo(T,A):t.flatten3dArrayTo(T,A):t.flatten2dArrayTo(T,A):A.set(T)},splitArray(T,A){let E=[];for(let y=0;y<T.length;y+=A)E.push(new T.constructor(T.buffer,y*4+T.byteOffset,A));return E},getAstString(T,A){let E=Array.isArray(T)?T:T.split(/\\r?\\n/g),y=A.loc.start,_=A.loc.end,w=[];if(y.line===_.line)w.push(E[y.line-1].substring(y.column,_.column));else{w.push(E[y.line-1].slice(y.column));for(let L=y.line;L<_.line;L++)w.push(E[L]);w.push(E[_.line-1].slice(0,_.column))}return w.join(`\n`)},allPropertiesOf(T){let A=[];do A.push.apply(A,Object.getOwnPropertyNames(T));while(T=Object.getPrototypeOf(T));return A},linesToString(T){return T.length>0?T.join(`;\n`)+`;\n`:`\n`},warnDeprecated(T,A,E){console.warn(E?`You are using a deprecated ${T} "${A}". It has been replaced with "${E}". Fixing, but please upgrade as it will soon be removed.`:`You are using a deprecated ${T} "${A}". It has been removed. Fixing, but please upgrade as it will soon be removed.`)},flipPixels:(T,A,E)=>{let y=E/2|0,_=A*4,w=new Uint8ClampedArray(A*4),L=T.slice(0);for(let N=0;N<y;++N){let b=N*_,c=(E-N-1)*_;w.set(L.subarray(b,b+_)),L.copyWithin(b,c,c+_),L.set(w,c)}return L},erectPackedFloat:(T,A)=>T.subarray(0,A),erect2DPackedFloat:(T,A,E)=>{let y=new Array(E);for(let _=0;_<E;_++){let w=_*A,L=w+A;y[_]=T.subarray(w,L)}return y},erect3DPackedFloat:(T,A,E,y)=>{let _=new Array(y);for(let w=0;w<y;w++){let L=new Array(E);for(let N=0;N<E;N++){let b=w*E*A+N*A,c=b+A;L[N]=T.subarray(b,c)}_[w]=L}return _},erectMemoryOptimizedFloat:(T,A)=>T.subarray(0,A),erectMemoryOptimized2DFloat:(T,A,E)=>{let y=new Array(E);for(let _=0;_<E;_++){let w=_*A;y[_]=T.subarray(w,w+A)}return y},erectMemoryOptimized3DFloat:(T,A,E,y)=>{let _=new Array(y);for(let w=0;w<y;w++){let L=new Array(E);for(let N=0;N<E;N++){let b=w*E*A+N*A;L[N]=T.subarray(b,b+A)}_[w]=L}return _},erectFloat:(T,A)=>{let E=new Float32Array(A),y=0;for(let _=0;_<A;_++)E[_]=T[y],y+=4;return E},erect2DFloat:(T,A,E)=>{let y=new Array(E),_=0;for(let w=0;w<E;w++){let L=new Float32Array(A);for(let N=0;N<A;N++)L[N]=T[_],_+=4;y[w]=L}return y},erect3DFloat:(T,A,E,y)=>{let _=new Array(y),w=0;for(let L=0;L<y;L++){let N=new Array(E);for(let b=0;b<E;b++){let c=new Float32Array(A);for(let C=0;C<A;C++)c[C]=T[w],w+=4;N[b]=c}_[L]=N}return _},erectArray2:(T,A)=>{let E=new Array(A),y=A*4,_=0;for(let w=0;w<y;w+=4)E[_++]=T.subarray(w,w+2);return E},erect2DArray2:(T,A,E)=>{let y=new Array(E),_=A*4;for(let w=0;w<E;w++){let L=new Array(A),N=w*_,b=0;for(let c=0;c<_;c+=4)L[b++]=T.subarray(c+N,c+N+2);y[w]=L}return y},erect3DArray2:(T,A,E,y)=>{let _=A*4,w=new Array(y);for(let L=0;L<y;L++){let N=new Array(E);for(let b=0;b<E;b++){let c=new Array(A),C=L*_*E+b*_,F=0;for(let P=0;P<_;P+=4)c[F++]=T.subarray(P+C,P+C+2);N[b]=c}w[L]=N}return w},erectArray3:(T,A)=>{let E=new Array(A),y=A*4,_=0;for(let w=0;w<y;w+=4)E[_++]=T.subarray(w,w+3);return E},erect2DArray3:(T,A,E)=>{let y=A*4,_=new Array(E);for(let w=0;w<E;w++){let L=new Array(A),N=w*y,b=0;for(let c=0;c<y;c+=4)L[b++]=T.subarray(c+N,c+N+3);_[w]=L}return _},erect3DArray3:(T,A,E,y)=>{let _=A*4,w=new Array(y);for(let L=0;L<y;L++){let N=new Array(E);for(let b=0;b<E;b++){let c=new Array(A),C=L*_*E+b*_,F=0;for(let P=0;P<_;P+=4)c[F++]=T.subarray(P+C,P+C+3);N[b]=c}w[L]=N}return w},erectArray4:(T,A)=>{let E=new Array(T),y=A*4,_=0;for(let w=0;w<y;w+=4)E[_++]=T.subarray(w,w+4);return E},erect2DArray4:(T,A,E)=>{let y=A*4,_=new Array(E);for(let w=0;w<E;w++){let L=new Array(A),N=w*y,b=0;for(let c=0;c<y;c+=4)L[b++]=T.subarray(c+N,c+N+4);_[w]=L}return _},erect3DArray4:(T,A,E,y)=>{let _=A*4,w=new Array(y);for(let L=0;L<y;L++){let N=new Array(E);for(let b=0;b<E;b++){let c=new Array(A),C=L*_*E+b*_,F=0;for(let P=0;P<_;P+=4)c[F++]=T.subarray(P+C,P+C+4);N[b]=c}w[L]=N}return w},flattenFunctionToString:(T,A)=>{let{findDependency:E,thisLookup:y,doNotDefine:_}=A,w=A.flattened;w||(w=A.flattened={});let L=u.parse(T),N=[],b=0;function c(F){if(Array.isArray(F)){let P=[];for(let M=0;M<F.length;M++)P.push(c(F[M]));return P.join("")}switch(F.type){case"Program":return c(F.body)+(F.body[0].type==="VariableDeclaration"?";":"");case"FunctionDeclaration":return`function ${F.id.name}(${F.params.map(c).join(", ")}) ${c(F.body)}`;case"BlockStatement":{let M=[];b+=2;for(let $=0;$<F.body.length;$++){let G=c(F.body[$]);G&&M.push(" ".repeat(b)+G,`;\n`)}return b-=2,`{\n${M.join("")}}`}case"VariableDeclaration":let P=t.normalizeDeclarations(F).map(c).filter(M=>M!==null);return P.length<1?"":`${F.kind} ${P.join(",")}`;case"VariableDeclarator":return F.init.object&&F.init.object.type==="ThisExpression"?y(F.init.property.name,!0)?`${F.id.name} = ${c(F.init)}`:null:`${F.id.name} = ${c(F.init)}`;case"CallExpression":{if(F.callee.property.name==="subarray")return`${c(F.callee.object)}.${c(F.callee.property)}(${F.arguments.map(M=>c(M)).join(", ")})`;if(F.callee.object.name==="gl"||F.callee.object.name==="context")return`${c(F.callee.object)}.${c(F.callee.property)}(${F.arguments.map(M=>c(M)).join(", ")})`;if(F.callee.object.type==="ThisExpression")return N.push(E("this",F.callee.property.name)),`${F.callee.property.name}(${F.arguments.map(M=>c(M)).join(", ")})`;if(F.callee.object.name){let M=E(F.callee.object.name,F.callee.property.name);return M===null?`${F.callee.object.name}.${F.callee.property.name}(${F.arguments.map($=>c($)).join(", ")})`:(N.push(M),`${F.callee.property.name}(${F.arguments.map($=>c($)).join(", ")})`)}else{if(F.callee.object.type==="MemberExpression")return`${c(F.callee.object)}.${F.callee.property.name}(${F.arguments.map(M=>c(M)).join(", ")})`;throw new Error("unknown ast.callee")}}case"ReturnStatement":return`return ${c(F.argument)}`;case"BinaryExpression":return`(${c(F.left)}${F.operator}${c(F.right)})`;case"UnaryExpression":return F.prefix?`${F.operator} ${c(F.argument)}`:`${c(F.argument)} ${F.operator}`;case"ExpressionStatement":return`${c(F.expression)}`;case"SequenceExpression":return`(${c(F.expressions)})`;case"ArrowFunctionExpression":return`(${F.params.map(c).join(", ")}) => ${c(F.body)}`;case"Literal":return F.raw;case"Identifier":return F.name;case"MemberExpression":return F.object.type==="ThisExpression"?y(F.property.name):F.computed?`${c(F.object)}[${c(F.property)}]`:c(F.object)+"."+c(F.property);case"ThisExpression":return"this";case"NewExpression":return`new ${c(F.callee)}(${F.arguments.map(M=>c(M)).join(", ")})`;case"ForStatement":return`for (${c(F.init)};${c(F.test)};${c(F.update)}) ${c(F.body)}`;case"AssignmentExpression":return`${c(F.left)}${F.operator}${c(F.right)}`;case"UpdateExpression":return`${c(F.argument)}${F.operator}`;case"IfStatement":return`if (${c(F.test)}) ${c(F.consequent)}`;case"ThrowStatement":return`throw ${c(F.argument)}`;case"ObjectPattern":return F.properties.map(c).join(", ");case"ArrayPattern":return F.elements.map(c).join(", ");case"DebuggerStatement":return"debugger;";case"ConditionalExpression":return`${c(F.test)}?${c(F.consequent)}:${c(F.alternate)}`;case"Property":if(F.kind==="init")return c(F.key)}throw new Error(`unhandled ast.type of ${F.type}`)}let C=c(L);if(N.length>0){let F=[];for(let P=0;P<N.length;P++){let M=N[P];w[M]||(w[M]=!0),M&&F.push(t.flattenFunctionToString(M,A)+`\n`)}return F.join("")+C}return C},normalizeDeclarations:T=>{if(T.type!=="VariableDeclaration")throw new Error(\'Ast is not of type "VariableDeclaration"\');let A=[];for(let E=0;E<T.declarations.length;E++){let y=T.declarations[E];if(y.id&&y.id.type==="ObjectPattern"&&y.id.properties){let{properties:_}=y.id;for(let w=0;w<_.length;w++){let L=_[w];if(L.value.type==="ObjectPattern"&&L.value.properties)for(let N=0;N<L.value.properties.length;N++){let b=L.value.properties[N];if(b.type==="Property")A.push({type:"VariableDeclarator",id:{type:"Identifier",name:b.key.name},init:{type:"MemberExpression",object:{type:"MemberExpression",object:y.init,property:{type:"Identifier",name:L.key.name},computed:!1},property:{type:"Identifier",name:b.key.name},computed:!1}});else throw new Error("unexpected state")}else if(L.value.type==="Identifier")A.push({type:"VariableDeclarator",id:{type:"Identifier",name:L.value&&L.value.name?L.value.name:L.key.name},init:{type:"MemberExpression",object:y.init,property:{type:"Identifier",name:L.key.name},computed:!1}});else throw new Error("unexpected state")}}else if(y.id&&y.id.type==="ArrayPattern"&&y.id.elements){let{elements:_}=y.id;for(let w=0;w<_.length;w++){let L=_[w];if(L.type==="Identifier")A.push({type:"VariableDeclarator",id:{type:"Identifier",name:L.name},init:{type:"MemberExpression",object:y.init,property:{type:"Literal",value:w,raw:w.toString(),start:L.start,end:L.end},computed:!0}});else throw new Error("unexpected state")}}else A.push(y)}return A},splitHTMLImageToRGB:(T,A)=>{let E=T.createKernel(function(N){return N[this.thread.y][this.thread.x].r*255},{output:[A.width,A.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),y=T.createKernel(function(N){return N[this.thread.y][this.thread.x].g*255},{output:[A.width,A.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),_=T.createKernel(function(N){return N[this.thread.y][this.thread.x].b*255},{output:[A.width,A.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),w=T.createKernel(function(N){return N[this.thread.y][this.thread.x].a*255},{output:[A.width,A.height],precision:"unsigned",argumentTypes:{a:"HTMLImage"}}),L=[E(A),y(A),_(A),w(A)];return L.rKernel=E,L.gKernel=y,L.bKernel=_,L.aKernel=w,L.gpu=T,L},splitRGBAToCanvases:(T,A,E,y)=>{let _=T.createKernel(function(b){let c=b[this.thread.y][this.thread.x];this.color(c.r/255,0,0,255)},{output:[E,y],graphical:!0,argumentTypes:{v:"Array2D(4)"}});_(A);let w=T.createKernel(function(b){let c=b[this.thread.y][this.thread.x];this.color(0,c.g/255,0,255)},{output:[E,y],graphical:!0,argumentTypes:{v:"Array2D(4)"}});w(A);let L=T.createKernel(function(b){let c=b[this.thread.y][this.thread.x];this.color(0,0,c.b/255,255)},{output:[E,y],graphical:!0,argumentTypes:{v:"Array2D(4)"}});L(A);let N=T.createKernel(function(b){let c=b[this.thread.y][this.thread.x];this.color(255,255,255,c.a/255)},{output:[E,y],graphical:!0,argumentTypes:{v:"Array2D(4)"}});return N(A),[_.canvas,w.canvas,L.canvas,N.canvas]},getMinifySafeName:T=>{try{let A=u.parse(`const value = ${T.toString()}`),{init:E}=A.body[0].declarations[0];return E.body.name||E.body.body[0].argument.name}catch{throw new Error("Unrecognized function type.  Please use `() => yourFunctionVariableHere` or function() { return yourFunctionVariableHere; }")}},sanitizeName:function(T){return n.test(T)&&(T=T.replace(n,"S_S")),g.test(T)?T=T.replace(g,"U_U"):v.test(T)&&(T=T.replace(v,"u_u")),T}},n=/\\$/,g=/__/,v=/_/,k=t.getSystemEndianness();o.exports={utils:t}},{"./input":110,"./texture":113,acorn:1}]},{},[107])(107)})});var ct=class{constructor(s=!1,h=!1){this.debug=s,this.listeners=[],this.synchronous=h,this.syncInterval="FRAMERATE",this.syncAnim=void 0,h===!0&&this.startSync()}addListener(s=null,h,i=void 0,o=void 0,m=void 0,u=this.debug,p=!0){if(h===void 0){console.error("You must assign an object");return}var d=s;d==null&&(d=Math.floor(Math.random()*1e5)),this.synchronous===!0&&(p=!1);var f={key:d,listener:new pt(h,i,o,m,u,p)};this.listeners.push(f)}getListener(s){return this.listeners.find((i,o)=>{if(i.key===s)return!0})}hasKey(s){var h=!1;return this.listeners.forEach((i,o)=>{if(i.key===s)return h=!0,!0}),h}getKeyIndices(s){var h=[];return this.listeners.find((i,o)=>{i.key===s&&h.push(o)}),h}onchange(s=null,h=null){if(s==null)this.listeners.forEach((o,m)=>{o.listener.onchange=h});else var i=this.listeners.find((o,m)=>{o.name===s&&(o.listener.onchange=h)})}addFunc=(s=null,h=null,i=!0)=>{var o=null;if(h!==null)if(s==null)this.listeners.forEach((u,p)=>{o=u.listener.addFunc(h),u.listener.running==!1&&i==!0&&u.listener.start()});else var m=this.listeners.find((u,p)=>{u.key===s&&(o=u.listener.addFunc(h),u.listener.running==!1&&i==!0&&u.listener.start())});return o};getFuncs=(s=void 0)=>{if(s){var h=this.listeners.find((i,o)=>{if(i.key===s)return!0});return h.onchangeFuncs}else return};removeFuncs=(s=null,h=null,i=!1)=>{if(s==null)this.listeners.forEach((m,u)=>{m.listener.removeFuncs(h)});else var o=this.listeners.find((m,u)=>{m.key===s&&(m.listener.removeFuncs(h),(m.listener.onchangeFuncs.length===0||i===!0)&&m.listener.stop())})};stop(s=null){if(this.synchronous&&this.stopSync(),s==null)this.listeners.forEach((i,o)=>{i.listener.stop()});else var h=this.listeners.find((i,o)=>{i.name===s&&i.listener.stop()})}start(s=null){if(this.synchronous&&this.stopSync(),s==null)this.listeners.forEach((i,o)=>{i.listener.start()});else var h=this.listeners.find((i,o)=>{i.name===s&&i.listener.start()})}startSync(){if(this.synchronous===!1){this.synchronous=!0,this.stop();let s=()=>{this.synchronous===!0&&(this.listeners.forEach(h=>{h.listener.check()}),this.syncInterval==="FRAMERATE"?this.syncAnim=requestAnimationFrame(s):typeof this.syncInterval=="number"&&setTimeout(s,this.syncInterval))};s()}}stopSync(){this.synchronous=!1,this.syncAnim&&cancelAnimationFrame(this.syncAnim)}remove(s=null){if(s==null)this.listeners.forEach(o=>{o.listener.stop()}),this.listeners.splice(0,this.listeners.length);else{var h=[],i=this.listeners.forEach((o,m)=>{o.key===s&&h.push(m)});h.reverse().forEach(o=>{this.listeners[o].listener.stop(),this.listeners.splice(o,1)})}}},pt=class{constructor(s,h="__ANY__",i=this.onchange,o="FRAMERATE",m=!1,u=!0){this.debug=m,this.onchange=i,this.onchangeFuncs=[],this.object=s,this.propName=h,this.propOld=void 0,this.setListenerRef(h),this.running=u,this.funcs=0,this.interval,o<10?(this.interval=10,console.log("Min recommended interval set: 10ms")):this.interval=o,u===!0&&(typeof window>"u"?setTimeout(()=>{this.check()},60):this.checker=requestAnimationFrame(this.check))}onchange=s=>{console.log(this.propName," changed from: ",this.propOld," to: ",this.object[this.propName])};addFunc=(s=null)=>{let h=0;return s!==null&&(this.onchangeFuncs.push({idx:this.funcs,onchange:s}),h=this.funcs,this.funcs++),h};removeFuncs(s=null){let h=0;s===null?this.onchangeFuncs=[]:this.onchangeFuncs.find((i,o)=>{if(i.idx===s)return h=o,!0})!==void 0&&this.onchangeFuncs.splice(h,1)}onchangeMulti=s=>{[...this.onchangeFuncs].forEach((i,o)=>{this.debug===!0&&console.log(i.onchange),i.onchange(s)})};setListenerRef=s=>{s==="__ANY__"||s===null||s===void 0?this.propOld=JSON.stringifyFast(this.object):Array.isArray(this.object[s])?this.propOld=JSON.stringifyFast(this.object[s].slice(this.object[s].length-20)):typeof this.object[s]=="object"?this.propOld=JSON.stringifyFast(this.object[s]):typeof this.object[s]=="function"?this.propOld=this.object[s].toString():this.propOld=this.object[s],this.debug===!0&&console.log("propname",s,", new assignment: ",this.propOld)};check=()=>{let s=!1;if(this.propName==="__ANY__"||this.propName===null||this.propName===void 0)this.propOld!==JSON.stringifyFast(this.object)&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object),this.setListenerRef(this.propName),s=!0);else if(Array.isArray(this.object[this.propName]))this.propOld!==JSON.stringifyFast(this.object[this.propName].slice(this.object[this.propName].length-20))&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),s=!0);else if(typeof this.object[this.propName]=="object"){let h=JSON.stringifyFast(this.object[this.propName]);this.propOld!==h&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),s=!0)}else typeof this.object[this.propName]=="function"?this.propOld!==this.object[this.propName].toString()&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName].toString()),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName].toString()),this.setListenerRef(this.propName),s=!0):this.object[this.propName]!==this.propOld&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),s=!0);return this.running===!0&&(this.debug===!0&&console.log("checking",this.object,this.propName),this.interval==="FRAMERATE"?typeof window>"u"?setTimeout(()=>{this.check()},16):this.checker=requestAnimationFrame(this.check):setTimeout(()=>{this.check()},this.interval)),s};start(){this.running=!0,typeof window>"u"?setTimeout(()=>{this.check()},16):this.checker=requestAnimationFrame(this.check)}stop(){this.running=!1,cancelAnimationFrame(this.checker)}};JSON.stringifyFast===void 0&&(JSON.stringifyFast=function(){let D=new Map,s=[],h=["this"];function i(){D.clear(),s.length=0,h.length=1}function o(u,p){var d=s.length-1;if(s[d]){var f=s[d];if(typeof f=="object")if(f[u]===p||d===0)h.push(u),s.push(p.pushed);else for(;d-->=0;){if(f=s[d],typeof f=="object"&&f[u]===p){d+=2,s.length=d,h.length=d,--d,s[d]=p,h[d]=u;break}d--}}}function m(u,p){let d;if(p!=null)if(typeof p=="object"){let f=p.constructor.name;u&&f==="Object"&&o(u,p);let r=D.get(p);if(r)return"[Circular Reference]"+r;if(D.set(p,h.join(".")),f==="Array")p.length>20?d=p.slice(p.length-20):d=p;else if(f.includes("Set"))d=Array.from(p);else if(f!=="Object"&&f!=="Number"&&f!=="String"&&f!=="Boolean")d="instanceof_"+f;else if(f==="Object"){let a={};for(let t in p)if(p[t]==null)a[t]=p[t];else if(Array.isArray(p[t]))p[t].length>20?a[t]=p[t].slice(p[t].length-20):a[t]=p[t];else if(p[t].constructor.name==="Object"){a[t]={};for(let n in p[t])if(Array.isArray(p[t][n]))p[t][n].length>20?a[t][n]=p[t][n].slice(p[t][n].length-20):a[t][n]=p[t][n];else if(p[t][n]!=null){let g=p[t][n].constructor.name;g.includes("Set")?a[t][n]=Array.from(p[t][n]):g!=="Number"&&g!=="String"&&g!=="Boolean"?a[t][n]="instanceof_"+g:a[t][n]=p[t][n]}else a[t][n]=p[t][n]}else{let n=p[t].constructor.name;n.includes("Set")?a[t]=Array.from(p[t]):n!=="Number"&&n!=="String"&&n!=="Boolean"?a[t]="instanceof_"+n:a[t]=p[t]}d=a}else d=p}else d=p;return d}return function(p,d){s.push(p);let f=JSON.stringify(p,m,d);return i(),f}}());JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=function(){let D=new Map,s=[],h=["this"];function i(){D.clear(),s.length=0,h.length=1}function o(u,p){var d=s.length-1,f=s[d];if(f[u]===p||d===0)h.push(u),s.push(p);else for(;d-->=0;)if(f=s[d],f[u]===p){d+=2,s.length=d,h.length=d,--d,s[d]=p,h[d]=u;break}}function m(u,p){if(p!=null&&typeof p=="object"){u&&o(u,p);let d=D.get(p);if(d)return"[Circular Reference]"+d;D.set(p,h.join("."))}return p}return function(p,d){try{return s.push(p),JSON.stringify(p,m,d)}finally{i()}}}());var Pt=ct;var Qe=class{constructor(s={},h="FRAMERATE",i=!0){this.data=s,this.interval=h,this.pushToState={},this.pushRecord={pushed:[]},this.pushCallbacks={},this.triggers={},this.prev={},this.listener=new Pt,this.defaultStartListenerEventLoop=i}subscribe(s,h,i=this.defaultStartListenerEventLoop){if(s&&s!=="state")if(this.data[s]===void 0)this.addToState(s,null,h,i);else return this.addSecondaryKeyResponse(s,h,void 0,i);else return this.addSecondaryKeyResponse(s,h,void 0,i)}subscribeOnce(s=void 0,h=i=>{}){let i,o=m=>{h(m),this.unsubscribe(s,i)};i=this.subscribe(s,o)}unsubscribe(s,h=null){h!==null?this.removeSecondaryKeyResponse(s,h,!0):console.error("Specify a subcription function index")}unsubscribeAll(s){this.unsubscribeAllSequential(s),this.unsubscribeAllTriggers(s),this.clearAllKeyResponses(s),this.data[s]&&delete this.data[s],this.listener.hasKey("pushToState")&&this.setSequentialState({stateRemoved:s})}setInterval(s="FRAMERATE"){this.interval=s,this.listener.listeners.forEach((h,i)=>{h.interval=this.interval})}updateState(s,h){this.data[s]==null?this.addToState(s,h):this.data[s]=h}setupSynchronousUpdates=()=>{if(!this.listener.hasKey("pushToState")){let s=()=>{if(Object.keys(this.pushToState).length>0){Object.assign(this.data,this.pushToState);for(let h of Object.getOwnPropertyNames(this.pushToState))delete this.pushToState[h]}};this.listener.addListener("pushToState",this.pushToState,"__ANY__",s,this.interval),this.addToState("pushRecord",this.pushRecord,h=>{let i=h.pushed.length;for(let o=0;o<i;o++){let m=h.pushed[o];this.pushCallbacks.state&&this.pushCallbacks.state.forEach(u=>{u.onchange(m)});for(let u in m)this.pushCallbacks[u]&&this.pushCallbacks[u].forEach(p=>{typeof p=="object"&&p.onchange(m[u])})}this.pushRecord.pushed.splice(0,i)})}};addToState(s,h,i=null,o=this.defaultStartListenerEventLoop,m=!1){if(!this.listener.hasKey("pushToState")&&this.defaultStartListenerEventLoop&&this.setupSynchronousUpdates(),this.data[s]=h,this.setSequentialState({stateAdded:s}),i!==null)return this.addSecondaryKeyResponse(s,i,m,o)}get(s){return this.data[s]}getState(){return JSON.parse(JSON.stringifyFast(this.data))}setState(s={},h=!1){if(!this.listener.hasKey("pushToState")&&this.defaultStartListenerEventLoop&&(this.setupSynchronousUpdates(),this.pushRecord.pushed.push(JSON.parse(JSON.stringifyWithCircularRefs(s)))),s.stateUpdateTimeStamp=Date.now(),h){for(let i in s)if(i in this.pushToState){if(Array.isArray(this.pushToState[i])&&Array.isArray(s[i]))s[i]=this.pushToState[i].push(...s[i]);else if(typeof this.pushToState[i]=="object"&&typeof s[i]=="object"){for(let o in s[i])if(this.pushToState[i][o]){if(Array.isArray(this.pushToState[i][o])&&Array.isArray(s[i][o]))s[i][o]=this.pushToState[i][o].push(...s[i][o]);else if(typeof this.pushToState[i][o]=="object"&&typeof s[i][o]=="object"){for(let m in s[i][o])if(this.pushToState[i][o][m])Array.isArray(this.pushToState[i][o][m])&&Array.isArray(s[i][o][m])&&(s[i][o][m]=this.pushToState[i][o][m].push(...s[i][o][m]));else if(typeof this.pushToState[i][o][m]=="object"&&typeof s[i][o][m]=="object")for(let u in s[i][o][m])this.pushToState[i][o][m][u]&&Array.isArray(this.pushToState[i][o][m][u])&&Array.isArray(s[i][o][m][u])&&(s[i][o][m][u]=this.pushToState[i][o][m][u].push(...s[i][o][m][u]))}}}}}if(Object.assign(this.pushToState,s),Object.keys(this.triggers).length>0){this.triggers.state&&this.triggers.state.forEach(i=>{i.onchange(this.data)});for(let i of Object.getOwnPropertyNames(this.triggers))i in this.pushToState&&(this.data[i]=this.pushToState[i],delete this.pushToState[i],this.triggers[i].forEach(o=>{o.onchange(this.data[i])}))}return this.pushToState}subscribeTrigger(s=void 0,h=i=>{}){if(s){this.triggers[s]||(this.triggers[s]=[]);let i=this.triggers[s].length;return this.triggers[s].push({idx:i,onchange:h}),this.triggers[s].length-1}else return}subscribeTriggerOnce(s=void 0,h=i=>{}){let i,o=m=>{h(m),this.unsubscribeTrigger(s,i)};i=this.subscribeTrigger(s,o)}unsubscribeTrigger(s=void 0,h=0){let i,o=this.triggers[s];o&&o.find(u=>{if(u.idx===h)return!0})&&o.splice(i,1)}unsubscribeAllTriggers(s){s&&this.triggers[s]&&delete this.triggers[s]}setSequentialState(s={}){this.listener.hasKey("pushToState")||this.setupSynchronousUpdates(),s.stateUpdateTimeStamp=Date.now(),this.pushRecord.pushed.push(JSON.parse(JSON.stringify(s)))}subscribeSequential(s=void 0,h=void 0){if(s)if(this.data[s]===void 0&&s!=="state"&&this.addToState(s,null,void 0),this.pushCallbacks[s]||(this.pushCallbacks[s]=[]),h){let i=this.pushCallbacks[s].length;return this.pushCallbacks[s].push({idx:i,onchange:h}),this.pushCallbacks[s].length-1}else return;else return}subscribeSequentialOnce(s=void 0,h=i=>{}){let i,o=m=>{h(m),this.unsubscribeSequential(s,i)};i=this.subscribeSequential(s,o)}unsubscribeSequential(s=void 0,h=0){s&&this.pushCallbacks[s]&&this.pushCallbacks[s].find((i,o)=>{if(i.idx===h)return this.pushCallbacks[s].splice(o,1),!0})}unsubscribeAllSequential(s){s&&this.pushCallbacks[s]&&this.pushCallbacks[s]&&delete this.pushCallbacks[s]}setPrimaryKeyResponse(s=null,h=null,i=!1,o=this.defaultStartListenerEventLoop){if(h!==null)if(this.listener.hasKey(s))this.listener.onchange(s,h);else if(s!=null&&s!=="state")this.listener.addListener(s,this.data,s,h,this.data.stateUpdateInterval,i,o);else{if(!this.listener.hasKey("state")){let m=()=>{this.prev=Object.assign({},this.data)};this.listener.addListener("state",this.data,"__ANY__",m,this.interval)}return this.listener.addFunc("state",h)}}addSecondaryKeyResponse=(s=null,h=null,i=!1,o=this.defaultStartListenerEventLoop)=>{if(h!=null){if(this.listener.hasKey(s))return this.listener.addFunc(s,h);if(s!=null&&s!=="state")return this.listener.addListener(s,this.data,s,()=>{},this.data.stateUpdateInterval,i,o),this.listener.addFunc(s,h);if(!this.listener.hasKey("state")){let m=()=>{this.prev=Object.assign({},this.data)};this.listener.addListener("state",this.data,"__ANY__",m,this.interval)}return this.listener.addFunc("state",h)}};removeSecondaryKeyResponse(s=null,h=null,i=!0){s!==null?this.listener.hasKey(s)?this.listener.removeFuncs(s,h,i):console.error("key does not exist"):console.error("provide key")}clearAllKeyResponses(s=null){s===null?this.listener.remove(null):this.listener.hasKey(s)&&this.listener.remove(s)}getKeySubCallbacks(s){return this.listener.getFuncs(s)}removeState=this.unsubscribeAll;runSynchronousListeners(){this.defaultStartListenerEventLoop=!1,this.listener.startSync()}stop(s=null){this.listener.stop(s)}};JSON.stringifyFast===void 0&&(JSON.stringifyFast=function(){let D=new Map,s=[],h=["this"];function i(){D.clear(),s.length=0,h.length=1}function o(u,p){var d=s.length-1;if(s[d]){var f=s[d];if(typeof f=="object")if(f[u]===p||d===0)h.push(u),s.push(p.pushed);else for(;d-->=0;){if(f=s[d],typeof f=="object"&&f[u]===p){d+=2,s.length=d,h.length=d,--d,s[d]=p,h[d]=u;break}d++}}}function m(u,p){let d;if(p!=null)if(typeof p=="object"){let f=p.constructor.name;u&&f==="Object"&&o(u,p);let r=D.get(p);if(r)return"[Circular Reference]"+r;if(D.set(p,h.join(".")),f==="Array")p.length>20?d=p.slice(p.length-20):d=p;else if(f.includes("Set"))d=Array.from(p);else if(f!=="Object"&&f!=="Number"&&f!=="String"&&f!=="Boolean")d="instanceof_"+f;else if(f==="Object"){let a={};for(let t in p)if(p[t]==null)a[t]=p[t];else if(Array.isArray(p[t]))p[t].length>20?a[t]=p[t].slice(p[t].length-20):a[t]=p[t];else if(p[t].constructor.name==="Object"){a[t]={};for(let n in p[t])if(Array.isArray(p[t][n]))p[t][n].length>20?a[t][n]=p[t][n].slice(p[t][n].length-20):a[t][n]=p[t][n];else if(p[t][n]!=null){let g=p[t][n].constructor.name;g.includes("Set")?a[t][n]=Array.from(p[t][n]):g!=="Number"&&g!=="String"&&g!=="Boolean"?a[t][n]="instanceof_"+g:a[t][n]=p[t][n]}else a[t][n]=p[t][n]}else{let n=p[t].constructor.name;n.includes("Set")?a[t]=Array.from(p[t]):n!=="Number"&&n!=="String"&&n!=="Boolean"?a[t]="instanceof_"+n:a[t]=p[t]}d=a}else d=p}else d=p;return d}return function(p,d){s.push(p);let f=JSON.stringify(p,m,d);return i(),f}}());JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=function(){let D=new Map,s=[],h=["this"];function i(){D.clear(),s.length=0,h.length=1}function o(u,p){var d=s.length-1,f=s[d];if(typeof f=="object")if(f[u]===p||d===0)h.push(u),s.push(p.pushed);else for(;d-->=0;){if(f=s[d],typeof f=="object"&&f[u]===p){d+=2,s.length=d,h.length=d,--d,s[d]=p,h[d]=u;break}d--}}function m(u,p){if(p!=null&&typeof p=="object"){u&&o(u,p);let d=D.get(p);if(d)return"[Circular Reference]"+d;D.set(p,h.join("."))}return p}return function(p,d){try{return s.push(p),JSON.stringify(p,m,d)}finally{i()}}}());var qe=class{constructor(s=void 0){this.state=new Qe({},void 0,!1),this.manager=s,s!==void 0&&(s.responses.find(i=>{if(i.name==="eventmanager")return!0})||s.addCallback("eventmanager",this.callback))}subEvent(s,h=i=>{console.log(s,i)}){return this.state.subscribeTrigger(s,h)}unsubEvent(s,h){return this.state.unsubscribeTrigger(s,h)}async addEvent(s,h=void 0,i=void 0,o=void 0){if(this.state.setState({[s]:void 0}),this.manager!==void 0&&(o!==void 0||i!==void 0))return h!==void 0?await this.manager.post({origin:o,foo:"addevent",input:[s,i]},h):(this.manager.workers.forEach(m=>{this.manager.post({origin:o,foo:"addevent",input:[s,i]},m.id)}),!0)}removeEmitter(s){this.state.unsubscribeAllTriggers(s)}emit=(s,h,i=void 0,o=void 0,m=void 0)=>{let u={eventName:s,output:h};!h||!s||(this.manager!==void 0?i!==void 0?this.manager.post(u,i,o):this.manager.workers.forEach(p=>{this.manager.post(u,p.id,o)}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&(m?m.postMessage(u,void 0,o):globalThis.postMessage(u,void 0,o)),this.state.setState({[s]:h}))};callback=s=>{typeof s=="object"&&s.eventName!==void 0&&s.output!==void 0&&this.state.setState({[s.eventName]:s.output})};export=()=>this};var et=async D=>await import(D);function hn(D){return D.toString().replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")}function cn(D){let s=D.toString();return s.slice(0,s.indexOf("{")+1)}function pn(head,body){let newFunc=eval(head+body+"}");return newFunc}function fn(D){let s=new RegExp("(|[a-zA-Z]w*|([a-zA-Z]w*(,s*[a-zA-Z]w*)*))s*=>"),h=typeof D=="string"?D.substring(0,10).includes("function"):!1,i=typeof D=="string"?s.test(D):!1;return!!(h||i)}function Ee(method){let getFunctionBody=D=>D.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4"),getFunctionHead=D=>{let s=D.indexOf(")");return D.slice(0,D.indexOf("{",s)+1)},newFuncHead=getFunctionHead(method),newFuncBody=getFunctionBody(method),newFunc;if(newFuncHead.includes("function ")){let D=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(D,newFuncBody)}else if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let D=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(D,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else newFunc=eval(newFuncHead+newFuncBody+"}");return newFunc}var Ae=class{constructor(){}static genSineWave(s=20,h=1,i=1,o=512,m=0,u=1){for(var p=[],d=[],f=1/o,r=0;r<i;r+=f){var a=Math.sin(2*Math.PI*s*r)*h;a+=Math.sin(2*Math.PI*m*r)*u,p.push(a),d.push(r)}return[d,p]}static getSineAmplitude(s=20,h=1,i=0,o=0){return Math.sin(this.TWO_PI*s*i+o)*h}static mean(s){var h=s.reduce((i,o)=>o+=i);return h/s.length}static mode(s){return s.sort((h,i)=>s.filter(o=>o===h).length-s.filter(o=>o===i).length).pop()}static std(s,h=void 0){let i=h;h||(i=this.mean(s));let o=0;for(let m=0;m<s.length;m++){let u=s[m]-i;o+=u*u}return Math.sqrt(o/s.length)}static relError(s=[],h=[],i=!0){if(s.length!==h.length)throw new Error("Input arrays of same length!");let o=s.length,m=new Array(s.length);for(let u=0;u<o;u++){let p=(s[u]-h[u])/s[u];i&&(p=Math.abs(p)),m[u]=p}return m}static informationEntropy(s=[]){let h=s.length,i=new Array(h);for(let o=0;o<h;o++){let m=s[o]*Math.log(s[o]);isNaN(m)&&(m=0),i[o]=m}return i}static zscore(s){let h=this.mean(s),i=this.std(s,h),o=new Array().length(s.length);for(let m=0;m<s.length;m++)o[m]=(s[m]-h)/i;return o}static variance(s){var h=this.mean(s);return s.reduce((i,o)=>i+(o-h)**2,0)/s.length}static dot(s,h){for(var i=0,o=0;o<s.length;o++)i+=s[o]*h[o];return i}static cross3D(s,h){return[s[1]*h[2]-s[2]*h[1],s[2]*h[0]-s[0]*h[2],s[0]*h[1]-s[1]*h[0]]}static magnitude(s){var h=0;return s.forEach(i=>{h+=i*i}),Math.sqrt(h)}static distance(s,h){var i=0;return s.forEach((o,m)=>{i+=(h[m]-o)*(h[m]-o)}),Math.sqrt(i)}static midpoint(s=[1,2,3],h=[3,4,5]){return s.map((i,o)=>(i+h[o])*.5)}static normalize(s){var h=0;h=this.magnitude(s);var i=new Array(s.length);return s.forEach((o,m)=>{i[m]=o*h}),i}static normalizeSeries(s=[],h=!0){let i=Math.max(...s),o=Math.min(...s);return h==!1&&(i=Math.max(i,Math.abs(o)),o=0),i-o===0&&(o=0,i===0&&(i=1e-13)),s.map(m=>(m-o)/(i-o))}static quadraticFormula(s,h,i){let o=Math.sqrt(h*h-4*s*i);if(!isNaN(o))return["complex","complex"];let m=1/(2*s);if(o===0)return[h*m];let u=-h;return[(u+o)*m,(u-o)*m]}static newtonsMethod(s=u=>Math.pow(u,5)+u*u-u-.2,h=0,i=1,o=.01,m=10){let u=[];for(let p=0;p<m;p++){let d=Math.random()*(i-h),f=s(d),r=s(d+o),a=(r-f)/o,t=d+o;for(;Math.abs(a)>o;){let v=-f/T,k=t+v;f=r,r=s(k);let T=(r-f)/(k-t)}let n,g=u.find((v,k)=>{if(Math.abs(xn1-v)<o)return n=k,!0});g?u[n]=(xn1+g)*.5:u.push(xn1)}return u}static makeVec(s,h){var i=[];return s.forEach((o,m)=>{i.push(h[m]-o)}),i}static combinations(s=["a","b","c"],h=3){var i=[];return h<=0?i.push([]):Ae.combinations(s,h-1).forEach(function(o){s.forEach(function(m){i.push([m].concat(o))})}),i}static generateCoordinateSpace(s=[10,10,10],h=[-10,-10,-10],i=[1,1,1],o=void 0){for(let d=0;d<s.length;d++)if(h[d]>s[d]){let f=s[d];s[d]=h[d],h[d]=f}let m=[],u=[...s],p=u.length-1;for(m.push([...u]);u[0]>=h[0];){let d=r=>{if(u[r]<=h[r]){if(r===0||(u[r]=s[r],r--,r<0))return;typeof i[r]=="function"?u[r]-=i[r](u[r]):u[r]-=i[r],d(r)}},f=p;typeof i[f]=="function"?u[f]-=i[f](u[f]):u[f]-=i[f],m.push([...u]),d(f),o&&(m[m.length-1]=o(m[m.length-1]))}return m}static calcVectorField(s=[[0,0],[0,1],[1,0],[1,1]],h=(i,o)=>[i*10,o*10]){return s.map(i=>h(...i))}static transpose(s){return s[0].map((h,i)=>s.map(o=>o[i]))}static matmul(s,h){for(var i=s.length,o=s[0].length,m=h.length,u=h[0].length,p=new Array(i),d=0;d<i;++d){p[d]=new Array(u);for(var f=0;f<u;++f){p[d][f]=0;for(var r=0;r<o;++r)p[d][f]+=s[d][r]*h[r][f]}}return p}static matscale(s,h){let i=[];for(var o=0;o<s.length;o++){i[o]=[];for(let m=0;m<s[0].length;m++)i[o][m]=s[o][m]*h}return i}static matadd(s,h){let i=[];for(let m=0;m<s.length;m++){i[m]=[];for(var o=0;o<s[0].length;o++)i[m][o]=s[m][o]+h[m][o]}return i}static matsub(s,h){let i=[];for(let m=0;m<s.length;m++){i[m]=[];for(var o=0;o<s[0].length;o++)i[m][o]=s[m][o]-h[m][o]}return i}static histogram(s=[],h=1,i=void 0){let o=[...s];o.sort(function(f,r){return f-r});let m=Math.min(...o);if(typeof i=="number"){let f=Math.max(...o);h=Math.abs((f-m)/(i-1))}let u=m,p=[],d=[];for(let f=0;f<o.length;f++){let r=h*u;if(o[f]>m+r){u++,r+=h;let t=m+r+r*.5;p.push(t),d.push(0)}d[d.length-1]++}return[p,d]}static normalDistribution(s=[],h=!0,i=1e-4){let o=this.mean(s),m=this.variance(s),u=s.length,p=[],d=1/(this.TWO_PI*m),f=1/m,r=0;for(let a=0;a<u;a++){let t=Math.exp(-.5*Math.pow((s[a]-o)*f,2))*d;t<i&&(t=0),p.push(t),r+=t}if(h){let a=1/r;p=p.map(t=>t*a)}return p}static expectedValue(s=[],h=this.normalDistribution(s)){return s.reduce((i,o,m)=>i+o*h[m])}static originMoment(s=[],h=this.normalDistribution(s),i=1){return s.reduce((o,m,u)=>o+Math.pow(m,i)*h[u])}static centralMoment(s=[],h=this.normalDistribution(s),i=1){let o=this.mean(s);return s.reduce((m,u,p)=>m+Math.pow(u-o,i)*h[p]/s.length)}static linearDiscriminantAnalysis(s=[],h=[]){let i=this.mean(s),o=this.mean(h),m=this.cov1d(s,h),u=this.normalDistribution(s),p=[];for(let d=0;d<s.length;d++)p.push(x[d]*m*o-.5*i*m*o+Math.log10(u[d]));return p}static conv1D(s=[],h=[1/3,1/3,1/3],i=Math.floor(h.length*.5)){let o=[],m=1/h.length;if(i>0){let d=new Array(i).fill(0);s=[...d,...s,...d]}let u=Math.floor(h.length*.5),p=s.length-h.length+u;for(let d=u;d<p;d++){let f=0;for(let r=0;r<h.length;r++)f+=s[d-u]*h[r];o.push(f*m)}return o}static conv2D(s=[[],[],[]],h=[[],[],[]],i=0){let o=new Array(s.length-Math.ceil(h.length*.5)).fill([]),m,u=Ae.transpose(u);if(i>0){let k=new Array(i).fill(0);m=Ae.transpose(s);for(let T=0;T<m.length;T++)m[T]=[...k,...m[T],...k];s=Ae.transpose(m);for(let T=0;T<s.length;T++)s[T]=[...k,...s[T],...k]}let p=Math.floor(h[0].length*.5),d=Math.floor(u[0].length*.5),f=s[0].length-h[0].length+p,r=m[0].length-u[0].length+d,a=1/(h[0].length*u[0].length),t=f*r,n=p,g,v=d;for(;n<t;){let k=0;g=n%s[0].length,g===0&&v++;for(let T=0;T<h[0].length;T++){for(let A=0;A<u[0].length;T++)k+=s[v-d+A][g-p+T]*h[A][T];o[v].push(k*a)}n++}return o}static cov2d(s){var h=this.transpose(s),i=[],o=[],m=[];s.forEach((v,k)=>{o.push(this.mean(v))}),h.forEach((v,k)=>{m.push(this.mean(v))}),s.forEach((v,k)=>{i.push([]);for(var T=0;T<v.length;T++)i[k].push((s[k][T]-o[k])*(s[k][T]-m[T])/(v.length-1))});for(var u=this.transpose(i),p=i.length,d=i[0].length,f=u.length,r=u[0].length,a=new Array(p),t=0;t<p;++t){a[t]=new Array(r);for(var n=0;n<r;++n){a[t][n]=0;for(var g=0;g<d;++g)a[t][n]+=i[t][g]*u[g][n]/(s[0].length-1)}}return a}static cov1d(s=[],h=[]){return this.cov2d([s,h])}static cov3d(s=[],h=[],i=[]){return[[this.cov1d(s,s),this.cov1d(s,h),this.cov1d(s,i)],[this.cov1d(h,s),this.cov1d(h,h),this.cov1d(h,i)],[this.cov1d(i,s),this.cov1d(i,h),this.cov1d(i,i)]]}static covNd(s=[]){let h=[];s.forEach((i,o)=>{h.push([]),s.forEach((m,u)=>{h[o].push(this.cov1d(i,m))})})}static eigens2x2(s=[[1,2],[3,4]]){let h=s[0][0]*s[1][1]-s[0][1]*s[1][0],i=(s[0][0]+s[1][1])*.5,o=Math.sqrt(i*i-h),m=i+o,u=i-o;return[m,u]}static eigenvectors2x2(s=[[1,2],[3,4]],h=[1,2]){let i=[-s[0][1],s[0][0]-h[0]];i[0]===0&&i[1]===0&&(i[0]=s[1][1]-h[0],i[1]=-s[1][0]);let o=[-s[0][1],s[0][0]-h[1]];return o[0]===0&&o[1]===0&&(o[0]=s[1][1]-h[1],o[1]=-s[1][0]),[i,o]}static fastpca2d(s,h){let i=this.cov1d(s,h),o=this.eigens2x2(i);o[1]>o[0]&&o.reverse();let m=this.eigenvectors2x2(i,o);return console.log(o,m),[o,m]}static crosscorrelation(s,h){var i=[...h,...Array(h.length).fill(0)],o=this.mean(s),m=this.mean(h),u=s.reduce((t,n)=>t+=Math.pow(n-o,2));u=Math.sqrt(u);var p=h.reduce((t,n)=>t+=Math.pow(n-o,2));p=Math.sqrt(p);for(var d=1/(u*p),f=new Array(s.length).fill(0),r=0;r<s.length;r++){var a=s.reduce((t,n,g)=>t+=(n-o)*(i[r+g]-m));f[r]=a*d}return f}static autocorrelation(s){var h=[...s,...Array(s.length).fill(0)],i=this.mean(s),o=s.reduce((f,r)=>f+=Math.pow(r-i,2));o=Math.sqrt(o);for(var m=1/(o*o),u=new Array(s.length).fill(0),p=0;p<s.length;p++){var d=s.reduce((f,r,a)=>f+=(r-i)*(h[p+a]-i));u[p]=d*m}return u}static autocorrelation2dNormalized(s){let h=[];for(let i=0;i<s.length;i++){h.push([]);for(let o=0;o<s[i].length;o++){let m=0,u=0;for(let p=0;p<s.length;p++)for(let d=0;d<s[p].length;d++)m+=s[i][o]*s[s.length-1-p][s[i].length-1-d],u+=s[i][o]*s[s.length-1][s[i].length-1];h[i][o]=m/u-1}}return h}static crosscorrelation2d(s,h){let i=[];for(let o=0;o<s.length;o++){i.push([]);for(let m=0;m<s[o].length;m++){let u=0;for(let p=0;p<h.length;p++)for(let d=0;d<h[p].length;d++)u+=s[o][m]*h[h.length-1-p][h[o].length-1-d];i[o][m]=u}}return i}static crosscorrelation2dNormalized(s,h){let i=[];for(let o=0;o<s.length;o++){i.push([]);for(let m=0;m<s[o].length;m++){let u=0,p=0;for(let d=0;d<h.length;d++)for(let f=0;f<h[d].length;f++)u+=s[o][m]*h[mat2d.length-1-d][h[o].length-1-f],p+=s[o][m]*h[h.length-1][h[o].length-1];i[o][m]=u/p-1}}return i}static correlograms(s=[[],[]]){var h=[];return s.forEach((i,o)=>{s.forEach((m,u)=>{u>=o&&h.push(Ae.crosscorrelation(i,m))})}),h}static dft(s=[]){for(var h=6.283185307179586,i=[],o=[],m=[],u=0;u<s.length;u++){i.push(0),o.push(0);for(var p=0;p<s.length;p++){var d=h*u*p/s.length;i[u]=i[u]+s[p]*Math.cos(d),o[u]=o[u]-s[p]*Math.sin(d)}m.push(Math.sqrt(i[u]*i[u]+o[u]*o[u]))}function f(t){return[...t.slice(Math.ceil(t.length*.5),t.length),...t.slice(0,Math.ceil(t.length*.5))]}m=f(m);let r=m.length*.5,a=m.map((t,n)=>n-r);return{real:i,imag:o,freqs:a,mags:m}}static sma(s=[],h){for(var i=[],o=0;o<s.length;o++)if(o==0)i.push(s[0]);else if(o<h){var m=s.slice(0,o+1);i.push(m.reduce((u,p)=>p+=u)/(o+1))}else{var m=s.slice(o-h,o);i.push(m.reduce((p,d)=>d+=p)/h)}return i}static sum(s=[]){if(s.length>0){var h=s.reduce((i,o)=>o+=i);return h}else return 0}static reduceArrByFactor(s,h=2){return s.filter((o,m)=>m%h===0)}static makeArr(s,h,i){for(var o=[],m=(h-s)/(i-1),u=0;u<i;u++)o.push(s+m*u);return o}static autoscale(s,h=1,i=0,o=!1){if(s?.length===0)return s;let m=Math.max(...s),u=Math.min(...s),p=1/h,d;if(o){let f=Math.max(Math.abs(u),Math.abs(m));return d=p/f,s.map(r=>r*d+(p*(i+1)*2-1-p))}else return d=p/(m-u),s.map(f=>2*((f-u)*d-1/(2*h))+(p*(i+1)*2-1-p))}static absmax(s){return Math.max(Math.abs(Math.min(...s)),Math.max(...s))}static downsample(s,h,i=1){if(s.length>h){let o=new Array(h),m=s.length/h,u=s.length-1,p=0,d=0;for(let f=m;f<s.length;f+=m){let r=Math.round(f);r>u&&(r=u);for(let a=p;a<r;a++)o[d]+=s[a];o[d]/=(r-p)*i,d++,p=r}return o}else return s}static interpolateArray(s,h,i=1){var o=function(t,n,g){return(t+(n-t)*g)*i},m=new Array,u=new Number((s.length-1)/(h-1));m[0]=s[0];for(var p=1;p<h-1;p++){var d=p*u,f=new Number(Math.floor(d)).toFixed(),r=new Number(Math.ceil(d)).toFixed(),a=d-f;m[p]=o(s[f],s[r],a)}return m[h-1]=s[s.length-1],m}static isExtrema(s,h="peak"){let i=[...s];if(i.length%2===0&&i.pop(),s.length>1){let o=!0;for(let m=0;m<i.length;m++){let u=i[m];if(h==="peak"){if(m<Math.floor(i.length*.5)&&u>=i[Math.floor(i.length*.5)]){o=!1;break}else if(m>Math.floor(i.length*.5)&&u>=i[Math.floor(i.length*.5)]){o=!1;break}}else if(h==="valley"){if(m<Math.floor(i.length*.5)&&u<=i[Math.floor(i.length*.5)]){o=!1;break}else if(m>Math.floor(i.length*.5)&&u<=i[Math.floor(i.length*.5)]){o=!1;break}}else if(m<Math.floor(i.length*.5)&&u<=i[Math.floor(i.length*.5)]){o=!1;break}else if(m>Math.floor(i.length*.5)&&u<=i[Math.floor(i.length*.5)]){o=!1;break}}if(h!=="peak"&&h!=="valley"&&o===!1){o=!0;for(let m=0;m<i.length;m++){let u=i[m];if(m<Math.floor(i.length*.5)&&u>=i[Math.floor(i.length*.5)]){o=!1;break}else if(m>Math.floor(i.length*.5)&&u>=i[Math.floor(i.length*.5)]){o=!1;break}}}return o}else return}static isCriticalPoint(s,h="peak"){let i=[...s];if(i.length%2===0&&i.pop(),s.length>1){let o=!0;for(let m=0;m<i.length;m++){let u=i[m];if(h==="peak"){if(m<i.length*.5&&u<=0){o=!1;break}else if(m>i.length*.5&&u>0){o=!1;break}}else if(h==="valley"){if(m<i.length*.5&&u>=0){o=!1;break}else if(m>i.length*.5&&u<0){o=!1;break}}else if(m<i.length*.5&&u>=0){o=!1;break}else if(m>i.length*.5&&u<0){o=!1;break}}if(h!=="peak"&&h!=="valley"&&o===!1){o=!0;for(let m=0;m<i.length;m++){let u=i[m];if(m<i.length*.5&&u<=0){o=!1;break}else if(m>i.length*.5&&u>0){o=!1;break}}}return o}else return}static getPeakThreshold(s,h,i){let o,m=s.filter((u,p)=>{if(h.indexOf(p)>-1)return!0});return i===0?o=this.mean(m):o=(i+this.mean(m))*.5,o}static column(s,h){let i=new Array(s.length).fill(0).map(()=>new Array(1).fill(0));for(let o=0;o<s.length;o++)i[o][0]=s[o][h];return i}static flatten_vector(s){let h=[];for(let i=0;i<s.length;i++)h[i]=s[i][0];return h}static squared_difference(s,h){let i=0;for(let o=0;o<s.length;o++)i=i+Math.pow(s[o]-h[o],2);return i}static shift_deflate(s,h,i){let o=Math.sqrt(this.matmul(this.transpose(i),i)),m=this.matscale(i,1/o),u=this.matscale(this.matmul(m,this.transpose(m)),h);return this.matsub(s,u)}static eigenvalue_of_vector(s,h){return ev=this.matmul(this.matmul(this.transpose(h),s),h),ev}static power_iteration(s,h=1e-5,i=1e3){let o=s.length,m=new Array(o).fill(0).map(()=>new Array(1).fill(Math.sqrt(o))),u=this.eigenvalue_of_vector(s,m),p=1,d=0;for(;p>h&&d<i;){let f=JSON.parse(JSON.stringify(u)),r=this.matmul(s,m);m=this.normalize(r),u=this.eigenvalue_of_vector(s,m),p=Math.abs(u-f),d++}return[u,m]}static eigens(s,h=1e-4,i=1e3){let o=[],m=[];for(let u=0;u<s.length;u++){let p=this.power_iteration(s,h,i),d=p[0],f=p[1];o[u]=d,m[u]=this.flatten_vector(f),s=this.shift_deflate(s,d,f)}return[o,m]}static pca(s,h=1e-5){let i=s.length,o=new Array(i),m=new Array(i),u=this.transpose(s);o[0]=this.column(s,0);let p=1,d=0;for(;espilon>h;){d++,m[0]=this.matmul(u,o[0]);let r=this.matmul(this.transpose(o[0]),o[0]);m[0]=this.matscale(m[0],1/r);let a=Math.sqrt(this.matmul(this.transpose(m[0]),m[0]));m[0]=this.matscale(m[0],1/a);let t=this.matmul(s,m[0]),n=this.matmul(this.transpose(m[0]),m[0]);t=this.matscale(t,1/n),p=this.squared_difference(o[0],t),o[0]=JSON.parse(JSON.stringify(t))}return this.matmul(this.transpose(o[0]),o[0])}static p300(s=[],h=[],i=[],o=256){let m=Math.floor(o/10),u=this.sma(h,m),p=this.peakDetect(u,"peak",m),d=this.mean(u),f=this.std(u,d),r=0,a=[];return p.length>0&&s.forEach((t,n)=>{for(;i[p[r]]<t+200&&(r++,!!p[r]););let g=0,v=[];for(;i[p[r+g]]<t+600&&(v.push(r+g),g++,!!p[r+g]););if(v.length>1){let k=[];v.forEach(E=>{k.push(u[p[E]])});let T=Math.max(...k),A=v[k.indexOf(T)];a.push({event_timestamp:t,event_index:n,peak_timestamp:i[[p[A]]],signal_index:[p[A]],signal_amplitude:h[[p[A]]],zscore:(u[p[A]]-d)/f})}else v.length===1&&a.push({event_timestamp:t,event_index:n,peak_timestamp:i[p[v[0]]],signal_index:p[v[0]],signal_amplitude:h[[p[v[0]]]],zscore:(u[p[v[0]]]-d)/f})}),a}},q=Ae;oe(q,"TWO_PI",Math.PI*2),oe(q,"C",299792458),oe(q,"G",66743e-15),oe(q,"h",662607015e-42),oe(q,"R",8314.32),oe(q,"Ra",287),oe(q,"H",69.3),oe(q,"kbar",1054571817e-43),oe(q,"kB",1380649e-29),oe(q,"ke",89875517923e-1),oe(q,"me",91093837015e-41),oe(q,"mp",167262192369e-38),oe(q,"mn",167492749804e-38),oe(q,"P0",101325),oe(q,"T0",288.15),oe(q,"p0",1.225),oe(q,"Na",60220978e16),oe(q,"y",1.405),oe(q,"M0",28.96643),oe(q,"g0",9.80665),oe(q,"Re",6378100),oe(q,"B",1458e-9),oe(q,"S",110.4),oe(q,"Sigma",365e-12),oe(q,"imgkernels",{edgeDetection:[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],boxBlur:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]],sobelLeft:[[1,0,-1],[2,0,-2],[1,0,-1]],sobelRight:[[-1,0,1],[-2,0,2],[-1,0,1]],sobelTop:[[1,2,1],[0,0,0],[-1,-2,-1]],sobelBottom:[[-1,2,1],[0,0,0],[1,2,1]],identity:[[0,0,0],[0,1,0],[0,0,0]],gaussian3x3:[[1,2,1],[2,4,2],[1,2,1]],guassian7x7:[[0,0,0,5,0,0,0],[0,5,18,32,18,5,0],[0,18,64,100,64,18,0],[5,32,100,100,100,32,5],[0,18,64,100,64,18,0],[0,5,18,32,18,5,0],[0,0,0,5,0,0,0]],emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],sharpen:[[0,-1,0],[-1,5,-1],[0,-1,0]]}),oe(q,"integral",(s=o=>o,h=[],i=.01)=>{let o=0;for(let m=h[0];m<h[1];m+=i)o+=s(m)*i;return o}),oe(q,"dintegral",(s=(m,u)=>m+u,h=[[],[]],i=.01,o=i)=>{let m=0;for(let u=h[0][0]+i;u<h[0][1];u+=i)for(let p=h[1][0]+o;p<h[1][1];p+=o)m+=s(u,p)*i*o;return m}),oe(q,"tintegral",(s=(u,p,d)=>u+p+d,h=[[],[],[]],i=.01,o=i,m=i)=>{let u=0;for(let p=h[0][0]+i;p<h[0][1];p+=i)for(let d=h[1][0]+o;d<h[1][1];d+=o)for(let f=h[2][0]+m;f<h[2][1];f+=m)u+=s(p,d,f)*i*o*m;return u}),oe(q,"pintegral",(s=o=>o,h=[],i=.01)=>{let o=0,m,u;for(let p=h[0];p<h[1];p+=i)m=u,u=s(p),m&&(o+=Ae.distance([0,m],[i,u]));return o}),oe(q,"meshgrid",Ae.generateCoordinateSpace),oe(q,"autocorrelation2d",s=>{let h=[];for(let i=0;i<s.length;i++){h.push([]);for(let o=0;o<s[i].length;o++){let m=0;for(let u=0;u<s.length;u++)for(let p=0;p<s[u].length;p++)m+=s[i][o]*s[s.length-1-u][s[i].length-1-p];h[i][o]=m}}return h}),oe(q,"upsample",Ae.interpolateArray),oe(q,"peakDetect",(s,h="peak",i=49)=>{let o=Math.floor(i*.5),m=[];for(let u=0;u<s.length-i;u++)Ae.isExtrema(s.slice(u,u+i),h)&&m.push(u+o-1);return m});Object.assign(Math,q);var Pe=class{constructor(s){this.callbackManager=s,s.Math2=q,this.callbacks=[{case:"xcor",callback:(h,i,o)=>q.crosscorrelation(...i)},{case:"autocor",callback:(h,i,o)=>q.autocorrelation(i)},{case:"cov1d",callback:(h,i,o)=>q.cov1d(...i)},{case:"cov2d",callback:(h,i,o)=>q.cov2d(i)},{case:"sma",callback:(h,i,o)=>q.sma(...i)}],this.addCallbacks()}addCallbacks(s=this.callbacks){s.forEach(h=>{this.callbackManager.addCallback(h.case,h.callback),h.aliases&&h.aliases.forEach(i=>{this.callbackManager.addCallback(i,h.callback)})})}};var vn=_i(Gt());function wi(D,s){return D+s}function Ei(D,s){return D-s}function Ai(D,s){return D*s}function ki(D,s){return D/s}function Ii(D,s,h,i){return[D+h,s+i]}function Di(D,s,h,i){return[D-h,s-i]}function Ci(D,s,h,i){return[D*h-s*i,D*i+s*h]}function Fi(D,s){let h=Math.exp(D);return[h*Math.cos(s),h*Math.sin(s)]}function be(D,s){return Math.sqrt(D*D+s*s)}function Ri(D){return 0-D}function Li(D){let s=Math.sqrt(D);for(var h=3;h<=s;){if(D%h===0)return h;h+=2}}function dt(D,s){for(var h=0,i=0;i<s;i++)h+=D[i];return h/s}function mt(D,s,h){for(var i=0,o=0;o<h;o++)i+=(D[o]-s)*(D[o]-s);return Math.sqrt(i)}function Mi(D,s,h){for(var i=0,o=0,m=0;m<h;m++)o=D[m]-s,i+=o*o;return i/h}function $i(D,s,h){for(var i=0,o=0,m=0;m<h;m++)o=D[m]-s,i+=o*o;return Math.sqrt(i/h)}function gt(D,s,h,i,o,m,u,p){for(var d=0,f=0;f<u;f++){var r=f+p,a=0;r<u&&(a=i[r]),d+=(D[f]-s)*(a-o)}return d/(h*m)}function Vi(D,s,h){for(var i=0,o=0;o<s;o++)i+=Math.exp(D[o]);return Math.exp(D[h])/i}function Ne(D,s,h){for(var i=0,o=0,m=1/s,u=6.28318530718*h*m,p=0;p<s;p++){var d=u*p;i=i+D[p]*Math.cos(d),o=o-D[p]*Math.sin(d)}return[i*m,o*m]}function xt(D,s,h,i){for(var o=0,m=0,u=1/s,p=6.28318530718*h*u,d=0;d<s;d++){var f=p*d;o=o+D[d+(s-1)*i]*Math.cos(f),m=m-D[d+(s-1)*i]*Math.sin(f)}return[o*u,m*u]}function Ke(D,s,h,i){var o=0,m=0,u=1/s,p=6.28318530718*h*u,d=1,f=0,r=i*.25;if(h<=r)for(;h<=r;)r=r*.5,d+=1;for(var a=0;a<s;a+=d){var t=a;t>s&&(t=s);var n=p*t;o=o+D[t]*Math.cos(n),m=m-D[t]*Math.sin(n),f+=1}return[o/f,m/f]}function Wt(D,s,h,i,o){var m=0,u=0,p=1/s,d=6.28318530718*h*p,f=1,r=0,a=o*.25;if(h<=a)for(;h<=a;)a=a*.5,f+=1;for(var t=0;t<s;t+=f){var n=t;n>s&&(n=s);var g=d*n;m=m+D[n+(s-1)*i]*Math.cos(g),u=u-D[n+(s-1)*i]*Math.sin(g),r+=1}return[m/r,u/r]}function tt(D,s,h){for(var i=0,o=0,m=1/s,u=6.28318530718*h*m,p=0;p<s;p++){var d=u*p;i=i+D[p]*Math.cos(d),o=D[p]*Math.sin(d)-o}return[i*m,o*m]}function jt(D,s,h,i){for(var o=0,m=0,u=1/s,p=6.28318530718*h*u,d=0;d<s;d++){var f=p*d;o=o+D[d+(s-1)*i]*Math.cos(f),m=D[d+(s-1)*i]*Math.sin(f)-m}return[o*u,m*u]}function it(D,s,h,i){var o=0,m=0,u=1/s,p=6.28318530718*h*u,d=1,f=0,r=i*.25;if(h<=r)for(;h<=r;)r=r*.5,d+=1;for(var a=0;a<s;a+=d){var t=a;t>s&&(t=s);var n=p*t;o=o+D[t]*Math.cos(n),m=D[t]*Math.sin(n)-m,f+=1}return[o/f,m/f]}function Ht(D,s,h,i,o){var m=0,u=0,p=1/s,d=6.28318530718*h*p,f=1,r=0,a=o*.25;if(h<=a)for(;h<=a;)a=a*.5,f+=1;for(var t=0;t<s;t+=f){var n=t;n>s&&(n=s);var g=d*n;m=m+D[n+(s-1)*i]*Math.cos(g),u=D[n+(s-1)*i]*Math.sin(g)-u,r+=1}return[m/r,u/r]}function Ni(D,s){var h=Math.floor(this.thread.x/s)*2,i=this.thread.x-Math.floor(this.thread.x/s)*s,o=dt(D[h],s),m=dt(D[h+1],s),u=mt(D[h],o,s),p=mt(D[h+1],m,s),d=gt(D[h],o,u,D[h+1],m,p,s,i);return d}function Oi(D,s,h,i){var o=Math.floor(this.thread.x/s)*2,m=this.thread.x-Math.floor(this.thread.x/s)*s,u=h[o],p=h[o+1],d=i[o],f=i[o+1],r=gt(D[o],u,d,D[o+1],p,f,s,m);return r}function zi(D,s,h){var i=Ne(D,s,this.thread.x);return be(i[0],i[1])*h}function Pi(D,s,h){var i=tt(D,s,this.thread.x);return be(i[0],i[1])*h}function Ut(D,s,h,i){var o=Ke(D,s,this.thread.x,i);return be(o[0],o[1])*h}function Bt(D,s,h,i){var o=it(D,s,this.thread.x,i);return be(o[0],o[1])*h}function Ki(D,s){var h=this.output.x,i=Ne(D[this.thread.y],h,this.thread.x);return be(i[0],i[1])*s}function Gi(D,s,h){var i=[0,0];if(this.thread.x<=s)i=Ne(D,s,this.thread.x);else{var o=Math.floor(this.thread.x/s);i=xt(D,s,this.thread.x-o*s,o)}return be(i[0],i[1])*h}function Ui(D,s,h,i){var o=[0,0];if(this.thread.x<=s)o=Ke(D,s,this.thread.x,i);else{var m=Math.floor(this.thread.x/s);o=Wt(D,s,this.thread.x-m*s,m,i)}return be(o[0],o[1])*h}function Bi(D,s,h,i,o){var m=[0,0],u=this.thread.x/s*(i-h)+h;return m=Ne(D,s,u),be(m[0],m[1])*o}function Wi(D,s,h,i,o){var m=[0,0],u=this.thread.x/s*(i-h)+h;return m=Ke(D,s,u),be(m[0],m[1])*o}function ji(D,s,h,i,o){var m=[0,0],u=this.thread.x/s*(i-h)+h;return m=tt(D,s,u),be(m[0],m[1])*o}function Hi(D,s,h,i,o){var m=[0,0],u=this.thread.x/s*(i-h)+h;return m=it(D,s,u),be(m[0],m[1])*o}function Xi(D,s,h,i,o){var m=[0,0];if(this.thread.x<s){var u=this.thread.x/s*(i-h)+h;m=Ne(D,s,u)}else{var p=Math.floor(this.thread.x/s),u=(this.thread.x-p*s)/s*(i-h)+h;m=xt(D,s,u-p*s,p)}return be(m[0],m[1])*o}function Yi(D,s,h,i,o){var m=[0,0];if(this.thread.x<s){var u=this.thread.x/s*(i-h)+h;m=Ke(D,s,u,s)}else{var p=Math.floor(this.thread.x/s),u=(this.thread.x-p*s)/s*(i-h)+h;m=Wt(D,s,u-p*s,p,s)}return be(m[0],m[1])*o}function Ji(D,s,h,i,o){var m=[0,0];if(this.thread.x<s){var u=this.thread.x/s*(i-h)+h;m=tt(D,s,u)}else{var p=Math.floor(this.thread.x/s),u=(this.thread.x-p*s)/s*(i-h)+h;m=jt(D,s,u-p*s,p)}return be(m[0]*2,m[1]*2)*o}function Zi(D,s,h,i,o){var m=[0,0];if(this.thread.x<s){var u=this.thread.x/s*(i-h)+h;m=it(D,s,u)}else{var p=Math.floor(this.thread.x/s),u=(this.thread.x-p*s)/s*(i-h)+h;m=Ht(D,s,u-p*s,p)}return be(m[0]*2,m[1]*2)*o}function Qi(D,s,h,i){for(var o=h*Math.floor(this.thread.x/s),m=D[o][this.thread.x],u=0;u<h;u++)m*=D[u][this.thread.x];return m*i}function qi(D,s,h,i,o){let m=(Math.sqrt(o)-1)/2,u=2*m+1,p=0,d=0,f=0,r=-m,a=0;for(;r<=m;){if(this.thread.x+r<0||this.thread.x+r>=s){r++;continue}let t=-m;for(;t<=m;){if(this.thread.y+t<0||this.thread.y+t>=h){t++;continue}a=(t+m)*u+r+m;let n=i[a],g=D[this.thread.y+r][this.thread.x+t];p+=g.r*n,d+=g.g*n,f+=g.b*n,t++}r++}this.color(p,d,f)}function en(D,s,h,i,o,m){let u=0,p=0,d=0;for(var f=0;f<m;f++){let r=o[f],a=(Math.sqrt(r)-1)/2,t=2*a+1,n=-a,g=0;for(;n<=a;){if(this.thread.x+n<0||this.thread.x+n>=s){n++;continue}let v=-a;for(;v<=a;){if(this.thread.y+v<0||this.thread.y+v>=h){v++;continue}g=(v+a)*t+n+a;let k=i[f][g],T=D[this.thread.y+n][this.thread.x+v];u+=T.r*k,p+=T.g*k,d+=T.b*k,v++}n++}}this.color(u,p,d)}function tn(D){return D[this.thread.y][this.thread.x]}var ye={correlogramsKern:Ni,correlogramsPCKern:Oi,dftKern:zi,idftKern:Pi,fftKern:Ut,ifftKern:Bt,dft_windowedKern:Bi,idft_windowedKern:ji,fft_windowedKern:Wi,ifft_windowedKern:Hi,listdft2DKern:Ki,listdft1DKern:Gi,listfft1DKern:Ui,listfft1D_windowedKern:Yi,listdft1D_windowedKern:Xi,listidft1D_windowedKern:Ji,listifft1D_windowedKern:Zi,bulkArrayMulKern:Qi,fftKern:Ut,ifftKern:Bt,multiImgConv2DKern:en,ImgConv2DKern:qi,transpose2DKern:tn},Xt=[wi,Ei,Ai,ki,Ii,Di,Ci,Fi,be,Ri,Li,dt,mt,Mi,$i,gt,Vi,Ne,xt,tt,jt,Ke,it,Ht];function ge(D,s,h={setDynamicOutput:!0,setDynamicArguments:!0,setPipeline:!0,setImmutable:!0,setGraphical:!1}){let i=D.createKernel(s);return h.setDynamicOutput&&i.setDynamicOutput(!0),h.output&&i.setOutput(h.output),h.setDynamicArguments&&i.setDynamicArguments(!0),h.setPipeline&&i.setPipeline(!0),h.setImmutable&&i.setImmutable(!0),h.setGraphical&&i.setGraphical(!0),i}function nn(D,s,h={output:[300,300],setDynamicArguments:!0,setDynamicOutput:!0,setPipeline:!1,setImmutable:!0,setGraphical:!0},i){let o=ge(D,s,h),m=o.canvas;return typeof i=="string"?document.getElementById(toAppend).appendChild(m):i?toAppend.appendChild(m):document.body.appendChild(m),o}var nt=class{constructor(s=new GPU){this.gpu=s,this.kernels=new Map,this.kernel,this.PI=3.141592653589793,this.SQRT1_2=.7071067811865476,this.addFunctions(),this.imgkernels={edgeDetection:[-1,-1,-1,-1,8,-1,-1,-1,-1],boxBlur:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],sobelLeft:[1,0,-1,2,0,-2,1,0,-1],sobelRight:[-1,0,1,-2,0,2,-1,0,1],sobelTop:[1,2,1,0,0,0,-1,-2,-1],sobelBottom:[-1,2,1,0,0,0,1,2,1],identity:[0,0,0,0,1,0,0,0,0],gaussian3x3:[1,2,1,2,4,2,1,2,1],guassian7x7:[0,0,0,5,0,0,0,0,5,18,32,18,5,0,0,18,64,100,64,18,0,5,32,100,100,100,32,5,0,18,64,100,64,18,0,0,5,18,32,18,5,0,0,0,0,5,0,0,0],emboss:[-2,-1,0,-1,1,1,0,1,2],sharpen:[0,-1,0,-1,5,-1,0,-1,0]}}addFunction(s=function(){}){this.gpu.addFunction(s)}addKernel(s="",h=function(){},i){return this.kernels.get(s)?(console.error("Kernel already exists"),!1):(this.kernels.set(s,ge(this.gpu,h,i)),!0)}addCanvasKernel(s,h,i,o){if(this.kernels.get(s))return console.error("Kernel already exists"),!1;{let u=nn(this.gpu,h,i,o);return this.kernels.set(s,u),u}}combineKernels(s,h=[],i=function(){}){if(this.kernels.get(s))return console.error("Kernel already exists"),!1;{h.forEach((u,p)=>{if(typeof u=="string"){let d=this.kernels.get(u);if(d)h[p]=d;else return!1}else typeof u=="function"&&(this.kernels.get(u.name)||this.addKernel(u.name,u))});let m=this.gpu.combineKernels(...h,i);return this.kernels.set(s,m),m}}callKernel(s="",h=[]){let i,o=this.kernels.get(s);return o?(i=o(...h),i):(console.error("Kernel not found"),!1)}callCanvasKernel(s="",h=[],i=[]){let o,m=this.kernels.get(s);return m?(i.length===2&&m.setOutput(i),o=m(...h),o):(console.error("Kernel not found"),!1)}hasKernel(s=""){return!!this.kernels.get(s)}addFunctions(){Xt.forEach(o=>this.gpu.addFunction(o)),this.correlograms=ge(this.gpu,ye.correlogramsKern),this.correlogramsPC=ge(this.gpu,ye.correlogramsPCKern),this.dft=ge(this.gpu,ye.dftKern),this.idft=ge(this.gpu,ye.idftKern),this.dft_windowed=ge(this.gpu,ye.dft_windowedKern),this.idft_windowed=ge(this.gpu,ye.idft_windowedKern),this.fft=ge(this.gpu,ye.fftKern),this.ifft=ge(this.gpu,ye.ifftKern),this.fft_windowed=ge(this.gpu,ye.fft_windowedKern),this.ifft_windowed=ge(this.gpu,ye.ifft_windowedKern),this.listdft2D=ge(this.gpu,ye.listdft2DKern),this.listdft1D=ge(this.gpu,ye.listdft1DKern),this.listdft1D_windowed=ge(this.gpu,ye.listdft1D_windowedKern),this.listfft1D=ge(this.gpu,ye.listfft1DKern),this.listfft1D_windowed=ge(this.gpu,ye.listfft1D_windowedKern),this.listidft1D_windowed=ge(this.gpu,ye.listidft1D_windowedKern),this.listifft1D_windowed=ge(this.gpu,ye.listifft1D_windowedKern),this.bulkArrayMul=ge(this.gpu,ye.bulkArrayMulKern),[{name:"correlograms",krnl:this.correlograms},{name:"correlogramsPC",krnl:this.correlogramsPC},{name:"dft",krnl:this.dft},{name:"idft",krnl:this.idft},{name:"dft_windowed",krnl:this.idft_windowed},{name:"fft",krnl:this.fft},{name:"ifft",krnl:this.ifft},{name:"fft_windowed",krnl:this.fft_windowed},{name:"ifft_windowed",krnl:this.ifft_windowed},{name:"listdft2D",krnl:this.listdft2D},{name:"listdft1D",krnl:this.listdft1D},{name:"listdft1D_windowed",krnl:this.listdft1D_windowed},{name:"listfft1D",krnl:this.listfft1D},{name:"listfft1D_windowed",krnl:this.listfft1D_windowed},{name:"listidft1D_windowed",krnl:this.listidft1D_windowed},{name:"listifft1D_windowed",krnl:this.listifft1D_windowed},{name:"bulkArrayMul",krnl:this.bulkArrayMul}].forEach(o=>{this.kernels.set(o.name,o)});let h=(o,m,u,p,d)=>{var f=this.fft_windowed(o,m,u,p,d,0),r=this.ifft_windowed(f,m,u,p,d);return r},i=(o,m,u,p,d)=>{var f=this.listdft1D_windowed(o,m,u,p,d,new Array(Math.ceil(o/m)).fill(0)),r=this.listifft1D_windowed(f,m,u,p,d);return r};this.gpuCoherence=(o,m,u,p,d)=>{var f=this.correlograms(o),r=this.listfft1D_windowed(f,m,u,p,d,new Array(Math.ceil(o/m)).fill(0)),a=this.bulkArrayMul(r,m,5,1);return a}}gpuXCors(s,h=!1,i=!1){var o;if(h===!0){var m=[],u=[];s.forEach((g,v)=>{m.push(g.reduce((k,T)=>T+=k)/g.length),u.push(Math.sqrt(m[v].reduce((k,T)=>k+=Math.pow(T-mean1,2))))});for(var p=[],d=[],f=[],r=0;r<s.length;r++)for(var a=r;a<s.length;a++)f.push(...s[r],...s[a]),p.push(m[r],m[a]),d.push(u[r],u[a]);this.correlogramsPC.setOutput([f.length]),this.correlogramsPC.setLoopMaxIterations(s[0].length*2),o=this.correlogramsPC(f,s[0].length,p,d)}else{for(var f=[],r=0;r<s.length;r++)for(var a=r;a<s.length;a++)f.push(...s[r],...s[a]);this.correlograms.setOutput([f.length]),this.correlograms.setLoopMaxIterations(s[0].length*2),o=this.correlograms(f,s[0].length)}if(i===!0)return o;var t=o.toArray();o.delete();for(var n=[],r=0;r<s.length;r++)n.push(t.splice(0,s[0].length));return n}gpuDFT(s,h,i=1,o=!1){var m=s.length,u=m/h;this.dft.setOutput([s.length]),this.dft.setLoopMaxIterations(m);var p=this.dft(s,m,i),d=null;if(o===!1){var f=this.makeFrequencyDistribution(m,u),r=p.toArray();return p.delete(),[f,this.orderMagnitudes(r)]}else{var a=p;return p.delete(),a}}MultiChannelDFT(s,h,i=1,o=!1){var m=[];s.forEach(n=>{m.push(...n)});var u=s[0].length,p=u/h;this.listdft1D.setOutput([m.length]),this.listdft1D.setLoopMaxIterations(u);var d=this.listdft1D(m,u,i);if(o===!1){var f=[],r=this.makeFrequencyDistribution(u,p);m=d.toArray();for(var a=0;a<m.length;a+=u)f.push(this.orderMagnitudes([...m.slice(a,a+u)]));return d.delete(),[r,f]}else{var t=d;return d.delete(),t}}MultiChannelDFT_Bandpass(s=[],h,i,o,m=1,u=!1){var p=[];s.forEach(n=>{p.push(...n)});var d=o*2,f=s[0].length,r=f/h;this.listdft1D_windowed.setOutput([p.length]),this.listdft1D_windowed.setLoopMaxIterations(f);var a=this.listdft1D_windowed(p,r,i,d,m);if(u===!0)return a;p=a.toArray(),a.delete();var t=this.bandPassWindow(i,o,r);return[t,this.orderBPMagnitudes(p,h,r,f)]}gpuFFT(s,h,i=1,p,m=!1){var u=s.length,p=u/h;this.fft.setOutput([s.length]),this.fft.setLoopMaxIterations(u);var d=this.fft(s,u,i,p),f=null;if(m===!1){var r=this.makeFrequencyDistribution(u,p),a=d.toArray();return d.delete(),[r,this.orderMagnitudes(a)]}else{var t=d;return d.delete(),t}}MultiChannelFFT(s,h,i=1,o=!1){var m=[];s.forEach(n=>{m.push(...n)});var u=s[0].length,p=u/h;this.listfft1D.setOutput([m.length]),this.listfft1D.setLoopMaxIterations(u);var d=this.listfft1D(m,u,i,p);if(o===!1){var f=[],r=this.makeFrequencyDistribution(u,p);m=d.toArray();for(var a=0;a<m.length;a+=u)f.push(this.orderMagnitudes([...m.slice(a,a+u)]));return d.delete(),[r,f]}else{var t=d;return d.delete(),t}}MultiChannelFFT_Bandpass(s=[],h,i,o,m=1,u=!1){var p=[];s.forEach(n=>{p.push(...n)});var d=o*2,f=s[0].length,r=f/h;this.listfft1D_windowed.setOutput([p.length]),this.listfft1D_windowed.setLoopMaxIterations(f);var a=this.listfft1D_windowed(p,r,i,d,m);if(u===!0)return a;p=a.toArray(),a.delete();var t=this.bandPassWindow(i,o,r);return[t,this.orderBPMagnitudes(p,h,r,f)]}orderMagnitudes(s){return[...s.slice(Math.ceil(s.length*.5),s.length),...s.slice(0,Math.ceil(s.length*.5))]}makeFrequencyDistribution(s,h){for(var i=s,o=h/i,m=[],u=-i/2;u<i/2;u++){var p=u*o;m.push(p)}return m}orderBPMagnitudes(s,h,i,o){for(var m=[],u=0;u<s.length;u+=o)m.push([...s.slice(u,Math.ceil(o*.5+u))]);var p=[],d=1/i;return h>1?(m.forEach((f,r)=>{p.push([]);for(var a=1/Math.max(...f),t=0;t<f.length;t++)if(t==0)p[r]=f.slice(t,Math.floor(i)),t=Math.floor(i);else{var n=t-Math.floor(Math.floor(t*d)*i)-1;p[r][n]=p[r][n]*f[t-1]*a}p[r]=[...p[r].slice(0,Math.ceil(p[r].length*.5))]}),p):m}bandPassWindow(s,h,i,o=!0){var m=h*2;let u=(m-s)/i;var p=[];if(o===!0)for(var d=0;d<Math.ceil(.5*i);d+=u)p.push(s+(m-s)*d/i);else for(var d=-Math.ceil(.5*i);d<Math.ceil(.5*i);d+=u)p.push(s+(m-s)*d/i);return p}};var Ge=class{constructor(s){try{this.gpu=new nt}catch{return}this.callbackManager=s,s.gpu=this.gpu,this.callbacks=[{case:"addgpufunc",callback:(h,i,o)=>h.gpu.addFunction(Ee(i[0]))},{case:"addkernel",callback:(h,i,o)=>h.gpu.addKernel(i[0],Ee(i[1]))},{case:"callkernel",callback:(h,i,o)=>h.gpu.callKernel(i[0],i.slice(1))},{case:"dft",callback:(h,i,o)=>(i[2]==null&&(i[2]=1),h.gpu.gpuDFT(...i))},{case:"multidft",callback:(h,i,o)=>(i[2]==null&&(i[2]=1),h.gpu.MultiChannelDFT(...i))},{case:"multidftbandpass",callback:(h,i,o)=>(i[4]==null&&(i[4]=1),h.gpu.MultiChannelDFT_Bandpass(...i))},{case:"fft",callback:(h,i,o)=>(i[2]==null&&(i[2]=1),h.gpu.gpuFFT(...i))},{case:"multifft",callback:(h,i,o)=>(i[2]==null&&(i[2]=1),h.gpu.MultiChannelFFT(...i))},{case:"multifftbandpass",callback:(h,i,o)=>(i[4]==null&&(i[4]=1),h.gpu.MultiChannelFFT_Bandpass(...i))},{case:"gpucoh",callback:(h,i,o)=>h.gpu.gpuCoherence(...i)},{case:"coherence",callback:(h,i,o)=>{let m=q.correlograms(i[0]),u=[...i[0],...m];var p,d=1;p=h.gpu.MultiChannelDFT_Bandpass(u,i[1],i[2],i[3],d);let f=p[1].splice(i[0].length,u.length-i[0].length),r=[],a=i[0].length;var t=0,n=0;f.forEach((v,k)=>{if(n+t===a){var T=f.splice(k,1);t++,f.splice(t,0,...T),n=0}n++});var g=[];return t=0,n=1,f.forEach((v,k)=>{var T=new Array(v.length).fill(0);k<a?(v.forEach((A,E)=>{T[E]=A}),g.push(T)):(v.forEach((A,E)=>{T[E]=A*A/(g[t][E]*g[t+n][E]),T[E]>1&&(T[E]=1)}),n++,n+t===a&&(t++,n=1),r.push(T))}),[p[0],p[1],r]}}],this.addCallbacks()}addCallbacks(s=this.callbacks){s.forEach(h=>{this.callbackManager.addCallback(h.case,h.callback),h.aliases&&h.aliases.forEach(i=>{this.callbackManager.addCallback(i,h.callback)})})}};function Yt(){}var yt=class{addEventListener(s,h){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[s]===void 0&&(i[s]=[]),i[s].indexOf(h)===-1&&i[s].push(h)}hasEventListener(s,h){if(this._listeners===void 0)return!1;let i=this._listeners;return i[s]!==void 0&&i[s].indexOf(h)!==-1}removeEventListener(s,h){if(this._listeners===void 0)return;let o=this._listeners[s];if(o!==void 0){let m=o.indexOf(h);m!==-1&&o.splice(m,1)}}dispatchEvent(s){if(this._listeners===void 0)return;let i=this._listeners[s.type];if(i!==void 0){s.target=this;let o=i.slice(0);for(let m=0,u=o.length;m<u;m++)o[m].call(this,s);s.target=null}}},bt=class extends yt{constructor(){super(),this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}setPointerCapture(){}releasePointerCapture(){}getBoundingClientRect(){return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}}handleEvent(s){if(s.type==="size"){this.left=s.left,this.top=s.top,this.width=s.width,this.height=s.height;return}s.preventDefault=Yt,s.stopPropagation=Yt,this.dispatchEvent(s)}focus(){}},st=class{constructor(){this.id="proxy"+Math.floor(Math.random()*1e4),this.targets={},this.handleEvent=this.handleEvent.bind(this)}makeProxy(s){let{id:h}=s,i=new bt;this.targets[h]=i}getProxy(s){return this.targets[s]}handleEvent(s){this.targets[s.id].handleEvent(s.data)}};var Ue=class{constructor(s){this.callbackManager=s,s.canvas=new OffscreenCanvas(512,512),s.ANIMATION=void 0,s.ANIMATIONFUNC=void 0,s.ANIMATING=!1,s.ANIMFRAMETIME=performance.now(),s.threeUtil=void 0,s.PROXYMANAGER=new st;try{}catch{self.document={}}this.callbacks=[{case:"resizecanvas",callback:(h,i,o)=>(h.canvas.width=i[0],h.canvas.height=i[1],!0)},{case:"proxyHandler",callback:(h,i,o)=>{if(i.type==="makeProxy"){h.PROXYMANAGER.makeProxy(i);let m=h.PROXYMANAGER.getProxy(i.id);m.ownerDocument=m,h[i.id]=m}else if(i.type==="event")h.PROXYMANAGER.handleEvent(i);else return!1;return!0}},{case:"initThree",callback:async(h,i,o)=>{if(h.ANIMATING&&(h.ANIMATING=!1,cancelAnimationFrame(h.ANIMATION)),!h.threeUtil){let m=await et("./lib/workerRenderer/workerThreeUtils.js");h.threeUtil=new m.threeUtil(h.canvas,h,h.PROXYMANAGER.getProxy(i[0])),h.THREE=h.threeUtil.THREE}return typeof i[1]=="object"&&await h.runCallback("setValues",i[1]),i[2]&&(h.threeUtil.setup=Ee(i[2])),i[3]&&(h.threeUtil.draw=Ee(i[3])),i[4]&&(h.threeUtil.clear=Ee(i[4])),h.threeUtil.clear(h,i,o),h.threeUtil.setup(h,i,o),!0}},{case:"startThree",callback:async(h,i,o)=>{if(h.ANIMATING&&(h.ANIMATING=!1,cancelAnimationFrame(h.ANIMATION)),!h.threeUtil){let m=await et("./lib/workerRenderer/workerThreeUtils.js");h.threeUtil=new m.threeUtil(h.canvas,h,h.PROXYMANAGER.getProxy(i[0]))}return h.threeUtil&&(h.threeUtil.clear(h,i,o),h.threeUtil.setup(h,i,o)),!0}},{case:"clearThree",callback:(h,i,o)=>(h.threeUtil&&h.threeUtil.clear(h,i,o),!0)},{case:"setAnimation",callback:(h,i,o)=>(h.animationFunc=Ee(i[0]),!0)},{case:"startAnimation",callback:(h,i,o)=>{let m=()=>{if(h.ANIMATING){h.animationFunc(h,i,o),h.ANIMFRAMETIME=performance.now()-h.ANIMFRAMETIME;let u=h.checkEvents("render",o),p={foo:"render",output:h.ANIMFRAMETIME,origin:o};h.ANIMFRAMETIME=performance.now(),u?h.EVENTS.emit("render",p):postMessage(p),requestAnimationFrame(m)}};return this.ANIMATING?(h.ANIMATING=!1,cancelAnimationFrame(h.ANIMATION),setTimeout(()=>{h.ANIMATING=!0,h.ANIMATION=requestAnimationFrame(m)},300)):(h.ANIMATING=!0,console.log("begin animation"),h.ANIMATION=requestAnimationFrame(m)),!0}},{case:"stopAnimation",callback:(h,i,o)=>h.ANIMATING?(h.ANIMATING=!1,cancelAnimationFrame(h.ANIMATION),!0):!1},{case:"render",callback:(h,i,o)=>{h.animationFunc(h,i,o);let m=performance.now()-h.ANIMFRAMETIME;return tselfhis.ANIMFRAMETIME=performance.now(),m}}],this.addCallbacks()}addCallbacks(s=this.callbacks){s.forEach(h=>{this.callbackManager.addCallback(h.case,h.callback),h.aliases&&h.aliases.forEach(i=>{this.callbackManager.addCallback(i,h.callback)})})}};var rt=class{canvas;ctx;context;constructor(options={cpu:!0,gpu:!0,renderer:!0}){if(this.EVENTS=new qe,this.EVENTSETTINGS=[],this.ID=Math.floor(Math.random()*1e3),this.defaultFunctions=[{case:"ping",callback:(D,s,h)=>"pong"},{case:"list",callback:(D,s,h)=>{let i=[];return this.callbacks.forEach((o,m)=>{i.push(m)}),i}},{case:"addfunc",callback:(D,s,h)=>{if(!s[0]||!s[1])return!1;let i=Ee(s[1]);if(s[2]===!0){let o=async(m,u,p)=>{try{return await i(m,u,p)}catch(d){console.error(d)}};D.callbacks.set(s[0],o)}else D.callbacks.set(s[0],i);return!0}},{case:"removefunc",callback:(D,s,h)=>{if(s[0])return this.removeCallback(s[0])}},{case:"setValues",callback:(D,s,h)=>typeof s=="object"?(Object.keys(s).forEach(i=>{D[i]=s[i],D.threeUtil&&(D.threeUtil[i]=s[i])}),!0):!1},{case:"appendValues",callback:(D,s,h)=>typeof s=="object"?(Object.keys(s).forEach(i=>{D[i]&&Array.isArray(s[i])?D[i].push(s[i]):D[i]=s[i]}),!0):!1},{case:"setValuesFromArrayBuffers",callback:(D,s,h)=>typeof s=="object"?(Object.keys(s).forEach(i=>{s[i].__proto__.__proto__.constructor.name==="TypedArray"?D[i]=Array.from(s[i]):D[i]=s[i]}),!0):!1},{case:"appendValuesFromArrayBuffers",callback:(D,s,h)=>typeof s=="object"?(Object.keys(s).forEach(i=>{!D[i]&&s[i].__proto__.__proto__.constructor.name==="TypedArray"?D[i]=Array.from(s[i]):D[i]?s[i].__proto__.__proto__.constructor.name==="TypedArray"?D[i].push(Array.from(s[i])):Array.isArray(s[i])?D[i].push(s[i]):D[i]=s[i]:D[i]=s[i]}),!0):!1},{case:"transferClassObject",callback:(self,args,origin)=>typeof args=="object"?(Object.keys(args).forEach(key=>{if(typeof args[key]=="string"){let obj=args[key];args[key].indexOf("class")===0&&(obj=eval("("+args[key]+")")),self[key]=obj,self.threeUtil&&(self.threeUtil[key]=obj)}}),!0):!1},{case:"addport",callback:(D,s,h)=>{let i=s[1];i.onmessage=onmessage,this[s[0]]=i}},{case:"addevent",callback:(D,s,h)=>{if(D.EVENTSETTINGS.push({eventName:s[0],case:s[1],port:s[2],origin:h}),s[2]){let i=s[2];i.onmessage=onmessage,this[s[0]+"port"]=i}return!0}},{case:"subevent",callback:(D,s,h)=>{if(typeof s[0]!="string")return!1;let i=Ee(s[1]),o=this.checkEvents(s[0]);return D.EVENTS.subEvent(s[0],m=>{i(D,m,h,o?.port,o?.eventName)})}},{case:"unsubevent",callback:(D,s,h)=>D.EVENTS.unsubEvent(s[0],s[1])}],this.callbacks=new Map,this.defaultFunctions.forEach(D=>{D.case&&this.callbacks.set(D.case,D.callback),D.aliases&&D.aliases.forEach(s=>this.callbacks.set(s,D.callback))}),options.cpu)try{Pe&&(this.workerCPU=new Pe(this))}catch(D){console.error(D)}if(options.gpu)try{Ge&&(this.workerGPU=new Ge(this))}catch(D){console.error(D)}if(options.renderer)try{Ue&&(this.workerRenderer=new Ue(this))}catch(D){console.error(D)}}addCallback=(D,s=(h,i,o)=>{})=>!D||!s?!1:(this.callbacks.set(D,s),!0);removeCallback=D=>this.callbacks.get(D)?(this.callbacks.delete(D),!0):!1;runCallback=async(D,s=[],h)=>{let i,o=this.callbacks.get(D);return o&&(i=await o(this,s,h)),i};checkEvents=(D,s)=>this.EVENTSETTINGS.find(i=>i.origin&&s&&i.case&&D?i.origin===s&&i.case===D:i.case&&D?i.case===D:i.origin&&s?i.origin===s:!1);checkCallbacks=async D=>{let s;if(!D.data)return s;let h;return D.data.case?h=this.callbacks.get(D.data.case):D.data.foo?h=this.callbacks.get(D.data.foo):D.data.command?h=this.callbacks.get(D.data.command):D.data.cmd&&(h=this.callbacks.get(D.data.cmd)),h&&(D.data.input?s=await h(this,D.data.input,D.data.origin):D.data.args?s=await h(this,D.data.args,D.data.origin):s=await h(this,void 0,D.data.origin)),s}};self.onmessage=async D=>{let s;D.data.output?s=D.data.output:s=D.data;let h,i;if(D.data?.eventName)manager.EVENTS.callback(D.data);else if(typeof s=="object"){s.canvas!==void 0&&(manager.canvas=s.canvas),s.context!==void 0&&(manager.ctx=manager.canvas.getContext(s.context),manager.context=manager.ctx);let o=manager.checkEvents(s.foo,s.origin);i=await manager.checkCallbacks(D),counter++;let m;if(i){if(i.__proto__?.__proto__?.constructor.name==="TypedArray")m=[i.buffer];else if(i.constructor?.name==="Object")for(let u in i)i[u].__proto__?.__proto__?.constructor.name==="TypedArray"&&(m?m.push(i[u].buffer):m=i[u].buffer)}h={output:i,foo:s.foo,origin:s.origin,callbackId:s.callbackId,counter},o?manager.EVENTS.emit(o.eventName,h,void 0,m,o.port):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self.postMessage(h,m)}return h};typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&(self.manager=new rt,self.id=`worker_${Math.floor(Math.random()*1e10)}`,self.counter=0,self.manager.EVENTS.emit("newWorker",id));var zn=self;})();\n/**\n * gpu.js\n * http://gpu.rocks/\n *\n * GPU Accelerated JavaScript\n *\n * @version 2.11.0\n * @date Tue Jan 05 2021 15:55:59 GMT-0500 (Eastern Standard Time)\n *\n * @license MIT\n * The MIT License\n *\n * Copyright (c) 2021 gpu.js Team\n */\n')],{type:"text/javascript"})),T=w,k=class{constructor(e=!1,t=!1){this.debug=e,this.listeners=[],this.synchronous=t,this.syncInterval="FRAMERATE",this.syncAnim=void 0,t===!0&&this.startSync()}addListener(e=null,t,r=void 0,n=void 0,s=void 0,l=this.debug,a=!0){if(t===void 0){console.error("You must assign an object");return}var i=e;i==null&&(i=Math.floor(Math.random()*1e5)),this.synchronous===!0&&(a=!1);var o={key:i,listener:new D(t,r,n,s,l,a)};this.listeners.push(o)}getListener(e){return this.listeners.find((t,r)=>{if(t.key===e)return!0})}hasKey(e){var t=!1;return this.listeners.forEach((r,n)=>{if(r.key===e)return t=!0,!0}),t}getKeyIndices(e){var t=[];return this.listeners.find((r,n)=>{r.key===e&&t.push(n)}),t}onchange(e=null,t=null){if(e==null)this.listeners.forEach((n,s)=>{n.listener.onchange=t});else var r=this.listeners.find((n,s)=>{n.name===e&&(n.listener.onchange=t)})}addFunc=(e=null,t=null,r=!0)=>{var n=null;if(t!==null)if(e==null)this.listeners.forEach((l,a)=>{n=l.listener.addFunc(t),l.listener.running==!1&&r==!0&&l.listener.start()});else var s=this.listeners.find((l,a)=>{l.key===e&&(n=l.listener.addFunc(t),l.listener.running==!1&&r==!0&&l.listener.start())});return n};getFuncs=(e=void 0)=>{if(e){var t=this.listeners.find((r,n)=>{if(r.key===e)return!0});return t.onchangeFuncs}else return};removeFuncs=(e=null,t=null,r=!1)=>{if(e==null)this.listeners.forEach((s,l)=>{s.listener.removeFuncs(t)});else var n=this.listeners.find((s,l)=>{s.key===e&&(s.listener.removeFuncs(t),(s.listener.onchangeFuncs.length===0||r===!0)&&s.listener.stop())})};stop(e=null){if(this.synchronous&&this.stopSync(),e==null)this.listeners.forEach((r,n)=>{r.listener.stop()});else var t=this.listeners.find((r,n)=>{r.name===e&&r.listener.stop()})}start(e=null){if(this.synchronous&&this.stopSync(),e==null)this.listeners.forEach((r,n)=>{r.listener.start()});else var t=this.listeners.find((r,n)=>{r.name===e&&r.listener.start()})}startSync(){if(this.synchronous===!1){this.synchronous=!0,this.stop();let e=()=>{this.synchronous===!0&&(this.listeners.forEach(t=>{t.listener.check()}),this.syncInterval==="FRAMERATE"?this.syncAnim=requestAnimationFrame(e):typeof this.syncInterval=="number"&&setTimeout(e,this.syncInterval))};e()}}stopSync(){this.synchronous=!1,this.syncAnim&&cancelAnimationFrame(this.syncAnim)}remove(e=null){if(e==null)this.listeners.forEach(n=>{n.listener.stop()}),this.listeners.splice(0,this.listeners.length);else{var t=[],r=this.listeners.forEach((n,s)=>{n.key===e&&t.push(s)});t.reverse().forEach(n=>{this.listeners[n].listener.stop(),this.listeners.splice(n,1)})}}},D=class{constructor(e,t="__ANY__",r=this.onchange,n="FRAMERATE",s=!1,l=!0){this.debug=s,this.onchange=r,this.onchangeFuncs=[],this.object=e,this.propName=t,this.propOld=void 0,this.setListenerRef(t),this.running=l,this.funcs=0,this.interval,n<10?(this.interval=10,console.log("Min recommended interval set: 10ms")):this.interval=n,l===!0&&(typeof window>"u"?setTimeout(()=>{this.check()},60):this.checker=requestAnimationFrame(this.check))}onchange=e=>{console.log(this.propName," changed from: ",this.propOld," to: ",this.object[this.propName])};addFunc=(e=null)=>{let t=0;return e!==null&&(this.onchangeFuncs.push({idx:this.funcs,onchange:e}),t=this.funcs,this.funcs++),t};removeFuncs(e=null){let t=0;e===null?this.onchangeFuncs=[]:this.onchangeFuncs.find((r,n)=>{if(r.idx===e)return t=n,!0})!==void 0&&this.onchangeFuncs.splice(t,1)}onchangeMulti=e=>{[...this.onchangeFuncs].forEach((t,r)=>{this.debug===!0&&console.log(t.onchange),t.onchange(e)})};setListenerRef=e=>{e==="__ANY__"||e===null||e===void 0?this.propOld=JSON.stringifyFast(this.object):Array.isArray(this.object[e])?this.propOld=JSON.stringifyFast(this.object[e].slice(this.object[e].length-20)):typeof this.object[e]=="object"?this.propOld=JSON.stringifyFast(this.object[e]):typeof this.object[e]=="function"?this.propOld=this.object[e].toString():this.propOld=this.object[e],this.debug===!0&&console.log("propname",e,", new assignment: ",this.propOld)};check=()=>{let e=!1;if(this.propName==="__ANY__"||this.propName===null||this.propName===void 0)this.propOld!==JSON.stringifyFast(this.object)&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object),this.setListenerRef(this.propName),e=!0);else if(Array.isArray(this.object[this.propName]))this.propOld!==JSON.stringifyFast(this.object[this.propName].slice(this.object[this.propName].length-20))&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),e=!0);else if(typeof this.object[this.propName]=="object"){let t=JSON.stringifyFast(this.object[this.propName]);this.propOld!==t&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),e=!0)}else typeof this.object[this.propName]=="function"?this.propOld!==this.object[this.propName].toString()&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName].toString()),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName].toString()),this.setListenerRef(this.propName),e=!0):this.object[this.propName]!==this.propOld&&(this.debug===!0&&console.log("onchange: ",this.onchange),this.onchange(this.object[this.propName]),this.onchangeFuncs.length>0&&this.onchangeMulti(this.object[this.propName]),this.setListenerRef(this.propName),e=!0);return this.running===!0&&(this.debug===!0&&console.log("checking",this.object,this.propName),this.interval==="FRAMERATE"?typeof window>"u"?setTimeout(()=>{this.check()},16):this.checker=requestAnimationFrame(this.check):setTimeout(()=>{this.check()},this.interval)),e};start(){this.running=!0,typeof window>"u"?setTimeout(()=>{this.check()},16):this.checker=requestAnimationFrame(this.check)}stop(){this.running=!1,cancelAnimationFrame(this.checker)}};JSON.stringifyFast===void 0&&(JSON.stringifyFast=function(){let e=new Map,t=[],r=["this"];function n(){e.clear(),t.length=0,r.length=1}function s(a,i){var o=t.length-1;if(t[o]){var c=t[o];if(typeof c=="object")if(c[a]===i||o===0)r.push(a),t.push(i.pushed);else for(;o-->=0;){if(c=t[o],typeof c=="object"&&c[a]===i){o+=2,t.length=o,r.length=o,--o,t[o]=i,r[o]=a;break}o--}}}function l(a,i){let o;if(i!=null)if(typeof i=="object"){let c=i.constructor.name;a&&c==="Object"&&s(a,i);let g=e.get(i);if(g)return"[Circular Reference]"+g;if(e.set(i,r.join(".")),c==="Array")i.length>20?o=i.slice(i.length-20):o=i;else if(c.includes("Set"))o=Array.from(i);else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean")o="instanceof_"+c;else if(c==="Object"){let p={};for(let u in i)if(i[u]==null)p[u]=i[u];else if(Array.isArray(i[u]))i[u].length>20?p[u]=i[u].slice(i[u].length-20):p[u]=i[u];else if(i[u].constructor.name==="Object"){p[u]={};for(let h in i[u])if(Array.isArray(i[u][h]))i[u][h].length>20?p[u][h]=i[u][h].slice(i[u][h].length-20):p[u][h]=i[u][h];else if(i[u][h]!=null){let d=i[u][h].constructor.name;d.includes("Set")?p[u][h]=Array.from(i[u][h]):d!=="Number"&&d!=="String"&&d!=="Boolean"?p[u][h]="instanceof_"+d:p[u][h]=i[u][h]}else p[u][h]=i[u][h]}else{let h=i[u].constructor.name;h.includes("Set")?p[u]=Array.from(i[u]):h!=="Number"&&h!=="String"&&h!=="Boolean"?p[u]="instanceof_"+h:p[u]=i[u]}o=p}else o=i}else o=i;return o}return function(a,i){t.push(a);let o=JSON.stringify(a,l,i);return n(),o}}()),JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=function(){let e=new Map,t=[],r=["this"];function n(){e.clear(),t.length=0,r.length=1}function s(a,i){var o=t.length-1,c=t[o];if(c[a]===i||o===0)r.push(a),t.push(i);else for(;o-->=0;)if(c=t[o],c[a]===i){o+=2,t.length=o,r.length=o,--o,t[o]=i,r[o]=a;break}}function l(a,i){if(i!=null&&typeof i=="object"){a&&s(a,i);let o=e.get(i);if(o)return"[Circular Reference]"+o;e.set(i,r.join("."))}return i}return function(a,i){try{return t.push(a),JSON.stringify(a,l,i)}finally{n()}}}());var I=k,F=class{constructor(e={},t="FRAMERATE",r=!0){this.data=e,this.interval=t,this.pushToState={},this.pushRecord={pushed:[]},this.pushCallbacks={},this.triggers={},this.prev={},this.listener=new I,this.defaultStartListenerEventLoop=r}subscribe(e,t,r=this.defaultStartListenerEventLoop){if(e&&e!=="state")if(this.data[e]===void 0)this.addToState(e,null,t,r);else return this.addSecondaryKeyResponse(e,t,void 0,r);else return this.addSecondaryKeyResponse(e,t,void 0,r)}subscribeOnce(e=void 0,t=r=>{}){let r,n=s=>{t(s),this.unsubscribe(e,r)};r=this.subscribe(e,n)}unsubscribe(e,t=null){t!==null?this.removeSecondaryKeyResponse(e,t,!0):console.error("Specify a subcription function index")}unsubscribeAll(e){this.unsubscribeAllSequential(e),this.unsubscribeAllTriggers(e),this.clearAllKeyResponses(e),this.data[e]&&delete this.data[e],this.listener.hasKey("pushToState")&&this.setSequentialState({stateRemoved:e})}setInterval(e="FRAMERATE"){this.interval=e,this.listener.listeners.forEach((t,r)=>{t.interval=this.interval})}updateState(e,t){this.data[e]==null?this.addToState(e,t):this.data[e]=t}setupSynchronousUpdates=()=>{if(!this.listener.hasKey("pushToState")){let e=()=>{if(Object.keys(this.pushToState).length>0){Object.assign(this.data,this.pushToState);for(let t of Object.getOwnPropertyNames(this.pushToState))delete this.pushToState[t]}};this.listener.addListener("pushToState",this.pushToState,"__ANY__",e,this.interval),this.addToState("pushRecord",this.pushRecord,t=>{let r=t.pushed.length;for(let n=0;n<r;n++){let s=t.pushed[n];this.pushCallbacks.state&&this.pushCallbacks.state.forEach(l=>{l.onchange(s)});for(let l in s)this.pushCallbacks[l]&&this.pushCallbacks[l].forEach(a=>{typeof a=="object"&&a.onchange(s[l])})}this.pushRecord.pushed.splice(0,r)})}};addToState(e,t,r=null,n=this.defaultStartListenerEventLoop,s=!1){if(!this.listener.hasKey("pushToState")&&this.defaultStartListenerEventLoop&&this.setupSynchronousUpdates(),this.data[e]=t,this.setSequentialState({stateAdded:e}),r!==null)return this.addSecondaryKeyResponse(e,r,s,n)}get(e){return this.data[e]}getState(){return JSON.parse(JSON.stringifyFast(this.data))}setState(e={},t=!1){if(!this.listener.hasKey("pushToState")&&this.defaultStartListenerEventLoop&&(this.setupSynchronousUpdates(),this.pushRecord.pushed.push(JSON.parse(JSON.stringifyWithCircularRefs(e)))),e.stateUpdateTimeStamp=Date.now(),t){for(let r in e)if(r in this.pushToState){if(Array.isArray(this.pushToState[r])&&Array.isArray(e[r]))e[r]=this.pushToState[r].push(...e[r]);else if(typeof this.pushToState[r]=="object"&&typeof e[r]=="object"){for(let n in e[r])if(this.pushToState[r][n]){if(Array.isArray(this.pushToState[r][n])&&Array.isArray(e[r][n]))e[r][n]=this.pushToState[r][n].push(...e[r][n]);else if(typeof this.pushToState[r][n]=="object"&&typeof e[r][n]=="object"){for(let s in e[r][n])if(this.pushToState[r][n][s])Array.isArray(this.pushToState[r][n][s])&&Array.isArray(e[r][n][s])&&(e[r][n][s]=this.pushToState[r][n][s].push(...e[r][n][s]));else if(typeof this.pushToState[r][n][s]=="object"&&typeof e[r][n][s]=="object")for(let l in e[r][n][s])this.pushToState[r][n][s][l]&&Array.isArray(this.pushToState[r][n][s][l])&&Array.isArray(e[r][n][s][l])&&(e[r][n][s][l]=this.pushToState[r][n][s][l].push(...e[r][n][s][l]))}}}}}if(Object.assign(this.pushToState,e),Object.keys(this.triggers).length>0){this.triggers.state&&this.triggers.state.forEach(r=>{r.onchange(this.data)});for(let r of Object.getOwnPropertyNames(this.triggers))r in this.pushToState&&(this.data[r]=this.pushToState[r],delete this.pushToState[r],this.triggers[r].forEach(n=>{n.onchange(this.data[r])}))}return this.pushToState}subscribeTrigger(e=void 0,t=r=>{}){if(e){this.triggers[e]||(this.triggers[e]=[]);let r=this.triggers[e].length;return this.triggers[e].push({idx:r,onchange:t}),this.triggers[e].length-1}else return}subscribeTriggerOnce(e=void 0,t=r=>{}){let r,n=s=>{t(s),this.unsubscribeTrigger(e,r)};r=this.subscribeTrigger(e,n)}unsubscribeTrigger(e=void 0,t=0){let r,n=this.triggers[e];n&&n.find(s=>{if(s.idx===t)return!0})&&n.splice(r,1)}unsubscribeAllTriggers(e){e&&this.triggers[e]&&delete this.triggers[e]}setSequentialState(e={}){this.listener.hasKey("pushToState")||this.setupSynchronousUpdates(),e.stateUpdateTimeStamp=Date.now(),this.pushRecord.pushed.push(JSON.parse(JSON.stringify(e)))}subscribeSequential(e=void 0,t=void 0){if(e)if(this.data[e]===void 0&&e!=="state"&&this.addToState(e,null,void 0),this.pushCallbacks[e]||(this.pushCallbacks[e]=[]),t){let r=this.pushCallbacks[e].length;return this.pushCallbacks[e].push({idx:r,onchange:t}),this.pushCallbacks[e].length-1}else return;else return}subscribeSequentialOnce(e=void 0,t=r=>{}){let r,n=s=>{t(s),this.unsubscribeSequential(e,r)};r=this.subscribeSequential(e,n)}unsubscribeSequential(e=void 0,t=0){e&&this.pushCallbacks[e]&&this.pushCallbacks[e].find((r,n)=>{if(r.idx===t)return this.pushCallbacks[e].splice(n,1),!0})}unsubscribeAllSequential(e){e&&this.pushCallbacks[e]&&this.pushCallbacks[e]&&delete this.pushCallbacks[e]}setPrimaryKeyResponse(e=null,t=null,r=!1,n=this.defaultStartListenerEventLoop){if(t!==null)if(this.listener.hasKey(e))this.listener.onchange(e,t);else if(e!=null&&e!=="state")this.listener.addListener(e,this.data,e,t,this.data.stateUpdateInterval,r,n);else{if(!this.listener.hasKey("state")){let s=()=>{this.prev=Object.assign({},this.data)};this.listener.addListener("state",this.data,"__ANY__",s,this.interval)}return this.listener.addFunc("state",t)}}addSecondaryKeyResponse=(e=null,t=null,r=!1,n=this.defaultStartListenerEventLoop)=>{if(t!=null){if(this.listener.hasKey(e))return this.listener.addFunc(e,t);if(e!=null&&e!=="state")return this.listener.addListener(e,this.data,e,()=>{},this.data.stateUpdateInterval,r,n),this.listener.addFunc(e,t);if(!this.listener.hasKey("state")){let s=()=>{this.prev=Object.assign({},this.data)};this.listener.addListener("state",this.data,"__ANY__",s,this.interval)}return this.listener.addFunc("state",t)}};removeSecondaryKeyResponse(e=null,t=null,r=!0){e!==null?this.listener.hasKey(e)?this.listener.removeFuncs(e,t,r):console.error("key does not exist"):console.error("provide key")}clearAllKeyResponses(e=null){e===null?this.listener.remove(null):this.listener.hasKey(e)&&this.listener.remove(e)}getKeySubCallbacks(e){return this.listener.getFuncs(e)}removeState=this.unsubscribeAll;runSynchronousListeners(){this.defaultStartListenerEventLoop=!1,this.listener.startSync()}stop(e=null){this.listener.stop(e)}};JSON.stringifyFast===void 0&&(JSON.stringifyFast=function(){let e=new Map,t=[],r=["this"];function n(){e.clear(),t.length=0,r.length=1}function s(a,i){var o=t.length-1;if(t[o]){var c=t[o];if(typeof c=="object")if(c[a]===i||o===0)r.push(a),t.push(i.pushed);else for(;o-->=0;){if(c=t[o],typeof c=="object"&&c[a]===i){o+=2,t.length=o,r.length=o,--o,t[o]=i,r[o]=a;break}o++}}}function l(a,i){let o;if(i!=null)if(typeof i=="object"){let c=i.constructor.name;a&&c==="Object"&&s(a,i);let g=e.get(i);if(g)return"[Circular Reference]"+g;if(e.set(i,r.join(".")),c==="Array")i.length>20?o=i.slice(i.length-20):o=i;else if(c.includes("Set"))o=Array.from(i);else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean")o="instanceof_"+c;else if(c==="Object"){let p={};for(let u in i)if(i[u]==null)p[u]=i[u];else if(Array.isArray(i[u]))i[u].length>20?p[u]=i[u].slice(i[u].length-20):p[u]=i[u];else if(i[u].constructor.name==="Object"){p[u]={};for(let h in i[u])if(Array.isArray(i[u][h]))i[u][h].length>20?p[u][h]=i[u][h].slice(i[u][h].length-20):p[u][h]=i[u][h];else if(i[u][h]!=null){let d=i[u][h].constructor.name;d.includes("Set")?p[u][h]=Array.from(i[u][h]):d!=="Number"&&d!=="String"&&d!=="Boolean"?p[u][h]="instanceof_"+d:p[u][h]=i[u][h]}else p[u][h]=i[u][h]}else{let h=i[u].constructor.name;h.includes("Set")?p[u]=Array.from(i[u]):h!=="Number"&&h!=="String"&&h!=="Boolean"?p[u]="instanceof_"+h:p[u]=i[u]}o=p}else o=i}else o=i;return o}return function(a,i){t.push(a);let o=JSON.stringify(a,l,i);return n(),o}}()),JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=function(){let e=new Map,t=[],r=["this"];function n(){e.clear(),t.length=0,r.length=1}function s(a,i){var o=t.length-1,c=t[o];if(typeof c=="object")if(c[a]===i||o===0)r.push(a),t.push(i.pushed);else for(;o-->=0;){if(c=t[o],typeof c=="object"&&c[a]===i){o+=2,t.length=o,r.length=o,--o,t[o]=i,r[o]=a;break}o--}}function l(a,i){if(i!=null&&typeof i=="object"){a&&s(a,i);let o=e.get(i);if(o)return"[Circular Reference]"+o;e.set(i,r.join("."))}return i}return function(a,i){try{return t.push(a),JSON.stringify(a,l,i)}finally{n()}}}());var C=class{constructor(e=void 0){this.state=new F({},void 0,!1),this.manager=e,e!==void 0&&(e.responses.find(t=>{if(t.name==="eventmanager")return!0})||e.addCallback("eventmanager",this.callback))}subEvent(e,t=r=>{console.log(e,r)}){return this.state.subscribeTrigger(e,t)}unsubEvent(e,t){return this.state.unsubscribeTrigger(e,t)}async addEvent(e,t=void 0,r=void 0,n=void 0){if(this.state.setState({[e]:void 0}),this.manager!==void 0&&(n!==void 0||r!==void 0))return t!==void 0?await this.manager.post({origin:n,foo:"addevent",input:[e,r]},t):(this.manager.workers.forEach(s=>{this.manager.post({origin:n,foo:"addevent",input:[e,r]},s.id)}),!0)}removeEmitter(e){this.state.unsubscribeAllTriggers(e)}emit=(e,t,r=void 0,n=void 0,s=void 0)=>{let l={eventName:e,output:t};!t||!e||(this.manager!==void 0?r!==void 0?this.manager.post(l,r,n):this.manager.workers.forEach(a=>{this.manager.post(l,a.id,n)}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&(s?s.postMessage(l,void 0,n):globalThis.postMessage(l,void 0,n)),this.state.setState({[e]:t}))};callback=e=>{typeof e=="object"&&e.eventName!==void 0&&e.output!==void 0&&this.state.setState({[e.eventName]:e.output})};export=()=>this},A=class{constructor(e,t,r=void 0,n=void 0,s=void 0,l=void 0,a=`canvas_${Math.round(Math.random()*1e5)}`,i=void 0){if(!t)throw new Error("Input a canvas element or Id");if(this.origin=a,this.workerId=l,this.manager=e,!e)return!1;typeof t=="string"&&(t=document.getElementById(t)),this.canvas=t,this.context=r,this.offscreen,this.workerId||this.initWorker(),typeof s=="object"&&this.manager.postToWorker({foo:"setValues",args:s,origin:this.origin},this.workerId,i),t&&this.setCanvas(t),r&&this.setContext(r),n&&this.setAnimation(n)}setContext(e=this.context){this.context=e,this.manager.postToWorker({context:e,origin:this.origin},this.workerId)}setCanvas(e=this.canvas){this.canvas=e,this.offscreen=e.transferControlToOffscreen(),this.manager.postToWorker({canvas:this.offscreen,origin:this.origin,foo:null},this.workerId,[this.offscreen])}setValues(e=void 0,t=void 0){typeof setValues=="object"&&this.manager.postToWorker({foo:"setValues",input:e,origin:this.origin},this.workerId,t)}setAnimation(e){let t=e;if(typeof e=="function")t=e.toString();else if(typeof e!="string")return!1;this.manager.postToWorker({origin:this.origin,foo:"setAnimation",input:[t]},this.workerId)}addSetup(e){let t=e;typeof e=="function"&&(t=e.toString()),this.manager.postToWorker({origin:this.origin,foo:"addFunc",input:["setupAnim",t]},this.workerId)}setThreeAnimation(e,t){this.manager.postToWorker({origin:this.origin,foo:"initThree",input:[e.toString(),t.toString()]})}startThreeAnimation(){this.manager.postToWorker({origin:this.origin,foo:"startThree",input:[]},this.workerId)}clearThreeAnimation(){this.manager.postToWorker({origin:this.origin,foo:"clearThree",input:[]},this.workerId)}setValues(e={},t=[]){typeof e=="object"&&this.manager.postToWorker({origin:this.origin,foo:"setValues",input:e},this.workerId,t)}startAnimation(){this.manager.postToWorker({origin:this.origin,foo:"startAnimation",input:[]},this.workerId)}stopAnimation(){this.manager.postToWorker({origin:this.origin,foo:"stopAnimation",input:[]},this.workerId)}setCanvasSize(e=this.canvas.width,t=this.canvas.height){this.manager.postToWorker({origin:this.origin,foo:"resizecanvas",input:[e,t]},this.workerId)}initWorker(){!this.workerId&&this.manager&&(this.workerId=this.manager.addWorker(),this.manager.workerResponses.push(this.workeronmessage)),this.setCanvas(),this.setContext()}init(e){this.workerId||this.initWorker(),this.setCanvas(),this.setContext(),e&&this.setAnimation(e)}deinit(){this.manager.terminate(this.workerId)}workeronmessage=e=>{e.origin===this.origin&&console.log("Result: ",e)};test(e="testcanvas"){let t=document.getElementById(e);t||(t=document.createElement("canvas"),t.id=e,document.body.insertAdjacentElement("beforeend",t)),this.canvas=t,this.context="2d",this.init(),this.setValues({x:1,y:2,z:3});function r(n,s,l){n.x||(n.x=1,n.y=2,n.z=3),n.ctx.font="10px serif",n.ctx.fillText(`${n.x} + ${n.y} + ${n.z} = ${n.x+n.y+n.z}`,10,50),n.x++,n.z+=2}this.setAnimation(r),setTimeout(()=>{this.stopAnimation()},1e4)}},R={},y=class{url;responses=[];workers=[];threads=0;threadrot=0;events;subEvent;unsubEvent;addEvent;toResolve={};ProxyElement=x;initProxyElement=S;ThreadedCanvas=A;constructor(e=1,t){this.url=t,this.responses=[],this.workers=[],this.threads=e,this.threadrot=0,this.EVENTS=new C(this),this.subEvent=(n,s=l=>{})=>{this.EVENTS.subEvent(n,s)},this.unsubEvent=(n,s)=>{this.EVENTS.unsubEvent(n,s)},this.addEvent=async(n,s,l,a)=>await this.EVENTS.addEvent(n,s,l,a);let r=0;for(console.log("worker",T);r<e;)this.addWorker(),r++}getWorker(e){return e?this.workers.find(t=>{if(t.id===e)return!0}).worker:this.workers[0].worker}addWorker=(e=this.url,t="module")=>{let r;try{if(e==null)r=new Worker(T);else if(t==="blob")try{let n="worker"+Math.floor(Math.random()*1e10),s=new Blob([this.url],{type:"text/javascript"});r=new Worker(URL.createObjectURL(s)),console.log("Blob worker created!")}catch(n){console.error(n)}else e instanceof URL||(e=new URL(e,R.url)),r=new Worker(e,{name:"worker_"+this.workers.length,type:t})}catch(n){try{console.log("Error creating worker (WARNING: Single Threaded). ERROR:",n)}catch(s){console.error("DummyWorker Error: ",s)}}finally{if(r){let n="worker_"+Math.floor(Math.random()*1e10);return this.workers.push({worker:r,id:n}),r.onmessage=s=>{var l=s.data;let a=this.toResolve[s.data.callbackId];a&&(a(l.output),delete this.toResolve[s.data.callbackId]),this.responses.forEach((i,o)=>{typeof i=="object"?i.callback(l):typeof i=="function"&&i(l)})},r.onerror=s=>{console.error(s)},console.log("magic threads: ",this.workers.length),n}else return}};addCallback(e="",t=r=>{}){e.length>0&&!this.responses.find(r=>{if(typeof r=="object"&&r.name===e)return!0})&&this.responses.push({name:e,callback:t})}removeCallback(e=""){if(e.length>0){let t;this.responses.find((r,n)=>{if(typeof r=="object"&&r.name===e)return t=n,!0})&&t&&this.responses.splice(t,1)}else typeof e=="number"&&this.responses.splice(e,1)}async addFunction(e,t,r,n,s=l=>{}){if(e&&t){typeof t=="function"&&(t=t.toString());let l={foo:"addfunc",args:[e,t],origin:n};return r?await this.post(l,r,s):(this.workers.forEach(a=>{this.post(l,a.id,s)}),!0)}}addWorkerFunction=this.addFunction;async run(e,t,r,n,s,l=a=>{}){if(e){if(e==="transferClassObject"&&typeof t=="object"&&!Array.isArray(t))for(let i in t)typeof t[i]=="object"&&!Array.isArray(t[i])&&(t[i]=t[i].toString());let a={foo:e,args:t,origin:n};return await this.post(a,r,s,l)}}runWorkerFunction=this.run;runFunction=this.run;async setValues(e={},t,r,n){if(t)return await this.run("setValues",e,t,r,n);this.workers.forEach(s=>{this.run("setValues",e,s.id,r,n)})}establishMessageChannel(e,t,r,n,s,l){let a=new MessageChannel,i=a.port1,o=a.port2;this.run("addevent",[e,s,i],t,l,[i]),this.run("addevent",[e,e,o],r,l,[o]),typeof n=="function"&&this.run("subevent",[e,n.toString()],r,l)}post=(e,t,r,n=s=>{})=>new Promise(s=>{typeof e!="object"&&(e={input:e}),Array.isArray(e.input)&&(e.input=e.input.map(a=>typeof a=="function"?a.toString():a));let l=a=>{n&&n(a),s(a)};if(e.callbackId=Math.floor(1e6*Math.random()),this.toResolve[e.callbackId]=l,t==null){let a=this.workers?.[this.threadrot]?.worker;a&&(a.postMessage(e,r),this.threads>1&&(this.threadrot++,this.threadrot>=this.threads&&(this.threadrot=0)))}else this.workers.find(a=>{if(a.id===t)return a.worker.postMessage(e,r),!0})});postToWorker=this.post;terminate(e){if(!e)this.workers.forEach(t=>t.worker.terminate());else{let t;return this.workers.find((r,n)=>{if(r.id===e)return t=n,r.worker.terminate(),!0})&&t?(this.workers.splice(t,1),!0):!1}}close=this.terminate},x=class{constructor(e,t,r,n,s){this.id="proxy"+Math.floor(Math.random()*1e4),this.eventHandlers=n,this.origin=t,this.workerId=r,this.manager=s instanceof y?s:new y;let l=i=>{this.manager.runWorkerFunction("proxyHandler",{type:"event",id:this.id,data:i},this.workerId,this.origin)};this.manager.runWorkerFunction("proxyHandler",{type:"makeProxy",id:this.id},this.workerId,this.origin);for(let[i,o]of Object.entries(this.eventHandlers))e.addEventListener(i,function(c){o(c,l)});let a=()=>{let i=e.getBoundingClientRect();l({type:"size",left:i.left,top:i.top,width:e.clientWidth,height:e.clientHeight})};a(),window.addEventListener("resize",a)}},f=b(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]),L=b(["deltaX","deltaY"]),M=b(["ctrlKey","metaKey","shiftKey","keyCode"]);function N(e,t){e.preventDefault(),L(e,t)}function $(e){e.preventDefault()}function O(e,t,r){for(let n of t)r[n]=e[n]}function b(e){return function(t,r){let n={type:t.type};O(t,e,n),r(n)}}function v(e,t){let r=[],n={type:e.type,touches:r};for(let s=0;s<e.touches.length;++s){let l=e.touches[s];r.push({pageX:l.pageX,pageY:l.pageY})}t(n)}var V={"37":!0,"38":!0,"39":!0,"40":!0};function z(e,t){let{keyCode:r}=e;V[r]&&(e.preventDefault(),M(e,t))}function S(e,t,r){let n={contextmenu:$,mousedown:f,mousemove:f,mouseup:f,pointerdown:f,pointermove:f,pointerup:f,touchstart:v,touchmove:v,touchend:v,wheel:N,keydown:z};return new x(e,r,t,n,this)}typeof globalThis.magic<"u"?Object.assign(globalThis.magic,m):globalThis.magic=m})();})();
